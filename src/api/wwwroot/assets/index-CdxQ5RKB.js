import{c as He,r as c,H as es,L as ts,a as jt,j as e,X as et,R as je,E as gt,b as tt,T as Ue,G as Mt,d as mt,C as Bt,P as Re,e as Ee,f as ke,u as ht,F as ss,g as as,h as xt,i as Ot,I as rs,k as _e,l as qe,S as Pt,m as ns,n as Wt,o as is,B as ls,p as os,q as cs,s as dt,t as Lt,v as ds,D as us,w as It,x as gs,y as ms,z as it,M as lt,U as wt,A as hs,J as xs,K as ps,N as fs,O as zt,Q as ys,V as ks,W as bs,Y as vs,Z as Nt,_ as Rt,$ as js,a0 as Ct,a1 as ws,a2 as Ns,a3 as Cs,a4 as Ss,a5 as Fs,a6 as Ts,a7 as Es,a8 as As,a9 as Pe,aa as Ds,ab as $s}from"./vendor-C-gS23U1.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();const Vt=He(t=>({theme:"dark",isSignalRConnected:!1,setTheme:s=>t({theme:s}),setSignalRConnected:s=>t({isSignalRConnected:s})})),We={async getAll(t){return ge("/api/workspaces",t)},async getById(t,s){return ge(`/api/workspaces/${t}`,s)},async create(t,s){return ue("/api/workspaces",t,s)},async update(t,s,a){return Se(`/api/workspaces/${t}`,s,a)},async delete(t,s){return Fe(`/api/workspaces/${t}`,s)},async getGitBranches(t,s){return ge(`/api/workspaces/${t}/git/branches`,s)}},Z={async getAll(t){return ge("/api/sessions",t)},async getById(t,s){return ge(`/api/sessions/${t}`,s)},async getByWorkspaceId(t,s){return ge(`/api/workspaces/${t}/sessions`,s)},async create(t,s){return ue("/api/sessions",t,s)},async update(t,s,a){return Se(`/api/sessions/${t}`,s,a)},async delete(t,s){return Fe(`/api/sessions/${t}`,s)},async getFiles(t,s,a){const n=s?`?folderPath=${encodeURIComponent(s)}`:"";return ge(`/api/sessions/${t}/files${n}`,a)},async getFileContent(t,s,a){return ge(`/api/sessions/${t}/files/content?filePath=${encodeURIComponent(s)}`,a)},async updateFileContent(t,s,a,n,r){return Se(`/api/sessions/${t}/files/content`,{filePath:s,content:a,lastModified:n},r)},async getGitStatus(t,s){return ge(`/api/sessions/${t}/git/status`,s)},async getGitFileContent(t,s,a,n){const r=a?`&mode=${a}`:"";return ge(`/api/sessions/${t}/git/file?filePath=${encodeURIComponent(s)}${r}`,n)},async unstageAllChanges(t,s){return ue(`/api/sessions/${t}/git/unstage-all`,{},s)},async unstageFile(t,s,a){return ue(`/api/sessions/${t}/git/unstage-file`,{filePath:s},a)},async discardAllChanges(t,s){return ue(`/api/sessions/${t}/git/discard-all`,{},s)},async discardFileChanges(t,s,a){return ue(`/api/sessions/${t}/git/discard-file`,{filePath:s},a)},async stageAllChanges(t,s){return ue(`/api/sessions/${t}/git/stage-all`,{},s)},async stageFile(t,s,a){return ue(`/api/sessions/${t}/git/stage-file`,{filePath:s},a)},async getAvailableEditors(t,s){return ge(`/api/sessions/${t}/editors`,s)},async openFileWithEditor(t,s,a,n){return ue(`/api/sessions/${t}/files/open`,{filePath:s,editorId:a},n)},async openFileFolder(t,s,a){return ue(`/api/sessions/${t}/files/open-folder`,{filePath:s},a)},async createFile(t,s,a,n){return ue(`/api/sessions/${t}/files`,{filePath:s,content:a},n)},async createFolder(t,s,a){return ue(`/api/sessions/${t}/folders`,{folderPath:s},a)},async renameFile(t,s,a,n){return Se(`/api/sessions/${t}/files/rename`,{oldPath:s,newName:a},n)},async deleteFile(t,s,a){return Fe(`/api/sessions/${t}/files?filePath=${encodeURIComponent(s)}`,a)},async mergeToMain(t,s){return ue(`/api/sessions/${t}/actions/merge-to-main`,{},s)},async pushBranch(t,s){return ue(`/api/sessions/${t}/actions/push-branch`,{},s)},async pullFromStarterBranch(t,s){return ue(`/api/sessions/${t}/actions/pull-from-starter`,{},s)},async resetSession(t,s){return ue(`/api/sessions/${t}/actions/reset`,{},s)},async cancelSession(t,s){return ue(`/api/sessions/${t}/actions/cancel`,{},s)},async stopWorkingMessages(t,s){return ue(`/api/sessions/${t}/actions/stop`,{},s)},async openWithVSCode(t,s){return ue(`/api/sessions/${t}/actions/open-with-vscode`,{},s)},async cancelMessage(t,s,a){return ue(`/api/sessions/${t}/actions/stop?messageId=${s}`,{},a)},async getTasks(t,s){return ge(`/api/sessions/${t}/tasks`,s)},async startTask(t,s,a){return ue(`/api/sessions/${t}/tasks/${s}/start`,{},a)},async clearUnreadMessages(t,s){return ue(`/api/sessions/${t}/clear-unread`,{},s)}},Ye={async getBySessionId(t,s){return ge(`/api/sessions/${t}/messages`,s)},async getById(t,s,a){return ge(`/api/sessions/${t}/messages/${s}`,a)},async send(t,s,a){return ue(`/api/sessions/${t}/messages/send`,s,a)},async update(t,s,a,n){return Se(`/api/sessions/${t}/messages/${s}`,a,n)},async delete(t,s,a){return Fe(`/api/sessions/${t}/messages/${s}`,a)}},Me={async getAll(t){return ge("/api/agents",t)},async getById(t,s){return ge(`/api/agents/${t}`,s)},async create(t,s){return ue("/api/agents",t,s)},async update(t,s,a){return Se(`/api/agents/${t}`,s,a)},async delete(t,s){return Fe(`/api/agents/${t}`,s)}},pt=(t,s,a)=>ue(`/api/sessions/${t}/actions/deploy-to-environment?environmentId=${s}${a?"&restartAfterSync=true":""}`),Le={async getByWorkspaceId(t,s){return ge(`/api/workspaces/${t}/environments`,s)},async getById(t,s){return ge(`/api/environments/${t}`,s)},async create(t,s,a){return ue(`/api/workspaces/${t}/environments`,s,a)},async update(t,s,a){return Se(`/api/environments/${t}`,s,a)},async delete(t,s){return Fe(`/api/environments/${t}`,s)},async validateGitBranch(t,s,a){return ge(`/api/workspaces/${t}/environments/validate-branch/${encodeURIComponent(s)}`,a)},async getTasks(t,s){return ge(`/api/environments/${t}/tasks`,s)},async startTask(t,s,a){return ue(`/api/environments/${t}/tasks/${s}/start`,{},a)},async reset(t,s){return ue(`/api/environments/${t}/reset`,{},s)}},Ke={async getByWorkspaceId(t,s){return ge(`/api/workspaces/${t}/variables`,s)},async create(t,s,a){return ue(`/api/workspaces/${t}/variables`,s,a)},async update(t,s,a,n){return Se(`/api/workspaces/${t}/variables/${encodeURIComponent(s)}`,a,n)},async delete(t,s,a){return Fe(`/api/workspaces/${t}/variables/${encodeURIComponent(s)}`,a)}},Ce={async getByWorkspaceId(t,s){return ge(`/api/workspaces/${t}/tasks`,s)},async getById(t,s){return ge(`/api/tasks/${t}`,s)},async create(t,s,a){return ue(`/api/workspaces/${t}/tasks`,s,a)},async update(t,s,a){return Se(`/api/tasks/${t}`,s,a)},async delete(t,s){return Fe(`/api/tasks/${t}`,s)},async stopTask(t,s){return ue(`/api/tasks/${t}/stop`,{},s)},async getTaskOutput(t,s){return ge(`/api/tasks/${t}/output`,s)}},De={async getAll(t){return ge("/api/backlogs",t)},async getById(t,s){return ge(`/api/backlogs/${t}`,s)},async create(t,s){return ue("/api/backlogs",t,s)},async update(t,s,a){return Se(`/api/backlogs/${t}`,s,a)},async delete(t,s){return Fe(`/api/backlogs/${t}`,s)}},Ve={async getAll(t){return ge("/api/mcps",t)},async getById(t,s){return ge(`/api/mcps/${t}`,s)},async create(t,s){return ue("/api/mcps",t,s)},async update(t,s,a){return Se(`/api/mcps/${t}`,s,a)},async delete(t,s){return Fe(`/api/mcps/${t}`,s)}},Ut={getStartupData:()=>ge("/api/startup")};async function ge(t,s){return st("GET",t,void 0,s)}async function ue(t,s,a){return st("POST",t,s,a)}async function Se(t,s,a){return st("PUT",t,s,a)}async function Fe(t,s){return st("DELETE",t,void 0,s)}async function st(t,s,a,n){if(n?.sessionCache){const r=sessionStorage.getItem(s);if(r)return JSON.parse(r)}if(n?.querystring){const r=Object.keys(n.querystring).filter(i=>n.querystring[i]!=null);if(r.length>0){const i=r.map(o=>{const l=n.querystring?.[o];return`${encodeURIComponent(o)}=${encodeURIComponent(l)}`}).join("&");s+=`?${i}`}}try{const r=await fetch(s,{method:t,body:t!=="GET"&&a?JSON.stringify(a):void 0,credentials:"include",headers:{"Content-Type":"application/json"}});if(r.status===401)throw new Error("Unauthorized");if(!r.ok)throw r;if(r.status===204)return null;const i=r.headers.get("Content-Type")?.includes("application/json")?await r.json():await r.text();return n?.sessionCache&&sessionStorage.setItem(s,JSON.stringify(i)),i}catch(r){if(n?.ignoreErrors)return null;throw r}}const Ms=Object.freeze(Object.defineProperty({__proto__:null,agentsApi:Me,environmentsApi:Le,fetchDelete:Fe,fetchGet:ge,fetchPost:ue,fetchPut:Se,mcpsApi:Ve,messagesApi:Ye,sessionsApi:Z,startupApi:Ut,tasksApi:Ce,workspaceEnvironmentVariablesApi:Ke,workspacesApi:We},Symbol.toStringTag,{value:"Module"})),ut="polygent-active-workspace-id",Bs=()=>{try{const t=localStorage.getItem(ut);return t?parseInt(t):null}catch{return null}},Os=t=>{try{t?localStorage.setItem(ut,t.toString()):localStorage.removeItem(ut)}catch{}},fe=He((t,s)=>({workspaces:[],sessions:[],environments:[],tasks:[],activeWorkspaceId:Bs(),activeSessionId:null,sessionStates:{},sessionTabStates:{},sessionTabs:{},sessionActiveTabIds:{},loadWorkspaces:async()=>{try{const a=await We.getAll();t({workspaces:a})}catch(a){console.error("Failed to load workspaces:",a)}},loadSessions:async a=>{try{let n;a?n=await Z.getByWorkspaceId(a):n=await Z.getAll(),t({sessions:n})}catch(n){console.error("Failed to load sessions:",n)}},setWorkspaces:a=>t({workspaces:a}),addWorkspace:a=>{const{workspaces:n}=s();t({workspaces:[...n,a]})},updateWorkspace:(a,n)=>{const{workspaces:r}=s();t({workspaces:r.map(i=>i.id===a?n:i)})},removeWorkspace:a=>{const{workspaces:n}=s();t({workspaces:n.filter(r=>r.id!==a)})},setSessions:a=>t({sessions:a}),addSession:a=>{const{sessions:n}=s();t({sessions:[...n,a]})},updateSession:a=>{const{sessions:n}=s();t({sessions:n.map(r=>r.id===a.id?a:r)})},removeSession:a=>{const{sessions:n}=s();t({sessions:n.filter(r=>r.id!==a)})},setSessionStatus:(a,n,r)=>{const{sessions:i}=s();t({sessions:i.map(o=>o.id===a?{...o,status:n,...r!==void 0&&{unreadCount:r}}:o)})},clearUnreadMessages:a=>{const{sessions:n}=s();t({sessions:n.map(r=>r.id===a?{...r,hasUnreadMessage:!1}:r)})},setSessionUnreadMessage:(a,n)=>{const{sessions:r}=s();t({sessions:r.map(i=>i.id===a?{...i,hasUnreadMessage:n}:i)})},setEnvironments:a=>t({environments:a}),setTasks:a=>t({tasks:a}),setActiveWorkspaceId:a=>{Os(a),t({activeWorkspaceId:a})},setActiveSessionId:a=>t({activeSessionId:a}),getSession:a=>{const{sessions:n}=s();return n.find(r=>r.id===a)},getSessionState:a=>{const{sessionStates:n}=s();return n[a]},setSessionState:(a,n)=>{const{sessionStates:r}=s();t({sessionStates:{...r,[a]:n}})},getTabState:a=>{const{sessionTabStates:n}=s();return n[a]},getSessionTabs:a=>{const{sessionTabs:n}=s();return n[a]||[{id:"chat",content:{type:"chat"},title:"Chat"}]},getSessionActiveTabId:a=>{const{sessionActiveTabIds:n}=s();return n[a]||"chat"},getTabContentById:(a,n)=>{const{sessionTabs:r}=s();return(r[a]||[{id:"chat",content:{type:"chat"},title:"Chat"}]).find(l=>l.id===n)?.content},setSessionTabs:(a,n)=>{const{sessionTabs:r}=s();t({sessionTabs:{...r,[a]:n}})},setSessionActiveTabId:(a,n)=>{const{sessionActiveTabIds:r}=s();t({sessionActiveTabIds:{...r,[a]:n}})},setTabContent:(a,n,r)=>{const{sessionTabs:i}=s(),l=(i[a]||[{id:"chat",content:{type:"chat"},title:"Chat"}]).map(d=>d.id===n?{...d,content:r}:d);t({sessionTabs:{...i,[a]:l}})},addSessionTab:(a,n)=>{const{sessionTabs:r}=s(),i=r[a]||[{id:"chat",content:{type:"chat"},title:"Chat"}];t({sessionTabs:{...r,[a]:[...i,n]}})},removeSessionTab:(a,n)=>{const{sessionTabs:r,sessionActiveTabIds:i}=s(),l=(r[a]||[]).filter(m=>m.id!==n),d=i[a],g=d===n?"chat":d;t({sessionTabs:{...r,[a]:l},sessionActiveTabIds:{...i,[a]:g}})},resetSessionTabs:a=>{const{sessionTabs:n,sessionActiveTabIds:r}=s();t({sessionTabs:{...n,[a]:[{id:"chat",content:{type:"chat"},title:"Chat",isDirty:!1}]},sessionActiveTabIds:{...r,[a]:"chat"}})},getTabDirty:(a,n)=>{const{sessionTabs:r}=s();return(r[a]||[]).find(l=>l.id===n)?.isDirty||!1},setTabDirty:(a,n,r)=>{const{sessionTabs:i}=s(),l=(i[a]||[]).map(d=>d.id===n?{...d,isDirty:r}:d);t({sessionTabs:{...i,[a]:l}})},refreshDiffTabs:a=>{const{sessionTabs:n}=s(),i=(n[a]||[]).map(o=>o.content.type==="diff"?{...o,content:{...o.content,lastRefresh:Date.now()}}:o);t({sessionTabs:{...n,[a]:i}})},initializeSessionTabs:a=>{const{sessionTabs:n,sessionActiveTabIds:r}=s();if(!n[a]){const i={id:"chat",content:{type:"chat"},title:"Chat",isDirty:!1};t({sessionTabs:{...n,[a]:[i]},sessionActiveTabIds:{...r,[a]:"chat"}})}}}));var he=(t=>(t[t.InMind=1]="InMind",t[t.Ready=2]="Ready",t[t.InProgress=3]="InProgress",t[t.Done=4]="Done",t[t.Canceled=5]="Canceled",t))(he||{}),be=(t=>(t[t.Ready=1]="Ready",t[t.Waiting=2]="Waiting",t[t.InProgress=3]="InProgress",t[t.Done=4]="Done",t[t.Canceled=5]="Canceled",t))(be||{}),ye=(t=>(t[t.System=1]="System",t[t.User=2]="User",t[t.Agent=3]="Agent",t[t.Tool=4]="Tool",t))(ye||{}),Ne=(t=>(t[t.Pending=1]="Pending",t[t.Working=2]="Working",t[t.Done=3]="Done",t[t.Failed=4]="Failed",t[t.Canceled=5]="Canceled",t))(Ne||{}),pe=(t=>(t[t.Build=1]="Build",t[t.Test=2]="Test",t[t.Start=3]="Start",t))(pe||{}),ve=(t=>(t[t.Bash=1]="Bash",t[t.PowerShell=2]="PowerShell",t[t.NodeJs=3]="NodeJs",t))(ve||{}),le=(t=>(t[t.Pending=1]="Pending",t[t.Running=2]="Running",t[t.Completed=3]="Completed",t[t.Failed=4]="Failed",t[t.Canceled=5]="Canceled",t))(le||{}),Be=(t=>(t[t.HttpStreaming=1]="HttpStreaming",t[t.Sse=2]="Sse",t[t.Stdio=3]="Stdio",t))(Be||{}),Ie=(t=>(t[t.Added=0]="Added",t[t.Modified=1]="Modified",t[t.Deleted=2]="Deleted",t[t.Renamed=3]="Renamed",t[t.Copied=4]="Copied",t))(Ie||{});function St(t,s){return`${s?"session":"env"}-${t}`}const Je=He((t,s)=>({taskExecutions:{},taskExecutionsMap:{},setTaskExecution:(a,n)=>{const{taskExecutions:r}=s(),i=r[a]||{taskExecutionId:a,output:"",status:le.Pending};t({taskExecutions:{...r,[a]:{...i,...n,taskExecutionId:a}}})},updateTaskOutput:(a,n)=>{const{taskExecutions:r}=s(),i=r[a];i&&t({taskExecutions:{...r,[a]:{...i,output:n}}})},updateTaskStatus:(a,n)=>{const{taskExecutions:r}=s(),i=r[a],o=new Date,l={status:n};(n===le.Completed||n===le.Failed||n===le.Canceled)&&(l.endTime=o),n===le.Running&&!i?.startTime&&(l.startTime=o),t({taskExecutions:{...r,[a]:{...i,...l}}})},getTaskExecution:a=>{const{taskExecutions:n}=s();return n[a]},mapTaskToExecution:(a,n,r)=>{const{taskExecutionsMap:i}=s(),o=St(a,n);t({taskExecutionsMap:{...i,[o]:r}})},getTaskExecutionId:(a,n)=>{const{taskExecutionsMap:r}=s();return r[St(a,n)]}})),ft=He((t,s)=>({environmentsByWorkspace:{},loading:{},error:{},loadEnvironments:async a=>{t(n=>({loading:{...n.loading,[a]:!0},error:{...n.error,[a]:null}}));try{const n=await Le.getByWorkspaceId(a);t(r=>({environmentsByWorkspace:{...r.environmentsByWorkspace,[a]:n||[]},loading:{...r.loading,[a]:!1}}))}catch(n){const r=n instanceof Error?n.message:"Failed to load environments";t(i=>({loading:{...i.loading,[a]:!1},error:{...i.error,[a]:r}}))}},setEnvironments:(a,n)=>{t(r=>({environmentsByWorkspace:{...r.environmentsByWorkspace,[a]:n}}))},addEnvironment:(a,n)=>{t(r=>{const i=r.environmentsByWorkspace[a]||[];return{environmentsByWorkspace:{...r.environmentsByWorkspace,[a]:[...i,n]}}})},updateEnvironment:(a,n)=>{t(r=>{const i=r.environmentsByWorkspace[a]||[];return{environmentsByWorkspace:{...r.environmentsByWorkspace,[a]:i.map(o=>o.id===n.id?n:o)}}})},removeEnvironment:(a,n)=>{t(r=>{const i=r.environmentsByWorkspace[a]||[];return{environmentsByWorkspace:{...r.environmentsByWorkspace,[a]:i.filter(o=>o.id!==n)}}})},clearEnvironments:a=>{t(n=>({environmentsByWorkspace:{...n.environmentsByWorkspace,[a]:[]}}))},getEnvironmentsByWorkspace:a=>s().environmentsByWorkspace[a],getEnvironmentById:a=>{const{environmentsByWorkspace:n}=s();for(const r of Object.values(n)){const i=r.find(o=>o.id===a);if(i)return i}},isLoading:a=>s().loading[a]||!1,getError:a=>s().error[a]||null})),yt=He((t,s)=>({editors:[],isInitialized:!1,isInitializing:!1,initError:null,initialize:async()=>{const{isInitialized:a,isInitializing:n}=s();if(!(a||n)){t({isInitializing:!0,initError:null});try{const r=await Ut.getStartupData(),i=fe.getState(),o=ft.getState();i.setWorkspaces(r.workspaces);const l={};r.environments.forEach(d=>{l[d.workspaceId]||(l[d.workspaceId]=[]),l[d.workspaceId].push(d)}),Object.entries(l).forEach(([d,g])=>{o.setEnvironments(parseInt(d),g)}),t({editors:r.availableEditors,isInitialized:!0,isInitializing:!1,initError:null})}catch(r){console.error("Failed to initialize application:",r),t({isInitializing:!1,initError:r instanceof Error?r.message:"Failed to initialize application"})}}},clearInitError:()=>t({initError:null})}));function Gt(){const{theme:t,setTheme:s}=Vt();return c.useEffect(()=>{const n=localStorage.getItem("polygent-theme");n&&["light","dark","system"].includes(n)&&s(n)},[s]),c.useEffect(()=>{const n=document.documentElement,r=i=>{i?n.classList.add("dark"):n.classList.remove("dark")};if(t==="dark")r(!0);else if(t==="light")r(!1);else{const i=window.matchMedia("(prefers-color-scheme: dark)").matches;r(i);const o=window.matchMedia("(prefers-color-scheme: dark)"),l=d=>{t==="system"&&r(d.matches)};return o.addEventListener("change",l),()=>o.removeEventListener("change",l)}localStorage.setItem("polygent-theme",t)},[t]),{theme:t,setTheme:s,toggleTheme:()=>{s(t==="light"?"dark":t==="dark"?"system":"light")}}}class Ps{connection=null;eventHandlers=new Map;isConnecting=!1;constructor(){this.initializeConnection()}initializeConnection(){this.connection=new es().withUrl("/hub").withAutomaticReconnect().configureLogging(ts.Information).build(),this.setupEventHandlers()}setupEventHandlers(){this.connection&&(this.connection.onclose(()=>{this.notifyHandlers("onDisconnected")}),this.connection.onreconnecting(()=>{this.notifyHandlers("onReconnecting")}),this.connection.onreconnected(()=>{this.notifyHandlers("onReconnected")}),this.connection.on("SessionStatusChanged",(s,a)=>{this.notifyHandlers("onSessionStatusChanged",parseInt(s),parseInt(a))}),this.connection.on("SessionUnreadMessageChanged",(s,a)=>{this.notifyHandlers("onSessionUnreadMessageChanged",parseInt(s),a)}),this.connection.on("MessageReceived",(s,a)=>{this.notifyHandlers("onMessageReceived",parseInt(s),a)}),this.connection.on("MessageStatusChanged",(s,a,n,r,i)=>{this.notifyHandlers("onMessageStatusChanged",parseInt(s),parseInt(a),parseInt(n),r,i)}),this.connection.on("TaskStatusChanged",(s,a,n,r,i)=>{this.notifyHandlers("onTaskStatusChanged",s,a,n,r,i)}),this.connection.on("TaskOutputChanged",(s,a,n,r,i)=>{this.notifyHandlers("onTaskOutputChanged",s,a,n,r,i)}))}async connect(){if(!(!this.connection||this.isConnecting)&&this.connection.state!==jt.Connected)try{this.isConnecting=!0,await this.connection.start(),this.notifyHandlers("onConnected")}catch(s){throw console.error("SignalR connection failed:",s),s}finally{this.isConnecting=!1}}async disconnect(){if(this.connection)try{await this.connection.stop()}catch(s){console.error("SignalR disconnection failed:",s)}}notifyHandlers(s,...a){const n=this.eventHandlers.get(s);n&&n.forEach(r=>{try{r(...a)}catch(i){console.error(`Error in SignalR event handler for ${s}:`,i)}})}on(s,a){this.eventHandlers.has(s)||this.eventHandlers.set(s,new Set);const n=this.eventHandlers.get(s),r=a;return n.add(r),()=>{n.delete(r),n.size===0&&this.eventHandlers.delete(s)}}off(s,a){if(a){const n=this.eventHandlers.get(s);n&&(n.delete(a),n.size===0&&this.eventHandlers.delete(s))}else this.eventHandlers.delete(s)}get isConnected(){return this.connection?.state===jt.Connected}get connectionState(){return this.connection?.state??null}async joinWorkspaceGroup(s){this.isConnected&&await this.connection?.invoke("JoinWorkspaceGroup",s)}async leaveWorkspaceGroup(s){this.isConnected&&await this.connection?.invoke("LeaveWorkspaceGroup",s)}async enterSession(s){this.isConnected&&await this.connection?.invoke("EnterSession",s)}async exitSession(s){this.isConnected&&await this.connection?.invoke("ExitSession",s)}}const de=new Ps;function Ht(t,s={}){const{autoConnect:a=!0,sessionId:n,workspaceId:r}=s,i=c.useRef(t),o=c.useRef(null),l=c.useRef(null);return i.current=t,c.useEffect(()=>{const d=[];return Object.entries(i.current).forEach(([g,m])=>{if(m){const x=de.on(g,m);d.push(x)}}),a&&de.connect().catch(console.error),()=>{d.forEach(g=>g())}},[a]),c.useEffect(()=>{if(n){if(!de.isConnected){const d=()=>{g()},g=de.on("onConnected",d)}return()=>{o.current&&(o.current=null)}}},[n]),c.useEffect(()=>{if(!r)return;const d=l.current,g=async()=>{de.isConnected&&(d&&d!==r&&await de.leaveWorkspaceGroup(d),await de.joinWorkspaceGroup(r),l.current=r)};if(de.isConnected)g();else{const m=()=>{g(),x()},x=de.on("onConnected",m)}return()=>{const m=l.current;m&&(de.leaveWorkspaceGroup(m),l.current=null)}},[r]),{isConnected:de.isConnected,connectionState:de.connectionState,connect:()=>de.connect(),disconnect:()=>de.disconnect(),joinWorkspaceGroup:d=>de.joinWorkspaceGroup(d),leaveWorkspaceGroup:d=>de.leaveWorkspaceGroup(d)}}function Ws(){const{setSignalRConnected:t}=Vt(),{updateTaskStatus:s,updateTaskOutput:a,mapTaskToExecution:n}=Je(),{setSessionStatus:r,setSessionUnreadMessage:i}=fe(),{isConnected:o,connectionState:l}=Ht({onConnected:()=>{t(!0)},onDisconnected:()=>{t(!1)},onReconnecting:()=>{t(!1)},onReconnected:()=>{t(!0)},onTaskStatusChanged(d,g,m,x,u){s(x,u),n(d,m,x)},onTaskOutputChanged(d,g,m,x,u){a(x,u),n(d,m,x)},onSessionStatusChanged(d,g){r(d,g)},onSessionUnreadMessageChanged(d,g){i(d,g)}},{autoConnect:!0});return c.useEffect(()=>{t(o)},[o,t]),{isConnected:o,connectionState:l}}function Ls({sessionId:t,enabled:s=!0,pingInterval:a=1e4}){const n=c.useRef(null),r=c.useRef(!0),{clearUnreadMessages:i}=fe();return c.useEffect(()=>{if(!s||!t)return;const o=async()=>{if(de.isConnected&&r.current){await de.enterSession(t);try{await Z.clearUnreadMessages(t),i(t)}catch(h){console.error("Failed to clear unread messages:",h)}d()}},l=async()=>{de.isConnected&&(await de.exitSession(t),g())},d=()=>{n.current&&clearInterval(n.current),n.current=setInterval(async()=>{if(de.isConnected&&r.current)try{await de.enterSession(t)}catch(h){console.error("Failed to ping session:",h)}},a)},g=()=>{n.current&&(clearInterval(n.current),n.current=null)},m=async()=>{const h=!document.hidden;r.current=h,h?await o():await l()},x=async()=>{r.current=!0,await o()},u=async()=>{r.current=!1,await l()},p=async()=>{await l()},k=()=>{r.current&&o()},b=()=>{g()};document.addEventListener("visibilitychange",m),window.addEventListener("focus",x),window.addEventListener("blur",u),window.addEventListener("beforeunload",p);const w=de.on("onConnected",k),N=de.on("onDisconnected",b);return de.isConnected&&o(),()=>{de.isConnected&&de.exitSession(t).catch(console.error),g(),document.removeEventListener("visibilitychange",m),window.removeEventListener("focus",x),window.removeEventListener("blur",u),window.removeEventListener("beforeunload",p),w(),N()}},[t,s,a]),{enterSession:()=>{if(de.isConnected)return de.enterSession(t)},exitSession:()=>{if(de.isConnected)return de.exitSession(t)}}}function qt(t){const[s,a]=c.useState([]),[n,r]=c.useState(!0),[i,o]=c.useState(!1),[l,d]=c.useState(null),[g,m]=c.useState(null),x=c.useCallback(v=>{a(D=>{const j=D.find(B=>B.id===v.id);let y;if(j){const B=v.updatedAt>j.updatedAt?v.updatedAt:j.updatedAt,G=v.updatedAt>j.updatedAt?v.status:j.status;y=D.map(A=>A.id===v.id?{...A,status:G,content:v.content||A.content,updatedAt:B||A.updatedAt}:A)}else y=[...D,v];return y.sort((B,G)=>new Date(B.updatedAt).getTime()-new Date(G.updatedAt).getTime())})},[]),u=c.useRef(t),p=c.useRef(x);u.current=t,p.current=x;const k=c.useCallback(()=>{d(null)},[]),b=c.useCallback(async()=>{try{r(!0),d(null);const D=(await Ye.getBySessionId(t)).sort((j,y)=>new Date(j.updatedAt).getTime()-new Date(y.updatedAt).getTime());a(D)}catch(v){console.error("Failed to fetch messages:",v),d("Failed to load messages")}finally{r(!1)}},[t]),w=c.useCallback(async(v,D,j)=>{if(v.trim())try{o(!0),d(null);const y={content:v.trim(),metadata:D,parentMessageId:j},$=new Date,B=await Ye.send(t,y);if(!B.success||!B.messageId)throw new Error(B.error||"Failed to send message");if(B.messageId){const G={id:B.messageId,sessionId:t,type:ye.User,content:v.trim(),status:Ne.Pending,metadata:D,parentMessageId:j,createdAt:$,updatedAt:$};x(G)}}catch(y){console.error("Failed to send message:",y),d(y instanceof Error?y.message:"Failed to send message")}finally{o(!1)}},[t]),N=c.useCallback(()=>{a([])},[]),h=c.useCallback((v,D)=>{v===u.current&&p.current({...D,createdAt:new Date(D.createdAt),updatedAt:new Date(D.updatedAt)})},[]),C=c.useCallback((v,D,j,y,$)=>{if(v===u.current){const B=$?new Date($):new Date;p.current({id:D,sessionId:u.current,type:ye.User,status:j,content:y||"",updatedAt:B,createdAt:B})}},[]),S=c.useCallback((v,D)=>{v===u.current&&m(D.toString())},[]);return c.useEffect(()=>{const v=[];return v.push(de.on("onMessageReceived",h),de.on("onMessageStatusChanged",C)),()=>{v.forEach(D=>D())}},[h,C,S]),c.useEffect(()=>{a([]),d(null),m(null),b()},[t,b]),{messages:s,loading:n,sending:i,error:l,sessionStatus:g,sendMessage:w,clearError:k,clearMessages:N}}function Kt(){const[t,s]=c.useState({isOpen:!1,title:"",message:""}),a=o=>{s({...o,isOpen:!0})},n=()=>{s(o=>({...o,isOpen:!1}))};return{confirmDialog:t,showConfirm:a,hideConfirm:n,handleConfirm:()=>{t.onConfirm?.(),n()},handleCancel:()=>{t.onCancel?.(),n()}}}function at(){const[t,s]=c.useState({isOpen:!1,title:"",message:""}),a=i=>{s({...i,isOpen:!0})},n=()=>{s(i=>({...i,isOpen:!1}))};return{alertDialog:t,showAlert:a,hideAlert:n,handleConfirm:()=>{t.onConfirm?.(),n()}}}function O({variant:t="primary",size:s="md",loading:a=!1,icon:n,children:r,className:i="",...o}){const l="flex items-center justify-center gap-2 rounded-md focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",d={primary:"bg-purple-800/80 text-white hover:bg-purple-900",secondary:"bg-neutral-600 text-white hover:bg-neutral-700",outline:"border border-neutral-300 dark:border-neutral-600 bg-transparent hover:bg-neutral-50 dark:hover:bg-neutral-700 text-neutral-700 dark:text-neutral-200",ghost:"bg-transparent hover:bg-neutral-100 dark:hover:bg-neutral-700 text-neutral-700 dark:text-neutral-200"},g={sm:"text-sm p-1.5",md:"text-sm px-4 py-2",lg:"text-base px-6 py-3"},m=`${l} ${d[t]} ${g[s]} ${i}`.trim();return e.jsxs("button",{className:m,disabled:a||o.disabled,...o,children:[a&&e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 0 1 8-8v4a4 4 0 0 0 0 8v4a8 8 0 0 1-8-8z"})]}),!a&&n,r]})}function ze({options:t,value:s,placeholder:a="Select an option",onSelect:n,className:r="",dropdownWidth:i,alignRight:o=!1,openUpward:l=!1}){const[d,g]=c.useState(!1),m=c.useRef(null),x=t.find(u=>u.value===s);return c.useEffect(()=>{function u(p){m.current&&!m.current.contains(p.target)&&g(!1)}return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]),e.jsxs("div",{className:`relative ${r}`,ref:m,children:[e.jsxs("button",{type:"button",onClick:()=>g(!d),className:"relative w-full cursor-default rounded-md border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 py-2 pl-3 pr-10 text-left shadow-sm focus:border-purple-500 focus:ring-1 sm:text-sm text-neutral-900 dark:text-neutral-100",children:[e.jsx("span",{className:"block truncate",children:x?x.label:a}),e.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:e.jsx("svg",{className:"h-5 w-5 text-neutral-400 dark:text-neutral-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),d&&e.jsx("div",{className:`absolute z-10 ${l?"bottom-full mb-1":"mt-1"} max-h-60 overflow-auto rounded-md bg-white dark:bg-neutral-800 py-1 text-base shadow-lg ring-1 ring-black dark:ring-neutral-600 ring-opacity-5 sm:text-sm ${i||"w-full"} ${o?"right-0":""}`,children:t.map(u=>e.jsx("button",{type:"button",onClick:()=>{n(u),g(!1)},className:"relative w-full cursor-default select-none py-2 pl-3 pr-9 text-left hover:bg-purple-900 hover:text-white",children:e.jsx("span",{className:"block truncate",children:u.label})},u.value))})]})}const Is={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl",full:"max-w-full mx-4"};function xe({isOpen:t,onClose:s,title:a,icon:n,children:r,footer:i,className:o="",contentClassName:l="",size:d="lg"}){return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:s}),e.jsxs("div",{className:`relative bg-white dark:bg-neutral-800 rounded-lg shadow-xl w-full ${Is[d]} max-h-[80vh] flex flex-col ${o}`,children:[(a||n)&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-neutral-200 dark:border-neutral-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[n,a&&e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:a})]}),e.jsx(O,{variant:"ghost",size:"sm",onClick:s,children:e.jsx(et,{size:20})})]}),e.jsx("div",{className:`flex-1 overflow-y-auto ${l}`,children:r}),i&&e.jsx("div",{className:"flex items-center justify-between px-6 py-3 border-t border-neutral-200 dark:border-neutral-700",children:i})]})]}):null}function Xe({size:t="md",className:s=""}){const a={sm:"w-3 h-3",md:"w-6 h-6",lg:"w-8 h-8"};return e.jsx("div",{className:`inline-block ${a[t]} ${s}`,children:e.jsx("div",{className:"w-full h-full border-2 border-current border-t-transparent rounded-full animate-spin opacity-75"})})}function kt({status:t,size:s}){return e.jsx("div",{className:"flex items-center justify-center "+(s==="lg"?"w-5":"w-3"),children:t===le.Running?e.jsx(Xe,{size:"sm"}):e.jsx("div",{className:`w-2 h-2 rounded-full ${t===le.Completed?"bg-green-500":t===le.Failed?"bg-red-500":"bg-neutral-400"}`})})}function zs({environments:t,className:s="",taskUpdateTrigger:a,workspaceName:n}){const[r,i]=c.useState(!1),[o,l]=c.useState({}),[d,g]=c.useState(!1),[m,x]=c.useState({}),{taskExecutions:u,setTaskExecution:p,mapTaskToExecution:k,getTaskExecutionId:b}=Je(),[w,N]=c.useState({isOpen:!1,taskName:"",taskExecutionId:"",environmentId:0}),h=c.useRef(null),C=c.useRef(null),S=c.useCallback(async A=>{l(R=>({...R,[A.id]:{...R[A.id],environment:A,loading:!0,error:null}}));try{const R=await Le.getTasks(A.id);l(ae=>({...ae,[A.id]:{environment:A,tasks:R,loading:!1,error:null}}))}catch(R){l(ae=>({...ae,[A.id]:{environment:A,tasks:[],loading:!1,error:R instanceof Error?R.message:"Failed to load tasks"}}))}},[]);c.useEffect(()=>{t.forEach(A=>{(!o[A.id]||o[A.id].tasks===void 0)&&S(A)})},[t.length]),c.useEffect(()=>{a&&t.length>0&&t.forEach(A=>{S(A)})},[a,t.length]),c.useEffect(()=>{Object.entries(u).forEach(([A,R])=>{(R.status===le.Completed||R.status===le.Failed||R.status===le.Canceled)&&t.forEach(ae=>{const z=o[ae.id];if(z?.tasks&&z.tasks.some(_=>b(_.id,!1)===A||_.taskExecutionId===A)){const _=z.tasks.find(E=>E.taskExecutionId===A||b(E.id,!1)===A);_&&_.status!==R.status&&S(ae)}})})},[u]);const v=async()=>{g(!0),await Promise.all(t.map(A=>S(A))),g(!1)},D=async(A,R,ae,z=!0)=>{const se=`start-${A}-${R}`;x(_=>({..._,[se]:!0}));try{const _=await Le.startTask(A,R);k(R,!1,_.taskExecutionId),p(_.taskExecutionId,{taskExecutionId:_.taskExecutionId,output:"",status:le.Running,startTime:new Date}),z&&$(R,ae,_.taskExecutionId,A,!0),setTimeout(()=>{const E=t.find(Y=>Y.id===A);E&&S(E)},100)}catch(_){console.error("Failed to start task:",_)}finally{x(_=>({..._,[se]:!1}))}},j=async(A,R)=>{const ae=`stop-${A}-${R}`;x(z=>({...z,[ae]:!0}));try{await Ce.stopTask(R);const z=t.find(se=>se.id===A);z&&S(z)}catch(z){console.error("Failed to stop task:",z)}finally{x(z=>({...z,[ae]:!1}))}},y=async(A,R,ae,z)=>{const se=`restart-${A}-${R}`;x(_=>({..._,[se]:!0}));try{await Ce.stopTask(z),await new Promise(_=>setTimeout(_,500)),await D(A,R,ae)}catch(_){console.error("Failed to restart task:",_)}finally{x(_=>({..._,[se]:!1}))}},$=async(A,R,ae,z,se=!1)=>{try{if(!se){const _=await Ce.getTaskOutput(ae);p(ae,{taskExecutionId:ae,output:_.output||"",status:_.status})}N({isOpen:!0,taskName:R,taskExecutionId:ae,environmentId:z})}catch(_){console.error("Failed to get task output:",_),N({isOpen:!0,taskName:R,taskExecutionId:ae,environmentId:z})}},B=async(A,R)=>{const ae=`reset-${A}`;x(z=>({...z,[ae]:!0}));try{await Le.reset(A);const z=t.find(se=>se.id===A);z&&S(z)}catch(z){console.error("Failed to reset environment:",z)}finally{x(z=>({...z,[ae]:!1}))}},G=Object.values(o).some(A=>(A.tasks||[]).some(R=>{const z=b(R.id,!1)||R.taskExecutionId,_=(z?u[z]:null)?.status??R.status;return R.type===pe.Start&&_===le.Running}));return e.jsxs("div",{className:`relative ${s}`,ref:h,children:[e.jsx("button",{type:"button",onClick:()=>i(!r),className:"relative rounded-md border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 py-2 px-3 text-left shadow-sm hover:bg-neutral-50 dark:hover:bg-neutral-700 focus:border-purple-500 focus:ring-1 sm:text-sm text-neutral-900 dark:text-neutral-100",children:e.jsxs("span",{className:"flex items-center gap-2",children:[G&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("div",{className:"absolute inset-0 w-2 h-2 bg-green-400 rounded-full animate-ping"})]}),e.jsx("span",{children:"Environments"})]})}),r&&e.jsxs("div",{className:"absolute bottom-full left-0 z-20 w-96 mb-2 rounded-md bg-white dark:bg-neutral-800 py-2 shadow-lg ring-1 ring-black dark:ring-neutral-600 ring-opacity-5 border border-neutral-200 dark:border-neutral-700 max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-neutral-200 dark:border-neutral-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:n?`${n} - Environment Tasks`:"Environment Tasks"}),e.jsx(O,{variant:"ghost",size:"sm",onClick:v,disabled:d,children:e.jsx(je,{size:14,className:d?"animate-spin":""})})]}),e.jsx("div",{className:"py-1 space-y-3",children:t.length===0?e.jsx("div",{className:"px-3 py-4 text-sm text-neutral-500 dark:text-neutral-400 text-center",children:"No environments available"}):t.map(A=>{const R=o[A.id],ae=R?.loading??!0,z=R?.error,se=R?.tasks??[],_=(se||[]).some(E=>{const J=b(E.id,!1)||E.taskExecutionId,ne=(J?u[J]:null)?.status??E.status;return E.type===pe.Start&&ne===le.Running});return e.jsxs("div",{className:"mx-2",children:[e.jsx("div",{className:"px-2 py-1 bg-neutral-50 dark:bg-neutral-700 rounded-t border-b border-neutral-200 dark:border-neutral-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[_&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("div",{className:"absolute inset-0 w-2 h-2 bg-green-400 rounded-full animate-ping"})]}),e.jsx("h4",{className:"text-xs text-neutral-700 dark:text-neutral-300",children:A.name}),A.url&&_&&e.jsx("button",{onClick:E=>{E.stopPropagation(),window.open(A.url,"_blank","noopener,noreferrer")},className:"text-neutral-500 hover:text-purple-600 dark:text-neutral-400 dark:hover:text-purple-400",title:`Open ${A.name} (${A.url})`,children:e.jsx(gt,{size:12})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:E=>{E.stopPropagation(),B(A.id,A.name)},disabled:m[`reset-${A.id}`],title:"Reset git repository (hard reset + pull)",className:"p-1 h-5 w-5",children:e.jsx(tt,{size:10,className:m[`reset-${A.id}`]?"animate-spin":""})}),e.jsxs("span",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:[se.length," task",se.length!==1?"s":""]})]})]})}),z&&e.jsxs("div",{className:"px-2 py-2 text-red-600 text-xs bg-red-50 dark:bg-red-900/20",children:["Error: ",z]}),e.jsx("div",{className:"border border-neutral-200 dark:border-neutral-600 rounded-b",children:ae?e.jsx("div",{className:"px-3 py-2 text-neutral-500 text-xs",children:"Loading tasks..."}):se.length===0?e.jsx("div",{className:"px-3 py-2 text-neutral-500 text-xs",children:"No tasks found"}):e.jsx("div",{className:"p-1",children:e.jsx(Jt,{isSession:!1,tasks:se,loading:m,taskExecutions:u,isReadonly:!1,onStart:(E,Y,J=!0)=>D(A.id,E,Y,J),onStop:E=>j(A.id,E),onRestart:(E,Y,J)=>y(A.id,E,Y,J),onViewOutput:(E,Y,J)=>$(E,Y,J,A.id),emptyMessage:"No tasks found",autoOpenOnGroupStart:!1})})})]},A.id)})})]}),e.jsx(xe,{isOpen:w.isOpen,onClose:()=>N({...w,isOpen:!1}),title:w.taskName,icon:e.jsxs(e.Fragment,{children:[e.jsx(Ue,{size:20,className:"text-neutral-500 dark:text-neutral-400"}),e.jsx(kt,{status:u[w.taskExecutionId]?.status||le.Pending,size:"sm"})]}),contentClassName:"p-6 bg-neutral-900 dark:bg-black",footer:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:["Execution ID: ",w.taskExecutionId]}),e.jsxs("div",{className:"flex gap-2",children:[u[w.taskExecutionId]?.status===le.Running&&e.jsx(O,{variant:"primary",size:"sm",onClick:()=>{j(w.environmentId,w.taskExecutionId),N({...w,isOpen:!1})},children:"Stop Task"}),e.jsx(O,{variant:"secondary",size:"sm",onClick:()=>N({...w,isOpen:!1}),children:"Close"})]})]}),children:e.jsx("div",{ref:C,className:"h-full",children:e.jsx(Xt,{output:u[w.taskExecutionId]?.output||"",className:"h-full",placeholder:"Waiting for output..."})})})]})}function Rs({environment:t,onEdit:s,onDelete:a,onClone:n}){return e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 p-6 mb-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Mt,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-neutral-900 dark:text-neutral-100",children:t.name}),e.jsxs("div",{className:"flex items-center gap-1 text-sm opacity-70",children:[e.jsx(mt,{className:"w-3 h-3"}),t.gitBranch]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>n(t),title:"Clone environment",children:e.jsx(Bt,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(t),title:"Edit environment",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>a(t.id),title:"Delete environment",children:e.jsx(Ee,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-8",children:[t.url&&e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-purple-600 hover:text-purple-800 underline break-all font-mono",children:t.url}),e.jsx(gt,{className:"w-3 h-3 text-neutral-500"})]})}),Object.keys(t.environmentVariables).length>0&&e.jsx("div",{children:e.jsxs("div",{className:"mt-1 text-sm text-neutral-600 dark:text-neutral-300",children:[Object.keys(t.environmentVariables).length," variables configured"]})})]})]})}function Vs({isOpen:t,environment:s,formData:a,setFormData:n,onSave:r,onCancel:i,workspace:o,isLoading:l=!1}){const[d,g]=c.useState([]),[m,x]=c.useState(!1);c.useEffect(()=>{if(t&&!m){const h=Object.entries(a.environmentVariables||{}).map(([C,S],v)=>({id:`${Date.now()}-${v}-${C}`,key:C,value:S}));g(h),x(!0)}else t||x(!1)},[t,a.environmentVariables,m]);const u=h=>{const C={};h.forEach(S=>{S.key.trim()&&(C[S.key]=S.value)}),n({...a,environmentVariables:C})},p=!!s,b=(()=>{const h={};return d.forEach(C=>{C.key.trim()&&(h[C.key]=(h[C.key]||0)+1)}),new Set(Object.keys(h).filter(C=>h[C]>1))})(),w=a.name.trim().length>0,N=w&&a.gitBranch&&b.size===0&&!l;return e.jsx(xe,{isOpen:t,onClose:i,title:p?"Edit Environment":"Create Environment",size:"md",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:r,disabled:!N,loading:l,children:p?"Update":"Create"}),e.jsx(O,{variant:"ghost",onClick:i,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:a.name,onChange:h=>n({...a,name:h.target.value}),className:`w-full px-3 py-2 border rounded-md text-neutral-900 dark:text-neutral-100 ${l?"bg-neutral-100 dark:bg-neutral-600 border-neutral-200 dark:border-neutral-500 cursor-not-allowed opacity-50":!w&&a.name.length>0?"bg-white dark:bg-neutral-700 border-red-300 dark:border-red-600 focus:ring-red-500":"bg-white dark:bg-neutral-700 border-neutral-300 dark:border-neutral-600"}`,placeholder:"e.g., Development, Staging, Production",disabled:l,required:!0}),!w&&a.name.length>0&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:"Environment name is required"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Git Branch"}),p?e.jsxs("div",{children:[e.jsx("input",{type:"text",value:a.gitBranch,disabled:!0,className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-neutral-100 dark:bg-neutral-600 text-neutral-900 dark:text-neutral-100 opacity-50 cursor-not-allowed"}),e.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Git branch cannot be changed after creation"})]}):e.jsx(bt,{workspaceId:o.id,value:a.gitBranch,onSelect:h=>n({...a,gitBranch:h}),placeholder:"Select git branch",autoSelectDefault:!a.gitBranch})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"URL (optional)"}),e.jsx("input",{type:"url",value:a.url||"",onChange:h=>n({...a,url:h.target.value}),className:`w-full px-3 py-2 border rounded-md text-neutral-900 dark:text-neutral-100 ${l?"bg-neutral-100 dark:bg-neutral-600 border-neutral-200 dark:border-neutral-500 cursor-not-allowed opacity-50":"bg-white dark:bg-neutral-700 border-neutral-300 dark:border-neutral-600"}`,placeholder:"https://example.com",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Environment Variables"}),e.jsxs("div",{className:"space-y-2",children:[d.map(h=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h.key,onChange:C=>{const S=d.map(v=>v.id===h.id?{...v,key:C.target.value}:v);g(S),u(S)},className:`flex-1 px-3 py-2 border rounded-md text-neutral-900 dark:text-neutral-100 ${l?"bg-neutral-100 dark:bg-neutral-600 border-neutral-200 dark:border-neutral-500 cursor-not-allowed opacity-50":h.key.trim()&&b.has(h.key)?"bg-white dark:bg-neutral-700 border-orange-300 dark:border-orange-600 focus:ring-orange-500":"bg-white dark:bg-neutral-700 border-neutral-300 dark:border-neutral-600"}`,placeholder:"Variable name",disabled:l}),e.jsx("input",{type:"text",value:h.value,onChange:C=>{const S=d.map(v=>v.id===h.id?{...v,value:C.target.value}:v);g(S),u(S)},className:`flex-1 px-3 py-2 border rounded-md text-neutral-900 dark:text-neutral-100 ${l?"bg-neutral-100 dark:bg-neutral-600 border-neutral-200 dark:border-neutral-500 cursor-not-allowed opacity-50":"bg-white dark:bg-neutral-700 border-neutral-300 dark:border-neutral-600"}`,placeholder:"Variable value",disabled:l}),e.jsx(O,{variant:"ghost",size:"sm",disabled:l,onClick:()=>{const C=d.filter(S=>S.id!==h.id);g(C),u(C)},children:e.jsx(Ee,{className:"w-4 h-4"})})]},h.id)),e.jsx(O,{variant:"ghost",size:"sm",disabled:l,onClick:()=>{const h={id:`${Date.now()}-${Math.random()}`,key:"",value:""},C=[...d,h];g(C)},icon:e.jsx(ke,{size:12}),children:"Add Variable"}),b.size>0&&e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 mt-2",children:["⚠️ Warning: Duplicate variable names detected. Only the last value will be saved for: ",Array.from(b).join(", ")]})]})]})]})})}function Us({workspace:t,onEdit:s,onDelete:a}){const n=ht(),r=(i,o)=>{i.stopPropagation(),n(`/workspace/${t.id}`)};return e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(ss,{className:"w-6 h-6 text-purple-600"})}),e.jsx("div",{children:e.jsx("h3",{className:"text-lg text-neutral-900 dark:text-neutral-100",children:t.name})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:i=>r(i),children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:i=>r(i),children:e.jsx(Ee,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(Ae,{className:"font-mono",children:t.gitRepository})})]})}function _t({isOpen:t,workspace:s,formData:a,setFormData:n,onSave:r,onCancel:i}){return e.jsx(xe,{isOpen:t,onClose:i,title:s?"Edit Workspace":"Create Workspace",size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:r,children:s?"Update":"Create"}),e.jsx(O,{variant:"ghost",onClick:i,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:a.name,onChange:o=>n({...a,name:o.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",placeholder:"Enter workspace name"})]}),!s&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Git Repository"}),e.jsx("input",{type:"text",value:a.gitRepository,onChange:o=>n({...a,gitRepository:o.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",placeholder:"https://github.com/user/repo.git"})]})]})})}function Ae({children:t,variant:s="default",size:a="md",className:n=""}){const r="inline-flex items-center rounded-full",i={default:"bg-neutral-100 dark:bg-neutral-700 text-neutral-800 dark:text-neutral-200",success:"bg-green-100 dark:bg-green-800 text-green-800 dark:text-green-200",warning:"bg-yellow-100 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200",error:"bg-red-100 dark:bg-red-800 text-red-800 dark:text-red-200"},o={sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-0.5 text-sm"},l=`${r} ${i[s]} ${o[a]} ${n}`.trim();return e.jsx("span",{className:l,children:t})}function Gs(){const{theme:t,toggleTheme:s}=Gt();return e.jsx("div",{className:"relative",children:e.jsxs("button",{onClick:s,className:"flex items-center space-x-2 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-700 text-neutral-700 dark:text-neutral-200",title:`Current theme: ${t}`,children:[t==="light"&&e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),t==="dark"&&e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}),t==="system"&&e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("span",{className:"capitalize",children:t})]})})}function Hs({session:t}){return e.jsxs(e.Fragment,{children:[t.hasUnreadMessage&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),t.status===be.InProgress&&e.jsx(Xe,{size:"sm"})]})}function qs(){const t=ht(),s=as(),[a,n]=c.useState(!1),[r,i]=c.useState({isOpen:!1,title:"",message:"",sessionId:null}),[o,l]=c.useState(!1),[d,g]=c.useState(""),[m,x]=c.useState(!1),{sessions:u,workspaces:p,activeWorkspaceId:k,activeSessionId:b,addSession:w,removeSession:N}=fe(),h=async()=>{if(x(!0),!p||p.length===0){g("You need to create at least one workspace before creating a session. Go to Workspaces to create one."),l(!0),x(!1);return}let j=!1;try{j=(await Me.getAll()).length>0}catch(y){console.error("Failed to check agents:",y),j=!1}if(!j){g("You need to create at least one agent before creating a session. Go to Agents to create one."),l(!0),x(!1);return}n(!0),x(!1)},C=async j=>{const y=await Z.create(j);w(y),n(!1),t(`/session/${y.id}`)},S=j=>{i({isOpen:!0,title:"Cancel Session",message:"Are you sure you want to cancel this session? All progress and changes will be lost.",sessionId:j})},v=async()=>{if(r.sessionId)try{await Z.cancelSession(r.sessionId),N(r.sessionId),b===r.sessionId&&t("/")}catch(j){console.error("Failed to cancel session:",j)}i({isOpen:!1,title:"",message:"",sessionId:null})},D=()=>{i({isOpen:!1,title:"",message:"",sessionId:null})};return e.jsxs("header",{className:"border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative h-8 w-8",children:[e.jsx("div",{className:"absolute w-full h-full flex items-center justify-center z-1",children:e.jsx("span",{className:"text-white font-mono",style:{letterSpacing:-2},children:"</>"})}),e.jsx("div",{className:"h-8 w-8 rounded-full magic-icon flex items-center justify-center"})]}),e.jsx("span",{className:"text-lg font-normal! text-neutral-900 dark:text-neutral-100 font-mono",children:"polygent"})]}),e.jsxs("div",{className:"flex items-center",children:[u.filter(j=>j.status===be.Waiting||j.status===be.InProgress).sort((j,y)=>j.createdAt>y.createdAt?-1:1).map(j=>e.jsxs("div",{className:(b===j.id&&s.pathname.startsWith("/session/")?"bg-purple-100 dark:bg-purple-900/80 ":"hover:bg-neutral-200 dark:hover:bg-neutral-600 ")+"flex items-center space-x-2 px-3 py-3 text-sm border-l border-neutral-200 dark:border-neutral-700",onClick:()=>t(`/session/${j.id}`),children:[e.jsx(Hs,{session:j}),e.jsx("span",{className:"mr-2",children:j.name||`Session #${j.id}`}),e.jsx("button",{className:"text-neutral-400 hover:text-neutral-600 dark:text-neutral-500 dark:hover:text-neutral-300 ml-1",onClick:y=>{y.stopPropagation(),S(j.id)},children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},j.id)),e.jsx("div",{className:`hover:bg-neutral-200 dark:hover:bg-neutral-600 flex items-center px-3 py-3 border-x border-neutral-200 dark:border-neutral-700 ${m?"cursor-wait":"cursor-pointer"}`,style:{height:38},onClick:h,children:e.jsx(ke,{size:14})})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Gs,{}),e.jsx(ze,{options:[{value:"home",label:"Home"},{value:"workspaces",label:"Workspaces"},{value:"agents",label:"Agents"},{value:"backlogs",label:"Backlogs"}],placeholder:"Menu",onSelect:j=>{t(j.value==="home"?"/":`/${j.value}`)},dropdownWidth:"w-40",alignRight:!0})]})]}),e.jsx(_s,{isOpen:a,activeWorkspaceId:k,onCreateSession:C,onCancel:()=>n(!1)}),e.jsx(Te,{isOpen:r.isOpen,title:r.title,message:r.message,variant:"danger",onConfirm:v,onCancel:D}),e.jsx(xe,{isOpen:o,onClose:()=>l(!1),title:"Requirements Missing",icon:e.jsx(xt,{className:"h-6 w-6 text-yellow-500"}),size:"sm",contentClassName:"p-6",footer:e.jsx(O,{onClick:()=>l(!1),children:"Got it"}),children:e.jsx("div",{className:"text-neutral-700 dark:text-neutral-300",children:d})})]})}function Qe({workspaceId:t,autoLoad:s=!0}){const{getEnvironmentsByWorkspace:a,loadEnvironments:n,isLoading:r,getError:i}=ft(),o=a(t),l=r(t),d=i(t);return c.useEffect(()=>{s&&t&&o===void 0&&!l&&n(t)},[s,t,o,l,n]),{environments:o??[],loading:l,error:d,refetch:()=>{t&&n(t)}}}function Yt(t){const[s,a]=c.useState([]),[n,r]=c.useState(!0),[i,o]=c.useState(null),[l,d]=c.useState(Date.now()),g=async x=>{if(!t){a([]),r(!1);return}try{x||r(!0),o(null);const u=await Ce.getByWorkspaceId(t);a(u),d(Date.now())}catch(u){o(u instanceof Error?u.message:"Failed to fetch workspace tasks")}finally{r(!1)}};return c.useEffect(()=>{g()},[t]),{tasks:s,loading:n,error:i,refreshTasks:x=>{g(x)},lastUpdate:l,taskCount:s.length}}function Ks(){const{activeWorkspaceId:t,workspaces:s}=fe(),{environments:a}=Qe({workspaceId:t??0,autoLoad:!0}),{lastUpdate:n}=Yt(t),i=s.find(o=>o.id===t)?.name;return e.jsx("footer",{className:"border-t border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-4 py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(zs,{environments:a,className:"min-w-32",taskUpdateTrigger:n,workspaceName:i})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"v1.0.0"})})]})})}function Te({isOpen:t,title:s,message:a,confirmText:n="Confirm",cancelText:r="Cancel",variant:i="danger",onConfirm:o,onCancel:l}){if(!t)return null;const g=(()=>{switch(i){case"danger":return{icon:"text-red-600 dark:text-red-400",iconBg:"bg-red-100 dark:bg-red-900"};case"warning":return{icon:"text-yellow-600 dark:text-yellow-400",iconBg:"bg-yellow-100 dark:bg-yellow-900"};case"info":return{icon:"text-purple-600 dark:text-purple-400",iconBg:"bg-purple-100 dark:bg-purple-900"}}})();return e.jsx(xe,{isOpen:t,onClose:l,title:s,icon:e.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-full ${g.iconBg} flex items-center justify-center`,children:e.jsx(Ot,{className:`w-6 h-6 ${g.icon}`})}),size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(O,{variant:"ghost",onClick:l,children:r}),e.jsx(O,{onClick:o,children:n})]}),children:e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-300",children:a})})}function rt({isOpen:t,title:s,message:a,confirmText:n="OK",variant:r="info",onConfirm:i}){if(!t)return null;const o=()=>{switch(r){case"danger":return{icon:xt,iconClass:"text-red-600 dark:text-red-400",iconBg:"bg-red-100 dark:bg-red-900"};case"warning":return{icon:Ot,iconClass:"text-yellow-600 dark:text-yellow-400",iconBg:"bg-yellow-100 dark:bg-yellow-900"};case"info":return{icon:rs,iconClass:"text-purple-600 dark:text-purple-400",iconBg:"bg-purple-100 dark:bg-purple-900"}}},{icon:l,iconClass:d,iconBg:g}=o();return e.jsx(xe,{isOpen:t,onClose:i,title:s,icon:e.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-full ${g} flex items-center justify-center`,children:e.jsx(l,{className:`w-6 h-6 ${d}`})}),size:"sm",contentClassName:"p-6",footer:e.jsx("div",{className:"flex justify-end",children:e.jsx(O,{onClick:i,children:n})}),children:e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-300",children:a})})}const ot="polygent_workspace_preferences",we={getPreferences(t){try{const s=localStorage.getItem(ot);return s?JSON.parse(s)[t.toString()]||{}:{}}catch(s){return console.error("Failed to load workspace preferences:",s),{}}},savePreferences(t,s){try{const a=localStorage.getItem(ot),n=a?JSON.parse(a):{};n[t.toString()]={...n[t.toString()],...s},localStorage.setItem(ot,JSON.stringify(n))}catch(a){console.error("Failed to save workspace preferences:",a)}},saveLastBranch(t,s){this.savePreferences(t,{lastSelectedBranch:s})},saveLastAgent(t,s){this.savePreferences(t,{lastSelectedAgentId:s})},getLastBranch(t){return this.getPreferences(t).lastSelectedBranch},getLastAgent(t){return this.getPreferences(t).lastSelectedAgentId}};function _s({isOpen:t,activeWorkspaceId:s,defaultName:a,onCreateSession:n,onCancel:r}){const{workspaces:i}=fe(),[o,l]=c.useState(""),[d,g]=c.useState(s),[m,x]=c.useState(null),[u,p]=c.useState(""),[k,b]=c.useState([]),[w,N]=c.useState(!1),[h,C]=c.useState(!1);c.useEffect(()=>{t&&(S(),l(""),g(s),x(null),p(a||""),C(!1))},[t,s,a]),c.useEffect(()=>{if(d){if(k.length>0){const B=we.getLastAgent(d);B&&k.some(G=>G.id===B)?x(B):x(null)}const $=we.getLastBranch(d);l($||"")}else l(""),x(null)},[d,k]);const S=async()=>{try{N(!0);const $=await Me.getAll();if(b($),d){const B=we.getLastAgent(d);B&&$.some(G=>G.id===B)&&x(B)}}catch($){console.error("Failed to load agents:",$)}finally{N(!1)}},v=async()=>{if(!(!d||!o||!m))try{C(!0),we.saveLastBranch(d,o),we.saveLastAgent(d,m),await n({workspaceId:d,starterGitBranch:o,agentId:m,name:u.trim()||null})}catch($){console.error("Failed to create session:",$),C(!1)}},D=d&&o.trim()&&m,j=i.map($=>({value:$.id.toString(),label:$.name})),y=k.map($=>({value:$.id.toString(),label:`${$.name}`+($.roleName?` (${$.roleName})`:"")}));return e.jsx(xe,{isOpen:t,onClose:h?()=>{}:r,title:"Create Session",size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:v,disabled:!D||w,loading:h,children:h?"Creating Session...":"Create Session"}),e.jsx(O,{variant:"ghost",onClick:r,disabled:h,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-4",style:{opacity:h?.6:1},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Session Name"}),e.jsx("input",{type:"text",value:u,onChange:$=>p($.target.value),placeholder:"Enter session name (optional)",className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md shadow-sm bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 focus:border-transparent",maxLength:100,disabled:h}),e.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"You can set it later"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Workspace"}),e.jsx(ze,{options:j,value:d?.toString(),placeholder:"Select workspace",onSelect:h?()=>{}:$=>{g(parseInt($.value))}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Start Git Branch"}),d?e.jsx(bt,{workspaceId:d,value:o,onSelect:h?()=>{}:$=>{l($),d&&we.saveLastBranch(d,$)},placeholder:"Select git branch"}):e.jsx("div",{className:"px-3 py-2 text-neutral-500 dark:text-neutral-400",children:"Select workspace first"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Agent"}),w?e.jsx("div",{className:"px-3 py-2 text-neutral-500 dark:text-neutral-400",children:"Loading agents..."}):e.jsx(ze,{options:y,value:m?.toString(),placeholder:"Select agent",onSelect:h?()=>{}:$=>x(parseInt($.value))})]})]})})}function Ys({items:t,position:s,onClose:a,isVisible:n}){const r=c.useRef(null),[i,o]=c.useState(null),[l,d]=c.useState({x:0,y:0});if(c.useEffect(()=>{const x=p=>{const k=p.target,b=r.current,w=b&&!b.contains(k),N=document.querySelector('[data-submenu="true"]'),h=!N||!N.contains(k);w&&h&&a()},u=p=>{p.key==="Escape"&&a()};return n?(document.addEventListener("mousedown",x),document.addEventListener("keydown",u)):o(null),()=>{document.removeEventListener("mousedown",x),document.removeEventListener("keydown",u)}},[n,a]),c.useEffect(()=>{if(n&&r.current){const x=r.current.getBoundingClientRect(),u=window.innerWidth,p=window.innerHeight;let k=s.x,b=s.y;s.x+x.width>u&&(k=u-x.width-10),s.y+x.height>p&&(b=p-x.height-10),r.current.style.left=`${k}px`,r.current.style.top=`${b}px`}},[n,s]),!n)return null;const g=(x,u)=>{if(!x.disabled)if(x.submenu){if(i===x.id)o(null);else if(o(x.id),u){const p=u.currentTarget.getBoundingClientRect(),k=window.innerWidth,b=window.innerHeight;let w=p.right,N=p.top;w+200>k&&(w=p.left-200),N+150>b&&(N=Math.max(10,b-150)),d({x:w,y:N})}}else x.onClick?.(),a()},m=x=>{x.disabled||(x.onClick?.(),a())};return e.jsxs("div",{ref:r,className:"fixed z-50 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-600 rounded-md shadow-lg py-1 min-w-48",style:{left:s.x,top:s.y},children:[t.map((x,u)=>e.jsx("div",{children:x.separator?e.jsx("div",{className:"border-t border-neutral-200 dark:border-neutral-600 my-1"}):e.jsxs("button",{className:`w-full text-left px-3 py-2 text-sm flex items-center space-x-2 ${x.disabled?"text-neutral-400 dark:text-neutral-500 cursor-not-allowed":i===x.id?"bg-neutral-100 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-200":"text-neutral-700 dark:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-neutral-700"}`,onClick:p=>g(x,p),onMouseEnter:p=>{x.submenu&&!x.disabled&&g(x,p)},disabled:x.disabled,children:[e.jsx("span",{className:"flex-1",children:x.label}),x.submenu&&e.jsx("span",{className:"flex-shrink-0",children:e.jsx(_e,{size:12})})]})},`${x.id}-${u}`)),i&&(()=>{const x=t.find(u=>u.id===i);return x?.submenu?e.jsx("div",{"data-submenu":"true",className:"fixed z-60 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-600 rounded-md shadow-lg py-1 min-w-36",style:{left:l.x,top:l.y},children:x.submenu.map((u,p)=>e.jsx("div",{children:u.separator?e.jsx("div",{className:"border-t border-neutral-200 dark:border-neutral-600 my-1"}):e.jsx("button",{className:`w-full text-left px-3 py-2 text-sm flex items-center space-x-2 ${u.disabled?"text-neutral-400 dark:text-neutral-500 cursor-not-allowed":"text-neutral-700 dark:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-neutral-700"}`,onClick:()=>m(u),disabled:u.disabled,children:e.jsx("span",{className:"flex-1",children:u.label})})},`${u.id}-${p}`))}):null})()]})}function Js({isOpen:t,currentName:s,onConfirm:a,onCancel:n,title:r="Rename"}){const[i,o]=c.useState(s),l=c.useRef(null);c.useEffect(()=>{t&&(o(s),setTimeout(()=>{if(l.current){l.current.focus();const m=s.lastIndexOf(".");m>0?l.current.setSelectionRange(0,m):l.current.select()}},100))},[t,s]);const d=m=>{m.preventDefault(),i.trim()&&i!==s?a(i.trim()):n()},g=m=>{m.key==="Escape"&&n()};return e.jsx(xe,{isOpen:t,onClose:n,title:r,size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(O,{type:"button",onClick:n,variant:"outline",children:"Cancel"}),e.jsx(O,{type:"submit",disabled:!i.trim()||i===s,onClick:d,children:"Rename"})]}),children:e.jsx("form",{onSubmit:d,children:e.jsx("input",{ref:l,type:"text",value:i,onChange:m=>o(m.target.value),onKeyDown:g,className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",placeholder:"Enter new name..."})})})}function Ft({isOpen:t,title:s,placeholder:a,onConfirm:n,onCancel:r}){const[i,o]=c.useState("");c.useEffect(()=>{t&&o("")},[t]);const l=g=>{g.preventDefault(),i.trim()&&n(i.trim())},d=g=>{g.key==="Escape"&&r()};return e.jsx(xe,{isOpen:t,onClose:r,title:s,size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(O,{type:"button",onClick:r,variant:"outline",children:"Cancel"}),e.jsx(O,{type:"submit",disabled:!i.trim(),onClick:l,children:"Create"})]}),children:e.jsx("form",{onSubmit:l,children:e.jsx("input",{type:"text",value:i,onChange:g=>o(g.target.value),onKeyDown:d,placeholder:a,className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 focus:border-transparent",autoFocus:!0})})})}function Xs({task:t,executionId:s,currentStatus:a,loading:n={},canStart:r,isRunning:i,hasOutput:o,onStart:l,onStop:d,onRestart:g,onViewOutput:m}){const x=`start-${t.id}`,u=s?`stop-${s}`:"",p=`restart-${t.id}`;return e.jsx("div",{className:`py-1 px-3 border border-neutral-200 dark:border-neutral-700 rounded ${o?"hover:bg-neutral-50 dark:hover:bg-neutral-700/50 cursor-pointer":""}`,onClick:o&&s&&m?()=>m(t.id,t.name,s):void 0,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(kt,{status:a,size:"sm"}),e.jsx("div",{className:"text-sm text-neutral-900 dark:text-neutral-100 truncate",children:t.name})]}),e.jsxs("div",{className:"flex flex-shrink-0",children:[r&&l&&e.jsx(O,{variant:"ghost",size:"sm",onClick:k=>{k.stopPropagation(),l(t.id,t.name)},disabled:n[x],title:"Start task",children:e.jsx(qe,{size:12})}),i&&s&&d&&e.jsx(O,{variant:"ghost",size:"sm",onClick:k=>{k.stopPropagation(),d(s)},disabled:n[u],title:"Stop task",children:e.jsx(Pt,{size:12})}),i&&s&&g&&e.jsx(O,{variant:"ghost",size:"sm",onClick:k=>{k.stopPropagation(),g(t.id,t.name,s)},disabled:n[p],title:"Restart task",children:e.jsx(tt,{size:12})})]})]})})}const Qs=t=>{if(t==null)return"Uncategorized";switch(t){case pe.Build:return"Build";case pe.Test:return"Test";case pe.Start:return"Start";default:return"Unknown"}},Zs=t=>{const s=t.reduce((r,i)=>{const o=Qs(i.type);return r[o]||(r[o]=[]),r[o].push(i),r},{}),a=["Build","Test","Start"];return Object.entries(s).sort(([r],[i])=>{const o=a.indexOf(r),l=a.indexOf(i);return o===-1&&l===-1?r.localeCompare(i):o===-1?1:l===-1?-1:o-l})};function Jt({isSession:t,tasks:s,loading:a={},taskExecutions:n={},isReadonly:r=!1,onStart:i,onStop:o,onRestart:l,onViewOutput:d,emptyMessage:g="No tasks found",autoOpenOnGroupStart:m=!1}){const{getTaskExecutionId:x}=Je();if(s.length===0)return e.jsx("div",{className:"text-neutral-500 text-sm",children:g});const u=async w=>{if(!i||r)return;let N=0;w.forEach(h=>{const S=x(h.id,t)||h.taskExecutionId,D=(S?n[S]:null)?.status??h.status;(D===le.Pending||D===le.Failed||D===le.Completed||D===le.Canceled)&&(m?(setTimeout(()=>{i(h.id,h.name,m)},N),N+=100):i(h.id,h.name,m))})},p=w=>{!o||r||w.forEach(N=>{const C=x(N.id,t)||N.taskExecutionId;((C?n[C]:null)?.status??N.status)===le.Running&&C&&o(C)})},k=async w=>{if(!l||r)return;let N=0;w.forEach(h=>{const S=x(h.id,t)||h.taskExecutionId;((S?n[S]:null)?.status??h.status)===le.Running&&S&&(m?(setTimeout(()=>{l(h.id,h.name,S)},N),N+=100):l(h.id,h.name,S))})},b=w=>{let N=!1,h=!1;return w.forEach(C=>{const v=x(C.id,t)||C.taskExecutionId,j=(v?n[v]:null)?.status??C.status;j===le.Running&&(h=!0),(j===le.Pending||j===le.Failed||j===le.Completed||j===le.Canceled)&&(N=!0)}),{canStartAny:N,isAnyRunning:h}};return e.jsx("div",{className:"space-y-4",children:Zs(s).map(([w,N])=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"group px-2 py-1 bg-neutral-100 dark:bg-neutral-700 rounded text-xs text-neutral-700 dark:text-neutral-300 flex items-center justify-between",children:[e.jsx("span",{children:w}),!r&&(()=>{const{canStartAny:h,isAnyRunning:C}=b(N);return e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 flex gap-1",children:[h&&e.jsx(O,{variant:"ghost",size:"sm",onClick:S=>{S.stopPropagation(),u(N)},title:`Start all ${w.toLowerCase()} tasks`,className:"h-5 w-5 p-0 hover:bg-neutral-200! dark:hover:bg-neutral-600!",children:e.jsx(qe,{size:10})}),C&&e.jsx(O,{variant:"ghost",size:"sm",onClick:S=>{S.stopPropagation(),p(N)},title:`Stop all ${w.toLowerCase()} tasks`,className:"h-5 w-5 p-0 hover:bg-neutral-200! dark:hover:bg-neutral-600!",children:e.jsx(Pt,{size:10})}),C&&l&&e.jsx(O,{variant:"ghost",size:"sm",onClick:S=>{S.stopPropagation(),k(N)},title:`Restart all ${w.toLowerCase()} tasks`,className:"h-5 w-5 p-0 hover:bg-neutral-200! dark:hover:bg-neutral-600!",children:e.jsx(tt,{size:10})})]})})()]}),e.jsx("div",{className:"space-y-1 ml-2",children:N.map(h=>{const S=x(h.id,t)||h.taskExecutionId,D=(S?n[S]:null)?.status??h.status,j=D===le.Running,y=!r&&(D===le.Pending||D===le.Failed||D===le.Completed||D===le.Canceled),$=D!==le.Pending&&!!S;return e.jsx(Xs,{task:h,executionId:S,currentStatus:D,loading:a,canStart:y,isRunning:j,hasOutput:$,onStart:B=>i?.(B,h.name,!0),onStop:o,onRestart:l,onViewOutput:d},h.id)})})]},w))})}function ea({isOpen:t,title:s,message:a}){return e.jsx(xe,{isOpen:t,onClose:()=>{},title:s,size:"sm",contentClassName:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Xe,{size:"lg",className:"mx-auto mb-4"}),a&&e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:a})]})})}function Xt({output:t,className:s="",autoScroll:a=!0,placeholder:n="Waiting for output..."}){const r=c.useRef(null);c.useEffect(()=>{if(!a||!r.current)return;requestAnimationFrame(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)})},[t,a]);const i=!!t;return c.useEffect(()=>{a&&r.current&&requestAnimationFrame(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)})},[a,i]),e.jsx("div",{className:"bg-neutral-900 dark:bg-neutral-950 rounded-lg p-4 h-full select-text",children:e.jsx("pre",{ref:r,className:`font-mono text-sm text-neutral-100 whitespace-pre-wrap wrap-break-word overflow-y-auto ${s}`,children:t||n})})}function ta({isOpen:t,session:s,onClose:a,onRename:n}){const[r,i]=c.useState(""),[o,l]=c.useState(!1);c.useEffect(()=>{t&&s&&i(s.name||"")},[t,s]);const d=async m=>{if(m.preventDefault(),!(!r.trim()||!s||r.trim()===s.name)){l(!0);try{await n(r.trim()),a()}catch(x){console.error("Failed to rename session:",x)}finally{l(!1)}}},g=()=>{i(s?.name||""),a()};return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:g}),e.jsx("div",{className:"relative bg-white dark:bg-neutral-800 rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-4",children:"Rename Session"}),e.jsxs("form",{onSubmit:d,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"session-name",className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-2",children:"Session Name"}),e.jsx("input",{id:"session-name",type:"text",value:r,onChange:m=>i(m.target.value),placeholder:"Enter session name...",className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md shadow-sm bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 focus:border-transparent",autoFocus:!0,disabled:o,maxLength:100})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(O,{type:"button",variant:"outline",onClick:g,disabled:o,children:"Cancel"}),e.jsx(O,{type:"submit",disabled:o||!r.trim()||r.trim()===s?.name,children:o?"Renaming...":"Rename"})]})]})]})})]}):null}function bt({workspaceId:t,value:s,onSelect:a,placeholder:n="Select git branch",disabled:r=!1,className:i,autoSelectDefault:o=!0}){const[l,d]=c.useState([]),[g,m]=c.useState(!1);c.useEffect(()=>{t?x():d([])},[t]);const x=async()=>{try{m(!0);const u=await We.getGitBranches(t);if(d(u),o&&!s&&u.length>0){let p="";u.includes("main")?p="main":u.includes("master")?p="master":p=u[0],a(p)}}catch(u){console.error("Failed to load git branches:",u),d([])}finally{m(!1)}};return g?e.jsx("div",{className:`px-3 py-2 text-neutral-500 dark:text-neutral-400 ${i||""}`,children:"Loading branches..."}):l.length===0?e.jsx("div",{className:`px-3 py-2 text-neutral-500 dark:text-neutral-400 ${i||""}`,children:"No branches found"}):e.jsx(ze,{options:l.map(u=>({value:u,label:u})),value:s,placeholder:n,onSelect:u=>a(u.value),disabled:r,className:i})}function $e({fileName:t,isFolder:s=!1,size:a=16,className:n=""}){if(s)return e.jsx(ns,{size:a,className:n});const r=t.split(".").pop()?.toLowerCase(),i=t.toLowerCase();return(()=>{if(i==="package.json"||i==="package-lock.json")return e.jsx(Wt,{size:a,className:n});if(i==="dockerfile"||i===".dockerignore")return e.jsx(is,{size:a,className:n});if(i==="readme.md"||i==="readme.txt")return e.jsx(ls,{size:a,className:n});if(i===".gitignore"||i===".gitattributes")return e.jsx(mt,{size:a,className:n});if(i===".env"||i.startsWith(".env."))return e.jsx(os,{size:a,className:n});switch(r){case"js":case"jsx":case"ts":case"tsx":case"vue":case"svelte":return e.jsx(dt,{size:a,className:n});case"html":case"htm":return e.jsx(Mt,{size:a,className:n});case"css":case"scss":case"sass":case"less":return e.jsx(ms,{size:a,className:n});case"json":case"jsonc":return e.jsx(gs,{size:a,className:n});case"xml":case"yml":case"yaml":case"toml":case"ini":case"conf":case"config":return e.jsx(It,{size:a,className:n});case"sql":case"db":case"sqlite":return e.jsx(us,{size:a,className:n});case"png":case"jpg":case"jpeg":case"gif":case"svg":case"webp":case"ico":return e.jsx(ds,{size:a,className:n});case"md":case"txt":case"rtf":return e.jsx(Lt,{size:a,className:n});case"sh":case"bash":case"zsh":case"fish":case"ps1":case"bat":case"cmd":return e.jsx(Ue,{size:a,className:n});case"py":case"rb":case"go":case"rs":case"cpp":case"c":case"h":case"java":case"kt":case"swift":case"php":return e.jsx(dt,{size:a,className:n});default:return e.jsx(cs,{size:a,className:n})}})()}function sa(){return e.jsx("div",{className:"flex h-full",children:e.jsx("div",{className:"flex-1 bg-neutral-50 dark:bg-neutral-900",children:e.jsx("div",{className:"flex flex-col h-full",children:e.jsx("div",{className:"flex-1 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg shadow-sm border border-neutral-200 dark:border-neutral-700 p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900 dark:text-neutral-100 mb-4",children:"Welcome to Polygent"}),e.jsx("p",{className:"text-neutral-600 dark:text-neutral-300",children:"Your AI agent orchestration platform is ready. Start by creating a workspace, agent or a new development session."})]})})})})})})}function aa(t){const{setActiveSessionId:s,getSession:a,updateSession:n,getSessionTabs:r,getSessionActiveTabId:i,getTabContentById:o,setSessionTabs:l,setSessionActiveTabId:d,addSessionTab:g,removeSessionTab:m,resetSessionTabs:x,initializeSessionTabs:u,setActiveWorkspaceId:p}=fe(),{getTaskExecution:k}=Je(),b=a(t),w=r(t),N=i(t);c.useEffect(()=>{b?b.workspaceId&&p(b.workspaceId):(async()=>{try{const Y=await Z.getById(t);n(Y),Y.workspaceId&&p(Y.workspaceId)}catch(Y){console.error("Failed to fetch session status:",Y)}})()},[t,b,n,x,p]),c.useEffect(()=>{s(t),u(t)},[t,s,u]),c.useEffect(()=>{const E=(ne,re,f,W,L)=>{const V=r(t).map(K=>K.content.type==="task"&&K.content.taskExecutionId===W?{...K,content:{...K.content,status:L,endTime:L===le.Completed||L===le.Failed?new Date:K.content.endTime}}:K);l(t,V)},Y=(ne,re,f,W,L)=>{const V=r(t).map(K=>{if(K.content.type==="task"&&K.content.taskExecutionId===W){const te=K.content.output||"";return{...K,content:{...K.content,output:L??te}}}return K});l(t,V)},J=de.on("onTaskStatusChanged",E),ce=de.on("onTaskOutputChanged",Y);return()=>{J(),ce()}},[t,r,l]);const h=(E,Y)=>({id:`${E.type}-${Date.now()}`,content:E,title:Y,isDirty:!1}),C=async(E,Y)=>{const ce=r(t).find(ne=>ne.content.type==="file"&&ne.content.path===E);if(ce){d(t,ce.id);return}try{const{content:ne,lastModified:re}=await Z.getFileContent(t,E),f=Tt(E),L=h({type:"file",path:E,name:Y,content:ne,language:f,lastModified:re,editableContent:ne},Y);g(t,L),d(t,L.id)}catch(ne){console.error("Failed to load file:",ne)}},S=async(E,Y,J)=>{const ne=r(t).find(re=>re.content.type==="diff"&&re.content.path===E&&re.id.includes(J||"WorkingVsHead"));if(ne){d(t,ne.id);return}try{let re="",f="";if(J==="StagedVsHead"){const[V,K]=await Promise.all([Z.getGitFileContent(t,E,"Staged"),Z.getGitFileContent(t,E,"Head")]);re=K.content,f=V.content}else if(J==="WorkingVsStaged"){const[V,K]=await Promise.all([Z.getGitFileContent(t,E,"Working"),Z.getGitFileContent(t,E,"Staged")]);re=K.content,f=V.content}else{const[V,K]=await Promise.all([Z.getGitFileContent(t,E,"Working"),Z.getGitFileContent(t,E,"Head")]);re=K.content,f=V.content}const W=Tt(E),H=h({type:"diff",path:E,name:Y,original:re,modified:f,language:W},`${Y} (Diff)`);H.id=`${H.id}-${J||"WorkingVsHead"}`,g(t,H),d(t,H.id)}catch(re){console.error("Failed to load full content diff:",re);const W=h({type:"diff",path:E,name:Y,original:"",modified:"",language:"text"},`${Y} (Diff)`);W.id=`${W.id}-${J||"WorkingVsHead"}`,g(t,W),d(t,W.id)}},v=(E,Y)=>{const J=k(E),ce=J?.status||le.Running,ne=J?.output||"",re={type:"task",taskExecutionId:E,name:Y,status:ce,output:ne,startTime:J?.startTime||new Date,endTime:J?.endTime},f=r(t),W=f.find(L=>L.content.type==="task"&&L.content.taskExecutionId===E);if(W){const L=f.map(H=>H.id===W.id?{...H,content:{...H.content,...re}}:H);l(t,L),d(t,W.id)}else{const L=h(re,Y);g(t,L),d(t,L.id)}},D=()=>{d(t,"chat")},j=E=>{m(t,E)},y=E=>{d(t,E)},$=async()=>{try{return await Z.mergeToMain(t)}catch(E){throw console.error("Failed to merge to main:",E),E}},B=async()=>{try{return await Z.pushBranch(t)}catch(E){throw console.error("Failed to push branch:",E),E}},G=async()=>{try{return await Z.pullFromStarterBranch(t)}catch(E){throw console.error("Failed to pull from starter branch:",E),E}},A=async()=>{try{const E=await Z.resetSession(t);return x(t),E}catch(E){throw console.error("Failed to reset session:",E),E}},R=async()=>{try{return await Z.cancelSession(t)}catch(E){throw console.error("Failed to cancel session:",E),E}},ae=async()=>{try{return await Z.stopWorkingMessages(t)}catch(E){throw console.error("Failed to stop working messages:",E),E}},z=async()=>{try{return await Z.openWithVSCode(t)}catch(E){throw console.error("Failed to open with VSCode:",E),E}},se=async E=>{try{const{content:Y,lastModified:J}=await Z.getFileContent(t,E),ne=r(t).map(re=>re.content.type==="file"&&re.content.path===E?{...re,content:{...re.content,content:Y,lastModified:J}}:re);l(t,ne)}catch(Y){throw console.error("Failed to refresh file content:",Y),Y}},_=b?.status===be.Canceled||b?.status===be.Done;return{tabs:w,activeTabId:N,getTabContentById:E=>o(t,E),session:b,isSessionReadonly:_,openFile:C,openDiff:S,openTask:v,openChat:D,closeTab:j,switchTab:y,refreshFileContent:se,mergeToMain:$,pushBranch:B,pullFromStarterBranch:G,resetSession:A,cancelSession:R,stopWorkingMessages:ae,openWithVSCode:z}}function Tt(t){const s=t.split(".").pop()?.toLowerCase();return{ts:"typescript",tsx:"typescript",js:"javascript",jsx:"javascript",json:"json",css:"css",scss:"scss",html:"html",md:"markdown",py:"python",cs:"csharp",java:"java",php:"php",rb:"ruby",go:"go",rs:"rust",sql:"sql",sh:"shell",yml:"yaml",yaml:"yaml",xml:"xml",dockerfile:"dockerfile"}[s||""]||"text"}const Et={gitStatus:null,isLoading:!1,error:null,enabled:!0},vt=He((t,s)=>({sessionGitStatus:{},setGitStatus:(a,n)=>t(r=>({sessionGitStatus:{...r.sessionGitStatus,[a]:n}})),updateGitStatus:(a,n)=>t(r=>({sessionGitStatus:{...r.sessionGitStatus,[a]:{...r.sessionGitStatus[a]||Et,...n}}})),clearGitStatus:a=>t(n=>{const{[a]:r,...i}=n.sessionGitStatus;return{sessionGitStatus:i}}),getGitStatusForSession:a=>s().sessionGitStatus[a],fetchGitStatus:async a=>{const{getGitStatusForSession:n,updateGitStatus:r,setGitStatus:i}=s(),l=n(a)?.enabled??!0;if(l){r(a,{isLoading:!0,error:null});try{const d=await Z.getGitStatus(a);i(a,{gitStatus:d,isLoading:!1,error:null,enabled:l}),fe.getState().refreshDiffTabs(a)}catch(d){const g=d instanceof Error?d.message:"Failed to fetch git status";i(a,{gitStatus:null,isLoading:!1,error:g,enabled:l})}}},setEnabled:(a,n)=>t(r=>({sessionGitStatus:{...r.sessionGitStatus,[a]:{...r.sessionGitStatus[a]||Et,enabled:n}}}))}));function nt(t){const{getGitStatusForSession:s,fetchGitStatus:a,setEnabled:n}=vt(),r=s(t),i=r?.gitStatus||null,o=r?.isLoading||!1,l=r?.error||null,d=c.useCallback(async()=>{await a(t)},[t,a]),g=c.useCallback(m=>{n(t,m)},[t,n]);return{gitStatus:i,isLoading:o,error:l,setEnabled:g,fetchGitStatus:d}}function ra({sessionId:t,isSessionReadonly:s,session:a,onMergeToMain:n,onPushBranch:r,onPullFromStarterBranch:i,onResetSession:o,onCancelSession:l,onStopWorkingMessages:d,onOpenWithVSCode:g,isVSCodeAvailable:m,onDeployToEnvironment:x,onSessionNameUpdate:u,autoDeployEnabled:p,selectedEnvironmentId:k,restartAfterSync:b,onAutoDeployChange:w,onSelectedEnvironmentIdChange:N,onRestartAfterSyncChange:h,messagesCount:C,isCriticalOperationRunning:S=!1}){const[v,D]=c.useState({}),[j,y]=c.useState(!1),[$,B]=c.useState(null),{workspaces:G}=fe(),{gitStatus:A}=nt(t),{environments:R,loading:ae,error:z,refetch:se}=Qe({workspaceId:a?.workspaceId||1,autoLoad:!!a?.workspaceId});c.useEffect(()=>{a?.agentId&&(async()=>{try{const oe=await Me.getById(a.agentId);B(oe)}catch(oe){console.error("Failed to load agent:",oe),B(null)}})()},[a?.agentId]);const[_,E]=c.useState({isOpen:!1,title:"",message:"",action:async()=>({message:""})}),Y=async(te,oe)=>{D(M=>({...M,[te]:!0}));try{await oe()}catch(M){console.error(`${te} failed:`,M)}finally{D(M=>({...M,[te]:!1}))}},J=(te,oe,M,T="warning")=>{E({isOpen:!0,title:te,message:oe,action:M,variant:T})},ce=async()=>{E(oe=>({...oe,isOpen:!1}));const te=_.action.name||"action";await Y(te,_.action)},ne=()=>{E(te=>({...te,isOpen:!1}))},re=async te=>{if(!a)throw new Error("No session available");try{await Z.update(a.id,{name:te}),u(te)}catch(oe){throw console.error("Failed to update session name:",oe),oe}},f=()=>{switch(a?.status){case be.Waiting:return"Waiting";case be.InProgress:return"In Progress";case be.Done:return"Completed";case be.Canceled:return"Canceled";default:return"Unknown"}},W=()=>A?A.stagedFiles.length>0||A.unstagedFiles.length>0||A.untrackedFiles.length>0:!1,L=()=>C>0||W(),H=()=>W(),K=["mergeToMain","pushBranch","pullFromStarterBranch","resetSession","cancelSession"].some(te=>v[te])||S;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 text-neutral-900 dark:text-neutral-100",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm mb-2",children:"Session"}),e.jsxs("div",{className:"text-xs bg-neutral-100 dark:bg-neutral-700 p-3 flex flex-col gap-2 rounded",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name: "}),e.jsx("span",{className:`px-1 py-0.5 rounded ${s?"cursor-default":"cursor-pointer hover:bg-neutral-200 dark:hover:bg-neutral-600 hover:underline"}`,onClick:()=>!s&&!K&&y(!0),title:s?"Read-only mode":"Click to rename",children:a?.name||"Untitled Session"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Id: "}),e.jsx("span",{children:a?.id})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status: "}),e.jsx("span",{children:f()})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Workspace: "}),e.jsx("span",{children:G.find(te=>te.id===a?.workspaceId)?.name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Agent: "}),e.jsx("span",{children:$?`${$.name}`+($.roleName?` (${$.roleName})`:""):"Loading..."})]})]})]}),R.length>0&&!s&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm mb-2",children:"Auto Deploy"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"autoDeploy",checked:p,onChange:te=>w(te.target.checked),disabled:K,className:"rounded border-neutral-300 dark:border-neutral-600 text-purple-600 dark:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed"}),e.jsx("label",{htmlFor:"autoDeploy",className:"text-sm text-neutral-700 dark:text-neutral-300 cursor-pointer",children:"Enable Auto Deploy"})]}),p&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:"Deploy to environment:"}),ae?e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"Loading environments..."}):z?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"text-xs text-red-500 dark:text-red-400",children:["Error: ",z]}),e.jsx("button",{onClick:se,className:"text-xs px-2 py-1 bg-red-100 hover:bg-red-200 dark:bg-red-900 dark:hover:bg-red-800 text-red-600 dark:text-red-400 rounded",children:"Retry"})]}):e.jsxs("select",{value:k,onChange:te=>N(te.target.value),disabled:R.length===0||K,className:"w-full text-xs border border-neutral-300 dark:border-neutral-600 rounded px-2 py-1 bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:R.length===0?"No environments found":"Select environment..."}),R.map(te=>e.jsx("option",{value:te.id.toString(),children:te.name},te.id))]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"restartAfterSync",checked:b,onChange:te=>h(te.target.checked),disabled:K,className:"rounded border-neutral-300 dark:border-neutral-600 text-purple-600 dark:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed"}),e.jsx("label",{htmlFor:"restartAfterSync",className:"text-xs text-neutral-600 dark:text-neutral-400 cursor-pointer",children:"Restart after sync"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm mb-2",children:"Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{variant:"outline",size:"sm",className:"w-full",onClick:()=>J("Complete and Merge into Main","Are you sure you want to merge this session to the main branch? This action cannot be undone.",n,"warning"),disabled:s||v.mergeToMain||!H()||K,children:v.mergeToMain?"Merging...":"Complete and Merge into Main"}),e.jsx(O,{variant:"outline",size:"sm",className:"w-full",onClick:()=>J("Mark as Completed","Are you sure you want to push this branch and mark the session as completed?",r,"info"),disabled:s||v.pushBranch||!L()||K,children:v.pushBranch?"Completing...":"Mark as Completed"}),e.jsx(O,{variant:"outline",size:"sm",className:"w-full",onClick:()=>J("Pull from Starter Branch","Are you sure you want to pull changes from the starter branch? This may overwrite local changes.",i,"warning"),disabled:s||v.pullFromStarterBranch||K,children:v.pullFromStarterBranch?"Pulling...":"Pull from Starter Branch"}),R.length>0&&e.jsx(O,{variant:"outline",size:"sm",className:"w-full",onClick:x,disabled:s||!H()||K,children:p&&k?`Deploy to ${R.find(te=>te.id.toString()===k)?.name||"Environment"}`:"Deploy to Environment"}),m&&e.jsx(O,{variant:"outline",size:"sm",className:"w-full",onClick:()=>Y("openWithVSCode",g),disabled:v.openWithVSCode||s||K,children:v.openWithVSCode?"Opening...":"Open with VSCode"}),a?.status===be.InProgress&&e.jsx(O,{variant:"outline",size:"sm",className:"w-full text-orange-600 hover:text-orange-700 border-orange-300 hover:border-orange-400",onClick:()=>J("Stop Progress","Are you sure you want to stop working messages? This will cancel any currently processing messages.",d,"warning"),disabled:s||v.stopWorkingMessages||K,children:v.stopWorkingMessages?"Stopping...":"Stop"}),e.jsx(O,{variant:"outline",size:"sm",className:"w-full",onClick:()=>J("Reset Session","Are you sure you want to reset this session? All progress and changes will be lost.",o,"danger"),disabled:s||v.resetSession||!L()||K,children:v.resetSession?"Resetting...":"Reset"}),e.jsx(O,{variant:"outline",size:"sm",className:"w-full text-red-600 hover:text-red-700",onClick:()=>J("Cancel Session","Are you sure you want to cancel this session? All progress and changes will be lost.",l,"danger"),disabled:s||v.cancelSession||K,children:v.cancelSession?"Canceling...":"Cancel"})]})]})]}),e.jsx(Te,{isOpen:_.isOpen,title:_.title,message:_.message,variant:_.variant,onConfirm:ce,onCancel:ne}),e.jsx(ta,{isOpen:j,session:a,onClose:()=>y(!1),onRename:re})]})}const At=t=>{const s={name:"",path:"",isFolder:!0,children:new Map};return t.forEach(({filePath:a,changeType:n,type:r})=>{const i=a.split("/");let o=s,l="";i.forEach((d,g)=>{const m=g===i.length-1;l=l?`${l}/${d}`:d,o.children.has(d)||o.children.set(d,{name:d,path:l,isFolder:!m,children:new Map,...m&&{fileInfo:{changeType:n,type:r}}}),o=o.children.get(d)})}),s};function na({sessionId:t=1,isSessionReadonly:s=!1,onOpenDiff:a}){const{gitStatus:n,isLoading:r,error:i,fetchGitStatus:o}=nt(t),[l,d]=c.useState(!1),[g,m]=c.useState(!1),[x,u]=c.useState(new Set);c.useEffect(()=>{const f=()=>{o()};return window.addEventListener("focus",f),()=>{window.removeEventListener("focus",f)}},[o]);const p=f=>{if(!n)return!1;const W=n.stagedFiles.some(H=>H.filePath===f),L=n.unstagedFiles.some(H=>H.filePath===f);return W&&L},[k,b]=c.useState({unstageAll:!1,discardAll:!1,stageAll:!1,unstageFile:null,discardFile:null,stageFile:null}),w=f=>{switch(f){case Ie.Added:return"+";case Ie.Modified:return"M";case Ie.Deleted:return"D";case Ie.Renamed:return"R";case Ie.Copied:return"C";default:return"M"}},N=async()=>{if(!s){b(f=>({...f,unstageAll:!0}));try{await Z.unstageAllChanges(t),await o()}catch(f){console.error("Failed to unstage all changes:",f)}finally{b(f=>({...f,unstageAll:!1}))}}},{confirmDialog:h,showConfirm:C,handleConfirm:S,handleCancel:v}=Kt(),{alertDialog:D,showAlert:j,handleConfirm:y}=at(),$=async()=>{C({title:"Discard All Changes",message:"Are you sure you want to discard all changes? This action cannot be undone.",variant:"danger",confirmText:"Discard All",onConfirm:async()=>{if(!s){b(f=>({...f,discardAll:!0}));try{await Z.discardAllChanges(t),await o()}catch(f){console.error("Failed to discard all changes:",f)}finally{b(f=>({...f,discardAll:!1}))}}}})},B=async f=>{if(!s){b(W=>({...W,unstageFile:f}));try{await se(async()=>{await Z.unstageFile(t,f)}),await o()}catch(W){console.error("Failed to unstage file:",W);const L=f.split("/").pop();j({title:"Unstage Failed",message:`Failed to unstage ${L}. Please try again.`,variant:"danger"})}finally{b(W=>({...W,unstageFile:null}))}}},G=async f=>{const W=f.split("/").pop();C({title:"Discard File Changes",message:`Are you sure you want to discard changes to ${W}? This action cannot be undone.`,variant:"danger",confirmText:"Discard Changes",onConfirm:async()=>{if(!s){b(L=>({...L,discardFile:f}));try{await se(async()=>{await Z.discardFileChanges(t,f)}),await o()}catch(L){console.error("Failed to discard file changes:",L),j({title:"Discard Failed",message:`Failed to discard changes to ${W}. Please try again.`,variant:"danger"})}finally{b(L=>({...L,discardFile:null}))}}}})},A=async()=>{if(!s){b(f=>({...f,stageAll:!0}));try{await Z.stageAllChanges(t),await o()}catch(f){console.error("Failed to stage all changes:",f)}finally{b(f=>({...f,stageAll:!1}))}}},R=async f=>{if(!s){b(W=>({...W,stageFile:f}));try{await se(async()=>{await Z.stageFile(t,f)}),await o()}catch(W){console.error("Failed to stage file:",W);const L=f.split("/").pop();j({title:"Stage Failed",message:`Failed to stage ${L}. Please try again.`,variant:"danger"})}finally{b(W=>({...W,stageFile:null}))}}},ae=f=>{const W=new Set(x);W.has(f)?W.delete(f):W.add(f),u(W)},z=(f,W)=>{const L=[],H=V=>{V.isFolder?Array.from(V.children.values()).forEach(K=>{H(K)}):V.fileInfo?.type===W&&L.push(V.path)};return H(f),L},se=async(f,W=3,L=100)=>{for(let H=1;H<=W;H++)try{await f();return}catch(V){const K=H===W;if((V?.message?.includes("index.lock")||V?.detail?.includes("index.lock"))&&!K){const oe=L*Math.pow(2,H-1);await new Promise(M=>setTimeout(M,oe));continue}throw V}},_=async f=>{if(s)return;const W=z(f,"unstaged").concat(z(f,"untracked"));if(W.length===0)return;b(V=>({...V,stageFile:f.path}));const L=[],H=[];try{for(const V of W)try{await se(async()=>{await Z.stageFile(t,V)}),L.push(V)}catch(K){console.error(`Failed to stage file ${V}:`,K),H.push(V)}if(await o(),H.length>0){const V=L.length,K=H.length,te=`Staging completed with ${V} success(es) and ${K} failure(s).
Failed files: ${H.map(oe=>oe.split("/").pop()).join(", ")}`;j({title:"Unstaging Results",message:te.replace(/\n/g,`

`),variant:"warning"})}}catch(V){console.error("Failed to stage folder files:",V);const K=L.length>0?`Partially completed: ${L.length} file(s) staged successfully. ${H.length} file(s) failed.`:"Failed to stage files. Please try again or refresh the page if the issue persists.";j({title:"Operation Results",message:K,variant:"warning"})}finally{b(V=>({...V,stageFile:null}))}},E=async f=>{if(s)return;const W=z(f,"staged");if(W.length===0)return;b(V=>({...V,unstageFile:f.path}));const L=[],H=[];try{for(const V of W)try{await se(async()=>{await Z.unstageFile(t,V)}),L.push(V)}catch(K){console.error(`Failed to unstage file ${V}:`,K),H.push(V)}if(await o(),H.length>0){const V=L.length,K=H.length,te=`Unstaging completed with ${V} success(es) and ${K} failure(s).
Failed files: ${H.map(oe=>oe.split("/").pop()).join(", ")}`;j({title:"Unstaging Results",message:te.replace(/\n/g,`

`),variant:"warning"})}}catch(V){console.error("Failed to unstage folder files:",V);const K=L.length>0?`Partially completed: ${L.length} file(s) unstaged successfully. ${H.length} file(s) failed.`:"Failed to unstage files. Please try again or refresh the page if the issue persists.";j({title:"Operation Results",message:K,variant:"warning"})}finally{b(V=>({...V,unstageFile:null}))}},Y=async f=>{s||z(f,"unstaged").length===0||C({title:"Discard Folder Changes",message:`Are you sure you want to discard all changes in "${f.name}"? This action cannot be undone.`,variant:"danger",confirmText:"Discard All",onConfirm:()=>J(f)})},J=async f=>{if(s)return;const W=z(f,"unstaged");if(W.length===0)return;b(V=>({...V,discardFile:f.path}));const L=[],H=[];try{for(const V of W)try{await se(async()=>{await Z.discardFileChanges(t,V)}),L.push(V)}catch(K){console.error(`Failed to discard file ${V}:`,K),H.push(V)}if(await o(),H.length>0){const V=L.length,K=H.length,te=`Discard completed with ${V} success(es) and ${K} failure(s).
Failed files: ${H.map(oe=>oe.split("/").pop()).join(", ")}`;j({title:"Unstaging Results",message:te.replace(/\n/g,`

`),variant:"warning"})}}catch(V){console.error("Failed to discard folder files:",V);const K=L.length>0?`Partially completed: ${L.length} file(s) discarded successfully. ${H.length} file(s) failed.`:"Failed to discard files. Please try again or refresh the page if the issue persists.";j({title:"Operation Results",message:K,variant:"warning"})}finally{b(V=>({...V,discardFile:null}))}},ce=(f,W=0,L)=>{const H=!x.has(f.path),V={paddingLeft:`${W*12}px`};if(f.isFolder){const K=f.children.size>0,te=z(f,"staged"),oe=z(f,"unstaged"),M=z(f,"untracked"),T=te.length>0||oe.length>0||M.length>0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center py-1 text-sm cursor-pointer hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded flex-1 min-w-0",style:V,onClick:()=>K&&ae(f.path),children:[K&&e.jsx(e.Fragment,{children:H?e.jsx(it,{className:"w-3 h-3 mr-1 flex-shrink-0"}):e.jsx(_e,{className:"w-3 h-3 mr-1 flex-shrink-0"})}),e.jsx($e,{fileName:f.name,isFolder:!0,size:14,className:"mr-2 flex-shrink-0"}),e.jsx("span",{className:"truncate text-neutral-700 dark:text-neutral-300",children:f.name})]}),T&&e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 pr-2",children:[te.length>0&&e.jsx("button",{onClick:P=>{P.stopPropagation(),E(f)},disabled:k.unstageFile===f.path||s,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:`Unstage all files in ${f.name} (${te.length} files)`,children:k.unstageFile===f.path?e.jsx(je,{className:"w-3 h-3 animate-spin"}):e.jsx(lt,{className:"w-3 h-3"})}),oe.length>0&&e.jsx("button",{onClick:P=>{P.stopPropagation(),Y(f)},disabled:k.discardFile===f.path||s,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:`Discard all changes in ${f.name} (${oe.length} files)`,children:k.discardFile===f.path?e.jsx(je,{className:"w-3 h-3 animate-spin"}):e.jsx(wt,{className:"w-3 h-3"})}),(oe.length>0||M.length>0)&&e.jsx("button",{onClick:P=>{P.stopPropagation(),_(f)},disabled:k.stageFile===f.path||s,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:`Stage all files in ${f.name} (${oe.length+M.length} files)`,children:k.stageFile===f.path?e.jsx(je,{className:"w-3 h-3 animate-spin"}):e.jsx(ke,{className:"w-3 h-3"})})]})]}),H&&K&&e.jsx("div",{children:Array.from(f.children.values()).sort((P,Q)=>P.isFolder&&!Q.isFolder?-1:!P.isFolder&&Q.isFolder?1:P.name.localeCompare(Q.name)).map(P=>ce(P,W+1,L))})]},f.path)}else{const{changeType:K,type:te}=f.fileInfo,oe=f.path.split("/").pop()||f.path;return e.jsxs("div",{className:"flex items-center justify-between group ps-2",children:[e.jsxs("div",{className:"flex items-center py-1 text-sm cursor-pointer hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded flex-1 min-w-0",style:V,onClick:()=>a(f.path,oe,L),title:"Click to view full content comparison",children:[e.jsx($e,{fileName:f.name,size:14,className:"mx-2 flex-shrink-0"}),e.jsxs("span",{className:"truncate text-neutral-700 dark:text-neutral-300",children:[e.jsx("span",{className:"inline-block w-3 text-center",children:w(K)})," ",f.name]})]}),e.jsx("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 pr-2",children:te==="staged"?e.jsx("button",{onClick:M=>{M.stopPropagation(),B(f.path)},disabled:k.unstageFile===f.path||s,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:"Unstage file",children:k.unstageFile===f.path?e.jsx(je,{className:"w-3 h-3 animate-spin"}):e.jsx(lt,{className:"w-3 h-3"})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:M=>{M.stopPropagation(),G(f.path)},disabled:k.discardFile===f.path||s,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:"Discard file changes",children:k.discardFile===f.path?e.jsx(je,{className:"w-3 h-3 animate-spin"}):e.jsx(wt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:M=>{M.stopPropagation(),R(f.path)},disabled:k.stageFile===f.path||s,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:"Stage file",children:k.stageFile===f.path?e.jsx(je,{className:"w-3 h-3 animate-spin"}):e.jsx(ke,{className:"w-3 h-3"})})]})})]},f.path)}};if(i)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:"Git Status"}),e.jsx("button",{onClick:o,className:"p-1 rounded hover:bg-neutral-100 dark:hover:bg-neutral-700",title:"Refresh",children:e.jsx(je,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400",children:[e.jsx(xt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:i})]})]});const ne=n?.stagedFiles?At(n.stagedFiles.map(f=>({filePath:f.filePath,changeType:f.changeType,type:"staged"}))):null,re=n?At([...(n.unstagedFiles||[]).map(f=>({filePath:f.filePath,changeType:f.changeType,type:"unstaged"})),...(n.untrackedFiles||[]).map(f=>({filePath:f,changeType:Ie.Added,type:"untracked"}))]):null;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:"Git Status"}),!s&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:o,disabled:r,className:"p-1 rounded hover:bg-neutral-100 dark:hover:bg-neutral-700 disabled:opacity-50",title:"Refresh",children:e.jsx(je,{className:`w-4 h-4 ${r?"animate-spin":""}`})})})]}),s?e.jsx("div",{className:"text-sm opacity-50",children:"You are viewing a read-only session."}):e.jsxs(e.Fragment,{children:[ne&&ne.children.size>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"group flex items-center justify-between mb-2",children:[e.jsxs("button",{className:"flex items-center gap-2 text-sm text-neutral-900 dark:text-neutral-100 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded p-1",onClick:()=>d(!l),children:[l?e.jsx(_e,{className:"w-4 h-4"}):e.jsx(it,{className:"w-4 h-4"}),"Staged Changes (",n?.stagedFiles?.length||0,")"]}),e.jsx("button",{onClick:N,disabled:k.unstageAll||s,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50 opacity-0 group-hover:opacity-100",title:"Unstage all changes",children:k.unstageAll?e.jsx(je,{className:"w-4 h-4 animate-spin"}):e.jsx(lt,{className:"w-4 h-4"})})]}),!l&&e.jsx("div",{className:"ml-2",children:Array.from(ne.children.values()).sort((f,W)=>f.isFolder&&!W.isFolder?-1:!f.isFolder&&W.isFolder?1:f.name.localeCompare(W.name)).map(f=>ce(f,0,"StagedVsHead"))})]}),re&&re.children.size>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"group flex items-center justify-between mb-2",children:[e.jsxs("button",{className:"flex items-center gap-2 text-sm text-neutral-900 dark:text-neutral-100 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded p-1",onClick:()=>m(!g),children:[g?e.jsx(_e,{className:"w-4 h-4"}):e.jsx(it,{className:"w-4 h-4"}),"Changes (",(n?.unstagedFiles?.length||0)+(n?.untrackedFiles?.length||0),")"]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 pr-2",children:[e.jsx("button",{onClick:$,disabled:k.discardAll||s,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:"Discard all changes",children:k.discardAll?e.jsx(je,{className:"w-4 h-4 animate-spin"}):e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:A,disabled:k.stageAll||s,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:"Stage all changes",children:k.stageAll?e.jsx(je,{className:"w-4 h-4 animate-spin"}):e.jsx(ke,{className:"w-4 h-4"})})]})]}),!g&&e.jsx("div",{className:"ml-2",children:Array.from(re.children.values()).sort((f,W)=>f.isFolder&&!W.isFolder?-1:!f.isFolder&&W.isFolder?1:f.name.localeCompare(W.name)).map(f=>ce(f,0,p(f.path)?"WorkingVsStaged":"WorkingVsHead"))})]}),n&&(n.stagedFiles?.length||0)===0&&(n.unstagedFiles?.length||0)===0&&(n.untrackedFiles?.length||0)===0&&e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400 text-center py-4",children:"No changes detected"}),r&&!n&&e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400 text-center py-4",children:"Loading git status..."})]}),e.jsx(Te,{isOpen:h.isOpen,title:h.title,message:h.message,confirmText:h.confirmText,cancelText:h.cancelText,variant:h.variant,onConfirm:S,onCancel:v}),e.jsx(rt,{isOpen:D.isOpen,title:D.title,message:D.message,confirmText:D.confirmText,variant:D.variant,onConfirm:y})]})}function ia({sessionId:t,activeFilePath:s,isSessionReadonly:a=!1,onOpenFile:n}){const[r,i]=c.useState([]),[o,l]=c.useState(!0),[d,g]=c.useState(null),{confirmDialog:m,showConfirm:x,handleConfirm:u,handleCancel:p}=Kt(),{alertDialog:k,showAlert:b,handleConfirm:w}=at(),[N,h]=c.useState(new Set),C=c.useRef(null),S=c.useRef(new Map);c.useEffect(()=>{if(!s||r.length===0)return;const T=setTimeout(async()=>{const P=s.split("/").filter(F=>F.length>0);if(P.length<=1)return;const Q=[];for(let F=0;F<P.length-1;F++){const I=P.slice(0,F+1).join("/");Q.push(I)}for(const F of Q)if(!N.has(F)){h(U=>new Set([...U,F]));const I=await v(F);await new Promise(U=>setTimeout(U,I?150:50))}},50);return()=>clearTimeout(T)},[s,r.length]);const v=async M=>{const T=(Q,F)=>{for(const I of Q){if(I.path===F&&I.isDirectory)return I;if(I.children){const U=T(I.children,F);if(U)return U}}return null},P=T(r,M);if(P&&!P.isLoaded&&!P.isLoading){const Q=(F,I)=>F.map(U=>U.path===I&&U.isDirectory?{...U,isLoading:!0}:U.children?{...U,children:Q(U.children,I)}:U);i(F=>Q(F,M));try{const F=await Y(M),I=(U,X,ie)=>U.map(ee=>ee.path===X&&ee.isDirectory?{...ee,children:ie,isLoaded:!0,isLoading:!1}:ee.children?{...ee,children:I(ee.children,X,ie)}:ee);return i(U=>I(U,M,F)),!0}catch(F){console.error(`Failed to load folder ${M}:`,F);const I=(U,X)=>U.map(ie=>ie.path===X&&ie.isDirectory?{...ie,isLoading:!1}:ie.children?{...ie,children:I(ie.children,X)}:ie);return i(U=>I(U,M)),!1}}return P?.isLoaded||!1};c.useEffect(()=>{if(!s||r.length===0)return;const T=setTimeout(()=>{const P=s.split("/").filter(I=>I.length>0);if(P.length<=1)return;const Q=[];for(let I=0;I<P.length-1;I++){const U=P.slice(0,I+1).join("/");Q.push(U)}const F=Q.filter(I=>!N.has(I));F.length>0&&h(I=>{const U=new Set(I);return F.forEach(X=>U.add(X)),U})},200);return()=>clearTimeout(T)},[s,N,r.length]),c.useEffect(()=>{if(!s||!C.current)return;const M=()=>{const P=S.current.get(s);P?P.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}):setTimeout(M,100)},T=setTimeout(M,200);return()=>clearTimeout(T)},[s,N,r]);const[D,j]=c.useState(new Set),[y,$]=c.useState({visible:!1,x:0,y:0}),{editors:B,isInitializing:G}=yt(),[A,R]=c.useState({isOpen:!1}),[ae,z]=c.useState({isOpen:!1}),[se,_]=c.useState({isOpen:!1});c.useEffect(()=>{(async()=>{if(a){l(!1);return}try{l(!0);const T=await Z.getFiles(t),P=E(T);i(P)}catch(T){console.error("Failed to fetch session files:",T),g("Failed to load files")}finally{l(!1)}})()},[t,a]);const E=M=>M.map(P=>({name:P.fileName,path:P.relativePath,isDirectory:P.isDirectory,children:P.isDirectory?[]:void 0,size:P.isDirectory?void 0:P.size,lastModified:P.lastModified,isLoaded:!P.isDirectory,isLoading:!1})).sort((P,Q)=>P.isDirectory&&!Q.isDirectory?-1:!P.isDirectory&&Q.isDirectory?1:P.name.toLowerCase().localeCompare(Q.name.toLowerCase())),Y=async M=>{if(a)return[];try{const T=await Z.getFiles(t,M);return E(T)}catch(T){return console.error(`Failed to load folder contents for ${M}:`,T),[]}},J=(M,T,P,Q)=>{M.preventDefault(),M.stopPropagation(),$({visible:!0,x:M.clientX,y:M.clientY,targetPath:T,targetName:P,isDirectory:Q})},ce=async M=>{if(!(!A.currentPath||a))try{await Z.renameFile(t,A.currentPath,M);const T=A.currentPath.includes("/")?A.currentPath.substring(0,A.currentPath.lastIndexOf("/")):"";await H(T)}catch(T){console.error("Failed to rename file:",T),b({title:"Rename Failed",message:"Failed to rename file. Please try again.",variant:"danger"})}finally{R({isOpen:!1})}},ne=async M=>{a||x({title:"Delete File",message:`Are you sure you want to delete "${M}"?`,variant:"danger",confirmText:"Delete",onConfirm:async()=>{try{await Z.deleteFile(t,M);const T=M.includes("/")?M.substring(0,M.lastIndexOf("/")):"";await H(T)}catch(T){console.error("Failed to delete file:",T),b({title:"Delete Failed",message:"Failed to delete file. Please try again.",variant:"danger"})}}})},re=async(M,T)=>{if(!a)try{await Z.openFileWithEditor(t,M,T)}catch(P){console.error("Failed to open file with editor:",P),b({title:"Open Failed",message:"Failed to open file with editor. Please try again.",variant:"danger"})}},f=async M=>{try{await Z.openFileFolder(t,M)}catch(T){console.error("Failed to open file folder:",T),b({title:"Open Failed",message:"Failed to open file folder. Please try again.",variant:"danger"})}},W=async M=>{if(!a)try{const T=ae.parentPath||"",P=T?`${T}/${M}`:M;await Z.createFile(t,P),await H(T)}catch(T){console.error("Failed to create file:",T),b({title:"Create Failed",message:"Failed to create file. Please try again.",variant:"danger"})}finally{z({isOpen:!1})}},L=async M=>{if(!a)try{const T=se.parentPath||"",P=T?`${T}/${M}`:M;await Z.createFolder(t,P),await H(T)}catch(T){console.error("Failed to create folder:",T),b({title:"Create Failed",message:"Failed to create folder. Please try again.",variant:"danger"})}finally{_({isOpen:!1})}},H=async M=>{try{if(M===""){const T=await Z.getFiles(t),P=E(T);i(P)}else{const T=await Z.getFiles(t),P=E(T);i(P)}}catch(T){console.error("Failed to refresh directory:",T)}},V=()=>{const M=[];return y.targetPath&&!y.isDirectory&&(M.push({id:"open",label:"Open",onClick:()=>{y.targetPath&&y.targetName&&n(y.targetPath,y.targetName)}}),a||(G?M.push({id:"open-with-loading",label:"Loading editors...",onClick:()=>{}}):B.length>0&&M.push({id:"open-with",label:"Open with",onClick:()=>{},submenu:B.map(T=>({id:`editor-${T.id}`,label:T.displayName,onClick:()=>{y.targetPath&&re(y.targetPath,T.id)}}))})),M.push({id:"sep1",label:"",separator:!0})),y.targetPath?a||(M.push({id:"open-folder",label:"Open folder",onClick:()=>{y.targetPath&&f(y.targetPath)}}),M.push({id:"sep2",label:"",separator:!0}),M.push({id:"rename",label:"Rename",onClick:()=>{R({isOpen:!0,currentPath:y.targetPath,currentName:y.targetName})}}),M.push({id:"delete",label:"Delete",onClick:()=>{y.targetPath&&ne(y.targetPath)}})):a||(M.push({id:"new-file",label:"New File",onClick:()=>{z({isOpen:!0,parentPath:""})}}),M.push({id:"new-folder",label:"New Folder",onClick:()=>{_({isOpen:!0,parentPath:""})}})),M},K=M=>{if(M===0)return"0 B";const T=1024,P=["B","KB","MB","GB"],Q=Math.floor(Math.log(M)/Math.log(T));return parseFloat((M/Math.pow(T,Q)).toFixed(1))+" "+P[Q]},te=async M=>{if(N.has(M)){h(Q=>{const F=new Set(Q);return F.delete(M),F});return}h(Q=>new Set([...Q,M]));const T=(Q,F)=>Q.map(I=>I.path===F&&I.isDirectory&&!I.isLoaded?{...I,isLoading:!0}:I.children?{...I,children:T(I.children,F)}:I),P=(Q,F)=>{for(const I of Q)if(I.path===F&&I.isDirectory&&!I.isLoaded||I.children&&P(I.children,F))return!0;return!1};if(P(r,M)){j(Q=>new Set([...Q,M])),i(Q=>T(Q,M));try{const Q=await Y(M),F=(I,U,X)=>I.map(ie=>ie.path===U&&ie.isDirectory?{...ie,children:X,isLoaded:!0,isLoading:!1}:ie.children?{...ie,children:F(ie.children,U,X)}:ie);i(I=>F(I,M,Q))}catch(Q){console.error(`Failed to load folder ${M}:`,Q);const F=(I,U)=>I.map(X=>X.path===U&&X.isDirectory?{...X,isLoading:!1}:X.children?{...X,children:F(X.children,U)}:X);i(I=>F(I,M))}finally{j(Q=>{const F=new Set(Q);return F.delete(M),F})}}},oe=(M,T)=>M.map(P=>e.jsx("div",{style:{marginLeft:`${T?0:12}px`},children:P.isDirectory?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"py-1 px-2 flex items-center hover:bg-neutral-50 dark:hover:bg-neutral-700/50",onClick:()=>te(P.path),onContextMenu:Q=>!a&&J(Q,P.path,P.name,!0),children:[P.isLoading?e.jsx("span",{className:"mr-1 text-xs animate-spin",children:"⏳"}):e.jsx("span",{className:"mr-1 text-xs duration-200",style:{transform:N.has(P.path)?"rotate(90deg)":"rotate(0deg)"},children:e.jsx(_e,{size:12})}),e.jsx($e,{fileName:P.name,isFolder:!0,size:14,className:"mr-1 flex-shrink-0"}),e.jsxs("span",{className:"text-sm",children:[P.name,"/"]})]}),N.has(P.path)&&P.children&&oe(P.children,!1)]}):e.jsxs("div",{ref:Q=>{Q?S.current.set(P.path,Q):S.current.delete(P.path)},className:`py-1 px-2 rounded-sm flex items-center justify-between group ${s===P.path?"bg-purple-100 dark:bg-purple-900/50":"hover:bg-neutral-50 dark:hover:bg-neutral-700/50"}`,onClick:()=>n(P.path,P.name),onContextMenu:Q=>!a&&J(Q,P.path,P.name,!1),title:`${P.path} (${K(P.size||0)})`,children:[e.jsxs("div",{className:"flex items-center min-w-0 flex-1 ps-4",children:[e.jsx($e,{fileName:P.name,size:14,className:"mr-2 flex-shrink-0"}),e.jsx("span",{className:"text-sm truncate",children:P.name})]}),e.jsx("div",{className:`text-xs ml-2 flex-shrink-0 ${s===P.path?"text-purple-600 dark:text-purple-300 opacity-100":"text-neutral-500 dark:text-neutral-400 opacity-0 group-hover:opacity-100"}`,children:K(P.size||0)})]})},P.path));return o?e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100 mb-2",children:"Session Files"}),e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Loading files..."})]}):d?e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100 mb-2",children:"Session Files"}),e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:d})]}):a?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:"Session Files"})}),e.jsx("div",{className:"text-sm opacity-50 mt-4",children:"You are viewing a read-only session."})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:"Session Files"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>z({isOpen:!0,parentPath:""}),disabled:a,className:"p-1 text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:a?"Actions disabled in read-only mode":"New File",children:e.jsx($e,{fileName:"file.txt",size:16})}),e.jsx("button",{onClick:()=>_({isOpen:!0,parentPath:""}),disabled:a,className:"p-1 text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:a?"Actions disabled in read-only mode":"New Folder",children:e.jsx($e,{fileName:"folder",isFolder:!0,size:16})})]})]}),e.jsx("div",{ref:C,className:"flex-1 overflow-y-auto",onContextMenu:M=>!a&&J(M),children:e.jsx("div",{className:"space-y-1 text-sm",children:r.length>0?oe(r,!0):e.jsxs("div",{className:"text-neutral-600 dark:text-neutral-400 text-center py-8",children:[e.jsx("div",{className:"mb-2 flex justify-center",children:e.jsx($e,{fileName:"empty",isFolder:!0,size:32})}),e.jsx("div",{children:"No files found"}),e.jsx("div",{className:"text-xs mt-1",children:"The session directory is empty"})]})})}),e.jsx(Ys,{items:V(),position:{x:y.x,y:y.y},isVisible:y.visible,onClose:()=>$({visible:!1,x:0,y:0})}),e.jsx(Js,{isOpen:A.isOpen,currentName:A.currentName||"",onConfirm:ce,onCancel:()=>R({isOpen:!1})}),e.jsx(Ft,{isOpen:ae.isOpen,title:"Create New File",placeholder:"Enter file name (e.g., example.txt)",onConfirm:W,onCancel:()=>z({isOpen:!1})}),e.jsx(Ft,{isOpen:se.isOpen,title:"Create New Folder",placeholder:"Enter folder name",onConfirm:L,onCancel:()=>_({isOpen:!1})}),e.jsx(Te,{isOpen:m.isOpen,title:m.title,message:m.message,confirmText:m.confirmText,cancelText:m.cancelText,variant:m.variant,onConfirm:u,onCancel:p}),e.jsx(rt,{isOpen:k.isOpen,title:k.title,message:k.message,confirmText:k.confirmText,variant:k.variant,onConfirm:w})]})}function la(t){const[s,a]=c.useState([]),[n,r]=c.useState(!0),[i,o]=c.useState(null),l=async g=>{try{g||r(!0),o(null);const m=await Z.getTasks(t);a(m)}catch(m){o(m instanceof Error?m.message:"Failed to fetch session tasks")}finally{r(!1)}};return c.useEffect(()=>{t&&l()},[t]),{tasks:s,loading:n,error:i,refreshTasks:g=>{l(g)}}}function oa({sessionId:t,isSessionReadonly:s,onOpenTask:a}){const[n,r]=c.useState({}),{taskExecutions:i,setTaskExecution:o,mapTaskToExecution:l}=Je(),{tasks:d,loading:g,error:m,refreshTasks:x}=la(t),u=async(w,N,h=!0)=>{const C=`start-${w}`;r(S=>({...S,[C]:!0}));try{const S=await Z.startTask(t,w),v=String(S.taskExecutionId);l(w,!0,v),o(v,{taskExecutionId:v,output:"",status:le.Running,startTime:new Date}),h&&b(w,N,v,!0),setTimeout(()=>{x(!0)},100)}catch(S){console.error("[Tasks] Failed to start task:",S)}finally{r(S=>({...S,[C]:!1}))}},p=async w=>{const N=`stop-${w}`;r(h=>({...h,[N]:!0}));try{await Ce.stopTask(w),x()}catch(h){console.error("Failed to stop task:",h)}finally{r(h=>({...h,[N]:!1}))}},k=async(w,N,h)=>{const C=`restart-${w}`;r(S=>({...S,[C]:!0}));try{await Ce.stopTask(h),await new Promise(S=>setTimeout(S,500)),await u(w,N,!0)}catch(S){console.error("Failed to restart task:",S)}finally{r(S=>({...S,[C]:!1}))}},b=async(w,N,h,C)=>{try{const S=C?{output:"",status:le.Running}:await Ce.getTaskOutput(h);l(w,!0,h),o(h,{...S,taskExecutionId:h}),a(h,N)}catch(S){console.error("[Tasks] Failed to get task output:",{taskExecutionId:h,error:S,sessionId:t}),i[h]||o(h,{taskExecutionId:h,output:"Unable to load output. The task may still be initializing.",status:le.Pending}),a(h,"Task Output")}};return e.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:"Tasks"}),!s&&e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>x(),disabled:g,children:e.jsx(je,{size:14,className:g?"animate-spin":""})})]}),m&&e.jsxs("div",{className:"text-red-600 text-sm p-2 bg-red-50 dark:bg-red-900/20 rounded",children:["Error: ",m]}),s?e.jsx("div",{className:"text-sm opacity-50",children:"You are viewing a read-only session."}):e.jsx("div",{className:"flex-1 overflow-y-auto",children:g&&d.length===0?e.jsx("div",{className:"text-neutral-500 text-sm",children:"Loading tasks..."}):e.jsx(Jt,{isSession:!0,tasks:d,loading:n,taskExecutions:i,isReadonly:s,onStart:(w,N,h=!0)=>u(w,N,h),onStop:p,onRestart:k,onViewOutput:(w,N,h)=>b(w,N,h,!1),emptyMessage:"No tasks found",autoOpenOnGroupStart:!0})})]})}function ca({sessionId:t,activeFilePath:s,suggestedSidebarTab:a,isSessionReadonly:n,session:r,onOpenFile:i,onOpenDiff:o,onOpenTask:l,onMergeToMain:d,onPushBranch:g,onPullFromStarterBranch:m,onResetSession:x,onCancelSession:u,onStopWorkingMessages:p,onOpenWithVSCode:k,isVSCodeAvailable:b,onDeployToEnvironment:w,onSessionNameUpdate:N,autoDeployEnabled:h,selectedEnvironmentId:C,restartAfterSync:S,onAutoDeployChange:v,onSelectedEnvironmentIdChange:D,onRestartAfterSyncChange:j,messagesCount:y,isCriticalOperationRunning:$=!1}){const[B,G]=c.useState("session"),[A,R]=c.useState(!1),[ae,z]=c.useState(()=>{const L=localStorage.getItem("sidebar-width");return L?parseInt(L,10):320}),[se,_]=c.useState(!1),E=c.useRef(null),{gitStatus:Y,fetchGitStatus:J}=nt(t);c.useEffect(()=>{R(!1),J()},[t]),c.useEffect(()=>{a&&!A&&G(a)},[a,A]),c.useEffect(()=>{localStorage.setItem("sidebar-width",ae.toString())},[ae]);const ce=c.useCallback(L=>{L.preventDefault(),_(!0)},[]),ne=c.useCallback(L=>{if(!se)return;const H=L.clientX;H>=200&&H<=600&&z(H)},[se]),re=c.useCallback(()=>{_(!1)},[]);c.useEffect(()=>(se?(document.addEventListener("mousemove",ne),document.addEventListener("mouseup",re),document.body.style.cursor="col-resize",document.body.style.userSelect="none"):(document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",re),document.body.style.cursor="",document.body.style.userSelect=""),()=>{document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",re),document.body.style.cursor="",document.body.style.userSelect=""}),[se,ne,re]);const f=L=>{switch(L){case"session":return 0;case"git":return!n&&Y?Y.stagedFiles.length+Y.unstagedFiles.length+Y.untrackedFiles.length:0;case"files":return 0;case"tasks":return 0;default:return 0}},W=()=>{switch(B){case"session":return e.jsx(ra,{sessionId:t,isSessionReadonly:n,session:r,onOpenTask:l,onMergeToMain:d,onPushBranch:g,onPullFromStarterBranch:m,onResetSession:x,onCancelSession:u,onStopWorkingMessages:p,onOpenWithVSCode:k,isVSCodeAvailable:b,onDeployToEnvironment:w,onSessionNameUpdate:N,autoDeployEnabled:h,selectedEnvironmentId:C,restartAfterSync:S,onAutoDeployChange:v,onSelectedEnvironmentIdChange:D,onRestartAfterSyncChange:j,messagesCount:y,isCriticalOperationRunning:$});case"git":return e.jsx(na,{sessionId:t,isSessionReadonly:n,onOpenDiff:o});case"files":return e.jsx(ia,{sessionId:t,activeFilePath:s,isSessionReadonly:n,onOpenFile:i});case"tasks":return e.jsx(oa,{sessionId:t,isSessionReadonly:n,onOpenTask:l});default:return null}};return e.jsxs("div",{ref:E,className:"border-r border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 flex flex-col relative",style:{width:`${ae}px`},children:[e.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-700 p-1",children:e.jsx("div",{className:"flex space-x-1",children:["session","git","files","tasks"].map(L=>e.jsxs("button",{onClick:()=>{$||(G(L),R(!0))},disabled:$,className:`flex items-center space-x-2 px-3 py-2 text-sm rounded-md ${B===L?"bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200":"text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 hover:bg-neutral-50 dark:hover:bg-neutral-700"} ${$?"opacity-50 cursor-not-allowed":""}`,children:[L==="session"&&e.jsx("span",{children:e.jsx(hs,{size:18})}),L==="git"&&e.jsx("span",{children:e.jsx(mt,{size:18})}),L==="files"&&e.jsx("span",{children:e.jsx(xs,{size:18})}),L==="tasks"&&e.jsx("span",{children:e.jsx(qe,{size:18})}),f(L)>0&&e.jsx(Ae,{variant:"default",size:"sm",children:f(L)})]},L))})}),e.jsx("div",{className:"flex-1 p-4 overflow-y-auto",children:W()}),e.jsx("div",{className:`absolute top-0 right-0 w-1 h-full cursor-col-resize bg-transparent hover:bg-purple-400 ${se?"bg-purple-400":""}`,onMouseDown:ce,style:{zIndex:10}})]})}function da({tabId:t}){const{getTabContentById:s,activeSessionId:a,setTabContent:n,getTabDirty:r,setTabDirty:i}=fe(),{fetchGitStatus:o}=vt(),l=s(a,t)||{},d=r(a,t),g=c.useCallback(G=>{i(a,t,G)},[a,i,t]),[m,x]=c.useState(!1),[u,p]=c.useState(!1),{editableContent:k,lastModified:b,content:w}=l,[N,h]=c.useState({isOpen:!1}),[C,S]=c.useState({isOpen:!1,message:""}),v=c.useCallback(G=>{const A=G||"";n(a,t,{...l,editableContent:A}),g(A!==w)},[a,l,w,g,n,t]),D=c.useCallback(async(G=!1)=>{if(!(!d||m))try{x(!0);const A=await Z.updateFileContent(a,l.path,k,G?void 0:b);n(a,t,{...l,editableContent:k,content:k,lastModified:A.lastModified}),g(!1),o(a)}catch(A){if(console.error("Failed to save file:",A),A.status===409){const R=A.data||{};h({isOpen:!0,currentLastModified:R.currentLastModified})}else S({isOpen:!0,message:"Failed to save file. Please try again."})}finally{x(!1)}},[a,l,k,d,m,b,g,n,t]),j=c.useCallback(async()=>{if(!(d||u))try{p(!0);const{content:G,lastModified:A}=await Z.getFileContent(a,l.path);n(a,t,{...l,lastModified:A,editableContent:G,content:G}),g(!1)}catch(G){console.error("Failed to refresh file:",G),S({isOpen:!0,message:"Failed to refresh file. Please try again."})}finally{p(!1)}},[d,u,a,l,t,n,g]),y=c.useCallback(G=>{G.ctrlKey&&G.key==="s"&&(G.preventDefault(),D())},[D]);c.useEffect(()=>(document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)),[y]);const $=()=>{h({isOpen:!1}),D(!0)},B=async()=>{h({isOpen:!1});try{const{content:G,lastModified:A}=await Z.getFileContent(a,l.path);n(a,t,{...l,lastModified:A,editableContent:G,content:G}),g(!1),S({isOpen:!0,message:"File has been reloaded with the latest changes. Your changes have been discarded."})}catch(G){console.error("Failed to reload file:",G),S({isOpen:!0,message:"Failed to reload file. Please refresh the page."})}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($e,{fileName:l.name||"",size:20,className:"text-neutral-600 dark:text-neutral-400"}),e.jsxs("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:[l.name,d&&e.jsx("span",{className:"text-orange-500 ml-2",children:"•"})]}),l.path!=l.name&&e.jsx("span",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:l.path})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:"outline",onClick:j,disabled:d,loading:u,title:"Refresh file content",children:u?"Refreshing...":"Refresh"}),e.jsxs(O,{onClick:()=>D(),disabled:!d||m,title:"Save (Ctrl+S)",children:[e.jsx(ps,{className:"w-4 h-4"}),m?"Saving...":"Save"]})]})]})}),e.jsx("div",{className:"flex-1",children:e.jsx(fs,{height:"100%",language:l.language,value:k,onChange:v,theme:"vs-dark",options:{readOnly:!1,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:14,lineNumbers:"on",renderWhitespace:"selection",folding:!0,wordWrap:"on",automaticLayout:!0,tabSize:2,insertSpaces:!0,formatOnPaste:!0,formatOnType:!0}})}),e.jsx(Te,{isOpen:N.isOpen,title:"File Conflict Detected",message:`This file has been modified by another process.

Your last modified: ${new Date(b).toLocaleString()}
Current last modified: ${new Date(N.currentLastModified||"").toLocaleString()}

Click Override to save your changes anyway, or Reload to discard your changes and reload the latest version.`,confirmText:"Override",cancelText:"Reload",variant:"warning",onConfirm:$,onCancel:B}),e.jsx(xe,{isOpen:C.isOpen,onClose:()=>S({isOpen:!1,message:""}),title:"Information",size:"sm",contentClassName:"p-6",footer:e.jsx("div",{className:"flex justify-end",children:e.jsx(O,{onClick:()=>S({isOpen:!1,message:""}),children:"OK"})}),children:e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-300",children:C.message})})]})}function ua({tabId:t}){const{getTabContentById:s,activeSessionId:a,setTabContent:n}=fe(),r=s(a,t),[i,o]=c.useState(!1);return c.useEffect(()=>{if(!r||r.type!=="diff"||!r.lastRefresh)return;(async()=>{if(!i){o(!0);try{const d=t.includes("StagedVsHead")?"StagedVsHead":t.includes("WorkingVsStaged")?"WorkingVsStaged":"WorkingVsHead";let g="",m="";if(d==="StagedVsHead"){const[u,p]=await Promise.all([Z.getGitFileContent(a,r.path,"Staged"),Z.getGitFileContent(a,r.path,"Head")]);g=p.content,m=u.content}else if(d==="WorkingVsStaged"){const[u,p]=await Promise.all([Z.getGitFileContent(a,r.path,"Working"),Z.getGitFileContent(a,r.path,"Staged")]);g=p.content,m=u.content}else{const[u,p]=await Promise.all([Z.getGitFileContent(a,r.path,"Working"),Z.getGitFileContent(a,r.path,"Head")]);g=p.content,m=u.content}const x={...r,original:g,modified:m};n(a,t,x)}catch(d){console.error("Failed to refresh diff content:",d)}finally{o(!1)}}})()},[r?.lastRefresh,t,a,r?.path,i,n]),!r||r.type!=="diff"?e.jsx("div",{className:"flex items-center justify-center h-full text-neutral-500",children:"Content not available"}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(zt,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"}),e.jsxs("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:[r.name," (Changes)"]}),e.jsx("span",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:r.path})]})}),e.jsx("div",{className:"flex-1",children:e.jsx(ys,{height:"100%",language:r.language,original:r.original,modified:r.modified,theme:"vs-dark",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:14,renderSideBySide:!0,ignoreTrimWhitespace:!1}})})]})}function ga({tabId:t}){const{getTabContentById:s,activeSessionId:a}=fe(),n=s(a,t);if(!n||n.type!=="task")return e.jsx("div",{className:"flex items-center justify-center h-full text-neutral-500",children:"Content not available"});const r=i=>i.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"});return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-6 py-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(kt,{status:n.status,size:"lg"}),e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:n.name})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-neutral-500 dark:text-neutral-400",children:[n.startTime&&e.jsxs("span",{children:["Started: ",r(n.startTime)]}),n.endTime&&e.jsxs("span",{children:["Ended: ",r(n.endTime)]})]})]})}),e.jsx("div",{className:"flex-1 p-6 min-h-0",children:e.jsx(Xt,{output:n.output,className:"h-full break-words"})})]})}const ma="modulepreload",ha=function(t){return"/"+t},Dt={},xa=function(s,a,n){let r=Promise.resolve();if(a&&a.length>0){let d=function(g){return Promise.all(g.map(m=>Promise.resolve(m).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");r=d(a.map(g=>{if(g=ha(g),g in Dt)return;Dt[g]=!0;const m=g.endsWith(".css"),x=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${x}`))return;const u=document.createElement("link");if(u.rel=m?"stylesheet":ma,m||(u.as="script"),u.crossOrigin="",u.href=g,l&&u.setAttribute("nonce",l),document.head.appendChild(u),m)return new Promise((p,k)=>{u.addEventListener("load",p),u.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${g}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return r.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return s().catch(i)})};function pa({status:t,size:s="sm"}){return t===Ne.Done?null:e.jsx("div",{className:"flex items-center justify-center "+(s==="lg"?"w-5":"w-3"),children:t===Ne.Working?e.jsx(Xe,{size:"sm"}):t===Ne.Pending?e.jsx(ks,{}):e.jsx("div",{className:`w-2 h-2 rounded-full ${t===Ne.Done?"bg-green-500":t===Ne.Failed?"bg-red-500":"bg-neutral-400"}`})})}const fa=t=>{switch(t){case ye.System:return"System";case ye.User:return"User";case ye.Agent:return"Agent";case ye.Tool:return"Tool";default:return"Unknown"}},ya=t=>{switch(t){case ye.User:return"bg-purple-100/60 dark:bg-purple-900/80 text-neutral-900 dark:text-neutral-100";case ye.Agent:return"bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100";case ye.Tool:return"bg-neutral-200/50 dark:bg-neutral-800/60 text-neutral-900 dark:text-neutral-100";case ye.System:return"bg-neutral-100 dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200";default:return"bg-neutral-100 dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200"}};function ka({message:t,onOpenFile:s}){const[a,n]=c.useState(!1),[r,i]=c.useState(!1),o=c.useCallback(x=>{const u=x.replace(/['"]/g,"").trim(),p=u.match(/^(.+):(\d+)$/),k=p?p[1]:u,b=p?parseInt(p[2],10):void 0,w=k.split(/[/\\]/).pop()||k;s&&(s(k,w),b&&console.log(`Should navigate to line ${b} in ${k}`))},[s]),l=c.useMemo(()=>{const x=t.content;return e.jsx(bs,{remarkPlugins:[vs],urlTransform:u=>u,components:{code({node:u,inline:p,className:k,children:b,...w}){return!k&&p!==!1?e.jsx("code",{className:"bg-neutral-200 dark:bg-neutral-700 px-1 py-0.5 rounded text-sm font-mono mx-0.5",...w,children:b}):e.jsx("code",{className:"font-mono",...w,children:b})},pre({children:u,className:p,...k}){const w=u?.props,N=/language-(\w+)/.exec(w?.className||""),h=N?N[1]:"";return e.jsxs("pre",{className:"bg-neutral-900 text-neutral-100 p-3 rounded mt-2 mb-2 overflow-x-auto text-sm block",...k,children:[h&&e.jsx("div",{className:"text-neutral-400 text-xs mb-2",children:h}),u]})},p({children:u}){return e.jsx("p",{className:"mb-2 whitespace-pre-line",children:u})},ul({children:u}){return e.jsx("ul",{className:"list-disc list-inside mb-2",children:u})},ol({children:u}){return e.jsx("ol",{className:"list-decimal list-inside mb-2",children:u})},li({children:u}){return e.jsx("li",{className:"mb-1",children:u})},h1({children:u}){return e.jsx("h1",{className:"text-xl font-bold mb-2 mt-3",children:u})},h2({children:u}){return e.jsx("h2",{className:"text-lg font-bold mb-2 mt-3",children:u})},h3({children:u}){return e.jsx("h3",{className:"text-base font-bold mb-2 mt-2",children:u})},blockquote({children:u}){return e.jsx("blockquote",{className:"border-l-4 border-neutral-300 dark:border-neutral-600 pl-4 py-1 mb-2 italic",children:u})},a({href:u,children:p}){if(u&&u.startsWith("file://")){const k=u.replace("file://","");return e.jsx("button",{onClick:b=>{b.preventDefault(),b.stopPropagation(),o(k)},className:"text-purple-600 dark:text-purple-400 hover:underline cursor-pointer bg-transparent border-none p-0 font-inherit underline-offset-auto",title:`Open ${k}`,children:p})}return e.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 dark:text-purple-400 hover:underline",children:p})},table({children:u}){return e.jsx("div",{className:"overflow-x-auto mb-2",children:e.jsx("table",{className:"min-w-full border border-neutral-300 dark:border-neutral-600",children:u})})},thead({children:u}){return e.jsx("thead",{className:"bg-neutral-100 dark:bg-neutral-700",children:u})},th({children:u}){return e.jsx("th",{className:"border border-neutral-300 dark:border-neutral-600 px-3 py-2 text-left font-semibold",children:u})},td({children:u}){return e.jsx("td",{className:"border border-neutral-300 dark:border-neutral-600 px-3 py-2",children:u})},hr(){return e.jsx("hr",{className:"my-3 border-neutral-300 dark:border-neutral-600"})},strong({children:u}){return e.jsx("strong",{className:"font-bold",children:u})},em({children:u}){return e.jsx("em",{className:"italic",children:u})}},children:x})},[o,t.content]),d=async()=>{try{await navigator.clipboard.writeText(t.content),n(!0),setTimeout(()=>n(!1),2e3)}catch(x){console.error("Failed to copy text: ",x)}},g=async()=>{if(!r){i(!0);try{if(t.status===Ne.Working){const{sessionsApi:x}=await xa(async()=>{const{sessionsApi:u}=await Promise.resolve().then(()=>Ms);return{sessionsApi:u}},void 0);await x.cancelMessage(t.sessionId,t.id)}else await Ye.update(t.sessionId,t.id,{status:Ne.Failed})}catch(x){console.error("Failed to cancel message: ",x)}finally{i(!1)}}},m=t.type===ye.User&&t.status===Ne.Pending||(t.type===ye.Agent||t.type===ye.Tool)&&t.status===Ne.Working;return e.jsx("div",{className:"flex justify-start "+(t.type===ye.Tool?"":"pb-4"),children:e.jsx("div",{className:"flex max-w-4xl",children:e.jsxs("div",{className:`px-4 py-3 max-w-none ${ya(t.type)}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pa,{status:t.status,type:t.type}),e.jsx("span",{className:"text-xs opacity-75",children:fa(t.type)}),e.jsx("span",{className:"text-xs opacity-50",children:new Date(t.updatedAt).toLocaleTimeString()})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[m&&e.jsx("button",{onClick:g,disabled:r,className:"p-1 text-xs opacity-50 hover:opacity-100 duration-200 rounded hover:bg-red-500/20 text-red-600 dark:text-red-400",title:t.status===Ne.Working?"Stop processing":"Cancel message",children:r?e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{onClick:d,className:"p-1 text-xs opacity-50 hover:opacity-100 duration-200 rounded hover:bg-black/10 dark:hover:bg-white/10",title:"Copy message content",children:a?e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 002 2v8a2 2 0 002 2z"})})})]})]}),e.jsx("div",{className:"text-sm font-mono leading-relaxed select-text",children:l}),t.metadata&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-xs opacity-75 hover:opacity-100",children:"Metadata"}),e.jsx("pre",{className:"text-xs opacity-60 mt-1 bg-black/10 dark:bg-white/10 p-2 rounded",children:t.metadata})]})]})})})}function ba({onSendMessage:t,disabled:s=!1,placeholder:a="Type your message...",className:n="",messageHistory:r=[],messageHistoryIndex:i=-1,onMessageHistoryIndexChange:o,inputMessage:l,onInputMessageChange:d}){const g=c.useRef(null),m=async()=>{if(!l.trim()||s)return;const p=l.trim();d("");const k=()=>{g.current&&(g.current.style.height="auto",requestAnimationFrame(()=>{g.current?.focus()}))};try{await t(p),k()}catch(b){console.error("Failed to send message:",b),k()}},x=p=>{if(p.key==="Enter"&&!p.shiftKey){p.preventDefault(),m();return}if((p.key==="ArrowUp"||p.key==="ArrowDown")&&(l.trim()===""||i>=0)){if(p.preventDefault(),!o||r.length===0)return;if(p.key==="ArrowUp"){const k=Math.min(i+1,r.length-1);o(k),d(r[k]||"")}else if(p.key==="ArrowDown")if(i>0){const k=i-1;o(k),d(r[k]||"")}else o(-1),d("")}},u=p=>{const k=p.target;d(k.value),o&&i>=0&&o(-1),k.style.height="auto",k.style.height=`${Math.min(k.scrollHeight,200)}px`};return e.jsxs("div",{className:`flex items-center space-x-3 ${n}`,children:[e.jsx("textarea",{ref:g,value:l,onChange:u,onKeyDown:x,placeholder:a,disabled:s,className:`
            w-full px-4 py-3 pr-12 rounded-lg border border-neutral-300 dark:border-neutral-600
            bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100
            placeholder-neutral-500 dark:placeholder-neutral-400
            focus:border-transparent
            resize-none overflow-hidden min-h-[48px] max-h-[200px]
            disabled:opacity-50 disabled:cursor-not-allowed
            duration-200  font-mono
          `,rows:1}),e.jsx(O,{onClick:m,disabled:!l.trim(),loading:s,className:"min-w-[80px] py-3 font-mono",children:"Send"})]})}function va({sessionId:t,className:s="",onOpenFile:a,onClearMessagesRef:n,isReadonly:r=!1,autoDeployEnabled:i=!1,selectedEnvironmentName:o,chatInputMessage:l,messageHistoryIndex:d,onChatInputMessageChange:g,onMessageHistoryIndexChange:m}){const x=c.useRef(null),{messages:u,loading:p,sending:k,error:b,sendMessage:w,clearError:N,clearMessages:h}=qt(t),C=c.useMemo(()=>u.filter(v=>v.type===ye.User).map(v=>v.content).reverse(),[u]);c.useEffect(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[u]),c.useEffect(()=>{n&&n(h)},[h,n]);const S=async v=>{m(-1),g(""),await w(v)};return p&&u.length===0?e.jsx("div",{className:`flex flex-col h-full ${s}`,children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(Xe,{size:"lg"})})}):e.jsxs("div",{className:`flex flex-col h-full bg-neutral-100/30 dark:bg-neutral-900 ${s}`,children:[e.jsx("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800",children:e.jsxs("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:["Session Chat",!r&&i&&o&&e.jsxs("span",{className:"ml-2 text-sm font-normal opacity-60",children:["Auto Deploy to ",e.jsx(Ae,{children:o})]})]})}),b&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/50 border-b border-red-200 dark:border-red-800 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:b}),e.jsx("button",{onClick:N,className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-200",children:"×"})]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4",children:u.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-neutral-500 dark:text-neutral-400",children:[e.jsx("p",{className:"text-lg",children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Start a conversation by sending a message below"})]})}):e.jsxs(e.Fragment,{children:[u.map(v=>e.jsx(ka,{message:v,onOpenFile:a},v.id)),e.jsx("div",{ref:x})]})}),!r&&e.jsx("div",{className:"border-t border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 p-4",children:e.jsx(ba,{onSendMessage:S,disabled:k||p,placeholder:k?"Sending...":"Type your message...",messageHistory:C,messageHistoryIndex:d,onMessageHistoryIndexChange:m,inputMessage:l,onInputMessageChange:g})})]})}function ja({tabs:t,activeTabId:s,sessionId:a,isSessionReadonly:n,session:r,onCloseTab:i,onSwitchTab:o,onOpenFile:l,onClearMessagesRef:d,autoDeployEnabled:g,selectedEnvironmentId:m,restartAfterSync:x,onSelectedEnvironmentIdChange:u,chatInputMessage:p,messageHistoryIndex:k,onChatInputMessageChange:b,onMessageHistoryIndexChange:w}){const N=c.useRef(void 0),h=g&&!!r?.workspaceId,{environments:C,loading:S,error:v,refetch:D}=Qe({workspaceId:r?.workspaceId||1,autoLoad:h});c.useEffect(()=>{C.length>0&&!m&&g&&u(C[0].id.toString())},[C,m,g,u]),c.useEffect(()=>{g&&r?.workspaceId&&C.length===0&&!S&&!v&&D()},[g,r?.workspaceId,C.length,S,v,D]),c.useEffect(()=>{const B=N.current,G=r?.status;B===be.InProgress&&(G===be.Done||G===be.Waiting)&&g&&m&&pt(a,+m,x).catch(A=>console.error("Auto-deploy failed:",A)),N.current=G},[r?.status,g,m,a,x]);const j=B=>{switch(B.content.type){case"chat":return e.jsx(Nt,{className:"w-4 h-4"});case"file":return e.jsx($e,{fileName:B.content.name||"",size:16,className:"text-neutral-600 dark:text-neutral-400"});case"diff":return e.jsx(zt,{className:"w-4 h-4"});case"task":return e.jsx(Ue,{className:"w-4 h-4"});default:return e.jsx(Nt,{className:"w-4 h-4"})}},y=B=>{switch(B.content.type){case"chat":{const G=C.find(A=>A.id.toString()===m);return e.jsx(va,{sessionId:a,className:"h-full min-h-0",onOpenFile:l,onClearMessagesRef:d,isReadonly:n,autoDeployEnabled:g,selectedEnvironmentName:G?.name,chatInputMessage:p,messageHistoryIndex:k,onChatInputMessageChange:b,onMessageHistoryIndexChange:w})}case"file":return e.jsx(da,{tabId:s});case"diff":return e.jsx(ua,{tabId:s});case"task":return e.jsx(ga,{tabId:s});default:return null}},$=t.some(B=>B.id!=="chat");return e.jsxs("div",{className:"flex-1 min-h-0 bg-neutral-50 dark:bg-neutral-900 flex flex-col",children:[$&&e.jsx("div",{className:"bg-white dark:bg-neutral-800 border-b border-neutral-200 dark:border-neutral-700",children:e.jsx("div",{className:"flex overflow-x-auto",children:t.map(B=>e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 border-r border-neutral-200 dark:border-neutral-700 min-w-0 ${s===B.id?"bg-neutral-100 dark:bg-neutral-900":"text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-100 hover:bg-neutral-50 dark:hover:bg-neutral-700"}`,onClick:()=>o(B.id),onMouseDown:G=>{G.button===1&&B.id!=="chat"&&(G.preventDefault(),i(B.id))},children:[j(B),e.jsx("span",{className:"text-sm truncate max-w-32",children:B.title}),B.isDirty&&e.jsx("span",{className:"text-orange-500 text-sm",children:"•"}),B.id!=="chat"&&e.jsx("button",{onClick:G=>{G.stopPropagation(),i(B.id)},className:"ml-1 p-0.5 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600",children:e.jsx(et,{className:"w-3 h-3"})})]},B.id))})}),t.map(B=>e.jsx("div",{className:"flex-1 min-h-0 flex flex-col"+(s!==B.id?" hidden":""),children:y(B)},B.id))]})}function wa({isOpen:t,onClose:s,sessionId:a,workspaceId:n}){const[r,i]=c.useState(""),[o,l]=c.useState(!1),[d,g]=c.useState(!0),{environments:m,loading:x,error:u}=Qe({workspaceId:n||0,autoLoad:t&&!!n}),{gitStatus:p}=nt(a),k=()=>p?p.stagedFiles.length>0||p.unstagedFiles.length>0||p.untrackedFiles.length>0:!1;c.useEffect(()=>{m.length>0&&!r&&i(m[0].id.toString())},[m,r]);const b=async()=>{if(r){l(!0);try{await pt(a,+r,d),s()}catch(h){console.error("Failed to deploy to environment:",h)}finally{l(!1)}}},w=()=>{o||(i(""),g(!0),s())},N=m.map(h=>({value:h.id.toString(),label:h.name}));return e.jsx(xe,{isOpen:t,onClose:w,title:"Deploy to Environment",size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(O,{variant:"outline",onClick:w,disabled:o,children:"Cancel"}),e.jsx(O,{onClick:b,disabled:!r||o||m.length===0||!k(),children:o?"Deploying...":"Deploy"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-2",children:"Select Environment"}),x?e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Loading environments..."}):u?e.jsxs("div",{className:"text-sm text-red-500 dark:text-red-400",children:["Error loading environments: ",u]}):m.length===0?e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"No environments found for this workspace."}):e.jsx(ze,{value:r,onSelect:h=>i(h.value),options:N,placeholder:"Choose an environment..."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"restartAfterSync",checked:d,onChange:h=>g(h.target.checked),className:"rounded border-neutral-300 dark:border-neutral-600 text-purple-600 dark:bg-neutral-700"}),e.jsx("label",{htmlFor:"restartAfterSync",className:"text-sm text-neutral-700 dark:text-neutral-300 cursor-pointer",children:"Restart after sync"})]})]})})}const Ge={},ct=(t,s)=>{Ge[t]={...Ge[t],...s}},Na=t=>Ge[t]||{autoDeployEnabled:!1,selectedEnvironmentId:"",restartAfterSync:!0},$t=(t,s)=>{Ge[t]={...Ge[t],chatState:s}},Ca=t=>Ge[t]?.chatState||{inputMessage:"",messageHistoryIndex:-1};function Sa(){const{sessionId:t}=Rt(),[s,a]=c.useState({isActive:!1,title:"",message:""}),[n,r]=c.useState(!1),i=c.useRef(null),[o,l]=c.useState(!1),[d,g]=c.useState(""),[m,x]=c.useState(!0),[u,p]=c.useState(""),[k,b]=c.useState(-1);c.useEffect(()=>{if(t){const ee=Na(t);l(ee.autoDeployEnabled),g(ee.selectedEnvironmentId),x(ee.restartAfterSync);const q=Ca(t);p(q.inputMessage),b(q.messageHistoryIndex)}},[t]);const w=ee=>{l(ee),t&&ct(t,{autoDeployEnabled:ee,selectedEnvironmentId:d,restartAfterSync:m}),ee||N("")},N=ee=>{g(ee),t&&ct(t,{autoDeployEnabled:o,selectedEnvironmentId:ee,restartAfterSync:m})},h=ee=>{x(ee),t&&ct(t,{autoDeployEnabled:o,selectedEnvironmentId:d,restartAfterSync:ee})},C=ee=>{p(ee),t&&$t(t,{inputMessage:ee,messageHistoryIndex:k})},S=ee=>{b(ee),t&&$t(t,{inputMessage:u,messageHistoryIndex:ee})};Ht({onMessageReceived:(ee,q)=>{ee===+t&&f(+t)},onMessageStatusChanged:(ee,q,me,Oe)=>{ee===+t&&f(+t)}},{autoConnect:!0,sessionId:t}),Ls({sessionId:+t,enabled:!!t,pingInterval:1e4});const{tabs:v,activeTabId:D,session:j,isSessionReadonly:y,openFile:$,openDiff:B,openTask:G,closeTab:A,switchTab:R,mergeToMain:ae,pushBranch:z,pullFromStarterBranch:se,resetSession:_,cancelSession:E,stopWorkingMessages:Y,openWithVSCode:J}=aa(+t),{updateSession:ce}=fe(),{editors:ne}=yt(),re=ne.some(ee=>(ee.id==="vscode"||ee.id==="vscode-insiders")&&ee.isAvailable),{fetchGitStatus:f}=vt(),{messages:W}=qt(+t),L=W.length,H=async(ee,q,me,Oe=!1)=>{a({isActive:!0,title:q,message:me});try{const Ze=await ee();return Oe&&i.current&&i.current(),Ze}finally{a({isActive:!1,title:"",message:""})}},V=()=>H(ae,"Merging to Main","Please wait while merging changes to the main branch..."),K=()=>H(z,"Completing Session","Please wait while pushing changes and marking session as completed..."),te=()=>H(se,"Pulling from Starter Branch","Please wait while pulling latest changes from the starter branch..."),oe=()=>H(_,"Resetting Session","Please wait while the session is being reset...",!0),M=()=>H(E,"Canceling Session","Please wait while the session is being canceled..."),T=()=>H(Y,"Stopping Progress","Please wait while stopping working messages..."),P=()=>H(J,"Opening with VSCode","Please wait while opening session with VSCode..."),Q=()=>{o&&d?H(async()=>(await pt(+t,+d,m),{message:"Deployment completed successfully"}),"Deploying to Environment","Please wait while deploying to the selected environment..."):r(!0)},F=ee=>{if(j){const q={...j,name:ee};ce(q)}},I=v.find(ee=>ee.id===D),U=I?.content.type==="file"?I.content.path:null,ie=I?.content.type==="file"?"files":I?.content.type==="diff"?"git":I?.content.type==="task"?"tasks":null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex h-full min-h-0",children:[e.jsx(ca,{sessionId:+t,activeFilePath:U,suggestedSidebarTab:ie,isSessionReadonly:y,session:j,onOpenFile:$,onOpenDiff:B,onOpenTask:G,onMergeToMain:V,onPushBranch:K,onPullFromStarterBranch:te,onResetSession:oe,onCancelSession:M,onStopWorkingMessages:T,onOpenWithVSCode:P,isVSCodeAvailable:re,onDeployToEnvironment:Q,onSessionNameUpdate:F,autoDeployEnabled:o,selectedEnvironmentId:d,restartAfterSync:m,onAutoDeployChange:w,onSelectedEnvironmentIdChange:N,onRestartAfterSyncChange:h,messagesCount:L,isCriticalOperationRunning:s.isActive}),e.jsx(ja,{tabs:v,activeTabId:D,sessionId:+t,isSessionReadonly:y,session:j,onCloseTab:A,onSwitchTab:R,onOpenFile:$,onClearMessagesRef:ee=>{i.current=ee},autoDeployEnabled:o,selectedEnvironmentId:d,restartAfterSync:m,onAutoDeployChange:w,onSelectedEnvironmentIdChange:N,chatInputMessage:u,messageHistoryIndex:k,onChatInputMessageChange:C,onMessageHistoryIndexChange:S})]}),e.jsx(ea,{isOpen:s.isActive,title:s.title,message:s.message}),e.jsx(wa,{isOpen:n,onClose:()=>r(!1),sessionId:+t,workspaceId:j?.workspaceId})]})}function Fa(){const t=ht(),{workspaces:s,addSession:a}=fe(),[n,r]=c.useState([]),[i,o]=c.useState(!0),[l,d]=c.useState(null),[g,m]=c.useState(new Set),[x,u]=c.useState(!1),[p,k]=c.useState(!1),[b,w]=c.useState(!1),[N,h]=c.useState(!1),[C,S]=c.useState(!1),[v,D]=c.useState(null),[j,y]=c.useState([]),[$,B]=c.useState(he.InMind),[G,A]=c.useState(void 0),[R,ae]=c.useState({title:"",description:"",status:he.InMind,tags:[]}),[z,se]=c.useState({search:"",status:"All",tags:"",workspace:"All"}),[_,E]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});c.useEffect(()=>{Y()},[]);const Y=async()=>{o(!0);try{const F=await De.getAll();r(F)}catch(F){console.error("Failed to load data:",F)}finally{o(!1)}},J=c.useMemo(()=>{const F=n.flatMap(I=>I.tags||[]);return[...new Set(F)].sort()},[n]),ce=c.useMemo(()=>n.filter(F=>{const I=z.search===""||F.title.toLowerCase().includes(z.search.toLowerCase())||F.description.toLowerCase().includes(z.search.toLowerCase()),U=z.status==="All"||z.status==="In mind"&&F.status===he.InMind||z.status==="Ready"&&F.status===he.Ready||z.status==="In Progress"&&F.status===he.InProgress||z.status==="Done"&&F.status===he.Done||z.status==="Canceled"&&F.status===he.Canceled,X=z.tags===""||F.tags&&F.tags.some(ee=>ee.toLowerCase().includes(z.tags.toLowerCase())),ie=z.workspace==="All"||z.workspace==="No workspace"&&!F.workspaceId||F.workspaceId&&s.find(ee=>ee.id===F.workspaceId)?.name===z.workspace;return I&&U&&X&&ie}),[n,z,s]);return{backlogs:n,workspaces:s,loading:i,selectedBacklog:l,selectedBacklogs:g,showForm:x,showBulkTagsModal:p,setShowBulkTagsModal:k,showBulkStatusModal:b,setShowBulkStatusModal:w,showBulkWorkspaceModal:N,setShowBulkWorkspaceModal:h,showStartSessionModal:C,setShowStartSessionModal:S,selectedBacklogForSession:v,setSelectedBacklogForSession:D,bulkTagsToAdd:j,setBulkTagsToAdd:y,bulkStatusToSet:$,setBulkStatusToSet:B,bulkWorkspaceToSet:G,setBulkWorkspaceToSet:A,formData:R,setFormData:ae,setShowForm:u,setSelectedBacklog:d,handleSave:async()=>{try{if(l){const F=await De.update(l.id,R);r(I=>I.map(U=>U.id===l.id?F:U))}else{const F=Array.isArray(R.tags)?R.tags:[],I={title:R.title,description:R.description,status:he.InMind,tags:F,workspaceId:R.workspaceId,sessionId:R.sessionId},U=await De.create(I);r(X=>[...X,U])}u(!1),d(null)}catch(F){console.error("Failed to save backlog:",F)}},handleDelete:async F=>{try{await De.delete(F),r(I=>I.filter(U=>U.id!==F)),E({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(I){console.error("Failed to delete backlog:",I)}},handleEdit:F=>{d(F),ae({title:F.title,description:F.description,status:F.status,tags:F.tags||[],workspaceId:F.workspaceId,sessionId:F.sessionId}),u(!0)},handleCreate:()=>{d(null),ae({title:"",description:"",status:he.InMind,tags:[],workspaceId:void 0,sessionId:void 0}),u(!0)},handleBulkDelete:async()=>{try{await Promise.all(Array.from(g).map(F=>De.delete(F))),r(F=>F.filter(I=>!g.has(I.id))),m(new Set),E({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(F){console.error("Failed to delete backlogs:",F)}},handleBulkAddTags:async()=>{try{const F=Array.from(g).map(async U=>{const X=n.find(ie=>ie.id===U);if(X){const ie=X.tags||[],ee=[...new Set([...ie,...j])];return await De.update(U,{title:X.title,description:X.description,status:X.status,tags:ee,workspaceId:X.workspaceId,sessionId:X.sessionId})}return null});(await Promise.all(F)).forEach(U=>{U&&r(X=>X.map(ie=>ie.id===U.id?U:ie))}),m(new Set),k(!1),y([])}catch(F){console.error("Failed to add tags to backlogs:",F)}},handleBulkChangeStatus:async()=>{try{const F=Array.from(g).map(async U=>{const X=n.find(ie=>ie.id===U);return X?await De.update(U,{title:X.title,description:X.description,status:$,tags:X.tags||[],workspaceId:X.workspaceId,sessionId:X.sessionId}):null});(await Promise.all(F)).forEach(U=>{U&&r(X=>X.map(ie=>ie.id===U.id?U:ie))}),m(new Set),w(!1)}catch(F){console.error("Failed to change status of backlogs:",F)}},handleBulkChangeWorkspace:async()=>{try{const F=Array.from(g).map(async U=>{const X=n.find(ie=>ie.id===U);return X?await De.update(U,{title:X.title,description:X.description,status:X.status,tags:X.tags||[],workspaceId:G,sessionId:X.sessionId}):null});(await Promise.all(F)).forEach(U=>{U&&r(X=>X.map(ie=>ie.id===U.id?U:ie))}),m(new Set),h(!1)}catch(F){console.error("Failed to change workspace of backlogs:",F)}},handleStartSession:F=>{D(F),S(!0)},handleCreateSession:async F=>{try{const I=n.find(ee=>ee.id===F.backlogId),U=I?I.title:null,X=await Z.create({workspaceId:F.workspaceId,starterGitBranch:F.starterGitBranch,agentId:F.agentId,name:U});a(X);const ie=await De.update(F.backlogId,{sessionId:X.id});r(ee=>ee.map(q=>q.id===F.backlogId?ie:q)),await Ye.send(X.id,{content:F.initialMessage}),S(!1),D(null),t(`/session/${X.id}`)}catch(I){console.error("Failed to create session:",I)}},handleOpenSession:F=>{t(`/session/${F}`)},toggleBacklogSelection:F=>{m(I=>{const U=new Set(I);return U.has(F)?U.delete(F):U.add(F),U})},selectAllBacklogs:()=>{m(new Set(ce.map(F=>F.id)))},clearSelection:()=>{m(new Set)},filteredBacklogs:ce,filters:z,setFilters:se,confirmDialog:_,setConfirmDialog:E,availableTags:J}}function Qt({selectedTags:t,availableTags:s,onChange:a,placeholder:n="Type to add tags..."}){const[r,i]=c.useState(""),[o,l]=c.useState([]),[d,g]=c.useState(!1),[m,x]=c.useState(-1),u=c.useRef(null),p=c.useRef(null);c.useEffect(()=>{if(r.trim()){const h=s.filter(C=>!t.includes(C)&&C.toLowerCase().includes(r.toLowerCase()));l(h),g(h.length>0)}else g(!1),l([]);x(-1)},[r,s,t]);const k=h=>{const C=h.trim();if(C&&!t.includes(C)){const S=[...t,C];a(S)}i(""),g(!1),x(-1)},b=h=>{a(t.filter(C=>C!==h))},w=h=>{h.key==="Enter"?(h.preventDefault(),m>=0&&o[m]?k(o[m]):r.trim()&&k(r)):h.key==="ArrowDown"?(h.preventDefault(),x(C=>C<o.length-1?C+1:C)):h.key==="ArrowUp"?(h.preventDefault(),x(C=>C>0?C-1:-1)):h.key==="Escape"?(g(!1),x(-1)):h.key==="Backspace"&&!r&&t.length>0?b(t[t.length-1]):(h.key===","||h.key==="Tab")&&(h.preventDefault(),r.trim()&&k(r))},N=h=>{u.current&&!u.current.contains(h.target)&&p.current&&!p.current.contains(h.target)&&(g(!1),x(-1))};return c.useEffect(()=>(document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)),[]),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 p-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 min-h-[42px] focus-within:ring-2 focus-within:ring-purple-500 focus-within:border-transparent",children:[t.map(h=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-sm rounded",children:[h,e.jsx("button",{type:"button",onClick:()=>b(h),className:"ml-1 text-purple-600 dark:text-purple-300 hover:text-purple-800 dark:hover:text-purple-100",children:e.jsx(et,{className:"w-3 h-3"})})]},h)),e.jsx("input",{ref:u,type:"text",value:r,onChange:h=>i(h.target.value),onKeyDown:w,onFocus:()=>{o.length>0&&g(!0)},placeholder:t.length===0?n:"",className:"flex-1 outline-none bg-transparent text-neutral-900 dark:text-neutral-100 min-w-[120px]"})]}),d&&o.length>0&&e.jsx("div",{ref:p,className:"absolute top-full left-0 right-0 z-10 mt-1 bg-white dark:bg-neutral-700 border border-neutral-300 dark:border-neutral-600 rounded-md shadow-lg max-h-40 overflow-y-auto",children:o.map((h,C)=>e.jsx("button",{type:"button",onClick:()=>k(h),className:`w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-600 ${C===m?"bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200":"text-neutral-900 dark:text-neutral-100"}`,children:h},h))})]})}function Ta({isOpen:t,selectedBacklog:s,formData:a,setFormData:n,onSave:r,onClose:i,availableTags:o,workspaces:l}){const[d,g]=c.useState({}),m=()=>{const p={};return a.title.trim()?a.title.length>255&&(p.title="Title must be 255 characters or less"):p.title="Title is required",g(p),Object.keys(p).length===0},x=()=>{m()&&(r(),g({}))},u=()=>{g({}),i()};return e.jsx(xe,{isOpen:t,onClose:u,title:s?"Edit Backlog":"Create Backlog",size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:x,children:s?"Update":"Create"}),e.jsx(O,{variant:"ghost",onClick:u,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:a.title,onChange:p=>n({...a,title:p.target.value}),className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${d.title?"border-red-500 dark:border-red-400 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,placeholder:"Enter backlog title"}),d.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:p=>n({...a,description:p.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",rows:3,placeholder:"Enter backlog description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Workspace (optional)"}),e.jsxs("select",{value:a.workspaceId||"",onChange:p=>n({...a,workspaceId:p.target.value?parseInt(p.target.value):void 0}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",children:[e.jsx("option",{value:"",children:"No workspace"}),l.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Tags"}),e.jsx(Qt,{selectedTags:a.tags||[],availableTags:o,onChange:p=>n({...a,tags:p}),placeholder:"Type to add tags (press Enter, Tab, or comma to add)"})]})]})})}function Ea({isOpen:t,selectedCount:s,bulkTags:a,setBulkTags:n,availableTags:r,onSave:i,onClose:o}){return e.jsx(xe,{isOpen:t,onClose:o,title:`Add Tags to ${s} Backlogs`,size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:i,disabled:a.length===0,children:"Add Tags"}),e.jsx(O,{variant:"ghost",onClick:o,children:"Cancel"})]}),children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Tags to Add"}),e.jsx(Qt,{selectedTags:a,availableTags:r,onChange:n,placeholder:"Type to add tags to selected backlogs"}),e.jsxs("p",{className:"mt-1 text-sm text-neutral-500 dark:text-neutral-400",children:["These tags will be added to all ",s," selected backlogs."]})]})})})}function Aa({isOpen:t,selectedCount:s,bulkStatus:a,setBulkStatus:n,onSave:r,onClose:i}){return e.jsx(xe,{isOpen:t,onClose:i,title:`Change Status of ${s} Backlogs`,size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:r,children:"Change Status"}),e.jsx(O,{variant:"ghost",onClick:i,children:"Cancel"})]}),children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"New Status"}),e.jsxs("select",{value:a,onChange:o=>n(parseInt(o.target.value)),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",children:[e.jsx("option",{value:he.InMind,children:"In mind"}),e.jsx("option",{value:he.Ready,children:"Ready"}),e.jsx("option",{value:he.InProgress,children:"In Progress"}),e.jsx("option",{value:he.Done,children:"Done"}),e.jsx("option",{value:he.Canceled,children:"Canceled"})]}),e.jsxs("p",{className:"mt-1 text-sm text-neutral-500 dark:text-neutral-400",children:["This status will be applied to all ",s," selected backlogs."]})]})})})}function Da({isOpen:t,selectedCount:s,bulkWorkspaceId:a,setBulkWorkspaceId:n,workspaces:r,onSave:i,onClose:o}){return e.jsx(xe,{isOpen:t,onClose:o,title:`Set Workspace for ${s} Backlogs`,size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:i,children:"Set Workspace"}),e.jsx(O,{variant:"ghost",onClick:o,children:"Cancel"})]}),children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Workspace"}),e.jsxs("select",{value:a||"",onChange:l=>n(l.target.value?parseInt(l.target.value):void 0),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",children:[e.jsx("option",{value:"",children:"No workspace"}),r.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),e.jsxs("p",{className:"mt-1 text-sm text-neutral-500 dark:text-neutral-400",children:["This workspace will be assigned to all ",s," selected backlogs."]})]})})})}function $a({isOpen:t,backlog:s,workspaces:a,onCreateSession:n,onCancel:r}){const[i,o]=c.useState(""),[l,d]=c.useState(null),[g,m]=c.useState(null),[x,u]=c.useState([]),[p,k]=c.useState(!1);c.useEffect(()=>{t&&s&&(b(),o(""),d(s.workspaceId||null),m(null))},[t,s]),c.useEffect(()=>{if(l){if(x.length>0){const D=we.getLastAgent(l);D&&x.some(j=>j.id===D)?m(D):m(null)}const v=we.getLastBranch(l);o(v||"")}else o(""),m(null)},[l,x]);const b=async()=>{try{k(!0);const v=await Me.getAll();if(u(v),l){const D=we.getLastAgent(l);D&&v.some(j=>j.id===D)&&m(D)}}catch(v){console.error("Failed to load agents:",v)}finally{k(!1)}},w=()=>{if(!l||!i||!g||!s)return;we.saveLastBranch(l,i),we.saveLastAgent(l,g);const v=`${s.title}

${s.description}`;n({workspaceId:l,starterGitBranch:i,agentId:g,backlogId:s.id,initialMessage:v})},N=l&&i.trim()&&g,h=!s?.workspaceId,C=a.map(v=>({value:v.id.toString(),label:v.name})),S=x.map(v=>({value:v.id.toString(),label:v.name+(v.roleName?` (${v.roleName})`:"")}));return e.jsx(xe,{isOpen:t,onClose:r,title:`Start Session for "${s?.title}"`,size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:w,disabled:!N,loading:p,children:"Start Session"}),e.jsx(O,{variant:"ghost",onClick:r,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-4",children:[h&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Workspace"}),e.jsx(ze,{options:C,value:l?.toString(),placeholder:"Select workspace",onSelect:v=>{d(parseInt(v.value))}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Start Git Branch"}),l?e.jsx(bt,{workspaceId:l,value:i,onSelect:v=>{o(v),l&&we.saveLastBranch(l,v)},placeholder:"Select git branch"}):e.jsx("div",{className:"px-3 py-2 text-neutral-500 dark:text-neutral-400",children:"Select workspace first"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Agent"}),p?e.jsx("div",{className:"px-3 py-2 text-neutral-500 dark:text-neutral-400",children:"Loading agents..."}):e.jsx(ze,{options:S,value:g?.toString(),placeholder:"Select agent",onSelect:v=>m(parseInt(v.value))})]}),e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-700 p-3 rounded-md",children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Initial Message"}),e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-300 whitespace-pre-wrap",children:s?`${s.title}

${s.description}`:""})]})]})})}function Ma(){const{backlogs:t,workspaces:s,loading:a,selectedBacklog:n,selectedBacklogs:r,showForm:i,showBulkTagsModal:o,setShowBulkTagsModal:l,showBulkStatusModal:d,setShowBulkStatusModal:g,showBulkWorkspaceModal:m,setShowBulkWorkspaceModal:x,showStartSessionModal:u,setShowStartSessionModal:p,selectedBacklogForSession:k,setSelectedBacklogForSession:b,bulkTagsToAdd:w,setBulkTagsToAdd:N,bulkStatusToSet:h,setBulkStatusToSet:C,bulkWorkspaceToSet:S,setBulkWorkspaceToSet:v,formData:D,setFormData:j,setShowForm:y,setSelectedBacklog:$,handleSave:B,handleDelete:G,handleEdit:A,handleCreate:R,handleBulkDelete:ae,handleBulkAddTags:z,handleBulkChangeStatus:se,handleBulkChangeWorkspace:_,handleStartSession:E,handleCreateSession:Y,handleOpenSession:J,toggleBacklogSelection:ce,selectAllBacklogs:ne,clearSelection:re,filteredBacklogs:f,filters:W,setFilters:L,confirmDialog:H,setConfirmDialog:V,availableTags:K}=Fa(),te=T=>{switch(T){case he.InMind:return"In mind";case he.Ready:return"Ready";case he.InProgress:return"In Progress";case he.Done:return"Done";case he.Canceled:return"Canceled";default:return"Unknown"}},oe=T=>{switch(T){case he.InMind:return"bg-neutral-100 text-neutral-800 dark:bg-neutral-700 dark:text-neutral-300";case he.Ready:return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";case he.InProgress:return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case he.Done:return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case he.Canceled:return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-neutral-100 text-neutral-800 dark:bg-neutral-700 dark:text-neutral-300"}},M=["All","In mind","Ready","In Progress","Done","Canceled"];return a?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg",children:"Loading backlogs..."})}):e.jsxs("div",{className:"flex flex-col h-full bg-neutral-50 dark:bg-neutral-900",children:[e.jsxs("div",{className:"p-6 border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-neutral-900 dark:text-neutral-100",children:"Backlogs"}),r.size>0&&e.jsxs("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mt-1",children:[r.size," backlog",r.size>1?"s":""," selected"]})]}),e.jsx("div",{className:"flex gap-2",children:r.size>0?e.jsxs(e.Fragment,{children:[e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>l(!0),children:[e.jsx(js,{className:"w-4 h-4 mr-2"}),"Add Tags"]}),e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>g(!0),children:[e.jsx(tt,{className:"w-4 h-4 mr-2"}),"Change Status"]}),e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>x(!0),children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Set Workspace"]}),e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>V({isOpen:!0,title:"Delete Backlogs",message:`Are you sure you want to delete ${r.size} backlog${r.size>1?"s":""}? This action cannot be undone.`,onConfirm:ae}),children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Delete"]}),e.jsxs(O,{variant:"ghost",size:"sm",onClick:re,children:[e.jsx(et,{className:"w-4 h-4 mr-2"}),"Clear"]})]}):e.jsx(O,{onClick:R,icon:e.jsx(ke,{size:12}),children:"Create Backlog"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4 text-neutral-500 dark:text-neutral-400"}),e.jsx("input",{type:"text",placeholder:"Search backlogs...",value:W.search,onChange:T=>L({...W,search:T.target.value}),className:"px-3 py-1.5 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4 text-neutral-500 dark:text-neutral-400"}),e.jsx("select",{value:W.status,onChange:T=>L({...W,status:T.target.value}),className:"px-3 py-1.5 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 text-sm",children:M.map(T=>e.jsx("option",{value:T,children:T},T))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Tags:"}),e.jsx("input",{type:"text",placeholder:"Filter by tags...",value:W.tags,onChange:T=>L({...W,tags:T.target.value}),className:"px-3 py-1.5 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ct,{className:"w-4 h-4 text-neutral-500 dark:text-neutral-400"}),e.jsxs("select",{value:W.workspace,onChange:T=>L({...W,workspace:T.target.value}),className:"px-3 py-1.5 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 text-sm",children:[e.jsx("option",{value:"All",children:"All Workspaces"}),e.jsx("option",{value:"No workspace",children:"No workspace"}),s.map(T=>e.jsx("option",{value:T.name,children:T.name},T.id))]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:f.length>0&&r.size===f.length,onChange:T=>{T.target.checked?ne():re()},className:"rounded border-neutral-300 dark:border-neutral-600"}),e.jsx("span",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Select all"})]}),e.jsxs("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:[f.length," of ",t.length," backlogs"]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:f.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:t.length===0?"No backlogs found":"No backlogs match your filters"})}):e.jsx("div",{className:"bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-700 border-b border-neutral-200 dark:border-neutral-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 w-12",children:e.jsx("input",{type:"checkbox",checked:f.length>0&&r.size===f.length,onChange:T=>{T.target.checked?ne():re()},className:"rounded border-neutral-300 dark:border-neutral-600"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Title"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Workspace"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Tags"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Session"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-600",children:f.map(T=>e.jsxs("tr",{className:r.has(T.id)?"bg-purple-50 dark:bg-purple-900/20":"",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:r.has(T.id),onChange:()=>ce(T.id),className:"rounded border-neutral-300 dark:border-neutral-600"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:T.title})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(Ae,{className:oe(T.status),children:te(T.status)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-300",children:T.workspaceId?s.find(P=>P.id===T.workspaceId)?.name||"Unknown":"No workspace"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:T.tags&&T.tags.length>0?T.tags.map((P,Q)=>e.jsx("span",{className:"px-2 py-1 bg-neutral-100 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300 text-xs rounded",children:P},Q)):e.jsx("span",{className:"text-neutral-400 dark:text-neutral-500 text-xs",children:"No tags"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-300 max-w-xs truncate",children:T.description})}),e.jsx("td",{className:"px-6 py-4",children:T.sessionId?e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>J(T.sessionId),children:[e.jsx(gt,{className:"w-4 h-4 mr-2"}),"Open"]}):e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>E(T),children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Start"]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>A(T),children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>V({isOpen:!0,title:"Delete Backlog",message:`Are you sure you want to delete "${T.title}"? This action cannot be undone.`,onConfirm:()=>G(T.id)}),children:e.jsx(Ee,{className:"w-4 h-4"})})]})})]},T.id))})]})})}),e.jsx(Ta,{isOpen:i,selectedBacklog:n,formData:D,setFormData:j,onSave:B,onClose:()=>{y(!1),$(null)},availableTags:K,workspaces:s}),e.jsx(Ea,{isOpen:o,selectedCount:r.size,bulkTags:w,setBulkTags:N,availableTags:K,onSave:z,onClose:()=>{l(!1),N([])}}),e.jsx(Aa,{isOpen:d,selectedCount:r.size,bulkStatus:h,setBulkStatus:C,onSave:se,onClose:()=>g(!1)}),e.jsx(Da,{isOpen:m,selectedCount:r.size,bulkWorkspaceId:S,setBulkWorkspaceId:v,workspaces:s,onSave:_,onClose:()=>x(!1)}),e.jsx($a,{isOpen:u,backlog:k,workspaces:s,onCreateSession:Y,onCancel:()=>{p(!1),b(null)}}),e.jsx(Te,{isOpen:H.isOpen,title:H.title,message:H.message,onConfirm:()=>{H.onConfirm(),V({isOpen:!1,title:"",message:"",onConfirm:()=>{}})},onCancel:()=>V({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),variant:"danger",confirmText:"Delete"})]})}function Ba(){const[t,s]=c.useState([]),[a,n]=c.useState([]),[r,i]=c.useState(!0),[o,l]=c.useState(null),[d,g]=c.useState(!1),[m,x]=c.useState({name:"",roleName:"",model:"",systemPrompt:"",mcpIds:[],mcps:[]}),[u,p]=c.useState({}),[k,b]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});c.useEffect(()=>{w(),N()},[]);const w=async()=>{i(!0);try{const y=await Me.getAll();s(y)}catch(y){console.error("Failed to load agents:",y)}finally{i(!1)}},N=async()=>{try{const y=await Ve.getAll();n(y)}catch(y){console.error("Failed to load MCPs:",y)}},h=()=>{l(null),x({name:"",roleName:"",model:"",systemPrompt:"",mcpIds:[],mcps:[]}),p({}),g(!0)},C=y=>{l(y),x({name:y.name,roleName:y.roleName,model:y.model,systemPrompt:y.systemPrompt,mcpIds:y.mcpIds,mcps:y.mcps?.map($=>$.name)??[]}),p({}),g(!0)},S=async()=>{p({});const y={};if(m.name.trim()||(y.name="Name is required"),m.model.trim()||(y.model="Please select a model for this agent"),Object.keys(y).length>0){p(y);return}try{if(o){const $={name:m.name,roleName:m.roleName,model:m.model,systemPrompt:m.systemPrompt,mcpIds:m.mcpIds},B=await Me.update(o.id,$);s(G=>G?.map(A=>A.id===o.id?B:A))}else{const $={name:m.name,roleName:m.roleName,model:m.model,systemPrompt:m.systemPrompt,mcpIds:m.mcpIds},B=await Me.create($);s(G=>[...G,B])}g(!1),l(null)}catch($){console.error("Failed to save agent:",$)}},v=async y=>{try{await Me.delete(y),s($=>$.filter(B=>B.id!==y)),b({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch($){console.error("Failed to delete agent:",$)}};return{agents:t,mcps:a,loading:r,selectedAgent:o,showForm:d,formData:m,formErrors:u,setFormData:x,setShowForm:g,setSelectedAgent:l,handleSave:S,handleDelete:v,handleDeleteConfirm:(y,$)=>{b({isOpen:!0,title:"Delete Agent",message:`Are you sure you want to delete "${$}"? This action cannot be undone.`,onConfirm:()=>v(y)})},handleModalClose:()=>{g(!1),l(null)},handleEdit:C,handleCreate:h,confirmDialog:k,setConfirmDialog:b}}function Oa({isOpen:t,onClose:s,onSave:a,selectedAgent:n,formData:r,formErrors:i,mcps:o,setFormData:l}){return e.jsx(xe,{isOpen:t,onClose:s,title:n?"Edit Agent":"Create Agent",size:"md",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:a,children:n?"Update":"Create"}),e.jsx(O,{variant:"ghost",onClick:s,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:r.name,onChange:d=>l({...r,name:d.target.value}),className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${i.name?"border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,placeholder:"Enter agent name",required:!0}),i.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Role Name"}),e.jsx("input",{type:"text",value:r.roleName,onChange:d=>l({...r,roleName:d.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",placeholder:"e.g., Frontend Developer, QA Engineer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Model *"}),e.jsxs("select",{value:r.model,onChange:d=>l({...r,model:d.target.value}),required:!0,className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${i.model?"border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,children:[e.jsx("option",{value:"",children:"Select a model"}),e.jsx("option",{value:"claude-code",children:"Claude Code"})]}),i.model&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.model})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"System Prompt"}),e.jsx("textarea",{value:r.systemPrompt,onChange:d=>l({...r,systemPrompt:d.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",rows:6,placeholder:"Enter the system prompt that defines the agent's behavior and role"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"MCPs"}),e.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto border border-neutral-300 dark:border-neutral-600 rounded-md p-2 bg-white dark:bg-neutral-700",children:[o.map(d=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:r.mcpIds.includes(d.id),onChange:g=>{g.target.checked?l({...r,mcpIds:[...r.mcpIds,d.id]}):l({...r,mcpIds:r.mcpIds.filter(m=>m!==d.id)})},className:"rounded border-neutral-300 text-purple-600"}),e.jsx("span",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:d.name})]},d.id)),o.length===0&&e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400 text-center py-2",children:"No MCPs available"})]})]})]})})}function Pa({agent:t,onEdit:s,onDelete:a}){return e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Cs,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-neutral-900 dark:text-neutral-100",children:t.name}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:t.roleName})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(t),children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>a(t.id,t.name),children:e.jsx(Ee,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsx(Ae,{className:"font-mono",children:t.model})}),t.mcps?.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:"MCPs:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.mcps.map((n,r)=>e.jsxs(Ae,{className:"bg-green-100 text-green-800",children:[e.jsx(dt,{className:"w-3 h-3 mr-1"}),n.name]},r))})]})]})]})}function Wa(){const{agents:t,mcps:s,loading:a,selectedAgent:n,showForm:r,formData:i,formErrors:o,setFormData:l,handleSave:d,handleDeleteConfirm:g,handleModalClose:m,handleEdit:x,handleCreate:u,confirmDialog:p,setConfirmDialog:k}=Ba();return a?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg",children:"Loading agents..."})}):e.jsxs("div",{className:"flex flex-col h-full bg-neutral-50 dark:bg-neutral-900",children:[e.jsx("div",{className:"p-6 border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-neutral-900 dark:text-neutral-100",children:"Agents"}),e.jsx(O,{onClick:u,icon:e.jsx(ke,{size:12}),children:"Create Agent"})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:"No agents found"}),e.jsx(O,{onClick:u,icon:e.jsx(ke,{size:12}),children:"Create your first agent"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:t?.map(b=>e.jsx(Pa,{agent:b,onEdit:x,onDelete:g},b.id))})}),e.jsx(Oa,{isOpen:r,onClose:m,onSave:d,selectedAgent:n,formData:i,formErrors:o,mcps:s,setFormData:l}),e.jsx(Te,{isOpen:p.isOpen,title:p.title,message:p.message,onConfirm:()=>{p.onConfirm(),k({isOpen:!1,title:"",message:"",onConfirm:()=>{}})},onCancel:()=>k({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),variant:"danger",confirmText:"Delete"})]})}function La(){const{workspaces:t,addWorkspace:s,updateWorkspace:a,removeWorkspace:n}=fe(),{alertDialog:r,showAlert:i,handleConfirm:o}=at(),[l,d]=c.useState(!1),[g,m]=c.useState(null),[x,u]=c.useState(!1),[p,k]=c.useState({name:"",gitRepository:""}),[b,w]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),N=()=>{if(t.length>=1){w({isOpen:!0,title:"Workspace Limit Reached",message:"You can only create 1 workspace. Please delete the existing workspace first to create a new one.",onConfirm:()=>w(D=>({...D,isOpen:!1}))});return}m(null),k({name:"",gitRepository:""}),u(!0)},h=D=>{m(D),k({name:D.name,gitRepository:D.gitRepository}),u(!0)},C=async()=>{d(!0);try{if(g){const D={name:p.name},j=await We.update(g.id,D);a(g.id,j)}else{const D={name:p.name,gitRepository:p.gitRepository},j=await We.create(D);s(j)}u(!1),m(null)}catch(D){console.error("Failed to save workspace:",D);const j=D?.message||D?.response?.data?.message||"Failed to save workspace. Please try again.";i({title:"Error",message:j,variant:"danger"})}finally{d(!1)}},S=async D=>{d(!0);try{await We.delete(D),n(D),w({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(j){console.error("Failed to delete workspace:",j)}finally{d(!1)}},v=t.length>=1;return{workspaces:t,loading:l,selectedWorkspace:g,showForm:x,formData:p,setFormData:k,setShowForm:u,setSelectedWorkspace:m,handleSave:C,handleDelete:S,handleEdit:h,handleCreate:N,confirmDialog:b,setConfirmDialog:w,isWorkspaceLimitReached:v,alertDialog:r,handleAlertConfirm:o}}function Ia(){const{workspaces:t,loading:s,selectedWorkspace:a,showForm:n,formData:r,setFormData:i,setShowForm:o,setSelectedWorkspace:l,handleSave:d,handleDelete:g,handleEdit:m,handleCreate:x,confirmDialog:u,setConfirmDialog:p,isWorkspaceLimitReached:k,alertDialog:b,handleAlertConfirm:w}=La();return s?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg",children:"Loading workspaces..."})}):e.jsxs("div",{className:"flex flex-col h-full bg-neutral-50 dark:bg-neutral-900",children:[e.jsx("div",{className:"p-6 border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-neutral-900 dark:text-neutral-100",children:"Workspaces"}),e.jsxs(O,{onClick:x,disabled:k,title:k?"Maximum of 1 workspace allowed":"Create a new workspace",icon:e.jsx(ke,{size:12}),children:["Create Workspace",k&&" (Limit Reached)"]})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:"No workspaces found"}),e.jsx(O,{onClick:x,icon:e.jsx(ke,{size:12}),children:"Create your first workspace"})]}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:t.map(N=>e.jsx(Us,{workspace:N,onEdit:m,onDelete:h=>p({isOpen:!0,title:"Delete Workspace",message:`Are you sure you want to delete "${N.name}"? This will also delete all associated sessions, environments, and tasks.`,onConfirm:()=>g(h)})},N.id))})}),e.jsx(_t,{isOpen:n,workspace:a,formData:r,setFormData:i,onSave:d,onCancel:()=>{o(!1),l(null)}}),e.jsx(Te,{isOpen:u.isOpen,title:u.title,message:u.message,onConfirm:()=>{u.onConfirm(),p({isOpen:!1,title:"",message:"",onConfirm:()=>{}})},onCancel:()=>p({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),variant:"danger",confirmText:"Delete"}),e.jsx(rt,{isOpen:b.isOpen,title:b.title,message:b.message,confirmText:b.confirmText,variant:b.variant,onConfirm:w})]})}function za(){const{workspaceId:t}=Rt(),{workspaces:s,updateWorkspace:a}=fe(),{addEnvironment:n,updateEnvironment:r,removeEnvironment:i}=ft(),{alertDialog:o,showAlert:l,handleConfirm:d}=at(),[g,m]=c.useState(null),[x,u]=c.useState(!0),[p,k]=c.useState({name:"",gitRepository:""}),[b,w]=c.useState(!1),{environments:N,loading:h}=Qe({workspaceId:+t,autoLoad:!0}),[C,S]=c.useState(!1),{refreshTasks:v}=Yt(+t),[D,j]=c.useState(null),[y,$]=c.useState(!1),[B,G]=c.useState({name:"",gitBranch:"",url:"",environmentVariables:{}}),[A,R]=c.useState([]),[ae,z]=c.useState(!0),[se,_]=c.useState(null),[E,Y]=c.useState(!1),[J,ce]=c.useState({name:"",type:null,workingDirectory:"",scriptType:ve.Bash,scriptContent:""}),[ne,re]=c.useState({}),[f,W]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});c.useEffect(()=>{t&&(L(),H())},[t]);const L=async()=>{if(t){u(!0);try{const q=s.find(me=>me.id===Number(t));if(q)m(q);else{const me=await We.getById(Number(t));m(me)}}catch(q){console.error("Failed to load workspace:",q)}finally{u(!1)}}},H=async()=>{if(!t){z(!1);return}z(!0);try{const q=await Ce.getByWorkspaceId(Number(t));R(q)}catch(q){console.error("Failed to load tasks:",q)}finally{z(!1)}},V=()=>{g&&(k({name:g.name,gitRepository:g.gitRepository}),w(!0))},K=async()=>{if(g)try{const q={name:p.name},me=await We.update(g.id,q);m(me),a(g.id,me),w(!1)}catch(q){console.error("Failed to update workspace:",q)}},te=()=>{if(N.length>=1){W({isOpen:!0,title:"Environment Limit Reached",message:"You can only create 1 environment per workspace. Please delete the existing environment first to create a new one.",onConfirm:()=>W(q=>({...q,isOpen:!1}))});return}j(null),G({name:"",gitBranch:"",url:"",environmentVariables:{}}),$(!0)},oe=q=>{j(q),G({name:q.name,gitBranch:q.gitBranch,url:q.url||"",environmentVariables:q.environmentVariables}),$(!0)},M=async()=>{if(!t){console.error("No workspace ID available");return}S(!0);try{const q=Number(t);if(D){const me=await Le.update(D.id,{name:B.name,url:B.url,environmentVariables:B.environmentVariables});r(q,me)}else{const me=await Le.create(q,{name:B.name,gitBranch:B.gitBranch,url:B.url,environmentVariables:B.environmentVariables});n(q,me)}$(!1),j(null)}catch(q){console.error("Failed to save environment:",q);const me=q?.message||q?.response?.data?.message||"Failed to save environment. Please try again.";l({title:"Error",message:me,variant:"danger"})}finally{S(!1)}},T=async q=>{if(t)try{await Le.delete(q),i(Number(t),q),W({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(me){console.error("Failed to delete environment:",me)}},P=()=>{_(null),ce({name:"",type:null,workingDirectory:"",scriptType:ve.Bash,scriptContent:""}),re({}),Y(!0)},Q=q=>{_(q),ce({name:q.name,type:q.type,workingDirectory:q.workingDirectory,scriptType:q.scriptType,scriptContent:q.scriptContent}),re({}),Y(!0)},F=q=>{_(null),ce({name:`${q.name} Copy`,type:q.type,workingDirectory:q.workingDirectory,scriptType:q.scriptType,scriptContent:q.scriptContent}),re({}),Y(!0)},I=()=>{const q={};return J.name.trim()||(q.name="Task name is required"),J.scriptContent.trim()||(q.scriptContent="Script content is required"),re(q),Object.keys(q).length===0},U=async()=>{if(!(!I()||!t))try{if(se){const q={name:J.name,type:J.type,workingDirectory:J.workingDirectory,scriptType:J.scriptType,scriptContent:J.scriptContent},me=await Ce.update(se.id,q);R(Oe=>Oe.map(Ze=>Ze.id===se.id?me:Ze)),v(!0)}else{const q={name:J.name,type:J.type,workingDirectory:J.workingDirectory,scriptType:J.scriptType,scriptContent:J.scriptContent},me=await Ce.create(Number(t),q);R(Oe=>[...Oe,me])}v(!0),Y(!1),_(null)}catch(q){console.error("Failed to save task:",q)}},X=async q=>{try{await Ce.delete(q),R(me=>me.filter(Oe=>Oe.id!==q)),v(!0),W({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(me){console.error("Failed to delete task:",me)}};return{workspace:g,workspaceLoading:x,workspaceForm:p,showWorkspaceForm:b,setShowWorkspaceForm:w,handleWorkspaceEdit:V,handleWorkspaceSave:K,setWorkspaceForm:k,environments:N,environmentsLoading:h,environmentSaving:C,selectedEnvironment:D,showEnvironmentForm:y,environmentFormData:B,setEnvironmentFormData:G,setShowEnvironmentForm:$,setSelectedEnvironment:j,handleEnvironmentSave:M,handleEnvironmentDelete:T,handleEnvironmentEdit:oe,handleEnvironmentCreate:te,tasks:A,tasksLoading:ae,selectedTask:se,showTaskForm:E,taskFormData:J,taskFormErrors:ne,setTaskFormData:ce,handleCreateTask:P,handleEditTask:Q,handleSaveTask:U,handleCloneTask:F,handleDeleteTaskConfirm:(q,me)=>{W({isOpen:!0,title:"Delete Task",message:`Are you sure you want to delete "${me}"? This action cannot be undone.`,onConfirm:()=>X(q)})},handleTaskModalClose:()=>{Y(!1),_(null)},confirmDialog:f,setConfirmDialog:W,isEnvironmentLimitReached:N.length>=1,alertDialog:o,handleAlertConfirm:d}}function Ra({environments:t,loading:s,onEditEnvironment:a,onDeleteEnvironment:n,onCloneEnvironment:r}){return s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-lg",children:"Loading environments..."})}):t.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:"No environments found"})}):t.map(i=>e.jsx(Rs,{environment:i,onEdit:a,onDelete:o=>n(o,i.name),onClone:r},i.id))}const Zt=c.forwardRef(({workspace:t},s)=>{const[a,n]=c.useState([]),[r,i]=c.useState(!0),[o,l]=c.useState(!1),[d,g]=c.useState(null),[m,x]=c.useState({key:"",value:""}),[u,p]=c.useState({}),[k,b]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});c.useEffect(()=>{w()},[t.id]);const w=async()=>{i(!0);try{const y=await Ke.getByWorkspaceId(t.id);n(y)}catch(y){console.error("Failed to load workspace environment variables:",y)}finally{i(!1)}},N=a,h=()=>{const y={};return m.key.trim()?m.key.length>255?y.key="Variable name must be 255 characters or less":!d&&a.some($=>$.key===m.key)&&(y.key="Variable name already exists"):y.key="Variable name is required",m.value.trim()||(y.value="Variable value is required"),p(y),Object.keys(y).length===0},C=()=>{g(null),x({key:"",value:""}),p({}),l(!0)};c.useImperativeHandle(s,()=>({addVariable:C}));const S=y=>{g(y.key),x({key:y.key,value:y.value}),p({}),l(!0)},v=async()=>{if(h())try{if(d){const y={value:m.value},$=await Ke.update(t.id,d,y);n(B=>B.map(G=>G.key===d?$:G))}else{const y={key:m.key,value:m.value},$=await Ke.create(t.id,y);n(B=>[...B,$])}l(!1),g(null)}catch(y){console.error("Failed to save workspace environment variable:",y),p({general:"Failed to save variable. Please try again."})}},D=async y=>{try{await Ke.delete(t.id,y),n($=>$.filter(B=>B.key!==y)),b({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch($){console.error("Failed to delete workspace environment variable:",$)}},j=y=>{b({isOpen:!0,title:"Delete Environment Variable",message:`Are you sure you want to delete "${y.key}"? This action cannot be undone.`,onConfirm:()=>D(y.key)})};return r?e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"text-lg",children:"Loading environment variables..."})}):e.jsxs("div",{className:"space-y-6",children:[a.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:"No environment variables found"})}):e.jsx("div",{className:"space-y-4",children:N.map(y=>e.jsxs("div",{className:"flex items-center p-4 border bg-white dark:bg-neutral-800 border-neutral-200 dark:border-neutral-600 rounded-lg",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-neutral-900 dark:text-neutral-100 mb-1",children:"Variable Name"}),e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-400 font-mono bg-neutral-100 dark:bg-neutral-600 px-2 py-1 rounded",children:y.key})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-neutral-900 dark:text-neutral-100 mb-1",children:"Variable Value"}),e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-400 font-mono bg-neutral-100 dark:bg-neutral-600 px-2 py-1 rounded break-all",children:y.value})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>S(y),title:"Edit variable",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>j(y),title:"Delete variable",children:e.jsx(Ee,{className:"w-4 h-4"})})]})]},y.key))}),e.jsxs(xe,{isOpen:o,onClose:()=>l(!1),title:d?"Edit Variable":"Add Variable",size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:v,children:d?"Update":"Create"}),e.jsx(O,{variant:"ghost",onClick:()=>l(!1),children:"Cancel"})]}),children:[u.general&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900/20 border border-red-300 dark:border-red-700 rounded text-red-700 dark:text-red-300 text-sm",children:u.general}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Variable Name"}),e.jsx("input",{type:"text",value:m.key,onChange:y=>x({...m,key:y.target.value}),disabled:!!d,placeholder:"Variable name (e.g., DATABASE_URL)",className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${u.key?"border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"} ${d?"opacity-50 cursor-not-allowed bg-neutral-100 dark:bg-neutral-600":""}`}),u.key&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.key}),d&&e.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Variable name cannot be changed when editing"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Variable Value"}),e.jsx("input",{type:"text",value:m.value,onChange:y=>x({...m,value:y.target.value}),placeholder:"Variable value",className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${u.value?"border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`}),u.value&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.value})]})]})]}),e.jsx(Te,{isOpen:k.isOpen,title:k.title,message:k.message,onConfirm:()=>{k.onConfirm(),b({isOpen:!1,title:"",message:"",onConfirm:()=>{}})},onCancel:()=>b({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),variant:"danger",confirmText:"Delete"})]})});Zt.displayName="WorkspaceEnvironmentVariablesView";const Va=t=>{if(t===null)return e.jsx(Ue,{className:"w-5 h-5 text-neutral-600"});switch(t){case pe.Build:return e.jsx(It,{className:"w-5 h-5 text-purple-600"});case pe.Test:return e.jsx(Lt,{className:"w-5 h-5 text-green-600"});case pe.Start:return e.jsx(qe,{className:"w-5 h-5 text-purple-600"});default:return e.jsx(Ue,{className:"w-5 h-5 text-neutral-600"})}},Ua=t=>{if(t===null)return"bg-neutral-100 text-neutral-800 dark:bg-neutral-700 dark:text-neutral-300";switch(t){case pe.Build:return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";case pe.Test:return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case pe.Start:return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";default:return"bg-neutral-100 text-neutral-800 dark:bg-neutral-700 dark:text-neutral-300"}},Ga=t=>{if(t===null)return"No Uncategorized";switch(t){case pe.Build:return"Build";case pe.Test:return"Test";case pe.Start:return"Start";default:return"Unknown"}},Ha=t=>{switch(t){case ve.Bash:return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300";case ve.PowerShell:return"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300";case ve.NodeJs:return"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-300";default:return"bg-neutral-100 text-neutral-800 dark:bg-neutral-700 dark:text-neutral-300"}};function qa({task:t,onEdit:s,onDelete:a,onClone:n,onExecute:r}){return e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 p-6 mb-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-neutral-100 dark:bg-neutral-700 rounded-lg",children:Va(t.type)}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-neutral-900 dark:text-neutral-100",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Ae,{className:Ua(t.type),children:Ga(t.type)}),e.jsx(Ae,{className:Ha(t.scriptType),children:ve[t.scriptType]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[r&&e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>r(t),className:"text-green-600 hover:text-green-700 hover:bg-green-50 dark:text-green-400 dark:hover:text-green-300 dark:hover:bg-green-900",title:"Execute task",children:e.jsx(qe,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>n(t),title:"Clone task",children:e.jsx(Bt,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(t),title:"Edit task",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>a(t.id,t.name),title:"Delete task",children:e.jsx(Ee,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-neutral-500 dark:text-neutral-400 pt-2 border-t border-neutral-200 dark:border-neutral-600",children:[e.jsxs("span",{children:["Created: ",new Date(t.createdAt).toLocaleDateString()]}),e.jsxs("span",{children:["Updated: ",new Date(t.updatedAt).toLocaleDateString()]})]})]})}function Ka({tasks:t,loading:s,onEditTask:a,onDeleteTask:n,onCloneTask:r}){return s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-lg",children:"Loading tasks..."})}):t.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:"No tasks found"})}):t.map(i=>e.jsx(qa,{task:i,onEdit:a,onDelete:n,onClone:r},i.id))}function _a({workspace:t,onWorkspaceEdit:s}){return e.jsx("div",{className:"p-6 border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-semibold text-neutral-900 dark:text-neutral-100",children:t.name}),e.jsx(O,{variant:"ghost",size:"sm",onClick:s,children:e.jsx(Ss,{className:"w-4 h-4 mr-2"})}),e.jsx(Ae,{className:"font-mono",children:t.gitRepository})]})})})}function Ya({isOpen:t,onClose:s,onSave:a,selectedTask:n,formData:r,formErrors:i,setFormData:o}){return e.jsx(xe,{isOpen:t,onClose:s,title:n?"Edit Task":"Create Task",size:"xl",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:a,children:n?"Update":"Create"}),e.jsx(O,{variant:"ghost",onClick:s,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:r.name,onChange:l=>o({...r,name:l.target.value}),className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${i.name?"border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,placeholder:"Enter task name"}),i.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Type"}),e.jsxs("select",{value:r.type??"",onChange:l=>o({...r,type:l.target.value===""?null:+l.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",children:[e.jsx("option",{value:"",children:"Uncategorized"}),Object.values(pe).filter(l=>!isNaN(Number(l))).map(l=>e.jsx("option",{value:l,children:Xa(+l)},l))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Script Type *"}),e.jsx("select",{value:r.scriptType,onChange:l=>o({...r,scriptType:+l.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",children:Object.values(ve).filter(l=>!isNaN(Number(l))).map(l=>e.jsx("option",{value:l,children:Ja(+l)},l))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:[e.jsx("span",{children:"Working Directory "}),e.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Relative paths are relative to the workspace root"})]}),e.jsx("input",{type:"text",value:r.workingDirectory,onChange:l=>o({...r,workingDirectory:l.target.value}),className:"w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 font-mono border-neutral-300 dark:border-neutral-600",placeholder:"e.g., /path/to/project or ./src"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Script Content *"}),e.jsx("textarea",{value:r.scriptContent,onChange:l=>o({...r,scriptContent:l.target.value}),className:`w-full flex-1 px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 font-mono text-sm ${i.scriptContent?"border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,rows:12,placeholder:Qa(r.scriptType)}),i.scriptContent&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.scriptContent})]})]})})}function Ja(t){switch(t){case ve.Bash:return"Bash";case ve.PowerShell:return"PowerShell";case ve.NodeJs:return"Node.js";default:return"Unknown"}}function Xa(t){if(t===null)return"Uncategorized";switch(t){case pe.Build:return"Build";case pe.Test:return"Test";case pe.Start:return"Start";default:return"Unknown"}}function Qa(t){switch(t){case ve.Bash:return`#!/bin/bash

# Example: Build script
npm install
npm run build`;case ve.PowerShell:return`# PowerShell script
# Example: Build script
npm install
npm run build`;case ve.NodeJs:return`// Node.js script
// Example: Build script
console.log("Starting build...");
process.exit(0);`;default:return"Enter your script content here..."}}function Za(){const t=c.useRef(null),{workspace:s,workspaceLoading:a,workspaceForm:n,showWorkspaceForm:r,setShowWorkspaceForm:i,handleWorkspaceEdit:o,handleWorkspaceSave:l,setWorkspaceForm:d,environments:g,environmentsLoading:m,environmentSaving:x,selectedEnvironment:u,showEnvironmentForm:p,environmentFormData:k,setEnvironmentFormData:b,setShowEnvironmentForm:w,setSelectedEnvironment:N,handleEnvironmentSave:h,handleEnvironmentDelete:C,handleEnvironmentEdit:S,handleEnvironmentCreate:v,tasks:D,tasksLoading:j,selectedTask:y,showTaskForm:$,taskFormData:B,taskFormErrors:G,setTaskFormData:A,handleCreateTask:R,handleEditTask:ae,handleCloneTask:z,handleSaveTask:se,handleDeleteTaskConfirm:_,handleTaskModalClose:E,confirmDialog:Y,setConfirmDialog:J,isEnvironmentLimitReached:ce,alertDialog:ne,handleAlertConfirm:re}=za();return a?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg",children:"Loading workspace..."})}):s?e.jsxs("div",{className:"flex flex-col h-full bg-neutral-50 dark:bg-neutral-900",children:[e.jsx(_a,{workspace:s,onWorkspaceEdit:o}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 overflow-auto p-6",children:[e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/20 rounded-lg",children:e.jsx(Fs,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 dark:text-neutral-100",children:"Environments"})]}),e.jsxs(O,{onClick:v,disabled:ce,title:ce?"Maximum of 1 environment allowed per workspace":"Create a new environment",icon:e.jsx(ke,{size:12}),children:["Create Environment",ce&&" (Limit Reached)"]})]}),e.jsx(Ra,{environments:g,loading:m,onEditEnvironment:S,onDeleteEnvironment:(f,W)=>J({isOpen:!0,title:"Delete Environment",message:`Are you sure you want to delete "${W}"? This action cannot be undone.`,onConfirm:()=>C(f)}),onCloneEnvironment:f=>{b({name:`${f.name} Copy`,gitBranch:f.gitBranch,url:f.url||"",environmentVariables:{...f.environmentVariables}}),N(null),w(!0)}})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/20 rounded-lg",children:e.jsx(Ue,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 dark:text-neutral-100",children:"Tasks"})]}),e.jsx(O,{onClick:R,icon:e.jsx(ke,{size:12}),children:"Create Task"})]}),e.jsx(Ka,{tasks:D,loading:j,onEditTask:ae,onDeleteTask:_,onCloneTask:z})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/20 rounded-lg",children:e.jsx(Ts,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 dark:text-neutral-100",children:"Environment Variables"})]}),e.jsx(O,{onClick:()=>t.current?.addVariable(),icon:e.jsx(ke,{size:12}),children:"Add Variable"})]}),e.jsx(Zt,{ref:t,workspace:s})]})]}),e.jsx(_t,{isOpen:r,workspace:s,formData:n,setFormData:d,onSave:l,onCancel:()=>i(!1)}),e.jsx(Vs,{isOpen:p,environment:u,formData:k,setFormData:b,onSave:h,onCancel:()=>{w(!1),N(null)},workspace:s,isLoading:x}),e.jsx(Ya,{isOpen:$,onClose:E,onSave:se,selectedTask:y,formData:B,formErrors:G,setFormData:A}),e.jsx(Te,{isOpen:Y.isOpen,title:Y.title,message:Y.message,onConfirm:()=>{Y.onConfirm(),J({isOpen:!1,title:"",message:"",onConfirm:()=>{}})},onCancel:()=>J({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),variant:"danger",confirmText:"Delete"}),e.jsx(rt,{isOpen:ne.isOpen,title:ne.title,message:ne.message,confirmText:ne.confirmText,variant:ne.variant,onConfirm:re})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg text-red-600",children:"Workspace not found"})})}function er(){const[t,s]=c.useState([]),[a,n]=c.useState(!0),[r,i]=c.useState(null),[o,l]=c.useState({}),[d,g]=c.useState(null),[m,x]=c.useState(!1),[u,p]=c.useState({name:"",description:"",type:Be.HttpStreaming,path:""}),[k,b]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});c.useEffect(()=>{w()},[]);const w=async()=>{n(!0),i(null);try{const j=await Ve.getAll();s(j)}catch(j){console.error("Failed to load MCPs:",j),i("Failed to load MCPs. Please try again.")}finally{n(!1)}},N=()=>{g(null),p({name:"",description:"",type:Be.HttpStreaming,path:""}),l({}),i(null),x(!0)},h=j=>{g(j),p({name:j.name,description:j.description||"",type:j.type,path:j.path}),l({}),i(null),x(!0)},C=()=>{const j={};return u.name.trim()||(j.name="Name is required"),u.type||(j.type="Type is required"),u.path.trim()||(j.path="Path is required"),l(j),Object.keys(j).length===0};return{mcps:t,loading:a,error:r,setError:i,fieldErrors:o,handleFieldErrorClear:j=>{l(y=>{const{[j]:$,...B}=y;return B})},selectedMCP:d,showForm:m,formData:u,setFormData:p,setShowForm:x,setSelectedMCP:g,handleSave:async()=>{if(C())try{if(i(null),l({}),d){const j={name:u.name,description:u.description,type:u.type,path:u.path},y=await Ve.update(d.id,j);s($=>$.map(B=>B.id===d.id?y:B))}else{const j={name:u.name,description:u.description,type:u.type,path:u.path},y=await Ve.create(j);s($=>[...$,y])}x(!1),g(null)}catch(j){console.error("Failed to save MCP:",j),i("Failed to save MCP. Please try again.")}},handleDelete:async j=>{try{i(null),await Ve.delete(j),s(y=>y.filter($=>$.id!==j)),b({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(y){console.error("Failed to delete MCP:",y),i("Failed to delete MCP. Please try again.")}},handleEdit:h,handleCreate:N,confirmDialog:k,setConfirmDialog:b}}const tr=t=>{switch(t){case Be.HttpStreaming:return"bg-purple-100 text-purple-800";case Be.Sse:return"bg-green-100 text-green-800";case Be.Stdio:return"bg-orange-100 text-orange-800";default:return"bg-neutral-100 text-neutral-800"}},sr=t=>{switch(t){case Be.HttpStreaming:return"HTTP Streaming";case Be.Sse:return"SSE (Server-Sent Events)";case Be.Stdio:return"STDIO";default:return"Unknown"}};function ar({mcp:t,onEdit:s,onDelete:a}){return e.jsx("div",{className:"bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(Wt,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-neutral-900 dark:text-neutral-100",children:t.name}),t.description&&e.jsx("div",{className:"space-y-3",children:e.jsx("div",{children:e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-300 mt-1",children:t.description||"No description provided"})})}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Ae,{className:tr(t.type),children:sr(t.type)}),e.jsx("code",{className:"text-sm bg-neutral-100 dark:bg-neutral-700 text-neutral-800 dark:text-neutral-200 px-2 py-1 rounded break-all",children:t.path})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(t),children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>a(t.id),children:e.jsx(Ee,{className:"w-4 h-4"})})]})]})})}function rr({isOpen:t,selectedMCP:s,formData:a,error:n,fieldErrors:r={},onFormDataChange:i,onFieldErrorClear:o,onSave:l,onClose:d,onErrorDismiss:g}){return e.jsxs(xe,{isOpen:t,onClose:d,title:s?"Edit MCP":"Add MCP",size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:l,children:s?"Update":"Add"}),e.jsx(O,{variant:"ghost",onClick:d,children:"Cancel"})]}),children:[n&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:n}),g&&e.jsx("button",{onClick:g,className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200",children:"×"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:a.name,onChange:m=>{i({...a,name:m.target.value}),r.name&&o&&o("name")},className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${r.name?"border-red-500 dark:border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,placeholder:"Enter MCP name"}),r.name&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:r.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:m=>i({...a,description:m.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",rows:3,placeholder:"Describe what this MCP does"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Type"}),e.jsxs("select",{value:a.type,onChange:m=>{i({...a,type:+m.target.value}),r.type&&o&&o("type")},className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${r.type?"border-red-500 dark:border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,children:[e.jsx("option",{value:"",children:"Select MCP type"}),e.jsx("option",{value:"1",children:"HTTP Streaming"}),e.jsx("option",{value:"2",children:"SSE (Server-Sent Events)"}),e.jsx("option",{value:"3",children:"STDIO"})]}),r.type&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:r.type})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Path"}),e.jsx("input",{type:"text",value:a.path,onChange:m=>{i({...a,path:m.target.value}),r.path&&o&&o("path")},className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${r.path?"border-red-500 dark:border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,placeholder:"Path to MCP package or executable"}),r.path&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:r.path}),e.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Can be a local path, npm package, or URL"})]})]})]})}function nr(){const{mcps:t,loading:s,error:a,setError:n,fieldErrors:r,handleFieldErrorClear:i,selectedMCP:o,showForm:l,formData:d,setFormData:g,setShowForm:m,setSelectedMCP:x,handleSave:u,handleDelete:p,handleEdit:k,handleCreate:b,confirmDialog:w,setConfirmDialog:N}=er();return s?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg",children:"Loading MCPs..."})}):e.jsxs("div",{className:"flex flex-col h-full bg-neutral-50 dark:bg-neutral-900",children:[e.jsx("div",{className:"p-6 border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-neutral-900 dark:text-neutral-100",children:"MCPs"}),e.jsx("p",{className:"text-neutral-600 dark:text-neutral-300 mt-1",children:"Model Context Protocols"})]}),e.jsx(O,{onClick:b,icon:e.jsx(ke,{size:12}),children:"Add MCP"})]})}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[a&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-red-700 dark:text-red-300",children:a}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>n(null),className:"text-red-600 dark:text-red-400",children:"×"})]})}),t.length===0&&!s?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:"No MCPs found"}),e.jsx(O,{onClick:b,icon:e.jsx(ke,{size:12}),children:"Add your first MCP"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:t.map(h=>e.jsx(ar,{mcp:h,onEdit:k,onDelete:C=>N({isOpen:!0,title:"Delete MCP",message:`Are you sure you want to delete "${h.name}"? This action cannot be undone.`,onConfirm:()=>p(C)})},h.id))})]}),e.jsx(rr,{isOpen:l,selectedMCP:o,formData:d,error:a,fieldErrors:r,onFormDataChange:g,onFieldErrorClear:i,onSave:u,onClose:()=>{m(!1),x(null),n(null)},onErrorDismiss:()=>n(null)}),e.jsx(Te,{isOpen:w.isOpen,title:w.title,message:w.message,onConfirm:()=>{w.onConfirm(),N({isOpen:!1,title:"",message:"",onConfirm:()=>{}})},onCancel:()=>N({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),variant:"danger",confirmText:"Delete"})]})}function ir(){Gt(),Ws();const{initialize:t,isInitialized:s,isInitializing:a,initError:n}=yt(),{loadSessions:r,loadWorkspaces:i}=fe();return c.useEffect(()=>{t()},[t]),c.useEffect(()=>{s&&(async()=>(await i(),await r(null)))()},[s,r,i]),a?e.jsx("div",{className:"flex items-center justify-center h-screen bg-neutral-50 dark:bg-neutral-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-neutral-600 dark:text-neutral-300",children:"Initializing application..."})]})}):n?e.jsx("div",{className:"flex items-center justify-center h-screen bg-neutral-50 dark:bg-neutral-900",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx("svg",{className:"h-12 w-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 13.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-800 dark:text-neutral-200 mb-2",children:"Initialization Failed"}),e.jsx("p",{className:"text-neutral-600 dark:text-neutral-400 mb-4",children:n}),e.jsx(O,{onClick:()=>window.location.reload(),children:"Retry"})]})}):e.jsx(Es,{children:e.jsxs("div",{className:"flex flex-col h-screen select-none",children:[e.jsx(qs,{}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs(As,{children:[e.jsx(Pe,{path:"/",element:e.jsx(sa,{})}),e.jsx(Pe,{path:"/session/:sessionId",element:e.jsx(Sa,{})}),e.jsx(Pe,{path:"/backlogs",element:e.jsx(Ma,{})}),e.jsx(Pe,{path:"/agents",element:e.jsx(Wa,{})}),e.jsx(Pe,{path:"/workspaces",element:e.jsx(Ia,{})}),e.jsx(Pe,{path:"/workspace/:workspaceId",element:e.jsx(Za,{})}),e.jsx(Pe,{path:"/mcps",element:e.jsx(nr,{})}),e.jsx(Pe,{path:"*",element:e.jsx(Ds,{to:"/",replace:!0})})]})}),e.jsx(Ks,{})]})})}$s.createRoot(document.getElementById("root")).render(e.jsx(ir,{}));
