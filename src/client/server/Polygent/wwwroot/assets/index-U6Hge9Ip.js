import{c as ze,r as c,H as _t,L as Kt,a as yt,j as e,X as Qe,R as fe,E as lt,b as Xe,T as Le,G as Tt,d as ot,C as Et,P as Ie,e as Ce,f as me,g as Jt,u as ct,F as Yt,h as At,i as Qt,k as Ve,S as $t,l as Xt,m as Dt,n as Zt,B as es,o as ts,p as ss,q as nt,s as Mt,I as as,D as rs,t as Bt,v as ns,w as is,x as Ye,y as tt,M as st,U as ft,z as ls,A as os,J as cs,K as ds,N as Ot,O as us,Q as gs,V as hs,W as ms,Y as bt,Z as Pt,_ as xs,$ as kt,a0 as ps,a1 as ys,a2 as fs,a3 as bs,a4 as ks,a5 as js,a6 as vs,a7 as ws,a8 as De,a9 as Ns,aa as Ss}from"./vendor-C9wJFylD.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();const dt=ze(t=>({theme:"system",isSignalRConnected:!1,setTheme:s=>t({theme:s}),setSignalRConnected:s=>t({isSignalRConnected:s})})),Me={async getAll(t){return le("/api/workspaces",t)},async getById(t,s){return le(`/api/workspaces/${t}`,s)},async create(t,s){return ne("/api/workspaces",t,s)},async update(t,s,a){return we(`/api/workspaces/${t}`,s,a)},async delete(t,s){return Ne(`/api/workspaces/${t}`,s)},async getGitBranches(t,s){return le(`/api/workspaces/${t}/git/branches`,s)}},Z={async getAll(t){return le("/api/sessions",t)},async getById(t,s){return le(`/api/sessions/${t}`,s)},async getByWorkspaceId(t,s){return le(`/api/workspaces/${t}/sessions`,s)},async create(t,s){return ne("/api/sessions",t,s)},async update(t,s,a){return we(`/api/sessions/${t}`,s,a)},async delete(t,s){return Ne(`/api/sessions/${t}`,s)},async getFiles(t,s,a){const n=s?`?folderPath=${encodeURIComponent(s)}`:"";return le(`/api/sessions/${t}/files${n}`,a)},async getFileContent(t,s,a){return le(`/api/sessions/${t}/files/content?filePath=${encodeURIComponent(s)}`,a)},async updateFileContent(t,s,a,n,r){return we(`/api/sessions/${t}/files/content`,{filePath:s,content:a,lastModified:n},r)},async getGitStatus(t,s){return le(`/api/sessions/${t}/git/status`,s)},async getGitFileContent(t,s,a,n){const r=a?`&mode=${a}`:"";return le(`/api/sessions/${t}/git/file?filePath=${encodeURIComponent(s)}${r}`,n)},async unstageAllChanges(t,s){return ne(`/api/sessions/${t}/git/unstage-all`,{},s)},async unstageFile(t,s,a){return ne(`/api/sessions/${t}/git/unstage-file`,{filePath:s},a)},async discardAllChanges(t,s){return ne(`/api/sessions/${t}/git/discard-all`,{},s)},async discardFileChanges(t,s,a){return ne(`/api/sessions/${t}/git/discard-file`,{filePath:s},a)},async stageAllChanges(t,s){return ne(`/api/sessions/${t}/git/stage-all`,{},s)},async stageFile(t,s,a){return ne(`/api/sessions/${t}/git/stage-file`,{filePath:s},a)},async getAvailableEditors(t,s){return le(`/api/sessions/${t}/editors`,s)},async openFileWithEditor(t,s,a,n){return ne(`/api/sessions/${t}/files/open`,{filePath:s,editorId:a},n)},async openFileFolder(t,s,a){return ne(`/api/sessions/${t}/files/open-folder`,{filePath:s},a)},async createFile(t,s,a,n){return ne(`/api/sessions/${t}/files`,{filePath:s,content:a},n)},async createFolder(t,s,a){return ne(`/api/sessions/${t}/folders`,{folderPath:s},a)},async renameFile(t,s,a,n){return we(`/api/sessions/${t}/files/rename`,{oldPath:s,newName:a},n)},async deleteFile(t,s,a){return Ne(`/api/sessions/${t}/files?filePath=${encodeURIComponent(s)}`,a)},async mergeToMain(t,s){return ne(`/api/sessions/${t}/actions/merge-to-main`,{},s)},async pushBranch(t,s){return ne(`/api/sessions/${t}/actions/push-branch`,{},s)},async pullFromStarterBranch(t,s){return ne(`/api/sessions/${t}/actions/pull-from-starter`,{},s)},async resetSession(t,s){return ne(`/api/sessions/${t}/actions/reset`,{},s)},async cancelSession(t,s){return ne(`/api/sessions/${t}/actions/cancel`,{},s)},async stopWorkingMessages(t,s){return ne(`/api/sessions/${t}/actions/stop`,{},s)},async openWithVSCode(t,s){return ne(`/api/sessions/${t}/actions/open-with-vscode`,{},s)},async cancelMessage(t,s,a){return ne(`/api/sessions/${t}/actions/stop?messageId=${s}`,{},a)},async getTasks(t,s){return le(`/api/sessions/${t}/tasks`,s)},async startTask(t,s,a){return ne(`/api/sessions/${t}/tasks/${s}/start`,{},a)},async clearUnreadMessages(t,s){return ne(`/api/sessions/${t}/clear-unread`,{},s)}},qe={async getBySessionId(t,s){return le(`/api/sessions/${t}/messages`,s)},async getById(t,s,a){return le(`/api/sessions/${t}/messages/${s}`,a)},async send(t,s,a){return ne(`/api/sessions/${t}/messages/send`,s,a)},async update(t,s,a,n){return we(`/api/sessions/${t}/messages/${s}`,a,n)},async delete(t,s,a){return Ne(`/api/sessions/${t}/messages/${s}`,a)}},Ee={async getAll(t){return le("/api/agents",t)},async getById(t,s){return le(`/api/agents/${t}`,s)},async create(t,s){return ne("/api/agents",t,s)},async update(t,s,a){return we(`/api/agents/${t}`,s,a)},async delete(t,s){return Ne(`/api/agents/${t}`,s)}},ut=(t,s,a)=>ne(`/api/sessions/${t}/actions/deploy-to-environment?environmentId=${s}${a?"&restartAfterSync=true":""}`),Be={async getByWorkspaceId(t,s){return le(`/api/workspaces/${t}/environments`,s)},async getById(t,s){return le(`/api/environments/${t}`,s)},async create(t,s,a){return ne(`/api/workspaces/${t}/environments`,s,a)},async update(t,s,a){return we(`/api/environments/${t}`,s,a)},async delete(t,s){return Ne(`/api/environments/${t}`,s)},async validateGitBranch(t,s,a){return le(`/api/workspaces/${t}/environments/validate-branch/${encodeURIComponent(s)}`,a)},async getTasks(t,s){return le(`/api/environments/${t}/tasks`,s)},async startTask(t,s,a){return ne(`/api/environments/${t}/tasks/${s}/start`,{},a)},async reset(t,s){return ne(`/api/environments/${t}/reset`,{},s)}},He={async getByWorkspaceId(t,s){return le(`/api/workspaces/${t}/variables`,s)},async create(t,s,a){return ne(`/api/workspaces/${t}/variables`,s,a)},async update(t,s,a,n){return we(`/api/workspaces/${t}/variables/${encodeURIComponent(s)}`,a,n)},async delete(t,s,a){return Ne(`/api/workspaces/${t}/variables/${encodeURIComponent(s)}`,a)}},ve={async getByWorkspaceId(t,s){return le(`/api/workspaces/${t}/tasks`,s)},async getById(t,s){return le(`/api/tasks/${t}`,s)},async create(t,s,a){return ne(`/api/workspaces/${t}/tasks`,s,a)},async update(t,s,a){return we(`/api/tasks/${t}`,s,a)},async delete(t,s){return Ne(`/api/tasks/${t}`,s)},async stopTask(t,s){return ne(`/api/tasks/${t}/stop`,{},s)},async getTaskOutput(t,s){return le(`/api/tasks/${t}/output`,s)}},Fe={async getAll(t){return le("/api/backlogs",t)},async getById(t,s){return le(`/api/backlogs/${t}`,s)},async create(t,s){return ne("/api/backlogs",t,s)},async update(t,s,a){return we(`/api/backlogs/${t}`,s,a)},async delete(t,s){return Ne(`/api/backlogs/${t}`,s)}},We={async getAll(t){return le("/api/mcps",t)},async getById(t,s){return le(`/api/mcps/${t}`,s)},async create(t,s){return ne("/api/mcps",t,s)},async update(t,s,a){return we(`/api/mcps/${t}`,s,a)},async delete(t,s){return Ne(`/api/mcps/${t}`,s)}},It={getStartupData:()=>le("/api/startup")};async function le(t,s){return Ze("GET",t,void 0,s)}async function ne(t,s,a){return Ze("POST",t,s,a)}async function we(t,s,a){return Ze("PUT",t,s,a)}async function Ne(t,s){return Ze("DELETE",t,void 0,s)}async function Ze(t,s,a,n){if(n?.sessionCache){const r=sessionStorage.getItem(s);if(r)return JSON.parse(r)}if(n?.querystring){const r=Object.keys(n.querystring).filter(i=>n.querystring[i]!=null);if(r.length>0){const i=r.map(o=>{const l=n.querystring?.[o];return`${encodeURIComponent(o)}=${encodeURIComponent(l)}`}).join("&");s+=`?${i}`}}try{const r=await fetch(s,{method:t,body:t!=="GET"&&a?JSON.stringify(a):void 0,credentials:"include",headers:{"Content-Type":"application/json"}});if(r.status===401)throw new Error("Unauthorized");if(!r.ok)throw r;if(r.status===204)return null;const i=r.headers.get("Content-Type")?.includes("application/json")?await r.json():await r.text();return n?.sessionCache&&sessionStorage.setItem(s,JSON.stringify(i)),i}catch(r){if(n?.ignoreErrors)return null;throw r}}const Cs=Object.freeze(Object.defineProperty({__proto__:null,agentsApi:Ee,environmentsApi:Be,fetchDelete:Ne,fetchGet:le,fetchPost:ne,fetchPut:we,mcpsApi:We,messagesApi:qe,sessionsApi:Z,startupApi:It,tasksApi:ve,workspaceEnvironmentVariablesApi:He,workspacesApi:Me},Symbol.toStringTag,{value:"Module"})),it="polygent-active-workspace-id",Fs=()=>{try{const t=localStorage.getItem(it);return t?parseInt(t):null}catch{return null}},Ts=t=>{try{t?localStorage.setItem(it,t.toString()):localStorage.removeItem(it)}catch{}},xe=ze((t,s)=>({workspaces:[],sessions:[],environments:[],tasks:[],activeWorkspaceId:Fs(),activeSessionId:null,sessionStates:{},sessionTabStates:{},sessionTabs:{},sessionActiveTabIds:{},loadWorkspaces:async()=>{try{const a=await Me.getAll();t({workspaces:a})}catch(a){console.error("Failed to load workspaces:",a)}},loadSessions:async a=>{try{let n;a?n=await Z.getByWorkspaceId(a):n=await Z.getAll(),t({sessions:n})}catch(n){console.error("Failed to load sessions:",n)}},setWorkspaces:a=>t({workspaces:a}),addWorkspace:a=>{const{workspaces:n}=s();t({workspaces:[...n,a]})},updateWorkspace:(a,n)=>{const{workspaces:r}=s();t({workspaces:r.map(i=>i.id===a?n:i)})},removeWorkspace:a=>{const{workspaces:n}=s();t({workspaces:n.filter(r=>r.id!==a)})},setSessions:a=>t({sessions:a}),addSession:a=>{const{sessions:n}=s();t({sessions:[...n,a]})},updateSession:a=>{const{sessions:n}=s();t({sessions:n.map(r=>r.id===a.id?a:r)})},removeSession:a=>{const{sessions:n}=s();t({sessions:n.filter(r=>r.id!==a)})},setSessionStatus:(a,n,r)=>{const{sessions:i}=s();t({sessions:i.map(o=>o.id===a?{...o,status:n,...r!==void 0&&{unreadCount:r}}:o)})},clearUnreadMessages:a=>{const{sessions:n}=s();t({sessions:n.map(r=>r.id===a?{...r,hasUnreadMessage:!1}:r)})},setSessionUnreadMessage:(a,n)=>{const{sessions:r}=s();t({sessions:r.map(i=>i.id===a?{...i,hasUnreadMessage:n}:i)})},setEnvironments:a=>t({environments:a}),setTasks:a=>t({tasks:a}),setActiveWorkspaceId:a=>{Ts(a),t({activeWorkspaceId:a})},setActiveSessionId:a=>t({activeSessionId:a}),getSession:a=>{const{sessions:n}=s();return n.find(r=>r.id===a)},getSessionState:a=>{const{sessionStates:n}=s();return n[a]},setSessionState:(a,n)=>{const{sessionStates:r}=s();t({sessionStates:{...r,[a]:n}})},getTabState:a=>{const{sessionTabStates:n}=s();return n[a]},getSessionTabs:a=>{const{sessionTabs:n}=s();return n[a]||[{id:"chat",content:{type:"chat"},title:"Chat"}]},getSessionActiveTabId:a=>{const{sessionActiveTabIds:n}=s();return n[a]||"chat"},getTabContentById:(a,n)=>{const{sessionTabs:r}=s();return(r[a]||[{id:"chat",content:{type:"chat"},title:"Chat"}]).find(l=>l.id===n)?.content},setSessionTabs:(a,n)=>{const{sessionTabs:r}=s();t({sessionTabs:{...r,[a]:n}})},setSessionActiveTabId:(a,n)=>{const{sessionActiveTabIds:r}=s();t({sessionActiveTabIds:{...r,[a]:n}})},setTabContent:(a,n,r)=>{const{sessionTabs:i}=s(),l=(i[a]||[{id:"chat",content:{type:"chat"},title:"Chat"}]).map(d=>d.id===n?{...d,content:r}:d);t({sessionTabs:{...i,[a]:l}})},addSessionTab:(a,n)=>{const{sessionTabs:r}=s(),i=r[a]||[{id:"chat",content:{type:"chat"},title:"Chat"}];t({sessionTabs:{...r,[a]:[...i,n]}})},removeSessionTab:(a,n)=>{const{sessionTabs:r,sessionActiveTabIds:i}=s(),l=(r[a]||[]).filter(g=>g.id!==n),d=i[a],m=d===n?"chat":d;t({sessionTabs:{...r,[a]:l},sessionActiveTabIds:{...i,[a]:m}})},resetSessionTabs:a=>{const{sessionTabs:n,sessionActiveTabIds:r}=s();t({sessionTabs:{...n,[a]:[{id:"chat",content:{type:"chat"},title:"Chat",isDirty:!1}]},sessionActiveTabIds:{...r,[a]:"chat"}})},getTabDirty:(a,n)=>{const{sessionTabs:r}=s();return(r[a]||[]).find(l=>l.id===n)?.isDirty||!1},setTabDirty:(a,n,r)=>{const{sessionTabs:i}=s(),l=(i[a]||[]).map(d=>d.id===n?{...d,isDirty:r}:d);t({sessionTabs:{...i,[a]:l}})}}));var ie=(t=>(t[t.InMind=1]="InMind",t[t.Ready=2]="Ready",t[t.InProgress=3]="InProgress",t[t.Done=4]="Done",t[t.Canceled=5]="Canceled",t))(ie||{}),pe=(t=>(t[t.Ready=1]="Ready",t[t.Waiting=2]="Waiting",t[t.InProgress=3]="InProgress",t[t.Done=4]="Done",t[t.Canceled=5]="Canceled",t))(pe||{}),he=(t=>(t[t.System=1]="System",t[t.User=2]="User",t[t.Agent=3]="Agent",t[t.Tool=4]="Tool",t))(he||{}),je=(t=>(t[t.Pending=1]="Pending",t[t.Working=2]="Working",t[t.Done=3]="Done",t[t.Failed=4]="Failed",t[t.Canceled=5]="Canceled",t))(je||{}),ge=(t=>(t[t.Build=1]="Build",t[t.Test=2]="Test",t[t.Start=3]="Start",t))(ge||{}),ye=(t=>(t[t.Bash=1]="Bash",t[t.PowerShell=2]="PowerShell",t[t.NodeJs=3]="NodeJs",t))(ye||{}),ae=(t=>(t[t.Pending=1]="Pending",t[t.Running=2]="Running",t[t.Completed=3]="Completed",t[t.Failed=4]="Failed",t[t.Canceled=5]="Canceled",t))(ae||{}),Ae=(t=>(t[t.HttpStreaming=1]="HttpStreaming",t[t.Sse=2]="Sse",t[t.Stdio=3]="Stdio",t))(Ae||{}),Oe=(t=>(t[t.Added=0]="Added",t[t.Modified=1]="Modified",t[t.Deleted=2]="Deleted",t[t.Renamed=3]="Renamed",t[t.Copied=4]="Copied",t))(Oe||{});function jt(t,s){return`${s?"session":"env"}-${t}`}const _e=ze((t,s)=>({taskExecutions:{},taskExecutionsMap:{},setTaskExecution:(a,n)=>{const{taskExecutions:r}=s(),i=r[a]||{taskExecutionId:a,output:"",status:ae.Pending};t({taskExecutions:{...r,[a]:{...i,...n,taskExecutionId:a}}})},updateTaskOutput:(a,n)=>{const{taskExecutions:r}=s(),i=r[a];i&&t({taskExecutions:{...r,[a]:{...i,output:n}}})},updateTaskStatus:(a,n)=>{const{taskExecutions:r}=s(),i=r[a],o=new Date,l={status:n};(n===ae.Completed||n===ae.Failed||n===ae.Canceled)&&(l.endTime=o),n===ae.Running&&!i?.startTime&&(l.startTime=o),t({taskExecutions:{...r,[a]:{...i,...l}}})},getTaskExecution:a=>{const{taskExecutions:n}=s();return n[a]},mapTaskToExecution:(a,n,r)=>{const{taskExecutionsMap:i}=s(),o=jt(a,n);t({taskExecutionsMap:{...i,[o]:r}})},getTaskExecutionId:(a,n)=>{const{taskExecutionsMap:r}=s();return r[jt(a,n)]}})),gt=ze((t,s)=>({environmentsByWorkspace:{},loading:{},error:{},loadEnvironments:async a=>{t(n=>({loading:{...n.loading,[a]:!0},error:{...n.error,[a]:null}}));try{const n=await Be.getByWorkspaceId(a);t(r=>({environmentsByWorkspace:{...r.environmentsByWorkspace,[a]:n||[]},loading:{...r.loading,[a]:!1}}))}catch(n){const r=n instanceof Error?n.message:"Failed to load environments";t(i=>({loading:{...i.loading,[a]:!1},error:{...i.error,[a]:r}}))}},setEnvironments:(a,n)=>{t(r=>({environmentsByWorkspace:{...r.environmentsByWorkspace,[a]:n}}))},addEnvironment:(a,n)=>{t(r=>{const i=r.environmentsByWorkspace[a]||[];return{environmentsByWorkspace:{...r.environmentsByWorkspace,[a]:[...i,n]}}})},updateEnvironment:(a,n)=>{t(r=>{const i=r.environmentsByWorkspace[a]||[];return{environmentsByWorkspace:{...r.environmentsByWorkspace,[a]:i.map(o=>o.id===n.id?n:o)}}})},removeEnvironment:(a,n)=>{t(r=>{const i=r.environmentsByWorkspace[a]||[];return{environmentsByWorkspace:{...r.environmentsByWorkspace,[a]:i.filter(o=>o.id!==n)}}})},clearEnvironments:a=>{t(n=>({environmentsByWorkspace:{...n.environmentsByWorkspace,[a]:[]}}))},getEnvironmentsByWorkspace:a=>s().environmentsByWorkspace[a],getEnvironmentById:a=>{const{environmentsByWorkspace:n}=s();for(const r of Object.values(n)){const i=r.find(o=>o.id===a);if(i)return i}},isLoading:a=>s().loading[a]||!1,getError:a=>s().error[a]||null})),ht=ze((t,s)=>({editors:[],isInitialized:!1,isInitializing:!1,initError:null,initialize:async()=>{const{isInitialized:a,isInitializing:n}=s();if(!(a||n)){t({isInitializing:!0,initError:null});try{const r=await It.getStartupData(),i=xe.getState(),o=gt.getState();i.setWorkspaces(r.workspaces);const l={};r.environments.forEach(d=>{l[d.workspaceId]||(l[d.workspaceId]=[]),l[d.workspaceId].push(d)}),Object.entries(l).forEach(([d,m])=>{o.setEnvironments(parseInt(d),m)}),t({editors:r.availableEditors,isInitialized:!0,isInitializing:!1,initError:null})}catch(r){console.error("Failed to initialize application:",r),t({isInitializing:!1,initError:r instanceof Error?r.message:"Failed to initialize application"})}}},clearInitError:()=>t({initError:null})}));function Wt(){const{theme:t,setTheme:s}=dt();return c.useEffect(()=>{const n=localStorage.getItem("polygent-theme");n&&["light","dark","system"].includes(n)&&s(n)},[s]),c.useEffect(()=>{const n=document.documentElement,r=i=>{i?n.classList.add("dark"):n.classList.remove("dark")};if(t==="dark")r(!0);else if(t==="light")r(!1);else{const i=window.matchMedia("(prefers-color-scheme: dark)").matches;r(i);const o=window.matchMedia("(prefers-color-scheme: dark)"),l=d=>{t==="system"&&r(d.matches)};return o.addEventListener("change",l),()=>o.removeEventListener("change",l)}localStorage.setItem("polygent-theme",t)},[t]),{theme:t,setTheme:s,toggleTheme:()=>{s(t==="light"?"dark":t==="dark"?"system":"light")}}}class Es{connection=null;eventHandlers=new Map;isConnecting=!1;constructor(){this.initializeConnection()}initializeConnection(){this.connection=new _t().withUrl("/hub").withAutomaticReconnect().configureLogging(Kt.Information).build(),this.setupEventHandlers()}setupEventHandlers(){this.connection&&(this.connection.onclose(()=>{this.notifyHandlers("onDisconnected")}),this.connection.onreconnecting(()=>{this.notifyHandlers("onReconnecting")}),this.connection.onreconnected(()=>{this.notifyHandlers("onReconnected")}),this.connection.on("SessionStatusChanged",(s,a)=>{this.notifyHandlers("onSessionStatusChanged",parseInt(s),parseInt(a))}),this.connection.on("SessionUnreadMessageChanged",(s,a)=>{this.notifyHandlers("onSessionUnreadMessageChanged",parseInt(s),a)}),this.connection.on("MessageReceived",(s,a)=>{this.notifyHandlers("onMessageReceived",parseInt(s),a)}),this.connection.on("MessageStatusChanged",(s,a,n,r,i)=>{this.notifyHandlers("onMessageStatusChanged",parseInt(s),parseInt(a),parseInt(n),r,i)}),this.connection.on("TaskStatusChanged",(s,a,n,r,i)=>{this.notifyHandlers("onTaskStatusChanged",s,a,n,r,i)}),this.connection.on("TaskOutputChanged",(s,a,n,r,i)=>{this.notifyHandlers("onTaskOutputChanged",s,a,n,r,i)}))}async connect(){if(!(!this.connection||this.isConnecting)&&this.connection.state!==yt.Connected)try{this.isConnecting=!0,await this.connection.start(),this.notifyHandlers("onConnected")}catch(s){throw console.error("SignalR connection failed:",s),s}finally{this.isConnecting=!1}}async disconnect(){if(this.connection)try{await this.connection.stop()}catch(s){console.error("SignalR disconnection failed:",s)}}notifyHandlers(s,...a){const n=this.eventHandlers.get(s);n&&n.forEach(r=>{try{r(...a)}catch(i){console.error(`Error in SignalR event handler for ${s}:`,i)}})}on(s,a){this.eventHandlers.has(s)||this.eventHandlers.set(s,new Set);const n=this.eventHandlers.get(s),r=a;return n.add(r),()=>{n.delete(r),n.size===0&&this.eventHandlers.delete(s)}}off(s,a){if(a){const n=this.eventHandlers.get(s);n&&(n.delete(a),n.size===0&&this.eventHandlers.delete(s))}else this.eventHandlers.delete(s)}get isConnected(){return this.connection?.state===yt.Connected}get connectionState(){return this.connection?.state??null}async joinWorkspaceGroup(s){this.isConnected&&await this.connection?.invoke("JoinWorkspaceGroup",s)}async leaveWorkspaceGroup(s){this.isConnected&&await this.connection?.invoke("LeaveWorkspaceGroup",s)}async enterSession(s){this.isConnected&&await this.connection?.invoke("EnterSession",s)}async exitSession(s){this.isConnected&&await this.connection?.invoke("ExitSession",s)}}const re=new Es;function Lt(t,s={}){const{autoConnect:a=!0,sessionId:n,workspaceId:r}=s,i=c.useRef(t),o=c.useRef(null),l=c.useRef(null);return i.current=t,c.useEffect(()=>{const d=[];return Object.entries(i.current).forEach(([m,g])=>{if(g){const x=re.on(m,g);d.push(x)}}),a&&re.connect().catch(console.error),()=>{d.forEach(m=>m())}},[a]),c.useEffect(()=>{if(n){if(!re.isConnected){const d=()=>{m()},m=re.on("onConnected",d)}return()=>{o.current&&(o.current=null)}}},[n]),c.useEffect(()=>{if(!r)return;const d=l.current,m=async()=>{re.isConnected&&(d&&d!==r&&await re.leaveWorkspaceGroup(d),await re.joinWorkspaceGroup(r),l.current=r)};if(re.isConnected)m();else{const g=()=>{m(),x()},x=re.on("onConnected",g)}return()=>{const g=l.current;g&&(re.leaveWorkspaceGroup(g),l.current=null)}},[r]),{isConnected:re.isConnected,connectionState:re.connectionState,connect:()=>re.connect(),disconnect:()=>re.disconnect(),joinWorkspaceGroup:d=>re.joinWorkspaceGroup(d),leaveWorkspaceGroup:d=>re.leaveWorkspaceGroup(d)}}function As(){const{setSignalRConnected:t}=dt(),{updateTaskStatus:s,updateTaskOutput:a,mapTaskToExecution:n}=_e(),{setSessionStatus:r,setSessionUnreadMessage:i}=xe(),{isConnected:o,connectionState:l}=Lt({onConnected:()=>{t(!0)},onDisconnected:()=>{t(!1)},onReconnecting:()=>{t(!1)},onReconnected:()=>{t(!0)},onTaskStatusChanged(d,m,g,x,u){s(x,u),n(d,g,x)},onTaskOutputChanged(d,m,g,x,u){a(x,u),n(d,g,x)},onSessionStatusChanged(d,m){r(d,m)},onSessionUnreadMessageChanged(d,m){i(d,m)}},{autoConnect:!0});return c.useEffect(()=>{t(o)},[o,t]),{isConnected:o,connectionState:l}}function $s({sessionId:t,enabled:s=!0,pingInterval:a=1e4}){const n=c.useRef(null),r=c.useRef(!0),{clearUnreadMessages:i}=xe();return c.useEffect(()=>{if(!s||!t)return;const o=async()=>{if(re.isConnected&&r.current){await re.enterSession(t);try{await Z.clearUnreadMessages(t),i(t)}catch(h){console.error("Failed to clear unread messages:",h)}d()}},l=async()=>{re.isConnected&&(await re.exitSession(t),m())},d=()=>{n.current&&clearInterval(n.current),n.current=setInterval(async()=>{if(re.isConnected&&r.current)try{await re.enterSession(t)}catch(h){console.error("Failed to ping session:",h)}},a)},m=()=>{n.current&&(clearInterval(n.current),n.current=null)},g=async()=>{const h=!document.hidden;r.current=h,h?await o():await l()},x=async()=>{r.current=!0,await o()},u=async()=>{r.current=!1,await l()},y=async()=>{await l()},k=()=>{r.current&&o()},F=()=>{m()};document.addEventListener("visibilitychange",g),window.addEventListener("focus",x),window.addEventListener("blur",u),window.addEventListener("beforeunload",y);const S=re.on("onConnected",k),v=re.on("onDisconnected",F);return re.isConnected&&o(),()=>{re.isConnected&&re.exitSession(t).catch(console.error),m(),document.removeEventListener("visibilitychange",g),window.removeEventListener("focus",x),window.removeEventListener("blur",u),window.removeEventListener("beforeunload",y),S(),v()}},[t,s,a]),{enterSession:()=>{if(re.isConnected)return re.enterSession(t)},exitSession:()=>{if(re.isConnected)return re.exitSession(t)}}}function Rt(t){const[s,a]=c.useState([]),[n,r]=c.useState(!0),[i,o]=c.useState(!1),[l,d]=c.useState(null),[m,g]=c.useState(null),x=c.useCallback(j=>{a(A=>{const D=A.find(P=>P.id===j.id);let b;if(D){const P=j.updatedAt>D.updatedAt?j.updatedAt:D.updatedAt,q=j.updatedAt>D.updatedAt?j.status:D.status;b=A.map(M=>M.id===j.id?{...M,status:q,content:j.content||M.content,updatedAt:P||M.updatedAt}:M)}else b=[...A,j];return b.sort((P,q)=>new Date(P.updatedAt).getTime()-new Date(q.updatedAt).getTime())})},[]),u=c.useRef(t),y=c.useRef(x);u.current=t,y.current=x;const k=c.useCallback(()=>{d(null)},[]),F=c.useCallback(async()=>{try{r(!0),d(null);const A=(await qe.getBySessionId(t)).sort((D,b)=>new Date(D.updatedAt).getTime()-new Date(b.updatedAt).getTime());a(A)}catch(j){console.error("Failed to fetch messages:",j),d("Failed to load messages")}finally{r(!1)}},[t]),S=c.useCallback(async(j,A,D)=>{if(j.trim())try{o(!0),d(null);const b={content:j.trim(),metadata:A,parentMessageId:D},T=new Date,P=await qe.send(t,b);if(!P.success||!P.messageId)throw new Error(P.error||"Failed to send message");if(P.messageId){const q={id:P.messageId,sessionId:t,type:he.User,content:j.trim(),status:je.Pending,metadata:A,parentMessageId:D,createdAt:T,updatedAt:T};x(q)}}catch(b){console.error("Failed to send message:",b),d(b instanceof Error?b.message:"Failed to send message")}finally{o(!1)}},[t]),v=c.useCallback(()=>{a([])},[]),h=c.useCallback((j,A)=>{j===u.current&&y.current({...A,createdAt:new Date(A.createdAt),updatedAt:new Date(A.updatedAt)})},[]),C=c.useCallback((j,A,D,b,T)=>{if(j===u.current){const P=T?new Date(T):new Date;y.current({id:A,sessionId:u.current,type:he.User,status:D,content:b||"",updatedAt:P,createdAt:P})}},[]),N=c.useCallback((j,A)=>{j===u.current&&g(A.toString())},[]);return c.useEffect(()=>{const j=[];return j.push(re.on("onMessageReceived",h),re.on("onMessageStatusChanged",C)),()=>{j.forEach(A=>A())}},[h,C,N]),c.useEffect(()=>{a([]),d(null),g(null),F()},[t,F]),{messages:s,loading:n,sending:i,error:l,sessionStatus:m,sendMessage:S,clearError:k,clearMessages:v}}function O({variant:t="primary",size:s="md",children:a,className:n="",...r}){const i="inline-flex items-center justify-center rounded-md focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",o={primary:"bg-purple-800 text-white hover:bg-purple-900",secondary:"bg-neutral-600 text-white hover:bg-neutral-700",outline:"border border-neutral-300 dark:border-neutral-600 bg-transparent hover:bg-neutral-50 dark:hover:bg-neutral-700 text-neutral-700 dark:text-neutral-200",ghost:"bg-transparent hover:bg-neutral-100 dark:hover:bg-neutral-700 text-neutral-700 dark:text-neutral-200"},l={sm:"text-sm p-1.5",md:"text-sm px-4 py-2",lg:"text-base px-6 py-3"},d=`${i} ${o[t]} ${l[s]} ${n}`.trim();return e.jsx("button",{className:d,...r,children:a})}function Pe({options:t,value:s,placeholder:a="Select an option",onSelect:n,className:r="",dropdownWidth:i,alignRight:o=!1,openUpward:l=!1}){const[d,m]=c.useState(!1),g=c.useRef(null),x=t.find(u=>u.value===s);return c.useEffect(()=>{function u(y){g.current&&!g.current.contains(y.target)&&m(!1)}return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]),e.jsxs("div",{className:`relative ${r}`,ref:g,children:[e.jsxs("button",{type:"button",onClick:()=>m(!d),className:"relative w-full cursor-default rounded-md border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 py-2 pl-3 pr-10 text-left shadow-sm focus:border-purple-500 focus:ring-1 sm:text-sm text-neutral-900 dark:text-neutral-100",children:[e.jsx("span",{className:"block truncate",children:x?x.label:a}),e.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:e.jsx("svg",{className:"h-5 w-5 text-neutral-400 dark:text-neutral-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),d&&e.jsx("div",{className:`absolute z-10 ${l?"bottom-full mb-1":"mt-1"} max-h-60 overflow-auto rounded-md bg-white dark:bg-neutral-800 py-1 text-base shadow-lg ring-1 ring-black dark:ring-neutral-600 ring-opacity-5 sm:text-sm ${i||"w-full"} ${o?"right-0":""}`,children:t.map(u=>e.jsx("button",{type:"button",onClick:()=>{n(u),m(!1)},className:"relative w-full cursor-default select-none py-2 pl-3 pr-9 text-left hover:bg-purple-900 hover:text-white",children:e.jsx("span",{className:"block truncate",children:u.label})},u.value))})]})}const Ds={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl",full:"max-w-full mx-4"};function ue({isOpen:t,onClose:s,title:a,icon:n,children:r,footer:i,className:o="",contentClassName:l="",size:d="lg"}){return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:s}),e.jsxs("div",{className:`relative bg-white dark:bg-neutral-800 rounded-lg shadow-xl w-full ${Ds[d]} max-h-[80vh] flex flex-col ${o}`,children:[(a||n)&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-neutral-200 dark:border-neutral-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[n,a&&e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:a})]}),e.jsx(O,{variant:"ghost",size:"sm",onClick:s,children:e.jsx(Qe,{size:20})})]}),e.jsx("div",{className:`flex-1 overflow-y-auto ${l}`,children:r}),i&&e.jsx("div",{className:"flex items-center justify-between px-6 py-3 border-t border-neutral-200 dark:border-neutral-700",children:i})]})]}):null}function Ke({size:t="md",className:s=""}){const a={sm:"w-3 h-3",md:"w-6 h-6",lg:"w-8 h-8"};return e.jsx("div",{className:`inline-block ${a[t]} ${s}`,children:e.jsx("div",{className:"w-full h-full border-2 border-current border-t-transparent rounded-full animate-spin opacity-75"})})}function mt({status:t,size:s}){return e.jsx("div",{className:"flex items-center justify-center "+(s==="lg"?"w-5":"w-3"),children:t===ae.Running?e.jsx(Ke,{size:"sm"}):e.jsx("div",{className:`w-2 h-2 rounded-full ${t===ae.Completed?"bg-green-500":t===ae.Failed?"bg-red-500":"bg-neutral-400"}`})})}function Ms({environments:t,className:s="",taskUpdateTrigger:a,workspaceName:n}){const[r,i]=c.useState(!1),[o,l]=c.useState({}),[d,m]=c.useState(!1),[g,x]=c.useState({}),{taskExecutions:u,setTaskExecution:y,mapTaskToExecution:k,getTaskExecutionId:F}=_e(),[S,v]=c.useState({isOpen:!1,taskName:"",taskExecutionId:"",environmentId:0}),h=c.useRef(null),C=c.useRef(null),N=c.useCallback(async M=>{l(U=>({...U,[M.id]:{...U[M.id],environment:M,loading:!0,error:null}}));try{const U=await Be.getTasks(M.id);l(Y=>({...Y,[M.id]:{environment:M,tasks:U,loading:!1,error:null}}))}catch(U){l(Y=>({...Y,[M.id]:{environment:M,tasks:[],loading:!1,error:U instanceof Error?U.message:"Failed to load tasks"}}))}},[]);c.useEffect(()=>{t.forEach(M=>{(!o[M.id]||o[M.id].tasks===void 0)&&N(M)})},[t.length]),c.useEffect(()=>{a&&t.length>0&&t.forEach(M=>{N(M)})},[a,t.length]),c.useEffect(()=>{Object.entries(u).forEach(([M,U])=>{(U.status===ae.Completed||U.status===ae.Failed||U.status===ae.Canceled)&&t.forEach(Y=>{const R=o[Y.id];if(R?.tasks&&R.tasks.some(p=>F(p.id,!1)===M||p.taskExecutionId===M)){const p=R.tasks.find($=>$.taskExecutionId===M||F($.id,!1)===M);p&&p.status!==U.status&&N(Y)}})})},[u]);const j=async()=>{m(!0),await Promise.all(t.map(M=>N(M))),m(!1)},A=async(M,U,Y,R=!0)=>{const f=`start-${M}-${U}`;x(p=>({...p,[f]:!0}));try{const p=await Be.startTask(M,U);k(U,!1,p.taskExecutionId),y(p.taskExecutionId,{taskExecutionId:p.taskExecutionId,output:"",status:ae.Running,startTime:new Date}),R&&T(U,Y,p.taskExecutionId,M,!0),setTimeout(()=>{const $=t.find(V=>V.id===M);$&&N($)},100)}catch(p){console.error("Failed to start task:",p)}finally{x(p=>({...p,[f]:!1}))}},D=async(M,U)=>{const Y=`stop-${M}-${U}`;x(R=>({...R,[Y]:!0}));try{await ve.stopTask(U);const R=t.find(f=>f.id===M);R&&N(R)}catch(R){console.error("Failed to stop task:",R)}finally{x(R=>({...R,[Y]:!1}))}},b=async(M,U,Y,R)=>{const f=`restart-${M}-${U}`;x(p=>({...p,[f]:!0}));try{await ve.stopTask(R),await new Promise(p=>setTimeout(p,500)),await A(M,U,Y)}catch(p){console.error("Failed to restart task:",p)}finally{x(p=>({...p,[f]:!1}))}},T=async(M,U,Y,R,f=!1)=>{try{if(!f){const p=await ve.getTaskOutput(Y);y(Y,{taskExecutionId:Y,output:p.output||"",status:p.status})}v({isOpen:!0,taskName:U,taskExecutionId:Y,environmentId:R})}catch(p){console.error("Failed to get task output:",p),v({isOpen:!0,taskName:U,taskExecutionId:Y,environmentId:R})}},P=async(M,U)=>{const Y=`reset-${M}`;x(R=>({...R,[Y]:!0}));try{await Be.reset(M);const R=t.find(f=>f.id===M);R&&N(R)}catch(R){console.error("Failed to reset environment:",R)}finally{x(R=>({...R,[Y]:!1}))}},q=Object.values(o).some(M=>(M.tasks||[]).some(U=>{const R=F(U.id,!1)||U.taskExecutionId,p=(R?u[R]:null)?.status??U.status;return U.type===ge.Start&&p===ae.Running}));return e.jsxs("div",{className:`relative ${s}`,ref:h,children:[e.jsx("button",{type:"button",onClick:()=>i(!r),className:"relative rounded-md border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 py-2 px-3 text-left shadow-sm hover:bg-neutral-50 dark:hover:bg-neutral-700 focus:border-purple-500 focus:ring-1 sm:text-sm text-neutral-900 dark:text-neutral-100",children:e.jsxs("span",{className:"flex items-center gap-2",children:[q&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("div",{className:"absolute inset-0 w-2 h-2 bg-green-400 rounded-full animate-ping"})]}),e.jsx("span",{children:"Environments"})]})}),r&&e.jsxs("div",{className:"absolute bottom-full left-0 z-20 w-96 mb-2 rounded-md bg-white dark:bg-neutral-800 py-2 shadow-lg ring-1 ring-black dark:ring-neutral-600 ring-opacity-5 border border-neutral-200 dark:border-neutral-700 max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-neutral-200 dark:border-neutral-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:n?`${n} - Environment Tasks`:"Environment Tasks"}),e.jsx(O,{variant:"ghost",size:"sm",onClick:j,disabled:d,children:e.jsx(fe,{size:14,className:d?"animate-spin":""})})]}),e.jsx("div",{className:"py-1 space-y-3",children:t.length===0?e.jsx("div",{className:"px-3 py-4 text-sm text-neutral-500 dark:text-neutral-400 text-center",children:"No environments available"}):t.map(M=>{const U=o[M.id],Y=U?.loading??!0,R=U?.error,f=U?.tasks??[],p=(f||[]).some($=>{const W=F($.id,!1)||$.taskExecutionId,Q=(W?u[W]:null)?.status??$.status;return $.type===ge.Start&&Q===ae.Running});return e.jsxs("div",{className:"mx-2",children:[e.jsx("div",{className:"px-2 py-1 bg-neutral-50 dark:bg-neutral-700 rounded-t border-b border-neutral-200 dark:border-neutral-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("div",{className:"absolute inset-0 w-2 h-2 bg-green-400 rounded-full animate-ping"})]}),e.jsx("h4",{className:"text-xs text-neutral-700 dark:text-neutral-300",children:M.name}),M.url&&p&&e.jsx("button",{onClick:$=>{$.stopPropagation(),window.open(M.url,"_blank","noopener,noreferrer")},className:"text-neutral-500 hover:text-purple-600 dark:text-neutral-400 dark:hover:text-purple-400 transition-colors",title:`Open ${M.name} (${M.url})`,children:e.jsx(lt,{size:12})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:$=>{$.stopPropagation(),P(M.id,M.name)},disabled:g[`reset-${M.id}`],title:"Reset git repository (hard reset + pull)",className:"p-1 h-5 w-5",children:e.jsx(Xe,{size:10,className:g[`reset-${M.id}`]?"animate-spin":""})}),e.jsxs("span",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:[f.length," task",f.length!==1?"s":""]})]})]})}),R&&e.jsxs("div",{className:"px-2 py-2 text-red-600 text-xs bg-red-50 dark:bg-red-900/20",children:["Error: ",R]}),e.jsx("div",{className:"border border-neutral-200 dark:border-neutral-600 rounded-b",children:Y?e.jsx("div",{className:"px-3 py-2 text-neutral-500 text-xs",children:"Loading tasks..."}):f.length===0?e.jsx("div",{className:"px-3 py-2 text-neutral-500 text-xs",children:"No tasks found"}):e.jsx("div",{className:"p-1",children:e.jsx(Gt,{isSession:!1,tasks:f,loading:g,taskExecutions:u,isReadonly:!1,onStart:($,V,W=!0)=>A(M.id,$,V,W),onStop:$=>D(M.id,$),onRestart:($,V,W)=>b(M.id,$,V,W),onViewOutput:($,V,W)=>T($,V,W,M.id),emptyMessage:"No tasks found",autoOpenOnGroupStart:!1})})})]},M.id)})})]}),e.jsx(ue,{isOpen:S.isOpen,onClose:()=>v({...S,isOpen:!1}),title:S.taskName,icon:e.jsxs(e.Fragment,{children:[e.jsx(Le,{size:20,className:"text-neutral-500 dark:text-neutral-400"}),e.jsx(mt,{status:u[S.taskExecutionId]?.status||ae.Pending,size:"sm"})]}),contentClassName:"p-6 bg-neutral-900 dark:bg-black",footer:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:["Execution ID: ",S.taskExecutionId]}),e.jsxs("div",{className:"flex gap-2",children:[u[S.taskExecutionId]?.status===ae.Running&&e.jsx(O,{variant:"primary",size:"sm",onClick:()=>{D(S.environmentId,S.taskExecutionId),v({...S,isOpen:!1})},children:"Stop Task"}),e.jsx(O,{variant:"secondary",size:"sm",onClick:()=>v({...S,isOpen:!1}),children:"Close"})]})]}),children:e.jsx("div",{ref:C,className:"h-full",children:e.jsx(Ut,{output:u[S.taskExecutionId]?.output||"",className:"h-full",placeholder:"Waiting for output..."})})})]})}function Bs({environment:t,onEdit:s,onDelete:a,onClone:n}){return e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 p-6 mb-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Tt,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-neutral-900 dark:text-neutral-100",children:t.name}),e.jsxs("div",{className:"flex items-center gap-1 text-sm opacity-70",children:[e.jsx(ot,{className:"w-3 h-3"}),t.gitBranch]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>n(t),title:"Clone environment",children:e.jsx(Et,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(t),title:"Edit environment",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>a(t.id),title:"Delete environment",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-8",children:[t.url&&e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-purple-600 hover:text-purple-800 underline break-all font-mono",children:t.url}),e.jsx(lt,{className:"w-3 h-3 text-neutral-500"})]})}),Object.keys(t.environmentVariables).length>0&&e.jsx("div",{children:e.jsxs("div",{className:"mt-1 text-sm text-neutral-600 dark:text-neutral-300",children:[Object.keys(t.environmentVariables).length," variables configured"]})})]})]})}function Os({isOpen:t,environment:s,formData:a,setFormData:n,onSave:r,onCancel:i,workspace:o,isLoading:l=!1}){const[d,m]=c.useState([]),[g,x]=c.useState(!1);c.useEffect(()=>{if(t&&!g){const h=Object.entries(a.environmentVariables||{}).map(([C,N],j)=>({id:`${Date.now()}-${j}-${C}`,key:C,value:N}));m(h),x(!0)}else t||x(!1)},[t,a.environmentVariables,g]);const u=h=>{const C={};h.forEach(N=>{N.key.trim()&&(C[N.key]=N.value)}),n({...a,environmentVariables:C})},y=!!s,F=(()=>{const h={};return d.forEach(C=>{C.key.trim()&&(h[C.key]=(h[C.key]||0)+1)}),new Set(Object.keys(h).filter(C=>h[C]>1))})(),S=a.name.trim().length>0,v=S&&a.gitBranch&&F.size===0&&!l;return e.jsx(ue,{isOpen:t,onClose:i,title:y?"Edit Environment":"Create Environment",size:"md",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{onClick:r,disabled:!v,children:[l&&e.jsx(Jt,{className:"w-4 h-4 mr-2 animate-spin"}),y?"Update":"Create"]}),e.jsx(O,{variant:"ghost",onClick:i,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:a.name,onChange:h=>n({...a,name:h.target.value}),className:`w-full px-3 py-2 border rounded-md text-neutral-900 dark:text-neutral-100 ${l?"bg-neutral-100 dark:bg-neutral-600 border-neutral-200 dark:border-neutral-500 cursor-not-allowed opacity-50":!S&&a.name.length>0?"bg-white dark:bg-neutral-700 border-red-300 dark:border-red-600 focus:ring-red-500":"bg-white dark:bg-neutral-700 border-neutral-300 dark:border-neutral-600"}`,placeholder:"e.g., Development, Staging, Production",disabled:l,required:!0}),!S&&a.name.length>0&&e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:"Environment name is required"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Git Branch"}),y?e.jsxs("div",{children:[e.jsx("input",{type:"text",value:a.gitBranch,disabled:!0,className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-neutral-100 dark:bg-neutral-600 text-neutral-900 dark:text-neutral-100 opacity-50 cursor-not-allowed"}),e.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Git branch cannot be changed after creation"})]}):e.jsx(xt,{workspaceId:o.id,value:a.gitBranch,onSelect:h=>n({...a,gitBranch:h}),placeholder:"Select git branch",autoSelectDefault:!a.gitBranch})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"URL (optional)"}),e.jsx("input",{type:"url",value:a.url||"",onChange:h=>n({...a,url:h.target.value}),className:`w-full px-3 py-2 border rounded-md text-neutral-900 dark:text-neutral-100 ${l?"bg-neutral-100 dark:bg-neutral-600 border-neutral-200 dark:border-neutral-500 cursor-not-allowed opacity-50":"bg-white dark:bg-neutral-700 border-neutral-300 dark:border-neutral-600"}`,placeholder:"https://example.com",disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Environment Variables"}),e.jsxs("div",{className:"space-y-2",children:[d.map(h=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h.key,onChange:C=>{const N=d.map(j=>j.id===h.id?{...j,key:C.target.value}:j);m(N),u(N)},className:`flex-1 px-3 py-2 border rounded-md text-neutral-900 dark:text-neutral-100 ${l?"bg-neutral-100 dark:bg-neutral-600 border-neutral-200 dark:border-neutral-500 cursor-not-allowed opacity-50":h.key.trim()&&F.has(h.key)?"bg-white dark:bg-neutral-700 border-orange-300 dark:border-orange-600 focus:ring-orange-500":"bg-white dark:bg-neutral-700 border-neutral-300 dark:border-neutral-600"}`,placeholder:"Variable name",disabled:l}),e.jsx("input",{type:"text",value:h.value,onChange:C=>{const N=d.map(j=>j.id===h.id?{...j,value:C.target.value}:j);m(N),u(N)},className:`flex-1 px-3 py-2 border rounded-md text-neutral-900 dark:text-neutral-100 ${l?"bg-neutral-100 dark:bg-neutral-600 border-neutral-200 dark:border-neutral-500 cursor-not-allowed opacity-50":"bg-white dark:bg-neutral-700 border-neutral-300 dark:border-neutral-600"}`,placeholder:"Variable value",disabled:l}),e.jsx(O,{variant:"ghost",size:"sm",disabled:l,onClick:()=>{const C=d.filter(N=>N.id!==h.id);m(C),u(C)},children:e.jsx(Ce,{className:"w-4 h-4"})})]},h.id)),e.jsxs(O,{variant:"ghost",size:"sm",disabled:l,onClick:()=>{const h={id:`${Date.now()}-${Math.random()}`,key:"",value:""},C=[...d,h];m(C)},children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Add Variable"]}),F.size>0&&e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 mt-2",children:["⚠️ Warning: Duplicate variable names detected. Only the last value will be saved for: ",Array.from(F).join(", ")]})]})]})]})})}function Ps({workspace:t,onEdit:s,onDelete:a}){const n=ct(),r=(i,o)=>{i.stopPropagation(),n(`/workspace/${t.id}`)};return e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Yt,{className:"w-6 h-6 text-purple-600"})}),e.jsx("div",{children:e.jsx("h3",{className:"text-lg text-neutral-900 dark:text-neutral-100",children:t.name})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:i=>r(i),children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:i=>r(i),children:e.jsx(Ce,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(Se,{className:"font-mono",children:t.gitRepository})})]})}function zt({isOpen:t,workspace:s,formData:a,setFormData:n,onSave:r,onCancel:i}){return e.jsx(ue,{isOpen:t,onClose:i,title:s?"Edit Workspace":"Create Workspace",size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:r,children:s?"Update":"Create"}),e.jsx(O,{variant:"ghost",onClick:i,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:a.name,onChange:o=>n({...a,name:o.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",placeholder:"Enter workspace name"})]}),!s&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Git Repository"}),e.jsx("input",{type:"text",value:a.gitRepository,onChange:o=>n({...a,gitRepository:o.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",placeholder:"https://github.com/user/repo.git"})]})]})})}function Se({children:t,variant:s="default",size:a="md",className:n=""}){const r="inline-flex items-center rounded-full",i={default:"bg-neutral-100 dark:bg-neutral-700 text-neutral-800 dark:text-neutral-200",success:"bg-green-100 dark:bg-green-800 text-green-800 dark:text-green-200",warning:"bg-yellow-100 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200",error:"bg-red-100 dark:bg-red-800 text-red-800 dark:text-red-200"},o={sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-0.5 text-sm"},l=`${r} ${i[s]} ${o[a]} ${n}`.trim();return e.jsx("span",{className:l,children:t})}function Is(){const{theme:t,toggleTheme:s}=Wt();return e.jsx("div",{className:"relative",children:e.jsxs("button",{onClick:s,className:"flex items-center space-x-2 px-3 py-2 text-sm rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-700 text-neutral-700 dark:text-neutral-200",title:`Current theme: ${t}`,children:[t==="light"&&e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),t==="dark"&&e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}),t==="system"&&e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("span",{className:"capitalize",children:t})]})})}function Ws({session:t}){return e.jsxs(e.Fragment,{children:[t.hasUnreadMessage&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),t.status===pe.InProgress&&e.jsx(Ke,{size:"sm"})]})}function Ls(){const t=ct(),[s,a]=c.useState(!1),[n,r]=c.useState({isOpen:!1,title:"",message:"",sessionId:null}),[i,o]=c.useState(!1),[l,d]=c.useState(""),[m,g]=c.useState(!1),{sessions:x,workspaces:u,activeWorkspaceId:y,activeSessionId:k,addSession:F,removeSession:S}=xe(),v=async()=>{if(g(!0),!u||u.length===0){d("You need to create at least one workspace before creating a session. Go to Workspaces to create one."),o(!0),g(!1);return}let A=!1;try{A=(await Ee.getAll()).length>0}catch(D){console.error("Failed to check agents:",D),A=!1}if(!A){d("You need to create at least one agent before creating a session. Go to Agents to create one."),o(!0),g(!1);return}a(!0),g(!1)},h=async A=>{const D=await Z.create(A);F(D),a(!1),t(`/session/${D.id}`)},C=A=>{r({isOpen:!0,title:"Cancel Session",message:"Are you sure you want to cancel this session? All progress and changes will be lost.",sessionId:A})},N=async()=>{if(n.sessionId)try{await Z.cancelSession(n.sessionId),S(n.sessionId),k===n.sessionId&&t("/")}catch(A){console.error("Failed to cancel session:",A)}r({isOpen:!1,title:"",message:"",sessionId:null})},j=()=>{r({isOpen:!1,title:"",message:"",sessionId:null})};return e.jsxs("header",{className:"border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative h-8 w-8",children:[e.jsx("div",{className:"absolute w-full h-full flex items-center justify-center z-1",children:e.jsx("span",{className:"text-white font-mono",style:{letterSpacing:-2},children:"</>"})}),e.jsx("div",{className:"h-8 w-8 rounded-full magic-icon flex items-center justify-center"})]}),e.jsx("span",{className:"text-lg font-normal! text-neutral-900 dark:text-neutral-100 font-mono",children:"polygent"})]}),e.jsxs("div",{className:"flex items-center",children:[x.filter(A=>A.status===pe.Waiting||A.status===pe.InProgress).sort((A,D)=>A.createdAt>D.createdAt?-1:1).map(A=>e.jsxs("div",{className:(k===A.id?"bg-purple-100 dark:bg-purple-900 ":"hover:bg-neutral-200 dark:hover:bg-neutral-600 ")+"flex items-center space-x-2 px-3 py-3 text-sm border-l border-neutral-200 dark:border-neutral-700",onClick:()=>t(`/session/${A.id}`),children:[e.jsx(Ws,{session:A}),e.jsx("span",{className:"text-neutral-700 dark:text-neutral-300 mr-2",children:A.name||`Session #${A.id}`}),e.jsx("button",{className:"text-neutral-400 hover:text-neutral-600 dark:text-neutral-500 dark:hover:text-neutral-300 ml-1",onClick:D=>{D.stopPropagation(),C(A.id)},children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},A.id)),e.jsx("div",{className:`hover:bg-neutral-200 dark:hover:bg-neutral-600 flex items-center px-3 py-3 border-x border-neutral-200 dark:border-neutral-700 ${m?"cursor-wait":"cursor-pointer"}`,style:{height:38},onClick:v,children:e.jsx(me,{size:14})})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Is,{}),e.jsx(Pe,{options:[{value:"home",label:"Home"},{value:"workspaces",label:"Workspaces"},{value:"agents",label:"Agents"},{value:"backlogs",label:"Backlogs"}],placeholder:"Menu",onSelect:A=>{t(A.value==="home"?"/":`/${A.value}`)},dropdownWidth:"w-40",alignRight:!0})]})]}),e.jsx(zs,{isOpen:s,activeWorkspaceId:y,onCreateSession:h,onCancel:()=>a(!1)}),e.jsx($e,{isOpen:n.isOpen,title:n.title,message:n.message,variant:"danger",onConfirm:N,onCancel:j}),e.jsx(ue,{isOpen:i,onClose:()=>o(!1),title:"Requirements Missing",icon:e.jsx(At,{className:"h-6 w-6 text-yellow-500"}),size:"sm",contentClassName:"p-6",footer:e.jsx(O,{onClick:()=>o(!1),children:"Got it"}),children:e.jsx("div",{className:"text-neutral-700 dark:text-neutral-300",children:l})})]})}function Je({workspaceId:t,autoLoad:s=!0}){const{getEnvironmentsByWorkspace:a,loadEnvironments:n,isLoading:r,getError:i}=gt(),o=a(t),l=r(t),d=i(t);return c.useEffect(()=>{s&&t&&o===void 0&&!l&&n(t)},[s,t,o,l,n]),{environments:o??[],loading:l,error:d,refetch:()=>{t&&n(t)}}}function Vt(t){const[s,a]=c.useState([]),[n,r]=c.useState(!0),[i,o]=c.useState(null),[l,d]=c.useState(Date.now()),m=async x=>{if(!t){a([]),r(!1);return}try{x||r(!0),o(null);const u=await ve.getByWorkspaceId(t);a(u),d(Date.now())}catch(u){o(u instanceof Error?u.message:"Failed to fetch workspace tasks")}finally{r(!1)}};return c.useEffect(()=>{m()},[t]),{tasks:s,loading:n,error:i,refreshTasks:x=>{m(x)},lastUpdate:l,taskCount:s.length}}function Rs(){const{isSignalRConnected:t}=dt(),{activeWorkspaceId:s,workspaces:a}=xe(),{environments:n}=Je({workspaceId:s??0,autoLoad:!0}),{lastUpdate:r}=Vt(s),o=a.find(l=>l.id===s)?.name;return e.jsx("footer",{className:"border-t border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-4 py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(Ms,{environments:n,className:"min-w-32",taskUpdateTrigger:r,workspaceName:o})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${t?"bg-green-500 animate-pulse":"bg-red-500"}`}),e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"v1.0.0"})]})]})})}function $e({isOpen:t,title:s,message:a,confirmText:n="Confirm",cancelText:r="Cancel",variant:i="danger",onConfirm:o,onCancel:l}){if(!t)return null;const m=(()=>{switch(i){case"danger":return{icon:"text-red-600 dark:text-red-400",iconBg:"bg-red-100 dark:bg-red-900"};case"warning":return{icon:"text-yellow-600 dark:text-yellow-400",iconBg:"bg-yellow-100 dark:bg-yellow-900"};case"info":return{icon:"text-purple-600 dark:text-purple-400",iconBg:"bg-purple-100 dark:bg-purple-900"}}})();return e.jsx(ue,{isOpen:t,onClose:l,title:s,icon:e.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-full ${m.iconBg} flex items-center justify-center`,children:e.jsx(Qt,{className:`w-6 h-6 ${m.icon}`})}),size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(O,{variant:"ghost",onClick:l,children:r}),e.jsx(O,{onClick:o,children:n})]}),children:e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-300",children:a})})}const at="polygent_workspace_preferences",ke={getPreferences(t){try{const s=localStorage.getItem(at);return s?JSON.parse(s)[t.toString()]||{}:{}}catch(s){return console.error("Failed to load workspace preferences:",s),{}}},savePreferences(t,s){try{const a=localStorage.getItem(at),n=a?JSON.parse(a):{};n[t.toString()]={...n[t.toString()],...s},localStorage.setItem(at,JSON.stringify(n))}catch(a){console.error("Failed to save workspace preferences:",a)}},saveLastBranch(t,s){this.savePreferences(t,{lastSelectedBranch:s})},saveLastAgent(t,s){this.savePreferences(t,{lastSelectedAgentId:s})},getLastBranch(t){return this.getPreferences(t).lastSelectedBranch},getLastAgent(t){return this.getPreferences(t).lastSelectedAgentId}};function zs({isOpen:t,activeWorkspaceId:s,defaultName:a,onCreateSession:n,onCancel:r}){const{workspaces:i}=xe(),[o,l]=c.useState(""),[d,m]=c.useState(s),[g,x]=c.useState(null),[u,y]=c.useState(""),[k,F]=c.useState([]),[S,v]=c.useState(!1),[h,C]=c.useState(!1);c.useEffect(()=>{t&&(N(),l(""),m(s),x(null),y(a||""),C(!1))},[t,s,a]),c.useEffect(()=>{if(d){if(k.length>0){const P=ke.getLastAgent(d);P&&k.some(q=>q.id===P)?x(P):x(null)}const T=ke.getLastBranch(d);l(T||"")}else l(""),x(null)},[d,k]);const N=async()=>{try{v(!0);const T=await Ee.getAll();if(F(T),d){const P=ke.getLastAgent(d);P&&T.some(q=>q.id===P)&&x(P)}}catch(T){console.error("Failed to load agents:",T)}finally{v(!1)}},j=async()=>{if(!(!d||!o||!g))try{C(!0),ke.saveLastBranch(d,o),ke.saveLastAgent(d,g),await n({workspaceId:d,starterGitBranch:o,agentId:g,name:u.trim()||null})}catch(T){console.error("Failed to create session:",T),C(!1)}},A=d&&o.trim()&&g,D=i.map(T=>({value:T.id.toString(),label:T.name})),b=k.map(T=>({value:T.id.toString(),label:`${T.name}`+(T.roleName?` (${T.roleName})`:"")}));return e.jsx(ue,{isOpen:t,onClose:h?()=>{}:r,title:"Create Session",size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:j,disabled:!A||S||h,children:e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),h?"Creating Session...":"Create Session"]})}),e.jsx(O,{variant:"ghost",onClick:r,disabled:h,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-4",style:{opacity:h?.6:1},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Session Name"}),e.jsx("input",{type:"text",value:u,onChange:T=>y(T.target.value),placeholder:"Enter session name (optional)",className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md shadow-sm bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 focus:border-transparent",maxLength:100,disabled:h}),e.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"You can set it later"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Workspace"}),e.jsx(Pe,{options:D,value:d?.toString(),placeholder:"Select workspace",onSelect:h?()=>{}:T=>{m(parseInt(T.value))}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Start Git Branch"}),d?e.jsx(xt,{workspaceId:d,value:o,onSelect:h?()=>{}:T=>{l(T),d&&ke.saveLastBranch(d,T)},placeholder:"Select git branch"}):e.jsx("div",{className:"px-3 py-2 text-neutral-500 dark:text-neutral-400",children:"Select workspace first"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Agent"}),S?e.jsx("div",{className:"px-3 py-2 text-neutral-500 dark:text-neutral-400",children:"Loading agents..."}):e.jsx(Pe,{options:b,value:g?.toString(),placeholder:"Select agent",onSelect:h?()=>{}:T=>x(parseInt(T.value))})]})]})})}function Vs({items:t,position:s,onClose:a,isVisible:n}){const r=c.useRef(null),[i,o]=c.useState(null),[l,d]=c.useState({x:0,y:0});if(c.useEffect(()=>{const x=y=>{const k=y.target,F=r.current,S=F&&!F.contains(k),v=document.querySelector('[data-submenu="true"]'),h=!v||!v.contains(k);S&&h&&a()},u=y=>{y.key==="Escape"&&a()};return n?(document.addEventListener("mousedown",x),document.addEventListener("keydown",u)):o(null),()=>{document.removeEventListener("mousedown",x),document.removeEventListener("keydown",u)}},[n,a]),c.useEffect(()=>{if(n&&r.current){const x=r.current.getBoundingClientRect(),u=window.innerWidth,y=window.innerHeight;let k=s.x,F=s.y;s.x+x.width>u&&(k=u-x.width-10),s.y+x.height>y&&(F=y-x.height-10),r.current.style.left=`${k}px`,r.current.style.top=`${F}px`}},[n,s]),!n)return null;const m=(x,u)=>{if(!x.disabled)if(x.submenu){if(i===x.id)o(null);else if(o(x.id),u){const y=u.currentTarget.getBoundingClientRect(),k=window.innerWidth,F=window.innerHeight;let S=y.right,v=y.top;S+200>k&&(S=y.left-200),v+150>F&&(v=Math.max(10,F-150)),d({x:S,y:v})}}else x.onClick?.(),a()},g=x=>{x.disabled||(x.onClick?.(),a())};return e.jsxs("div",{ref:r,className:"fixed z-50 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-600 rounded-md shadow-lg py-1 min-w-48",style:{left:s.x,top:s.y},children:[t.map((x,u)=>e.jsx("div",{children:x.separator?e.jsx("div",{className:"border-t border-neutral-200 dark:border-neutral-600 my-1"}):e.jsxs("button",{className:`w-full text-left px-3 py-2 text-sm flex items-center space-x-2 ${x.disabled?"text-neutral-400 dark:text-neutral-500 cursor-not-allowed":i===x.id?"bg-neutral-100 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-200":"text-neutral-700 dark:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-neutral-700"}`,onClick:y=>m(x,y),onMouseEnter:y=>{x.submenu&&!x.disabled&&m(x,y)},disabled:x.disabled,children:[e.jsx("span",{className:"flex-1",children:x.label}),x.submenu&&e.jsx("span",{className:"flex-shrink-0",children:"▶"})]})},`${x.id}-${u}`)),i&&(()=>{const x=t.find(u=>u.id===i);return x?.submenu?e.jsx("div",{"data-submenu":"true",className:"fixed z-60 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-600 rounded-md shadow-lg py-1 min-w-36",style:{left:l.x,top:l.y},children:x.submenu.map((u,y)=>e.jsx("div",{children:u.separator?e.jsx("div",{className:"border-t border-neutral-200 dark:border-neutral-600 my-1"}):e.jsx("button",{className:`w-full text-left px-3 py-2 text-sm flex items-center space-x-2 ${u.disabled?"text-neutral-400 dark:text-neutral-500 cursor-not-allowed":"text-neutral-700 dark:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-neutral-700"}`,onClick:()=>g(u),disabled:u.disabled,children:e.jsx("span",{className:"flex-1",children:u.label})})},`${u.id}-${y}`))}):null})()]})}function Gs({isOpen:t,currentName:s,onConfirm:a,onCancel:n,title:r="Rename"}){const[i,o]=c.useState(s),l=c.useRef(null);c.useEffect(()=>{t&&(o(s),setTimeout(()=>{if(l.current){l.current.focus();const g=s.lastIndexOf(".");g>0?l.current.setSelectionRange(0,g):l.current.select()}},100))},[t,s]);const d=g=>{g.preventDefault(),i.trim()&&i!==s?a(i.trim()):n()},m=g=>{g.key==="Escape"&&n()};return e.jsx(ue,{isOpen:t,onClose:n,title:r,size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(O,{type:"button",onClick:n,variant:"outline",children:"Cancel"}),e.jsx(O,{type:"submit",disabled:!i.trim()||i===s,onClick:d,children:"Rename"})]}),children:e.jsx("form",{onSubmit:d,children:e.jsx("input",{ref:l,type:"text",value:i,onChange:g=>o(g.target.value),onKeyDown:m,className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",placeholder:"Enter new name..."})})})}function vt({isOpen:t,title:s,placeholder:a,onConfirm:n,onCancel:r}){const[i,o]=c.useState("");c.useEffect(()=>{t&&o("")},[t]);const l=m=>{m.preventDefault(),i.trim()&&n(i.trim())},d=m=>{m.key==="Escape"&&r()};return e.jsx(ue,{isOpen:t,onClose:r,title:s,size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(O,{type:"button",onClick:r,variant:"outline",children:"Cancel"}),e.jsx(O,{type:"submit",disabled:!i.trim(),onClick:l,children:"Create"})]}),children:e.jsx("form",{onSubmit:l,children:e.jsx("input",{type:"text",value:i,onChange:m=>o(m.target.value),onKeyDown:d,placeholder:a,className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 focus:border-transparent",autoFocus:!0})})})}function Us({task:t,executionId:s,currentStatus:a,loading:n={},canStart:r,isRunning:i,hasOutput:o,onStart:l,onStop:d,onRestart:m,onViewOutput:g}){const x=`start-${t.id}`,u=s?`stop-${s}`:"",y=`restart-${t.id}`;return e.jsx("div",{className:`py-1 px-3 border border-neutral-200 dark:border-neutral-700 rounded ${o?"hover:bg-neutral-50 dark:hover:bg-neutral-700/50 cursor-pointer":""}`,onClick:o&&s&&g?()=>g(t.id,t.name,s):void 0,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(mt,{status:a,size:"sm"}),e.jsx("div",{className:"text-sm text-neutral-900 dark:text-neutral-100 truncate",children:t.name})]}),e.jsxs("div",{className:"flex flex-shrink-0",children:[r&&l&&e.jsx(O,{variant:"ghost",size:"sm",onClick:k=>{k.stopPropagation(),l(t.id,t.name)},disabled:n[x],title:"Start task",children:e.jsx(Ve,{size:12})}),i&&s&&d&&e.jsx(O,{variant:"ghost",size:"sm",onClick:k=>{k.stopPropagation(),d(s)},disabled:n[u],title:"Stop task",children:e.jsx($t,{size:12})}),i&&s&&m&&e.jsx(O,{variant:"ghost",size:"sm",onClick:k=>{k.stopPropagation(),m(t.id,t.name,s)},disabled:n[y],title:"Restart task",children:e.jsx(Xe,{size:12})})]})]})})}const Hs=t=>{if(t==null)return"No Selected";switch(t){case ge.Build:return"Build";case ge.Test:return"Test";case ge.Start:return"Start";default:return"Unknown"}},qs=t=>{const s=t.reduce((r,i)=>{const o=Hs(i.type);return r[o]||(r[o]=[]),r[o].push(i),r},{}),a=["Build","Test","Start"];return Object.entries(s).sort(([r],[i])=>{const o=a.indexOf(r),l=a.indexOf(i);return o===-1&&l===-1?r.localeCompare(i):o===-1?1:l===-1?-1:o-l})};function Gt({isSession:t,tasks:s,loading:a={},taskExecutions:n={},isReadonly:r=!1,onStart:i,onStop:o,onRestart:l,onViewOutput:d,emptyMessage:m="No tasks found",autoOpenOnGroupStart:g=!1}){const{getTaskExecutionId:x}=_e();if(s.length===0)return e.jsx("div",{className:"text-neutral-500 text-sm",children:m});const u=async S=>{if(!i||r)return;let v=0;S.forEach(h=>{const N=x(h.id,t)||h.taskExecutionId,A=(N?n[N]:null)?.status??h.status;(A===ae.Pending||A===ae.Failed||A===ae.Completed||A===ae.Canceled)&&(g?(setTimeout(()=>{i(h.id,h.name,g)},v),v+=100):i(h.id,h.name,g))})},y=S=>{!o||r||S.forEach(v=>{const C=x(v.id,t)||v.taskExecutionId;((C?n[C]:null)?.status??v.status)===ae.Running&&C&&o(C)})},k=async S=>{if(!l||r)return;let v=0;S.forEach(h=>{const N=x(h.id,t)||h.taskExecutionId;((N?n[N]:null)?.status??h.status)===ae.Running&&N&&(g?(setTimeout(()=>{l(h.id,h.name,N)},v),v+=100):l(h.id,h.name,N))})},F=S=>{let v=!1,h=!1;return S.forEach(C=>{const j=x(C.id,t)||C.taskExecutionId,D=(j?n[j]:null)?.status??C.status;D===ae.Running&&(h=!0),(D===ae.Pending||D===ae.Failed||D===ae.Completed||D===ae.Canceled)&&(v=!0)}),{canStartAny:v,isAnyRunning:h}};return e.jsx("div",{className:"space-y-4",children:qs(s).map(([S,v])=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"group px-2 py-1 bg-neutral-100 dark:bg-neutral-700 rounded text-xs text-neutral-700 dark:text-neutral-300 flex items-center justify-between",children:[e.jsx("span",{children:S}),!r&&(()=>{const{canStartAny:h,isAnyRunning:C}=F(v);return e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 flex gap-1",children:[h&&e.jsx(O,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),u(v)},title:`Start all ${S.toLowerCase()} tasks`,className:"h-5 w-5 p-0 hover:bg-neutral-200! dark:hover:bg-neutral-600!",children:e.jsx(Ve,{size:10})}),C&&e.jsx(O,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),y(v)},title:`Stop all ${S.toLowerCase()} tasks`,className:"h-5 w-5 p-0 hover:bg-neutral-200! dark:hover:bg-neutral-600!",children:e.jsx($t,{size:10})}),C&&l&&e.jsx(O,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),k(v)},title:`Restart all ${S.toLowerCase()} tasks`,className:"h-5 w-5 p-0 hover:bg-neutral-200! dark:hover:bg-neutral-600!",children:e.jsx(Xe,{size:10})})]})})()]}),e.jsx("div",{className:"space-y-1 ml-2",children:v.map(h=>{const N=x(h.id,t)||h.taskExecutionId,A=(N?n[N]:null)?.status??h.status,D=A===ae.Running,b=!r&&(A===ae.Pending||A===ae.Failed||A===ae.Completed||A===ae.Canceled),T=A!==ae.Pending&&!!N;return e.jsx(Us,{task:h,executionId:N,currentStatus:A,loading:a,canStart:b,isRunning:D,hasOutput:T,onStart:P=>i?.(P,h.name,!0),onStop:o,onRestart:l,onViewOutput:d},h.id)})})]},S))})}function _s({isOpen:t,title:s,message:a}){return e.jsx(ue,{isOpen:t,onClose:()=>{},title:s,size:"sm",contentClassName:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ke,{size:"lg",className:"mx-auto mb-4"}),a&&e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:a})]})})}function Ut({output:t,className:s="",autoScroll:a=!0,placeholder:n="Waiting for output..."}){const r=c.useRef(null);c.useEffect(()=>{if(!a||!r.current)return;requestAnimationFrame(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)})},[t,a]);const i=!!t;return c.useEffect(()=>{a&&r.current&&requestAnimationFrame(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)})},[a,i]),e.jsx("div",{className:"bg-neutral-900 dark:bg-neutral-950 rounded-lg p-4 h-full select-text",children:e.jsx("pre",{ref:r,className:`font-mono text-sm text-neutral-100 whitespace-pre-wrap wrap-break-word overflow-y-auto ${s}`,children:t||n})})}function Ks({isOpen:t,session:s,onClose:a,onRename:n}){const[r,i]=c.useState(""),[o,l]=c.useState(!1);c.useEffect(()=>{t&&s&&i(s.name||"")},[t,s]);const d=async g=>{if(g.preventDefault(),!(!r.trim()||!s||r.trim()===s.name)){l(!0);try{await n(r.trim()),a()}catch(x){console.error("Failed to rename session:",x)}finally{l(!1)}}},m=()=>{i(s?.name||""),a()};return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:m}),e.jsx("div",{className:"relative bg-white dark:bg-neutral-800 rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-4",children:"Rename Session"}),e.jsxs("form",{onSubmit:d,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"session-name",className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-2",children:"Session Name"}),e.jsx("input",{id:"session-name",type:"text",value:r,onChange:g=>i(g.target.value),placeholder:"Enter session name...",className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md shadow-sm bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 focus:border-transparent",autoFocus:!0,disabled:o,maxLength:100})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(O,{type:"button",variant:"outline",onClick:m,disabled:o,children:"Cancel"}),e.jsx(O,{type:"submit",disabled:o||!r.trim()||r.trim()===s?.name,children:o?"Renaming...":"Rename"})]})]})]})})]}):null}function xt({workspaceId:t,value:s,onSelect:a,placeholder:n="Select git branch",disabled:r=!1,className:i,autoSelectDefault:o=!0}){const[l,d]=c.useState([]),[m,g]=c.useState(!1);c.useEffect(()=>{t?x():d([])},[t]);const x=async()=>{try{g(!0);const u=await Me.getGitBranches(t);if(d(u),o&&!s&&u.length>0){let y="";u.includes("main")?y="main":u.includes("master")?y="master":y=u[0],a(y)}}catch(u){console.error("Failed to load git branches:",u),d([])}finally{g(!1)}};return m?e.jsx("div",{className:`px-3 py-2 text-neutral-500 dark:text-neutral-400 ${i||""}`,children:"Loading branches..."}):l.length===0?e.jsx("div",{className:`px-3 py-2 text-neutral-500 dark:text-neutral-400 ${i||""}`,children:"No branches found"}):e.jsx(Pe,{options:l.map(u=>({value:u,label:u})),value:s,placeholder:n,onSelect:u=>a(u.value),disabled:r,className:i})}function Te({fileName:t,isFolder:s=!1,size:a=16,className:n=""}){if(s)return e.jsx(Xt,{size:a,className:n});const r=t.split(".").pop()?.toLowerCase(),i=t.toLowerCase();return(()=>{if(i==="package.json"||i==="package-lock.json")return e.jsx(Dt,{size:a,className:n});if(i==="dockerfile"||i===".dockerignore")return e.jsx(Zt,{size:a,className:n});if(i==="readme.md"||i==="readme.txt")return e.jsx(es,{size:a,className:n});if(i===".gitignore"||i===".gitattributes")return e.jsx(ot,{size:a,className:n});if(i===".env"||i.startsWith(".env."))return e.jsx(ts,{size:a,className:n});switch(r){case"js":case"jsx":case"ts":case"tsx":case"vue":case"svelte":return e.jsx(nt,{size:a,className:n});case"html":case"htm":return e.jsx(Tt,{size:a,className:n});case"css":case"scss":case"sass":case"less":return e.jsx(is,{size:a,className:n});case"json":case"jsonc":return e.jsx(ns,{size:a,className:n});case"xml":case"yml":case"yaml":case"toml":case"ini":case"conf":case"config":return e.jsx(Bt,{size:a,className:n});case"sql":case"db":case"sqlite":return e.jsx(rs,{size:a,className:n});case"png":case"jpg":case"jpeg":case"gif":case"svg":case"webp":case"ico":return e.jsx(as,{size:a,className:n});case"md":case"txt":case"rtf":return e.jsx(Mt,{size:a,className:n});case"sh":case"bash":case"zsh":case"fish":case"ps1":case"bat":case"cmd":return e.jsx(Le,{size:a,className:n});case"py":case"rb":case"go":case"rs":case"cpp":case"c":case"h":case"java":case"kt":case"swift":case"php":return e.jsx(nt,{size:a,className:n});default:return e.jsx(ss,{size:a,className:n})}})()}function Js(){return e.jsx("div",{className:"flex h-full",children:e.jsx("div",{className:"flex-1 bg-neutral-50 dark:bg-neutral-900",children:e.jsx("div",{className:"flex flex-col h-full",children:e.jsx("div",{className:"flex-1 p-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg shadow-sm border border-neutral-200 dark:border-neutral-700 p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900 dark:text-neutral-100 mb-4",children:"Welcome to Polygent"}),e.jsx("p",{className:"text-neutral-600 dark:text-neutral-300",children:"Your AI agent orchestration platform is ready. Start by creating a workspace, agent or a new development session."})]})})})})})})}function Ys(t){const{setActiveSessionId:s,getSession:a,updateSession:n,getSessionTabs:r,getSessionActiveTabId:i,getTabContentById:o,setSessionTabs:l,setSessionActiveTabId:d,addSessionTab:m,removeSessionTab:g,resetSessionTabs:x,setActiveWorkspaceId:u}=xe(),{getTaskExecution:y}=_e(),k=a(t),F=r(t),S=i(t);c.useEffect(()=>{k?k.workspaceId&&u(k.workspaceId):(async()=>{try{const $=await Z.getById(t);n($),$.workspaceId&&u($.workspaceId)}catch($){console.error("Failed to fetch session status:",$)}})()},[t,k,n,x,u]),c.useEffect(()=>{s(t)},[t,s]),c.useEffect(()=>{const p=(_,Q,te,ee,E)=>{const w=r(t).map(L=>L.content.type==="task"&&L.content.taskExecutionId===ee?{...L,content:{...L.content,status:E,endTime:E===ae.Completed||E===ae.Failed?new Date:L.content.endTime}}:L);l(t,w)},$=(_,Q,te,ee,E)=>{const w=r(t).map(L=>{if(L.content.type==="task"&&L.content.taskExecutionId===ee){const J=L.content.output||"";return{...L,content:{...L.content,output:E??J}}}return L});l(t,w)},V=re.on("onTaskStatusChanged",p),W=re.on("onTaskOutputChanged",$);return()=>{V(),W()}},[t,r,l]);const v=(p,$)=>({id:`${p.type}-${Date.now()}`,content:p,title:$,isDirty:!1}),h=async(p,$)=>{const W=r(t).find(_=>_.content.type==="file"&&_.content.path===p);if(W){d(t,W.id);return}try{const{content:_,lastModified:Q}=await Z.getFileContent(t,p),te=wt(p),E=v({type:"file",path:p,name:$,content:_,language:te,lastModified:Q,editableContent:_},$);m(t,E),d(t,E.id)}catch(_){console.error("Failed to load file:",_)}},C=async(p,$,V)=>{const _=r(t).find(Q=>Q.content.type==="diff"&&Q.content.path===p&&Q.id.includes(V||"WorkingVsHead"));if(_){d(t,_.id);return}try{let Q="",te="";if(V==="StagedVsHead"){const[w,L]=await Promise.all([Z.getGitFileContent(t,p,"Staged"),Z.getGitFileContent(t,p,"Head")]);Q=L.content,te=w.content}else if(V==="WorkingVsStaged"){const[w,L]=await Promise.all([Z.getGitFileContent(t,p,"Working"),Z.getGitFileContent(t,p,"Staged")]);Q=L.content,te=w.content}else{const[w,L]=await Promise.all([Z.getGitFileContent(t,p,"Working"),Z.getGitFileContent(t,p,"Head")]);Q=L.content,te=w.content}const ee=wt(p),B=v({type:"diff",path:p,name:$,original:Q,modified:te,language:ee},`${$} (Diff)`);B.id=`${B.id}-${V||"WorkingVsHead"}`,m(t,B),d(t,B.id)}catch(Q){console.error("Failed to load full content diff:",Q);const ee=v({type:"diff",path:p,name:$,original:"",modified:"",language:"text"},`${$} (Diff)`);ee.id=`${ee.id}-${V||"WorkingVsHead"}`,m(t,ee),d(t,ee.id)}},N=(p,$)=>{const V=y(p),W=V?.status||ae.Running,_=V?.output||"",Q={type:"task",taskExecutionId:p,name:$,status:W,output:_,startTime:V?.startTime||new Date,endTime:V?.endTime},te=r(t),ee=te.find(E=>E.content.type==="task"&&E.content.taskExecutionId===p);if(ee){const E=te.map(B=>B.id===ee.id?{...B,content:{...B.content,...Q}}:B);l(t,E),d(t,ee.id)}else{const E=v(Q,$);m(t,E),d(t,E.id)}},j=()=>{d(t,"chat")},A=p=>{g(t,p)},D=p=>{d(t,p)},b=async()=>{try{return await Z.mergeToMain(t)}catch(p){throw console.error("Failed to merge to main:",p),p}},T=async()=>{try{return await Z.pushBranch(t)}catch(p){throw console.error("Failed to push branch:",p),p}},P=async()=>{try{return await Z.pullFromStarterBranch(t)}catch(p){throw console.error("Failed to pull from starter branch:",p),p}},q=async()=>{try{const p=await Z.resetSession(t);return x(t),p}catch(p){throw console.error("Failed to reset session:",p),p}},M=async()=>{try{return await Z.cancelSession(t)}catch(p){throw console.error("Failed to cancel session:",p),p}},U=async()=>{try{return await Z.stopWorkingMessages(t)}catch(p){throw console.error("Failed to stop working messages:",p),p}},Y=async()=>{try{return await Z.openWithVSCode(t)}catch(p){throw console.error("Failed to open with VSCode:",p),p}},R=async p=>{try{const{content:$,lastModified:V}=await Z.getFileContent(t,p),_=r(t).map(Q=>Q.content.type==="file"&&Q.content.path===p?{...Q,content:{...Q.content,content:$,lastModified:V}}:Q);l(t,_)}catch($){throw console.error("Failed to refresh file content:",$),$}},f=k?.status===pe.Canceled||k?.status===pe.Done;return{tabs:F,activeTabId:S,getTabContentById:p=>o(t,p),session:k,isSessionReadonly:f,openFile:h,openDiff:C,openTask:N,openChat:j,closeTab:A,switchTab:D,refreshFileContent:R,mergeToMain:b,pushBranch:T,pullFromStarterBranch:P,resetSession:q,cancelSession:M,stopWorkingMessages:U,openWithVSCode:Y}}function wt(t){const s=t.split(".").pop()?.toLowerCase();return{ts:"typescript",tsx:"typescript",js:"javascript",jsx:"javascript",json:"json",css:"css",scss:"scss",html:"html",md:"markdown",py:"python",cs:"csharp",java:"java",php:"php",rb:"ruby",go:"go",rs:"rust",sql:"sql",sh:"shell",yml:"yaml",yaml:"yaml",xml:"xml",dockerfile:"dockerfile"}[s||""]||"text"}const Nt={gitStatus:null,isLoading:!1,error:null,enabled:!0},pt=ze((t,s)=>({sessionGitStatus:{},setGitStatus:(a,n)=>t(r=>({sessionGitStatus:{...r.sessionGitStatus,[a]:n}})),updateGitStatus:(a,n)=>t(r=>({sessionGitStatus:{...r.sessionGitStatus,[a]:{...r.sessionGitStatus[a]||Nt,...n}}})),clearGitStatus:a=>t(n=>{const{[a]:r,...i}=n.sessionGitStatus;return{sessionGitStatus:i}}),getGitStatusForSession:a=>s().sessionGitStatus[a],fetchGitStatus:async a=>{const{getGitStatusForSession:n,updateGitStatus:r,setGitStatus:i}=s(),l=n(a)?.enabled??!0;if(l){r(a,{isLoading:!0,error:null});try{const d=await Z.getGitStatus(a);i(a,{gitStatus:d,isLoading:!1,error:null,enabled:l})}catch(d){const m=d instanceof Error?d.message:"Failed to fetch git status";i(a,{gitStatus:null,isLoading:!1,error:m,enabled:l})}}},setEnabled:(a,n)=>t(r=>({sessionGitStatus:{...r.sessionGitStatus,[a]:{...r.sessionGitStatus[a]||Nt,enabled:n}}}))}));function et(t){const{getGitStatusForSession:s,fetchGitStatus:a,setEnabled:n}=pt(),r=s(t),i=r?.gitStatus||null,o=r?.isLoading||!1,l=r?.error||null,d=c.useCallback(async()=>{await a(t)},[t,a]),m=c.useCallback(g=>{n(t,g)},[t,n]);return{gitStatus:i,isLoading:o,error:l,setEnabled:m,fetchGitStatus:d}}function Qs({sessionId:t,isSessionReadonly:s,session:a,onMergeToMain:n,onPushBranch:r,onPullFromStarterBranch:i,onResetSession:o,onCancelSession:l,onStopWorkingMessages:d,onOpenWithVSCode:m,isVSCodeAvailable:g,onDeployToEnvironment:x,onSessionNameUpdate:u,autoDeployEnabled:y,selectedEnvironmentId:k,restartAfterSync:F,onAutoDeployChange:S,onSelectedEnvironmentIdChange:v,onRestartAfterSyncChange:h,messagesCount:C}){const[N,j]=c.useState({}),[A,D]=c.useState(!1),[b,T]=c.useState(null),{workspaces:P}=xe(),{gitStatus:q}=et(t),{environments:M,loading:U,error:Y,refetch:R}=Je({workspaceId:a?.workspaceId||1,autoLoad:!!a?.workspaceId});c.useEffect(()=>{a?.agentId&&(async()=>{try{const L=await Ee.getById(a.agentId);T(L)}catch(L){console.error("Failed to load agent:",L),T(null)}})()},[a?.agentId]);const[f,p]=c.useState({isOpen:!1,title:"",message:"",action:async()=>({message:""})}),$=async(w,L)=>{j(J=>({...J,[w]:!0}));try{await L()}catch(J){console.error(`${w} failed:`,J)}finally{j(J=>({...J,[w]:!1}))}},V=(w,L,J,K="warning")=>{p({isOpen:!0,title:w,message:L,action:J,variant:K})},W=async()=>{p(L=>({...L,isOpen:!1}));const w=f.action.name||"action";await $(w,f.action)},_=()=>{p(w=>({...w,isOpen:!1}))},Q=async w=>{if(!a)throw new Error("No session available");try{await Z.update(a.id,{name:w}),u(w)}catch(L){throw console.error("Failed to update session name:",L),L}},te=()=>{switch(a?.status){case pe.Waiting:return"Waiting";case pe.InProgress:return"In Progress";case pe.Done:return"Completed";case pe.Canceled:return"Canceled";default:return"Unknown"}},ee=()=>q?q.stagedFiles.length>0||q.unstagedFiles.length>0||q.untrackedFiles.length>0:!1,E=()=>C>0||ee(),B=()=>ee();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4 text-neutral-900 dark:text-neutral-100",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm mb-2",children:"Session"}),e.jsxs("div",{className:"text-xs bg-neutral-100 dark:bg-neutral-700 p-3 flex flex-col gap-2 rounded",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name: "}),e.jsx("span",{className:`px-1 py-0.5 rounded ${s?"cursor-default":"cursor-pointer hover:bg-neutral-200 dark:hover:bg-neutral-600 hover:underline"}`,onClick:()=>!s&&D(!0),title:s?"Read-only mode":"Click to rename",children:a?.name||"Untitled Session"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Id: "}),e.jsx("span",{children:a?.id})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status: "}),e.jsx("span",{children:te()})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Workspace: "}),e.jsx("span",{children:P.find(w=>w.id===a?.workspaceId)?.name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Agent: "}),e.jsx("span",{children:b?`${b.name}`+(b.roleName?` (${b.roleName})`:""):"Loading..."})]})]})]}),M.length>0&&!s&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm mb-2",children:"Auto Deploy"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"autoDeploy",checked:y,onChange:w=>S(w.target.checked),className:"rounded border-neutral-300 dark:border-neutral-600 text-purple-600 dark:bg-neutral-700"}),e.jsx("label",{htmlFor:"autoDeploy",className:"text-sm text-neutral-700 dark:text-neutral-300 cursor-pointer",children:"Enable Auto Deploy"})]}),y&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:"Deploy to environment:"}),U?e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"Loading environments..."}):Y?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"text-xs text-red-500 dark:text-red-400",children:["Error: ",Y]}),e.jsx("button",{onClick:R,className:"text-xs px-2 py-1 bg-red-100 hover:bg-red-200 dark:bg-red-900 dark:hover:bg-red-800 text-red-600 dark:text-red-400 rounded",children:"Retry"})]}):e.jsxs("select",{value:k,onChange:w=>v(w.target.value),disabled:M.length===0,className:"w-full text-xs border border-neutral-300 dark:border-neutral-600 rounded px-2 py-1 bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:M.length===0?"No environments found":"Select environment..."}),M.map(w=>e.jsx("option",{value:w.id.toString(),children:w.name},w.id))]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"restartAfterSync",checked:F,onChange:w=>h(w.target.checked),className:"rounded border-neutral-300 dark:border-neutral-600 text-purple-600 dark:bg-neutral-700"}),e.jsx("label",{htmlFor:"restartAfterSync",className:"text-xs text-neutral-600 dark:text-neutral-400 cursor-pointer",children:"Restart after sync"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm mb-2",children:"Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{variant:"outline",size:"sm",className:"w-full",onClick:()=>V("Merge to Main","Are you sure you want to merge this session to the main branch? This action cannot be undone.",n,"warning"),disabled:s||N.mergeToMain||!B(),children:N.mergeToMain?"Merging...":"Merge to Main"}),e.jsx(O,{variant:"outline",size:"sm",className:"w-full",onClick:()=>V("Mark as Completed","Are you sure you want to push this branch and mark the session as completed?",r,"info"),disabled:s||N.pushBranch,children:N.pushBranch?"Completing...":"Mark as Completed"}),e.jsx(O,{variant:"outline",size:"sm",className:"w-full",onClick:()=>V("Pull from Starter Branch","Are you sure you want to pull changes from the starter branch? This may overwrite local changes.",i,"warning"),disabled:s||N.pullFromStarterBranch,children:N.pullFromStarterBranch?"Pulling...":"Pull from Starter Branch"}),M.length>0&&e.jsx(O,{variant:"outline",size:"sm",className:"w-full",onClick:x,disabled:s||!B(),children:y&&k?`Deploy to ${M.find(w=>w.id.toString()===k)?.name||"Environment"}`:"Deploy to Environment"}),g&&e.jsx(O,{variant:"outline",size:"sm",className:"w-full",onClick:()=>$("openWithVSCode",m),disabled:N.openWithVSCode,children:N.openWithVSCode?"Opening...":"Open with VSCode"}),a?.status===pe.InProgress&&e.jsx(O,{variant:"outline",size:"sm",className:"w-full text-orange-600 hover:text-orange-700 border-orange-300 hover:border-orange-400",onClick:()=>V("Stop Progress","Are you sure you want to stop working messages? This will cancel any currently processing messages.",d,"warning"),disabled:s||N.stopWorkingMessages,children:N.stopWorkingMessages?"Stopping...":"Stop"}),e.jsx(O,{variant:"outline",size:"sm",className:"w-full",onClick:()=>V("Reset Session","Are you sure you want to reset this session? All progress and changes will be lost.",o,"danger"),disabled:s||N.resetSession||!E(),children:N.resetSession?"Resetting...":"Reset"}),e.jsx(O,{variant:"outline",size:"sm",className:"w-full text-red-600 hover:text-red-700",onClick:()=>V("Cancel Session","Are you sure you want to cancel this session? All progress and changes will be lost.",l,"danger"),disabled:s||N.cancelSession,children:N.cancelSession?"Canceling...":"Cancel"})]})]})]}),e.jsx($e,{isOpen:f.isOpen,title:f.title,message:f.message,variant:f.variant,onConfirm:W,onCancel:_}),e.jsx(Ks,{isOpen:A,session:a,onClose:()=>D(!1),onRename:Q})]})}const St=t=>{const s={name:"",path:"",isFolder:!0,children:new Map};return t.forEach(({filePath:a,changeType:n,type:r})=>{const i=a.split("/");let o=s,l="";i.forEach((d,m)=>{const g=m===i.length-1;l=l?`${l}/${d}`:d,o.children.has(d)||o.children.set(d,{name:d,path:l,isFolder:!g,children:new Map,...g&&{fileInfo:{changeType:n,type:r}}}),o=o.children.get(d)})}),s};function Xs({sessionId:t=1,isSessionReadonly:s=!1,onOpenDiff:a}){const{gitStatus:n,isLoading:r,error:i,fetchGitStatus:o}=et(t),[l,d]=c.useState(!1),[m,g]=c.useState(!1),[x,u]=c.useState(new Set);c.useEffect(()=>{const f=()=>{o()};return window.addEventListener("focus",f),()=>{window.removeEventListener("focus",f)}},[o]);const y=f=>{if(!n)return!1;const p=n.stagedFiles.some(V=>V.filePath===f),$=n.unstagedFiles.some(V=>V.filePath===f);return p&&$},[k,F]=c.useState({unstageAll:!1,discardAll:!1,stageAll:!1,unstageFile:null,discardFile:null,stageFile:null}),S=f=>{switch(f){case Oe.Added:return"+";case Oe.Modified:return"M";case Oe.Deleted:return"D";case Oe.Renamed:return"R";case Oe.Copied:return"C";default:return"M"}},v=async()=>{F(f=>({...f,unstageAll:!0}));try{await Z.unstageAllChanges(t),await o()}catch(f){console.error("Failed to unstage all changes:",f)}finally{F(f=>({...f,unstageAll:!1}))}},h=async()=>{if(confirm("Are you sure you want to discard all changes? This action cannot be undone.")){F(f=>({...f,discardAll:!0}));try{await Z.discardAllChanges(t),await o()}catch(f){console.error("Failed to discard all changes:",f)}finally{F(f=>({...f,discardAll:!1}))}}},C=async f=>{F(p=>({...p,unstageFile:f}));try{await T(async()=>{await Z.unstageFile(t,f)}),await o()}catch(p){console.error("Failed to unstage file:",p);const $=f.split("/").pop();alert(`Failed to unstage ${$}. Please try again.`)}finally{F(p=>({...p,unstageFile:null}))}},N=async f=>{const p=f.split("/").pop();if(confirm(`Are you sure you want to discard changes to ${p}? This action cannot be undone.`)){F($=>({...$,discardFile:f}));try{await T(async()=>{await Z.discardFileChanges(t,f)}),await o()}catch($){console.error("Failed to discard file changes:",$),alert(`Failed to discard changes to ${p}. Please try again.`)}finally{F($=>({...$,discardFile:null}))}}},j=async()=>{F(f=>({...f,stageAll:!0}));try{await Z.stageAllChanges(t),await o()}catch(f){console.error("Failed to stage all changes:",f)}finally{F(f=>({...f,stageAll:!1}))}},A=async f=>{F(p=>({...p,stageFile:f}));try{await T(async()=>{await Z.stageFile(t,f)}),await o()}catch(p){console.error("Failed to stage file:",p);const $=f.split("/").pop();alert(`Failed to stage ${$}. Please try again.`)}finally{F(p=>({...p,stageFile:null}))}},D=f=>{const p=new Set(x);p.has(f)?p.delete(f):p.add(f),u(p)},b=(f,p)=>{const $=[],V=W=>{W.isFolder?Array.from(W.children.values()).forEach(_=>{V(_)}):W.fileInfo?.type===p&&$.push(W.path)};return V(f),$},T=async(f,p=3,$=100)=>{for(let V=1;V<=p;V++)try{await f();return}catch(W){const _=V===p;if((W?.message?.includes("index.lock")||W?.detail?.includes("index.lock"))&&!_){const te=$*Math.pow(2,V-1);await new Promise(ee=>setTimeout(ee,te));continue}throw W}},P=async f=>{const p=b(f,"unstaged").concat(b(f,"untracked"));if(p.length===0)return;F(W=>({...W,stageFile:f.path}));const $=[],V=[];try{for(const W of p)try{await T(async()=>{await Z.stageFile(t,W)}),$.push(W)}catch(_){console.error(`Failed to stage file ${W}:`,_),V.push(W)}if(await o(),V.length>0){const W=$.length,_=V.length,Q=`Staging completed with ${W} success(es) and ${_} failure(s).
Failed files: ${V.map(te=>te.split("/").pop()).join(", ")}`;alert(Q)}}catch(W){console.error("Failed to stage folder files:",W);const _=$.length>0?`Partially completed: ${$.length} file(s) staged successfully. ${V.length} file(s) failed.`:"Failed to stage files. Please try again or refresh the page if the issue persists.";alert(_)}finally{F(W=>({...W,stageFile:null}))}},q=async f=>{const p=b(f,"staged");if(p.length===0)return;F(W=>({...W,unstageFile:f.path}));const $=[],V=[];try{for(const W of p)try{await T(async()=>{await Z.unstageFile(t,W)}),$.push(W)}catch(_){console.error(`Failed to unstage file ${W}:`,_),V.push(W)}if(await o(),V.length>0){const W=$.length,_=V.length,Q=`Unstaging completed with ${W} success(es) and ${_} failure(s).
Failed files: ${V.map(te=>te.split("/").pop()).join(", ")}`;alert(Q)}}catch(W){console.error("Failed to unstage folder files:",W);const _=$.length>0?`Partially completed: ${$.length} file(s) unstaged successfully. ${V.length} file(s) failed.`:"Failed to unstage files. Please try again or refresh the page if the issue persists.";alert(_)}finally{F(W=>({...W,unstageFile:null}))}},M=async f=>{const p=b(f,"unstaged");if(p.length===0||!confirm(`Are you sure you want to discard all changes in "${f.name}"? This action cannot be undone.`))return;F(W=>({...W,discardFile:f.path}));const $=[],V=[];try{for(const W of p)try{await T(async()=>{await Z.discardFileChanges(t,W)}),$.push(W)}catch(_){console.error(`Failed to discard file ${W}:`,_),V.push(W)}if(await o(),V.length>0){const W=$.length,_=V.length,Q=`Discard completed with ${W} success(es) and ${_} failure(s).
Failed files: ${V.map(te=>te.split("/").pop()).join(", ")}`;alert(Q)}}catch(W){console.error("Failed to discard folder files:",W);const _=$.length>0?`Partially completed: ${$.length} file(s) discarded successfully. ${V.length} file(s) failed.`:"Failed to discard files. Please try again or refresh the page if the issue persists.";alert(_)}finally{F(W=>({...W,discardFile:null}))}},U=(f,p=0,$)=>{const V=!x.has(f.path),W={paddingLeft:`${p*12}px`};if(f.isFolder){const _=f.children.size>0,Q=b(f,"staged"),te=b(f,"unstaged"),ee=b(f,"untracked"),E=Q.length>0||te.length>0||ee.length>0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center py-1 text-sm cursor-pointer hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded flex-1 min-w-0",style:W,onClick:()=>_&&D(f.path),children:[_&&e.jsx(e.Fragment,{children:V?e.jsx(tt,{className:"w-3 h-3 mr-1 flex-shrink-0"}):e.jsx(Ye,{className:"w-3 h-3 mr-1 flex-shrink-0"})}),e.jsx(Te,{fileName:f.name,isFolder:!0,size:14,className:"mr-2 flex-shrink-0"}),e.jsx("span",{className:"truncate text-neutral-700 dark:text-neutral-300",children:f.name})]}),E&&e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity pr-2",children:[Q.length>0&&e.jsx("button",{onClick:B=>{B.stopPropagation(),q(f)},disabled:k.unstageFile===f.path,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:`Unstage all files in ${f.name} (${Q.length} files)`,children:k.unstageFile===f.path?e.jsx(fe,{className:"w-3 h-3 animate-spin"}):e.jsx(st,{className:"w-3 h-3"})}),te.length>0&&e.jsx("button",{onClick:B=>{B.stopPropagation(),M(f)},disabled:k.discardFile===f.path,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:`Discard all changes in ${f.name} (${te.length} files)`,children:k.discardFile===f.path?e.jsx(fe,{className:"w-3 h-3 animate-spin"}):e.jsx(ft,{className:"w-3 h-3"})}),(te.length>0||ee.length>0)&&e.jsx("button",{onClick:B=>{B.stopPropagation(),P(f)},disabled:k.stageFile===f.path,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:`Stage all files in ${f.name} (${te.length+ee.length} files)`,children:k.stageFile===f.path?e.jsx(fe,{className:"w-3 h-3 animate-spin"}):e.jsx(me,{className:"w-3 h-3"})})]})]}),V&&_&&e.jsx("div",{children:Array.from(f.children.values()).sort((B,w)=>B.isFolder&&!w.isFolder?-1:!B.isFolder&&w.isFolder?1:B.name.localeCompare(w.name)).map(B=>U(B,p+1,$))})]},f.path)}else{const{changeType:_,type:Q}=f.fileInfo,te=f.path.split("/").pop()||f.path;return e.jsxs("div",{className:"flex items-center justify-between group ps-3.5",children:[e.jsxs("div",{className:"flex items-center py-1 text-sm cursor-pointer hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded flex-1 min-w-0",style:W,onClick:()=>a(f.path,te,$),title:"Click to view full content comparison",children:[e.jsx(Te,{fileName:f.name,size:14,className:"mr-2 flex-shrink-0"}),e.jsxs("span",{className:"truncate text-neutral-700 dark:text-neutral-300",children:[e.jsx(Se,{size:"sm",className:"w-5! h-5! flex align-center justify-center rounded-sm",children:S(_)})," ",f.name]})]}),e.jsx("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity pr-2",children:Q==="staged"?e.jsx("button",{onClick:ee=>{ee.stopPropagation(),C(f.path)},disabled:k.unstageFile===f.path,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:"Unstage file",children:k.unstageFile===f.path?e.jsx(fe,{className:"w-3 h-3 animate-spin"}):e.jsx(st,{className:"w-3 h-3"})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ee=>{ee.stopPropagation(),N(f.path)},disabled:k.discardFile===f.path,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:"Discard file changes",children:k.discardFile===f.path?e.jsx(fe,{className:"w-3 h-3 animate-spin"}):e.jsx(ft,{className:"w-3 h-3"})}),e.jsx("button",{onClick:ee=>{ee.stopPropagation(),A(f.path)},disabled:k.stageFile===f.path,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:"Stage file",children:k.stageFile===f.path?e.jsx(fe,{className:"w-3 h-3 animate-spin"}):e.jsx(me,{className:"w-3 h-3"})})]})})]},f.path)}};if(i)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:"Git Status"}),e.jsx("button",{onClick:o,className:"p-1 rounded hover:bg-neutral-100 dark:hover:bg-neutral-700",title:"Refresh",children:e.jsx(fe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400",children:[e.jsx(At,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:i})]})]});const Y=n?.stagedFiles?St(n.stagedFiles.map(f=>({filePath:f.filePath,changeType:f.changeType,type:"staged"}))):null,R=n?St([...(n.unstagedFiles||[]).map(f=>({filePath:f.filePath,changeType:f.changeType,type:"unstaged"})),...(n.untrackedFiles||[]).map(f=>({filePath:f,changeType:Oe.Added,type:"untracked"}))]):null;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:"Git Status"}),!s&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:o,disabled:r,className:"p-1 rounded hover:bg-neutral-100 dark:hover:bg-neutral-700 disabled:opacity-50",title:"Refresh",children:e.jsx(fe,{className:`w-4 h-4 ${r?"animate-spin":""}`})})})]}),s?e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"You are viewing a read-only session."}):e.jsxs(e.Fragment,{children:[Y&&Y.children.size>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"group flex items-center justify-between mb-2",children:[e.jsxs("button",{className:"flex items-center gap-2 text-sm text-neutral-900 dark:text-neutral-100 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded p-1",onClick:()=>d(!l),children:[l?e.jsx(Ye,{className:"w-4 h-4"}):e.jsx(tt,{className:"w-4 h-4"}),"Staged Changes (",n?.stagedFiles?.length||0,")"]}),e.jsx("button",{onClick:v,disabled:k.unstageAll,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50 opacity-0 group-hover:opacity-100 transition-opacity",title:"Unstage all changes",children:k.unstageAll?e.jsx(fe,{className:"w-4 h-4 animate-spin"}):e.jsx(st,{className:"w-4 h-4"})})]}),!l&&e.jsx("div",{className:"ml-2",children:Array.from(Y.children.values()).sort((f,p)=>f.isFolder&&!p.isFolder?-1:!f.isFolder&&p.isFolder?1:f.name.localeCompare(p.name)).map(f=>U(f,0,"StagedVsHead"))})]}),R&&R.children.size>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"group flex items-center justify-between mb-2",children:[e.jsxs("button",{className:"flex items-center gap-2 text-sm text-neutral-900 dark:text-neutral-100 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded p-1",onClick:()=>g(!m),children:[m?e.jsx(Ye,{className:"w-4 h-4"}):e.jsx(tt,{className:"w-4 h-4"}),"Changes (",(n?.unstagedFiles?.length||0)+(n?.untrackedFiles?.length||0),")"]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:h,disabled:k.discardAll,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:"Discard all changes",children:k.discardAll?e.jsx(fe,{className:"w-4 h-4 animate-spin"}):e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:j,disabled:k.stageAll,className:"p-1 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600 disabled:opacity-50",title:"Stage all changes",children:k.stageAll?e.jsx(fe,{className:"w-4 h-4 animate-spin"}):e.jsx(me,{className:"w-4 h-4"})})]})]}),!m&&e.jsx("div",{className:"ml-2",children:Array.from(R.children.values()).sort((f,p)=>f.isFolder&&!p.isFolder?-1:!f.isFolder&&p.isFolder?1:f.name.localeCompare(p.name)).map(f=>U(f,0,y(f.path)?"WorkingVsStaged":"WorkingVsHead"))})]}),n&&(n.stagedFiles?.length||0)===0&&(n.unstagedFiles?.length||0)===0&&(n.untrackedFiles?.length||0)===0&&e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400 text-center py-4",children:"No changes detected"}),r&&!n&&e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400 text-center py-4",children:"Loading git status..."})]})]})}function Zs({sessionId:t,activeFilePath:s,isSessionReadonly:a=!1,onOpenFile:n}){const[r,i]=c.useState([]),[o,l]=c.useState(!0),[d,m]=c.useState(null),[g,x]=c.useState(new Set),u=c.useRef(null),y=c.useRef(new Map);c.useEffect(()=>{if(!s||r.length===0)return;const B=setTimeout(async()=>{const w=s.split("/").filter(J=>J.length>0);if(w.length<=1)return;const L=[];for(let J=0;J<w.length-1;J++){const K=w.slice(0,J+1).join("/");L.push(K)}for(const J of L)if(!g.has(J)){x(se=>new Set([...se,J]));const K=await k(J);await new Promise(se=>setTimeout(se,K?150:50))}},50);return()=>clearTimeout(B)},[s,r.length]);const k=async E=>{const B=(L,J)=>{for(const K of L){if(K.path===J&&K.isDirectory)return K;if(K.children){const se=B(K.children,J);if(se)return se}}return null},w=B(r,E);if(w&&!w.isLoaded&&!w.isLoading){const L=(J,K)=>J.map(se=>se.path===K&&se.isDirectory?{...se,isLoading:!0}:se.children?{...se,children:L(se.children,K)}:se);i(J=>L(J,E));try{const J=await M(E),K=(se,ce,H)=>se.map(de=>de.path===ce&&de.isDirectory?{...de,children:H,isLoaded:!0,isLoading:!1}:de.children?{...de,children:K(de.children,ce,H)}:de);return i(se=>K(se,E,J)),!0}catch(J){console.error(`Failed to load folder ${E}:`,J);const K=(se,ce)=>se.map(H=>H.path===ce&&H.isDirectory?{...H,isLoading:!1}:H.children?{...H,children:K(H.children,ce)}:H);return i(se=>K(se,E)),!1}}return w?.isLoaded||!1};c.useEffect(()=>{if(!s||r.length===0)return;const B=setTimeout(()=>{const w=s.split("/").filter(K=>K.length>0);if(w.length<=1)return;const L=[];for(let K=0;K<w.length-1;K++){const se=w.slice(0,K+1).join("/");L.push(se)}const J=L.filter(K=>!g.has(K));J.length>0&&x(K=>{const se=new Set(K);return J.forEach(ce=>se.add(ce)),se})},200);return()=>clearTimeout(B)},[s,g,r.length]),c.useEffect(()=>{if(!s||!u.current)return;const E=()=>{const w=y.current.get(s);w?w.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}):setTimeout(E,100)},B=setTimeout(E,200);return()=>clearTimeout(B)},[s,g,r]);const[F,S]=c.useState(new Set),[v,h]=c.useState({visible:!1,x:0,y:0}),{editors:C,isInitializing:N}=ht(),[j,A]=c.useState({isOpen:!1}),[D,b]=c.useState({isOpen:!1}),[T,P]=c.useState({isOpen:!1});c.useEffect(()=>{(async()=>{try{l(!0);const B=await Z.getFiles(t),w=q(B);i(w)}catch(B){console.error("Failed to fetch session files:",B),m("Failed to load files")}finally{l(!1)}})()},[t]);const q=E=>E.map(w=>({name:w.fileName,path:w.relativePath,isDirectory:w.isDirectory,children:w.isDirectory?[]:void 0,size:w.isDirectory?void 0:w.size,lastModified:w.lastModified,isLoaded:!w.isDirectory,isLoading:!1})).sort((w,L)=>w.isDirectory&&!L.isDirectory?-1:!w.isDirectory&&L.isDirectory?1:w.name.toLowerCase().localeCompare(L.name.toLowerCase())),M=async E=>{try{const B=await Z.getFiles(t,E);return q(B)}catch(B){return console.error(`Failed to load folder contents for ${E}:`,B),[]}},U=(E,B,w,L)=>{E.preventDefault(),E.stopPropagation(),h({visible:!0,x:E.clientX,y:E.clientY,targetPath:B,targetName:w,isDirectory:L})},Y=async E=>{if(j.currentPath)try{await Z.renameFile(t,j.currentPath,E);const B=j.currentPath.includes("/")?j.currentPath.substring(0,j.currentPath.lastIndexOf("/")):"";await W(B)}catch(B){console.error("Failed to rename file:",B),alert("Failed to rename file. Please try again.")}finally{A({isOpen:!1})}},R=async E=>{if(confirm(`Are you sure you want to delete "${E}"?`))try{await Z.deleteFile(t,E);const B=E.includes("/")?E.substring(0,E.lastIndexOf("/")):"";await W(B)}catch(B){console.error("Failed to delete file:",B),alert("Failed to delete file. Please try again.")}},f=async(E,B)=>{try{await Z.openFileWithEditor(t,E,B)}catch(w){console.error("Failed to open file with editor:",w),alert("Failed to open file with editor. Please try again.")}},p=async E=>{try{await Z.openFileFolder(t,E)}catch(B){console.error("Failed to open file folder:",B),alert("Failed to open file folder. Please try again.")}},$=async E=>{try{const B=D.parentPath||"",w=B?`${B}/${E}`:E;await Z.createFile(t,w),await W(B)}catch(B){console.error("Failed to create file:",B),alert("Failed to create file. Please try again.")}finally{b({isOpen:!1})}},V=async E=>{try{const B=T.parentPath||"",w=B?`${B}/${E}`:E;await Z.createFolder(t,w),await W(B)}catch(B){console.error("Failed to create folder:",B),alert("Failed to create folder. Please try again.")}finally{P({isOpen:!1})}},W=async E=>{try{if(E===""){const B=await Z.getFiles(t),w=q(B);i(w)}else{const B=await Z.getFiles(t),w=q(B);i(w)}}catch(B){console.error("Failed to refresh directory:",B)}},_=()=>{const E=[];return v.targetPath&&!v.isDirectory&&(E.push({id:"open",label:"Open",onClick:()=>{v.targetPath&&v.targetName&&n(v.targetPath,v.targetName)}}),a||(N?E.push({id:"open-with-loading",label:"Loading editors...",onClick:()=>{}}):C.length>0&&E.push({id:"open-with",label:"Open with",onClick:()=>{},submenu:C.map(B=>({id:`editor-${B.id}`,label:B.displayName,onClick:()=>{v.targetPath&&f(v.targetPath,B.id)}}))})),E.push({id:"sep1",label:"",separator:!0})),v.targetPath?a||(E.push({id:"open-folder",label:"Open folder",onClick:()=>{v.targetPath&&p(v.targetPath)}}),E.push({id:"sep2",label:"",separator:!0}),E.push({id:"rename",label:"Rename",onClick:()=>{A({isOpen:!0,currentPath:v.targetPath,currentName:v.targetName})}}),E.push({id:"delete",label:"Delete",onClick:()=>{v.targetPath&&R(v.targetPath)}})):a||(E.push({id:"new-file",label:"New File",onClick:()=>{b({isOpen:!0,parentPath:""})}}),E.push({id:"new-folder",label:"New Folder",onClick:()=>{P({isOpen:!0,parentPath:""})}})),E},Q=E=>{if(E===0)return"0 B";const B=1024,w=["B","KB","MB","GB"],L=Math.floor(Math.log(E)/Math.log(B));return parseFloat((E/Math.pow(B,L)).toFixed(1))+" "+w[L]},te=async E=>{if(g.has(E)){x(L=>{const J=new Set(L);return J.delete(E),J});return}x(L=>new Set([...L,E]));const B=(L,J)=>L.map(K=>K.path===J&&K.isDirectory&&!K.isLoaded?{...K,isLoading:!0}:K.children?{...K,children:B(K.children,J)}:K),w=(L,J)=>{for(const K of L)if(K.path===J&&K.isDirectory&&!K.isLoaded||K.children&&w(K.children,J))return!0;return!1};if(w(r,E)){S(L=>new Set([...L,E])),i(L=>B(L,E));try{const L=await M(E),J=(K,se,ce)=>K.map(H=>H.path===se&&H.isDirectory?{...H,children:ce,isLoaded:!0,isLoading:!1}:H.children?{...H,children:J(H.children,se,ce)}:H);i(K=>J(K,E,L))}catch(L){console.error(`Failed to load folder ${E}:`,L);const J=(K,se)=>K.map(ce=>ce.path===se&&ce.isDirectory?{...ce,isLoading:!1}:ce.children?{...ce,children:J(ce.children,se)}:ce);i(K=>J(K,E))}finally{S(L=>{const J=new Set(L);return J.delete(E),J})}}},ee=(E,B)=>E.map(w=>e.jsx("div",{style:{marginLeft:`${B?0:12}px`},children:w.isDirectory?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"py-1 px-2 flex items-center hover:bg-neutral-50 dark:hover:bg-neutral-700/50",onClick:()=>te(w.path),onContextMenu:L=>!a&&U(L,w.path,w.name,!0),children:[w.isLoading?e.jsx("span",{className:"mr-1 text-xs animate-spin",children:"⏳"}):e.jsx("span",{className:"mr-1 text-xs transition-transform duration-200",style:{transform:g.has(w.path)?"rotate(90deg)":"rotate(0deg)"},children:e.jsx(Ye,{size:12})}),e.jsx(Te,{fileName:w.name,isFolder:!0,size:14,className:"mr-1 flex-shrink-0"}),e.jsxs("span",{className:"text-sm",children:[w.name,"/"]})]}),g.has(w.path)&&w.children&&ee(w.children,!1)]}):e.jsxs("div",{ref:L=>{L?y.current.set(w.path,L):y.current.delete(w.path)},className:`py-1 px-2 rounded-sm flex items-center justify-between group ${s===w.path?"bg-purple-100 dark:bg-purple-900/50":"hover:bg-neutral-50 dark:hover:bg-neutral-700/50"}`,onClick:()=>n(w.path,w.name),onContextMenu:L=>!a&&U(L,w.path,w.name,!1),title:`${w.path} (${Q(w.size||0)})`,children:[e.jsxs("div",{className:"flex items-center min-w-0 flex-1 ps-4",children:[e.jsx(Te,{fileName:w.name,size:14,className:"mr-2 flex-shrink-0"}),e.jsx("span",{className:"text-sm truncate",children:w.name})]}),e.jsx("div",{className:`text-xs transition-opacity ml-2 flex-shrink-0 ${s===w.path?"text-purple-600 dark:text-purple-300 opacity-100":"text-neutral-500 dark:text-neutral-400 opacity-0 group-hover:opacity-100"}`,children:Q(w.size||0)})]})},w.path));return o?e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100 mb-2",children:"Session Files"}),e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Loading files..."})]}):d?e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100 mb-2",children:"Session Files"}),e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:d})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:"Session Files"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>b({isOpen:!0,parentPath:""}),disabled:a,className:"p-1 text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:a?"Actions disabled in read-only mode":"New File",children:e.jsx(Te,{fileName:"file.txt",size:16})}),e.jsx("button",{onClick:()=>P({isOpen:!0,parentPath:""}),disabled:a,className:"p-1 text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:a?"Actions disabled in read-only mode":"New Folder",children:e.jsx(Te,{fileName:"folder",isFolder:!0,size:16})})]})]}),e.jsx("div",{ref:u,className:"flex-1 overflow-y-auto",onContextMenu:E=>!a&&U(E),children:e.jsx("div",{className:"space-y-1 text-sm",children:r.length>0?ee(r,!0):e.jsxs("div",{className:"text-neutral-600 dark:text-neutral-400 text-center py-8",children:[e.jsx("div",{className:"mb-2 flex justify-center",children:e.jsx(Te,{fileName:"empty",isFolder:!0,size:32})}),e.jsx("div",{children:"No files found"}),e.jsx("div",{className:"text-xs mt-1",children:"The session directory is empty"})]})})}),e.jsx(Vs,{items:_(),position:{x:v.x,y:v.y},isVisible:v.visible,onClose:()=>h({visible:!1,x:0,y:0})}),e.jsx(Gs,{isOpen:j.isOpen,currentName:j.currentName||"",onConfirm:Y,onCancel:()=>A({isOpen:!1})}),e.jsx(vt,{isOpen:D.isOpen,title:"Create New File",placeholder:"Enter file name (e.g., example.txt)",onConfirm:$,onCancel:()=>b({isOpen:!1})}),e.jsx(vt,{isOpen:T.isOpen,title:"Create New Folder",placeholder:"Enter folder name",onConfirm:V,onCancel:()=>P({isOpen:!1})})]})}function ea(t){const[s,a]=c.useState([]),[n,r]=c.useState(!0),[i,o]=c.useState(null),l=async m=>{try{m||r(!0),o(null);const g=await Z.getTasks(t);a(g)}catch(g){o(g instanceof Error?g.message:"Failed to fetch session tasks")}finally{r(!1)}};return c.useEffect(()=>{t&&l()},[t]),{tasks:s,loading:n,error:i,refreshTasks:m=>{l(m)}}}function ta({sessionId:t,isSessionReadonly:s,onOpenTask:a}){const[n,r]=c.useState({}),{taskExecutions:i,setTaskExecution:o,mapTaskToExecution:l}=_e(),{tasks:d,loading:m,error:g,refreshTasks:x}=ea(t),u=async(S,v,h=!0)=>{const C=`start-${S}`;r(N=>({...N,[C]:!0}));try{const N=await Z.startTask(t,S),j=String(N.taskExecutionId);l(S,!0,j),o(j,{taskExecutionId:j,output:"",status:ae.Running,startTime:new Date}),h&&F(S,v,j,!0),setTimeout(()=>{x(!0)},100)}catch(N){console.error("[Tasks] Failed to start task:",N)}finally{r(N=>({...N,[C]:!1}))}},y=async S=>{const v=`stop-${S}`;r(h=>({...h,[v]:!0}));try{await ve.stopTask(S),x()}catch(h){console.error("Failed to stop task:",h)}finally{r(h=>({...h,[v]:!1}))}},k=async(S,v,h)=>{const C=`restart-${S}`;r(N=>({...N,[C]:!0}));try{await ve.stopTask(h),await new Promise(N=>setTimeout(N,500)),await u(S,v,!0)}catch(N){console.error("Failed to restart task:",N)}finally{r(N=>({...N,[C]:!1}))}},F=async(S,v,h,C)=>{try{const N=C?{output:"",status:ae.Running}:await ve.getTaskOutput(h);l(S,!0,h),o(h,{...N,taskExecutionId:h}),a(h,v)}catch(N){console.error("[Tasks] Failed to get task output:",{taskExecutionId:h,error:N,sessionId:t}),i[h]||o(h,{taskExecutionId:h,output:"Unable to load output. The task may still be initializing.",status:ae.Pending}),a(h,"Task Output")}};return e.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:"Tasks"}),!s&&e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>x(),disabled:m,children:e.jsx(fe,{size:14,className:m?"animate-spin":""})})]}),g&&e.jsxs("div",{className:"text-red-600 text-sm p-2 bg-red-50 dark:bg-red-900/20 rounded",children:["Error: ",g]}),s?e.jsx("div",{className:"text-sm text-neutral-500",children:"You are viewing a read-only session."}):e.jsx("div",{className:"flex-1 overflow-y-auto",children:m&&d.length===0?e.jsx("div",{className:"text-neutral-500 text-sm",children:"Loading tasks..."}):e.jsx(Gt,{isSession:!0,tasks:d,loading:n,taskExecutions:i,isReadonly:s,onStart:(S,v,h=!0)=>u(S,v,h),onStop:y,onRestart:k,onViewOutput:(S,v,h)=>F(S,v,h,!1),emptyMessage:"No tasks found",autoOpenOnGroupStart:!0})})]})}function sa({sessionId:t,activeFilePath:s,suggestedSidebarTab:a,isSessionReadonly:n,session:r,onOpenFile:i,onOpenDiff:o,onOpenTask:l,onMergeToMain:d,onPushBranch:m,onPullFromStarterBranch:g,onResetSession:x,onCancelSession:u,onStopWorkingMessages:y,onOpenWithVSCode:k,isVSCodeAvailable:F,onDeployToEnvironment:S,onSessionNameUpdate:v,autoDeployEnabled:h,selectedEnvironmentId:C,restartAfterSync:N,onAutoDeployChange:j,onSelectedEnvironmentIdChange:A,onRestartAfterSyncChange:D,messagesCount:b}){const[T,P]=c.useState("session"),[q,M]=c.useState(!1),{gitStatus:U,fetchGitStatus:Y}=et(t);c.useEffect(()=>{M(!1),Y()},[t]),c.useEffect(()=>{a&&!q&&P(a)},[a,q]);const R=p=>{switch(p){case"session":return 0;case"git":return!n&&U?U.stagedFiles.length+U.unstagedFiles.length+U.untrackedFiles.length:0;case"files":return 0;case"tasks":return 0;default:return 0}},f=()=>{switch(T){case"session":return e.jsx(Qs,{sessionId:t,isSessionReadonly:n,session:r,onOpenTask:l,onMergeToMain:d,onPushBranch:m,onPullFromStarterBranch:g,onResetSession:x,onCancelSession:u,onStopWorkingMessages:y,onOpenWithVSCode:k,isVSCodeAvailable:F,onDeployToEnvironment:S,onSessionNameUpdate:v,autoDeployEnabled:h,selectedEnvironmentId:C,restartAfterSync:N,onAutoDeployChange:j,onSelectedEnvironmentIdChange:A,onRestartAfterSyncChange:D,messagesCount:b});case"git":return e.jsx(Xs,{sessionId:t,isSessionReadonly:n,onOpenDiff:o});case"files":return e.jsx(Zs,{sessionId:t,activeFilePath:s,isSessionReadonly:n,onOpenFile:i});case"tasks":return e.jsx(ta,{sessionId:t,isSessionReadonly:n,onOpenTask:l});default:return null}};return e.jsxs("div",{className:"w-80 border-r border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 flex flex-col",children:[e.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-700 p-1",children:e.jsx("div",{className:"flex space-x-1",children:["session","git","files","tasks"].map(p=>e.jsxs("button",{onClick:()=>{P(p),M(!0)},className:`flex items-center space-x-2 px-3 py-2 text-sm rounded-md ${T===p?"bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200":"text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 hover:bg-neutral-50 dark:hover:bg-neutral-700"}`,children:[p==="session"&&e.jsx("span",{children:e.jsx(ls,{size:18})}),p==="git"&&e.jsx("span",{children:e.jsx(ot,{size:18})}),p==="files"&&e.jsx("span",{children:e.jsx(os,{size:18})}),p==="tasks"&&e.jsx("span",{children:e.jsx(Ve,{size:18})}),R(p)>0&&e.jsx(Se,{variant:"default",size:"sm",children:R(p)})]},p))})}),e.jsx("div",{className:"flex-1 p-4 overflow-y-auto",children:f()})]})}function aa({tabId:t}){const{getTabContentById:s,activeSessionId:a,setTabContent:n,getTabDirty:r,setTabDirty:i}=xe(),{fetchGitStatus:o}=pt(),l=s(a,t)||{},d=r(a,t),m=c.useCallback(b=>{i(a,t,b)},[a,i,t]),[g,x]=c.useState(!1),{editableContent:u,lastModified:y,content:k}=l,[F,S]=c.useState({isOpen:!1}),[v,h]=c.useState({isOpen:!1,message:""}),C=c.useCallback(b=>{const T=b||"";n(a,t,{...l,editableContent:T}),m(T!==k)},[a,l,k,m,n,t]),N=c.useCallback(async(b=!1)=>{if(!(!d||g))try{x(!0);const T=await Z.updateFileContent(a,l.path,u,b?void 0:y);n(a,t,{...l,editableContent:u,content:u,lastModified:T.lastModified}),m(!1),o(a)}catch(T){if(console.error("Failed to save file:",T),T.status===409){const P=T.data||{};S({isOpen:!0,currentLastModified:P.currentLastModified})}else h({isOpen:!0,message:"Failed to save file. Please try again."})}finally{x(!1)}},[a,l,u,d,g,y,m,n,t]),j=c.useCallback(b=>{b.ctrlKey&&b.key==="s"&&(b.preventDefault(),N())},[N]);c.useEffect(()=>(document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)),[j]);const A=()=>{S({isOpen:!1}),N(!0)},D=async()=>{S({isOpen:!1});try{const{content:b,lastModified:T}=await Z.getFileContent(a,l.path);n(a,t,{...l,lastModified:T,editableContent:b,content:b}),m(!1),h({isOpen:!0,message:"File has been reloaded with the latest changes. Your changes have been discarded."})}catch(b){console.error("Failed to reload file:",b),h({isOpen:!0,message:"Failed to reload file. Please refresh the page."})}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Te,{fileName:l.name||"",size:20,className:"text-neutral-600 dark:text-neutral-400"}),e.jsxs("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:[l.name,d&&e.jsx("span",{className:"text-orange-500 ml-2",children:"•"})]}),l.path!=l.name&&e.jsx("span",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:l.path})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>N(),disabled:!d||g,className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-green-600 hover:bg-green-700 disabled:bg-neutral-400 disabled:cursor-not-allowed text-white rounded-md",title:"Save (Ctrl+S)",children:[e.jsx(cs,{className:"w-4 h-4"}),g?"Saving...":"Save"]})})]})}),e.jsx("div",{className:"flex-1",children:e.jsx(ds,{height:"100%",language:l.language,value:u,onChange:C,theme:"vs-dark",options:{readOnly:!1,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:14,lineNumbers:"on",renderWhitespace:"selection",folding:!0,wordWrap:"on",automaticLayout:!0,tabSize:2,insertSpaces:!0,formatOnPaste:!0,formatOnType:!0}})}),e.jsx($e,{isOpen:F.isOpen,title:"File Conflict Detected",message:`This file has been modified by another process.

Your last modified: ${new Date(y).toLocaleString()}
Current last modified: ${new Date(F.currentLastModified||"").toLocaleString()}

Click Override to save your changes anyway, or Reload to discard your changes and reload the latest version.`,confirmText:"Override",cancelText:"Reload",variant:"warning",onConfirm:A,onCancel:D}),e.jsx(ue,{isOpen:v.isOpen,onClose:()=>h({isOpen:!1,message:""}),title:"Information",size:"sm",contentClassName:"p-6",footer:e.jsx("div",{className:"flex justify-end",children:e.jsx(O,{onClick:()=>h({isOpen:!1,message:""}),children:"OK"})}),children:e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-300",children:v.message})})]})}function ra({tabId:t}){const{getTabContentById:s,activeSessionId:a}=xe(),n=s(a,t);return!n||n.type!=="diff"?e.jsx("div",{className:"flex items-center justify-center h-full text-neutral-500",children:"Content not available"}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ot,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"}),e.jsxs("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:[n.name," (Changes)"]}),e.jsx("span",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:n.path})]})}),e.jsx("div",{className:"flex-1",children:e.jsx(us,{height:"100%",language:n.language,original:n.original,modified:n.modified,theme:"vs-dark",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:14,renderSideBySide:!0,ignoreTrimWhitespace:!1}})})]})}function na({tabId:t}){const{getTabContentById:s,activeSessionId:a}=xe(),n=s(a,t);if(!n||n.type!=="task")return e.jsx("div",{className:"flex items-center justify-center h-full text-neutral-500",children:"Content not available"});const r=i=>i.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"});return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-6 py-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(mt,{status:n.status,size:"lg"}),e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:n.name})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-neutral-500 dark:text-neutral-400",children:[n.startTime&&e.jsxs("span",{children:["Started: ",r(n.startTime)]}),n.endTime&&e.jsxs("span",{children:["Ended: ",r(n.endTime)]})]})]})}),e.jsx("div",{className:"flex-1 p-6 min-h-0",children:e.jsx(Ut,{output:n.output,className:"h-full break-words"})})]})}const ia="modulepreload",la=function(t){return"/"+t},Ct={},oa=function(s,a,n){let r=Promise.resolve();if(a&&a.length>0){let d=function(m){return Promise.all(m.map(g=>Promise.resolve(g).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");r=d(a.map(m=>{if(m=la(m),m in Ct)return;Ct[m]=!0;const g=m.endsWith(".css"),x=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${x}`))return;const u=document.createElement("link");if(u.rel=g?"stylesheet":ia,g||(u.as="script"),u.crossOrigin="",u.href=m,l&&u.setAttribute("nonce",l),document.head.appendChild(u),g)return new Promise((y,k)=>{u.addEventListener("load",y),u.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${m}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return r.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return s().catch(i)})};function ca({status:t,size:s="sm"}){return t===je.Done?null:e.jsx("div",{className:"flex items-center justify-center "+(s==="lg"?"w-5":"w-3"),children:t===je.Working?e.jsx(Ke,{size:"sm"}):t===je.Pending?e.jsx(gs,{}):e.jsx("div",{className:`w-2 h-2 rounded-full ${t===je.Done?"bg-green-500":t===je.Failed?"bg-red-500":"bg-neutral-400"}`})})}const da=t=>{switch(t){case he.System:return"System";case he.User:return"User";case he.Agent:return"Agent";case he.Tool:return"Tool";default:return"Unknown"}},ua=t=>{switch(t){case he.User:return"bg-purple-100/60 dark:bg-purple-900/60 text-neutral-900 dark:text-neutral-100";case he.Agent:return"bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100";case he.Tool:return"bg-neutral-200/50 dark:bg-neutral-800/60 text-neutral-900 dark:text-neutral-100";case he.System:return"bg-neutral-100 dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200";default:return"bg-neutral-100 dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200"}};function ga({message:t,onOpenFile:s}){const[a,n]=c.useState(!1),[r,i]=c.useState(!1),o=c.useCallback(x=>{const u=x.replace(/['"]/g,"").trim(),y=u.match(/^(.+):(\d+)$/),k=y?y[1]:u,F=y?parseInt(y[2],10):void 0,S=k.split(/[/\\]/).pop()||k;s&&(s(k,S),F&&console.log(`Should navigate to line ${F} in ${k}`))},[s]),l=c.useMemo(()=>{const x=t.content;return e.jsx(hs,{remarkPlugins:[ms],urlTransform:u=>u,components:{code({node:u,inline:y,className:k,children:F,...S}){return!k&&y!==!1?e.jsx("code",{className:"bg-neutral-200 dark:bg-neutral-700 px-1 py-0.5 rounded text-sm font-mono mx-0.5",...S,children:F}):e.jsx("code",{className:"font-mono",...S,children:F})},pre({children:u,className:y,...k}){const S=u?.props,v=/language-(\w+)/.exec(S?.className||""),h=v?v[1]:"";return e.jsxs("pre",{className:"bg-neutral-900 text-neutral-100 p-3 rounded mt-2 mb-2 overflow-x-auto text-sm block",...k,children:[h&&e.jsx("div",{className:"text-neutral-400 text-xs mb-2",children:h}),u]})},p({children:u}){return e.jsx("p",{className:"mb-2 whitespace-pre-line",children:u})},ul({children:u}){return e.jsx("ul",{className:"list-disc list-inside mb-2",children:u})},ol({children:u}){return e.jsx("ol",{className:"list-decimal list-inside mb-2",children:u})},li({children:u}){return e.jsx("li",{className:"mb-1",children:u})},h1({children:u}){return e.jsx("h1",{className:"text-xl font-bold mb-2 mt-3",children:u})},h2({children:u}){return e.jsx("h2",{className:"text-lg font-bold mb-2 mt-3",children:u})},h3({children:u}){return e.jsx("h3",{className:"text-base font-bold mb-2 mt-2",children:u})},blockquote({children:u}){return e.jsx("blockquote",{className:"border-l-4 border-neutral-300 dark:border-neutral-600 pl-4 py-1 mb-2 italic",children:u})},a({href:u,children:y}){if(u&&u.startsWith("file://")){const k=u.replace("file://","");return e.jsx("button",{onClick:F=>{F.preventDefault(),F.stopPropagation(),o(k)},className:"text-purple-600 dark:text-purple-400 hover:underline cursor-pointer bg-transparent border-none p-0 font-inherit underline-offset-auto",title:`Open ${k}`,children:y})}return e.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 dark:text-purple-400 hover:underline",children:y})},table({children:u}){return e.jsx("div",{className:"overflow-x-auto mb-2",children:e.jsx("table",{className:"min-w-full border border-neutral-300 dark:border-neutral-600",children:u})})},thead({children:u}){return e.jsx("thead",{className:"bg-neutral-100 dark:bg-neutral-700",children:u})},th({children:u}){return e.jsx("th",{className:"border border-neutral-300 dark:border-neutral-600 px-3 py-2 text-left font-semibold",children:u})},td({children:u}){return e.jsx("td",{className:"border border-neutral-300 dark:border-neutral-600 px-3 py-2",children:u})},hr(){return e.jsx("hr",{className:"my-3 border-neutral-300 dark:border-neutral-600"})},strong({children:u}){return e.jsx("strong",{className:"font-bold",children:u})},em({children:u}){return e.jsx("em",{className:"italic",children:u})}},children:x})},[o,t.content]),d=async()=>{try{await navigator.clipboard.writeText(t.content),n(!0),setTimeout(()=>n(!1),2e3)}catch(x){console.error("Failed to copy text: ",x)}},m=async()=>{if(!r){i(!0);try{if(t.status===je.Working){const{sessionsApi:x}=await oa(async()=>{const{sessionsApi:u}=await Promise.resolve().then(()=>Cs);return{sessionsApi:u}},void 0);await x.cancelMessage(t.sessionId,t.id)}else await qe.update(t.sessionId,t.id,{status:je.Failed})}catch(x){console.error("Failed to cancel message: ",x)}finally{i(!1)}}},g=t.type===he.User&&t.status===je.Pending||(t.type===he.Agent||t.type===he.Tool)&&t.status===je.Working;return e.jsx("div",{className:"flex justify-start "+(t.type===he.Tool?"":"pb-4"),children:e.jsx("div",{className:"flex max-w-4xl",children:e.jsxs("div",{className:`px-4 py-3 max-w-none ${ua(t.type)}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ca,{status:t.status,type:t.type}),e.jsx("span",{className:"text-xs opacity-75",children:da(t.type)}),e.jsx("span",{className:"text-xs opacity-50",children:new Date(t.updatedAt).toLocaleTimeString()})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[g&&e.jsx("button",{onClick:m,disabled:r,className:"p-1 text-xs opacity-50 hover:opacity-100 transition-opacity duration-200 rounded hover:bg-red-500/20 text-red-600 dark:text-red-400",title:t.status===je.Working?"Stop processing":"Cancel message",children:r?e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{onClick:d,className:"p-1 text-xs opacity-50 hover:opacity-100 transition-opacity duration-200 rounded hover:bg-black/10 dark:hover:bg-white/10",title:"Copy message content",children:a?e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 002 2v8a2 2 0 002 2z"})})})]})]}),e.jsx("div",{className:"text-sm font-mono leading-relaxed select-text",children:l}),t.metadata&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-xs opacity-75 hover:opacity-100",children:"Metadata"}),e.jsx("pre",{className:"text-xs opacity-60 mt-1 bg-black/10 dark:bg-white/10 p-2 rounded",children:t.metadata})]})]})})})}function ha({onSendMessage:t,disabled:s=!1,placeholder:a="Type your message...",className:n="",messageHistory:r=[],messageHistoryIndex:i=-1,onMessageHistoryIndexChange:o,inputMessage:l,onInputMessageChange:d}){const m=c.useRef(null),g=async()=>{if(!l.trim()||s)return;const y=l.trim();d("");const k=()=>{m.current&&(m.current.style.height="auto",requestAnimationFrame(()=>{m.current?.focus()}))};try{await t(y),k()}catch(F){console.error("Failed to send message:",F),k()}},x=y=>{if(y.key==="Enter"&&!y.shiftKey){y.preventDefault(),g();return}if((y.key==="ArrowUp"||y.key==="ArrowDown")&&(l.trim()===""||i>=0)){if(y.preventDefault(),!o||r.length===0)return;if(y.key==="ArrowUp"){const k=Math.min(i+1,r.length-1);o(k),d(r[k]||"")}else if(y.key==="ArrowDown")if(i>0){const k=i-1;o(k),d(r[k]||"")}else o(-1),d("")}},u=y=>{const k=y.target;d(k.value),o&&i>=0&&o(-1),k.style.height="auto",k.style.height=`${Math.min(k.scrollHeight,200)}px`};return e.jsxs("div",{className:`flex items-center space-x-3 ${n}`,children:[e.jsx("textarea",{ref:m,value:l,onChange:u,onKeyDown:x,placeholder:a,disabled:s,className:`
            w-full px-4 py-3 pr-12 rounded-lg border border-neutral-300 dark:border-neutral-600
            bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100
            placeholder-neutral-500 dark:placeholder-neutral-400
            focus:border-transparent
            resize-none overflow-hidden min-h-[48px] max-h-[200px]
            disabled:opacity-50 disabled:cursor-not-allowed
            duration-200
          `,rows:1}),e.jsx("button",{onClick:g,disabled:s||!l.trim(),className:`
          px-6 py-3 rounded-lg transition-all duration-200
          flex items-center justify-center min-w-[80px]
          ${s||!l.trim()?"bg-neutral-200/50 dark:bg-neutral-600 text-neutral-500 dark:text-neutral-400 cursor-not-allowed":"bg-purple-900 hover:bg-purple-700 text-white shadow-sm hover:shadow-md"}
        `,children:s?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):"Send"})]})}function ma({sessionId:t,className:s="",onOpenFile:a,onClearMessagesRef:n,isReadonly:r=!1,autoDeployEnabled:i=!1,selectedEnvironmentName:o,chatInputMessage:l,messageHistoryIndex:d,onChatInputMessageChange:m,onMessageHistoryIndexChange:g}){const x=c.useRef(null),{messages:u,loading:y,sending:k,error:F,sendMessage:S,clearError:v,clearMessages:h}=Rt(t),C=c.useMemo(()=>u.filter(j=>j.type===he.User).map(j=>j.content).reverse(),[u]);c.useEffect(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[u]),c.useEffect(()=>{n&&n(h)},[h,n]);const N=async j=>{g(-1),await S(j)};return y&&u.length===0?e.jsx("div",{className:`flex flex-col h-full ${s}`,children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(Ke,{size:"lg"})})}):e.jsxs("div",{className:`flex flex-col h-full bg-neutral-100/30 dark:bg-neutral-900 ${s}`,children:[e.jsx("div",{className:"flex items-center justify-between p-4 border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800",children:e.jsxs("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:["Session Chat",!r&&i&&o&&e.jsxs("span",{className:"ml-2 text-sm font-normal opacity-60",children:["Auto Deploy to ",e.jsx(Se,{children:o})]})]})}),F&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/50 border-b border-red-200 dark:border-red-800 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:F}),e.jsx("button",{onClick:v,className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-200",children:"×"})]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto p-4",children:u.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center text-neutral-500 dark:text-neutral-400",children:[e.jsx("p",{className:"text-lg",children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Start a conversation by sending a message below"})]})}):e.jsxs(e.Fragment,{children:[u.map(j=>e.jsx(ga,{message:j,onOpenFile:a},j.id)),e.jsx("div",{ref:x})]})}),!r&&e.jsx("div",{className:"border-t border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 p-4",children:e.jsx(ha,{onSendMessage:N,disabled:k||y,placeholder:k?"Sending...":"Type your message...",messageHistory:C,messageHistoryIndex:d,onMessageHistoryIndexChange:g,inputMessage:l,onInputMessageChange:m})})]})}function xa({tabs:t,activeTabId:s,sessionId:a,isSessionReadonly:n,session:r,onCloseTab:i,onSwitchTab:o,onOpenFile:l,onClearMessagesRef:d,autoDeployEnabled:m,selectedEnvironmentId:g,restartAfterSync:x,onSelectedEnvironmentIdChange:u,chatInputMessage:y,messageHistoryIndex:k,onChatInputMessageChange:F,onMessageHistoryIndexChange:S}){const v=c.useRef(void 0),h=m&&!!r?.workspaceId,{environments:C,loading:N,error:j,refetch:A}=Je({workspaceId:r?.workspaceId||1,autoLoad:h});c.useEffect(()=>{C.length>0&&!g&&m&&u(C[0].id.toString())},[C,g,m,u]),c.useEffect(()=>{m&&r?.workspaceId&&C.length===0&&!N&&!j&&A()},[m,r?.workspaceId,C.length,N,j,A]),c.useEffect(()=>{const P=v.current,q=r?.status;P===pe.InProgress&&(q===pe.Done||q===pe.Waiting)&&m&&g&&ut(a,+g,x).catch(M=>console.error("Auto-deploy failed:",M)),v.current=q},[r?.status,m,g,a,x]);const D=P=>{switch(P.content.type){case"chat":return e.jsx(bt,{className:"w-4 h-4"});case"file":return e.jsx(Te,{fileName:P.content.name||"",size:16,className:"text-neutral-600 dark:text-neutral-400"});case"diff":return e.jsx(Ot,{className:"w-4 h-4"});case"task":return e.jsx(Le,{className:"w-4 h-4"});default:return e.jsx(bt,{className:"w-4 h-4"})}},b=P=>{switch(P.content.type){case"chat":{const q=C.find(M=>M.id.toString()===g);return e.jsx(ma,{sessionId:a,className:"h-full min-h-0",onOpenFile:l,onClearMessagesRef:d,isReadonly:n,autoDeployEnabled:m,selectedEnvironmentName:q?.name,chatInputMessage:y,messageHistoryIndex:k,onChatInputMessageChange:F,onMessageHistoryIndexChange:S})}case"file":return e.jsx(aa,{tabId:s});case"diff":return e.jsx(ra,{tabId:s});case"task":return e.jsx(na,{tabId:s});default:return null}},T=t.some(P=>P.id!=="chat");return e.jsxs("div",{className:"flex-1 min-h-0 bg-neutral-50 dark:bg-neutral-900 flex flex-col",children:[T&&e.jsx("div",{className:"bg-white dark:bg-neutral-800 border-b border-neutral-200 dark:border-neutral-700",children:e.jsx("div",{className:"flex overflow-x-auto",children:t.map(P=>e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 border-r border-neutral-200 dark:border-neutral-700 min-w-0 ${s===P.id?"bg-neutral-50 dark:bg-neutral-900 text-purple-600 dark:text-purple-400":"text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-100 hover:bg-neutral-50 dark:hover:bg-neutral-700"}`,onClick:()=>o(P.id),onMouseDown:q=>{q.button===1&&P.id!=="chat"&&(q.preventDefault(),i(P.id))},children:[D(P),e.jsx("span",{className:"text-sm truncate max-w-32",children:P.title}),P.isDirty&&e.jsx("span",{className:"text-orange-500 text-sm",children:"•"}),P.id!=="chat"&&e.jsx("button",{onClick:q=>{q.stopPropagation(),i(P.id)},className:"ml-1 p-0.5 rounded hover:bg-neutral-200 dark:hover:bg-neutral-600",children:e.jsx(Qe,{className:"w-3 h-3"})})]},P.id))})}),t.map(P=>e.jsx("div",{className:"flex-1 min-h-0 flex flex-col"+(s!==P.id?" hidden":""),children:b(P)},P.id))]})}function pa({isOpen:t,onClose:s,sessionId:a,workspaceId:n}){const[r,i]=c.useState(""),[o,l]=c.useState(!1),[d,m]=c.useState(!0),{environments:g,loading:x,error:u}=Je({workspaceId:n||0,autoLoad:t&&!!n}),{gitStatus:y}=et(a),k=()=>y?y.stagedFiles.length>0||y.unstagedFiles.length>0||y.untrackedFiles.length>0:!1;c.useEffect(()=>{g.length>0&&!r&&i(g[0].id.toString())},[g,r]);const F=async()=>{if(r){l(!0);try{await ut(a,+r,d),s()}catch(h){console.error("Failed to deploy to environment:",h)}finally{l(!1)}}},S=()=>{o||(i(""),m(!0),s())},v=g.map(h=>({value:h.id.toString(),label:h.name}));return e.jsx(ue,{isOpen:t,onClose:S,title:"Deploy to Environment",size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(O,{variant:"outline",onClick:S,disabled:o,children:"Cancel"}),e.jsx(O,{onClick:F,disabled:!r||o||g.length===0||!k(),children:o?"Deploying...":"Deploy"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-2",children:"Select Environment"}),x?e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Loading environments..."}):u?e.jsxs("div",{className:"text-sm text-red-500 dark:text-red-400",children:["Error loading environments: ",u]}):g.length===0?e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"No environments found for this workspace."}):e.jsx(Pe,{value:r,onSelect:h=>i(h.value),options:v,placeholder:"Choose an environment..."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"restartAfterSync",checked:d,onChange:h=>m(h.target.checked),className:"rounded border-neutral-300 dark:border-neutral-600 text-purple-600 dark:bg-neutral-700"}),e.jsx("label",{htmlFor:"restartAfterSync",className:"text-sm text-neutral-700 dark:text-neutral-300 cursor-pointer",children:"Restart after sync"})]})]})})}const Re={},rt=(t,s)=>{Re[t]={...Re[t],...s}},ya=t=>Re[t]||{autoDeployEnabled:!1,selectedEnvironmentId:"",restartAfterSync:!0},Ft=(t,s)=>{Re[t]={...Re[t],chatState:s}},fa=t=>Re[t]?.chatState||{inputMessage:"",messageHistoryIndex:-1};function ba(){const{sessionId:t}=Pt(),[s,a]=c.useState({isActive:!1,title:"",message:""}),[n,r]=c.useState(!1),i=c.useRef(null),[o,l]=c.useState(!1),[d,m]=c.useState(""),[g,x]=c.useState(!0),[u,y]=c.useState(""),[k,F]=c.useState(-1);c.useEffect(()=>{if(t){const I=ya(t);l(I.autoDeployEnabled),m(I.selectedEnvironmentId),x(I.restartAfterSync);const X=fa(t);y(X.inputMessage),F(X.messageHistoryIndex)}},[t]);const S=I=>{l(I),t&&rt(t,{autoDeployEnabled:I,selectedEnvironmentId:d,restartAfterSync:g}),I||v("")},v=I=>{m(I),t&&rt(t,{autoDeployEnabled:o,selectedEnvironmentId:I,restartAfterSync:g})},h=I=>{x(I),t&&rt(t,{autoDeployEnabled:o,selectedEnvironmentId:d,restartAfterSync:I})},C=I=>{y(I),t&&Ft(t,{inputMessage:I,messageHistoryIndex:k})},N=I=>{F(I),t&&Ft(t,{inputMessage:u,messageHistoryIndex:I})};Lt({onMessageReceived:(I,X)=>{I===+t&&ee(+t)},onMessageStatusChanged:(I,X,oe,be)=>{I===+t&&ee(+t)}},{autoConnect:!0,sessionId:t}),$s({sessionId:+t,enabled:!!t,pingInterval:1e4});const{tabs:j,activeTabId:A,session:D,isSessionReadonly:b,openFile:T,openDiff:P,openTask:q,closeTab:M,switchTab:U,mergeToMain:Y,pushBranch:R,pullFromStarterBranch:f,resetSession:p,cancelSession:$,stopWorkingMessages:V,openWithVSCode:W}=Ys(+t),{updateSession:_}=xe(),{editors:Q}=ht(),te=Q.some(I=>(I.id==="vscode"||I.id==="vscode-insiders")&&I.isAvailable),{fetchGitStatus:ee}=pt(),{messages:E}=Rt(+t),B=E.length,w=async(I,X,oe,be=!1)=>{a({isActive:!0,title:X,message:oe});try{const Ue=await I();return be&&i.current&&i.current(),Ue}finally{a({isActive:!1,title:"",message:""})}},L=()=>w(p,"Resetting Session","Please wait while the session is being reset...",!0),J=()=>w($,"Canceling Session","Please wait while the session is being canceled..."),K=()=>w(V,"Stopping Progress","Please wait while stopping working messages..."),se=()=>w(W,"Opening with VSCode","Please wait while opening session with VSCode..."),ce=()=>{o&&d?w(async()=>(await ut(+t,+d,g),{message:"Deployment completed successfully"}),"Deploying to Environment","Please wait while deploying to the selected environment..."):r(!0)},H=I=>{if(D){const X={...D,name:I};_(X)}},de=j.find(I=>I.id===A),Ge=de?.content.type==="file"?de.content.path:null,z=de?.content.type==="file"?"files":de?.content.type==="diff"?"git":de?.content.type==="task"?"tasks":null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex h-full min-h-0",children:[e.jsx(sa,{sessionId:+t,activeFilePath:Ge,suggestedSidebarTab:z,isSessionReadonly:b,session:D,onOpenFile:T,onOpenDiff:P,onOpenTask:q,onMergeToMain:Y,onPushBranch:R,onPullFromStarterBranch:f,onResetSession:L,onCancelSession:J,onStopWorkingMessages:K,onOpenWithVSCode:se,isVSCodeAvailable:te,onDeployToEnvironment:ce,onSessionNameUpdate:H,autoDeployEnabled:o,selectedEnvironmentId:d,restartAfterSync:g,onAutoDeployChange:S,onSelectedEnvironmentIdChange:v,onRestartAfterSyncChange:h,messagesCount:B}),e.jsx(xa,{tabs:j,activeTabId:A,sessionId:+t,isSessionReadonly:b,session:D,onCloseTab:M,onSwitchTab:U,onOpenFile:T,onClearMessagesRef:I=>{i.current=I},autoDeployEnabled:o,selectedEnvironmentId:d,restartAfterSync:g,onAutoDeployChange:S,onSelectedEnvironmentIdChange:v,chatInputMessage:u,messageHistoryIndex:k,onChatInputMessageChange:C,onMessageHistoryIndexChange:N})]}),e.jsx(_s,{isOpen:s.isActive,title:s.title,message:s.message}),e.jsx(pa,{isOpen:n,onClose:()=>r(!1),sessionId:+t,workspaceId:D?.workspaceId})]})}function ka(){const t=ct(),{workspaces:s,addSession:a}=xe(),[n,r]=c.useState([]),[i,o]=c.useState(!0),[l,d]=c.useState(null),[m,g]=c.useState(new Set),[x,u]=c.useState(!1),[y,k]=c.useState(!1),[F,S]=c.useState(!1),[v,h]=c.useState(!1),[C,N]=c.useState(!1),[j,A]=c.useState(null),[D,b]=c.useState([]),[T,P]=c.useState(ie.InMind),[q,M]=c.useState(void 0),[U,Y]=c.useState({title:"",description:"",status:ie.InMind,tags:[]}),[R,f]=c.useState({search:"",status:"All",tags:"",workspace:"All"}),[p,$]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});c.useEffect(()=>{V()},[]);const V=async()=>{o(!0);try{const G=await Fe.getAll();r(G)}catch(G){console.error("Failed to load data:",G)}finally{o(!1)}},W=c.useMemo(()=>{const G=n.flatMap(z=>z.tags||[]);return[...new Set(G)].sort()},[n]),_=c.useMemo(()=>n.filter(G=>{const z=R.search===""||G.title.toLowerCase().includes(R.search.toLowerCase())||G.description.toLowerCase().includes(R.search.toLowerCase()),I=R.status==="All"||R.status==="In mind"&&G.status===ie.InMind||R.status==="Ready"&&G.status===ie.Ready||R.status==="In Progress"&&G.status===ie.InProgress||R.status==="Done"&&G.status===ie.Done||R.status==="Canceled"&&G.status===ie.Canceled,X=R.tags===""||G.tags&&G.tags.some(be=>be.toLowerCase().includes(R.tags.toLowerCase())),oe=R.workspace==="All"||R.workspace==="No workspace"&&!G.workspaceId||G.workspaceId&&s.find(be=>be.id===G.workspaceId)?.name===R.workspace;return z&&I&&X&&oe}),[n,R,s]);return{backlogs:n,workspaces:s,loading:i,selectedBacklog:l,selectedBacklogs:m,showForm:x,showBulkTagsModal:y,setShowBulkTagsModal:k,showBulkStatusModal:F,setShowBulkStatusModal:S,showBulkWorkspaceModal:v,setShowBulkWorkspaceModal:h,showStartSessionModal:C,setShowStartSessionModal:N,selectedBacklogForSession:j,setSelectedBacklogForSession:A,bulkTagsToAdd:D,setBulkTagsToAdd:b,bulkStatusToSet:T,setBulkStatusToSet:P,bulkWorkspaceToSet:q,setBulkWorkspaceToSet:M,formData:U,setFormData:Y,setShowForm:u,setSelectedBacklog:d,handleSave:async()=>{try{if(l){const G=await Fe.update(l.id,U);r(z=>z.map(I=>I.id===l.id?G:I))}else{const G=Array.isArray(U.tags)?U.tags:[],z={title:U.title,description:U.description,status:ie.InMind,tags:G,workspaceId:U.workspaceId,sessionId:U.sessionId},I=await Fe.create(z);r(X=>[...X,I])}u(!1),d(null)}catch(G){console.error("Failed to save backlog:",G)}},handleDelete:async G=>{try{await Fe.delete(G),r(z=>z.filter(I=>I.id!==G)),$({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(z){console.error("Failed to delete backlog:",z)}},handleEdit:G=>{d(G),Y({title:G.title,description:G.description,status:G.status,tags:G.tags||[],workspaceId:G.workspaceId,sessionId:G.sessionId}),u(!0)},handleCreate:()=>{d(null),Y({title:"",description:"",status:ie.InMind,tags:[],workspaceId:void 0,sessionId:void 0}),u(!0)},handleBulkDelete:async()=>{try{await Promise.all(Array.from(m).map(G=>Fe.delete(G))),r(G=>G.filter(z=>!m.has(z.id))),g(new Set),$({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(G){console.error("Failed to delete backlogs:",G)}},handleBulkAddTags:async()=>{try{const G=Array.from(m).map(async I=>{const X=n.find(oe=>oe.id===I);if(X){const oe=X.tags||[],be=[...new Set([...oe,...D])];return await Fe.update(I,{title:X.title,description:X.description,status:X.status,tags:be,workspaceId:X.workspaceId,sessionId:X.sessionId})}return null});(await Promise.all(G)).forEach(I=>{I&&r(X=>X.map(oe=>oe.id===I.id?I:oe))}),g(new Set),k(!1),b([])}catch(G){console.error("Failed to add tags to backlogs:",G)}},handleBulkChangeStatus:async()=>{try{const G=Array.from(m).map(async I=>{const X=n.find(oe=>oe.id===I);return X?await Fe.update(I,{title:X.title,description:X.description,status:T,tags:X.tags||[],workspaceId:X.workspaceId,sessionId:X.sessionId}):null});(await Promise.all(G)).forEach(I=>{I&&r(X=>X.map(oe=>oe.id===I.id?I:oe))}),g(new Set),S(!1)}catch(G){console.error("Failed to change status of backlogs:",G)}},handleBulkChangeWorkspace:async()=>{try{const G=Array.from(m).map(async I=>{const X=n.find(oe=>oe.id===I);return X?await Fe.update(I,{title:X.title,description:X.description,status:X.status,tags:X.tags||[],workspaceId:q,sessionId:X.sessionId}):null});(await Promise.all(G)).forEach(I=>{I&&r(X=>X.map(oe=>oe.id===I.id?I:oe))}),g(new Set),h(!1)}catch(G){console.error("Failed to change workspace of backlogs:",G)}},handleStartSession:G=>{A(G),N(!0)},handleCreateSession:async G=>{try{const z=n.find(be=>be.id===G.backlogId),I=z?z.title:null,X=await Z.create({workspaceId:G.workspaceId,starterGitBranch:G.starterGitBranch,agentId:G.agentId,name:I});a(X);const oe=await Fe.update(G.backlogId,{sessionId:X.id});r(be=>be.map(Ue=>Ue.id===G.backlogId?oe:Ue)),await qe.send(X.id,{content:G.initialMessage}),N(!1),A(null),t(`/session/${X.id}`)}catch(z){console.error("Failed to create session:",z)}},handleOpenSession:G=>{t(`/session/${G}`)},toggleBacklogSelection:G=>{g(z=>{const I=new Set(z);return I.has(G)?I.delete(G):I.add(G),I})},selectAllBacklogs:()=>{g(new Set(_.map(G=>G.id)))},clearSelection:()=>{g(new Set)},filteredBacklogs:_,filters:R,setFilters:f,confirmDialog:p,setConfirmDialog:$,availableTags:W}}function Ht({selectedTags:t,availableTags:s,onChange:a,placeholder:n="Type to add tags..."}){const[r,i]=c.useState(""),[o,l]=c.useState([]),[d,m]=c.useState(!1),[g,x]=c.useState(-1),u=c.useRef(null),y=c.useRef(null);c.useEffect(()=>{if(r.trim()){const h=s.filter(C=>!t.includes(C)&&C.toLowerCase().includes(r.toLowerCase()));l(h),m(h.length>0)}else m(!1),l([]);x(-1)},[r,s,t]);const k=h=>{const C=h.trim();if(C&&!t.includes(C)){const N=[...t,C];a(N)}i(""),m(!1),x(-1)},F=h=>{a(t.filter(C=>C!==h))},S=h=>{h.key==="Enter"?(h.preventDefault(),g>=0&&o[g]?k(o[g]):r.trim()&&k(r)):h.key==="ArrowDown"?(h.preventDefault(),x(C=>C<o.length-1?C+1:C)):h.key==="ArrowUp"?(h.preventDefault(),x(C=>C>0?C-1:-1)):h.key==="Escape"?(m(!1),x(-1)):h.key==="Backspace"&&!r&&t.length>0?F(t[t.length-1]):(h.key===","||h.key==="Tab")&&(h.preventDefault(),r.trim()&&k(r))},v=h=>{u.current&&!u.current.contains(h.target)&&y.current&&!y.current.contains(h.target)&&(m(!1),x(-1))};return c.useEffect(()=>(document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)),[]),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 p-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 min-h-[42px] focus-within:ring-2 focus-within:ring-purple-500 focus-within:border-transparent",children:[t.map(h=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-sm rounded",children:[h,e.jsx("button",{type:"button",onClick:()=>F(h),className:"ml-1 text-purple-600 dark:text-purple-300 hover:text-purple-800 dark:hover:text-purple-100",children:e.jsx(Qe,{className:"w-3 h-3"})})]},h)),e.jsx("input",{ref:u,type:"text",value:r,onChange:h=>i(h.target.value),onKeyDown:S,onFocus:()=>{o.length>0&&m(!0)},placeholder:t.length===0?n:"",className:"flex-1 outline-none bg-transparent text-neutral-900 dark:text-neutral-100 min-w-[120px]"})]}),d&&o.length>0&&e.jsx("div",{ref:y,className:"absolute top-full left-0 right-0 z-10 mt-1 bg-white dark:bg-neutral-700 border border-neutral-300 dark:border-neutral-600 rounded-md shadow-lg max-h-40 overflow-y-auto",children:o.map((h,C)=>e.jsx("button",{type:"button",onClick:()=>k(h),className:`w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-600 ${C===g?"bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200":"text-neutral-900 dark:text-neutral-100"}`,children:h},h))})]})}function ja({isOpen:t,selectedBacklog:s,formData:a,setFormData:n,onSave:r,onClose:i,availableTags:o,workspaces:l}){const[d,m]=c.useState({}),g=()=>{const y={};return a.title.trim()?a.title.length>255&&(y.title="Title must be 255 characters or less"):y.title="Title is required",m(y),Object.keys(y).length===0},x=()=>{g()&&(r(),m({}))},u=()=>{m({}),i()};return e.jsx(ue,{isOpen:t,onClose:u,title:s?"Edit Backlog":"Create Backlog",size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:x,children:s?"Update":"Create"}),e.jsx(O,{variant:"ghost",onClick:u,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:a.title,onChange:y=>n({...a,title:y.target.value}),className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${d.title?"border-red-500 dark:border-red-400 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,placeholder:"Enter backlog title"}),d.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:y=>n({...a,description:y.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",rows:3,placeholder:"Enter backlog description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Status"}),e.jsxs("select",{value:a.status,onChange:y=>n({...a,status:parseInt(y.target.value)}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",children:[e.jsx("option",{value:ie.InMind,children:"In mind"}),e.jsx("option",{value:ie.Ready,children:"Ready"}),e.jsx("option",{value:ie.InProgress,children:"In Progress"}),e.jsx("option",{value:ie.Done,children:"Done"}),e.jsx("option",{value:ie.Canceled,children:"Canceled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Workspace (optional)"}),e.jsxs("select",{value:a.workspaceId||"",onChange:y=>n({...a,workspaceId:y.target.value?parseInt(y.target.value):void 0}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",children:[e.jsx("option",{value:"",children:"No workspace"}),l.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Tags"}),e.jsx(Ht,{selectedTags:a.tags||[],availableTags:o,onChange:y=>n({...a,tags:y}),placeholder:"Type to add tags (press Enter, Tab, or comma to add)"})]})]})})}function va({isOpen:t,selectedCount:s,bulkTags:a,setBulkTags:n,availableTags:r,onSave:i,onClose:o}){return e.jsx(ue,{isOpen:t,onClose:o,title:`Add Tags to ${s} Backlogs`,size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:i,disabled:a.length===0,children:"Add Tags"}),e.jsx(O,{variant:"ghost",onClick:o,children:"Cancel"})]}),children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Tags to Add"}),e.jsx(Ht,{selectedTags:a,availableTags:r,onChange:n,placeholder:"Type to add tags to selected backlogs"}),e.jsxs("p",{className:"mt-1 text-sm text-neutral-500 dark:text-neutral-400",children:["These tags will be added to all ",s," selected backlogs."]})]})})})}function wa({isOpen:t,selectedCount:s,bulkStatus:a,setBulkStatus:n,onSave:r,onClose:i}){return e.jsx(ue,{isOpen:t,onClose:i,title:`Change Status of ${s} Backlogs`,size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:r,children:"Change Status"}),e.jsx(O,{variant:"ghost",onClick:i,children:"Cancel"})]}),children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"New Status"}),e.jsxs("select",{value:a,onChange:o=>n(parseInt(o.target.value)),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",children:[e.jsx("option",{value:ie.InMind,children:"In mind"}),e.jsx("option",{value:ie.Ready,children:"Ready"}),e.jsx("option",{value:ie.InProgress,children:"In Progress"}),e.jsx("option",{value:ie.Done,children:"Done"}),e.jsx("option",{value:ie.Canceled,children:"Canceled"})]}),e.jsxs("p",{className:"mt-1 text-sm text-neutral-500 dark:text-neutral-400",children:["This status will be applied to all ",s," selected backlogs."]})]})})})}function Na({isOpen:t,selectedCount:s,bulkWorkspaceId:a,setBulkWorkspaceId:n,workspaces:r,onSave:i,onClose:o}){return e.jsx(ue,{isOpen:t,onClose:o,title:`Set Workspace for ${s} Backlogs`,size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:i,children:"Set Workspace"}),e.jsx(O,{variant:"ghost",onClick:o,children:"Cancel"})]}),children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Workspace"}),e.jsxs("select",{value:a||"",onChange:l=>n(l.target.value?parseInt(l.target.value):void 0),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",children:[e.jsx("option",{value:"",children:"No workspace"}),r.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),e.jsxs("p",{className:"mt-1 text-sm text-neutral-500 dark:text-neutral-400",children:["This workspace will be assigned to all ",s," selected backlogs."]})]})})})}function Sa({isOpen:t,backlog:s,workspaces:a,onCreateSession:n,onCancel:r}){const[i,o]=c.useState(""),[l,d]=c.useState(null),[m,g]=c.useState(null),[x,u]=c.useState([]),[y,k]=c.useState(!1);c.useEffect(()=>{t&&s&&(F(),o(""),d(s.workspaceId||null),g(null))},[t,s]),c.useEffect(()=>{if(l){if(x.length>0){const A=ke.getLastAgent(l);A&&x.some(D=>D.id===A)?g(A):g(null)}const j=ke.getLastBranch(l);o(j||"")}else o(""),g(null)},[l,x]);const F=async()=>{try{k(!0);const j=await Ee.getAll();if(u(j),l){const A=ke.getLastAgent(l);A&&j.some(D=>D.id===A)&&g(A)}}catch(j){console.error("Failed to load agents:",j)}finally{k(!1)}},S=()=>{if(!l||!i||!m||!s)return;ke.saveLastBranch(l,i),ke.saveLastAgent(l,m);const j=`${s.title}

${s.description}`;n({workspaceId:l,starterGitBranch:i,agentId:m,backlogId:s.id,initialMessage:j})},v=l&&i.trim()&&m,h=!s?.workspaceId,C=a.map(j=>({value:j.id.toString(),label:j.name})),N=x.map(j=>({value:j.id.toString(),label:`${j.name} (${j.roleName})`}));return e.jsx(ue,{isOpen:t,onClose:r,title:`Start Session for "${s?.title}"`,size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:S,disabled:!v||y,children:"Start Session"}),e.jsx(O,{variant:"ghost",onClick:r,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-4",children:[h&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Workspace"}),e.jsx(Pe,{options:C,value:l?.toString(),placeholder:"Select workspace",onSelect:j=>{d(parseInt(j.value))}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Start Git Branch"}),l?e.jsx(xt,{workspaceId:l,value:i,onSelect:j=>{o(j),l&&ke.saveLastBranch(l,j)},placeholder:"Select git branch"}):e.jsx("div",{className:"px-3 py-2 text-neutral-500 dark:text-neutral-400",children:"Select workspace first"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Agent"}),y?e.jsx("div",{className:"px-3 py-2 text-neutral-500 dark:text-neutral-400",children:"Loading agents..."}):e.jsx(Pe,{options:N,value:m?.toString(),placeholder:"Select agent",onSelect:j=>g(parseInt(j.value))})]}),e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-700 p-3 rounded-md",children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Initial Message"}),e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-300 whitespace-pre-wrap",children:s?`${s.title}

${s.description}`:""})]})]})})}function Ca(){const{backlogs:t,workspaces:s,loading:a,selectedBacklog:n,selectedBacklogs:r,showForm:i,showBulkTagsModal:o,setShowBulkTagsModal:l,showBulkStatusModal:d,setShowBulkStatusModal:m,showBulkWorkspaceModal:g,setShowBulkWorkspaceModal:x,showStartSessionModal:u,setShowStartSessionModal:y,selectedBacklogForSession:k,setSelectedBacklogForSession:F,bulkTagsToAdd:S,setBulkTagsToAdd:v,bulkStatusToSet:h,setBulkStatusToSet:C,bulkWorkspaceToSet:N,setBulkWorkspaceToSet:j,formData:A,setFormData:D,setShowForm:b,setSelectedBacklog:T,handleSave:P,handleDelete:q,handleEdit:M,handleCreate:U,handleBulkDelete:Y,handleBulkAddTags:R,handleBulkChangeStatus:f,handleBulkChangeWorkspace:p,handleStartSession:$,handleCreateSession:V,handleOpenSession:W,toggleBacklogSelection:_,selectAllBacklogs:Q,clearSelection:te,filteredBacklogs:ee,filters:E,setFilters:B,confirmDialog:w,setConfirmDialog:L,availableTags:J}=ka(),K=H=>{switch(H){case ie.InMind:return"In mind";case ie.Ready:return"Ready";case ie.InProgress:return"In Progress";case ie.Done:return"Done";case ie.Canceled:return"Canceled";default:return"Unknown"}},se=H=>{switch(H){case ie.InMind:return"bg-neutral-100 text-neutral-800 dark:bg-neutral-700 dark:text-neutral-300";case ie.Ready:return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";case ie.InProgress:return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case ie.Done:return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case ie.Canceled:return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-neutral-100 text-neutral-800 dark:bg-neutral-700 dark:text-neutral-300"}},ce=["All","In mind","Ready","In Progress","Done","Canceled"];return a?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg",children:"Loading backlogs..."})}):e.jsxs("div",{className:"flex flex-col h-full bg-neutral-50 dark:bg-neutral-900",children:[e.jsxs("div",{className:"p-6 border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-neutral-900 dark:text-neutral-100",children:"Backlogs"}),r.size>0&&e.jsxs("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mt-1",children:[r.size," backlog",r.size>1?"s":""," selected"]})]}),e.jsx("div",{className:"flex gap-2",children:r.size>0?e.jsxs(e.Fragment,{children:[e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>l(!0),children:[e.jsx(xs,{className:"w-4 h-4 mr-2"}),"Add Tags"]}),e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>m(!0),children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Change Status"]}),e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>x(!0),children:[e.jsx(kt,{className:"w-4 h-4 mr-2"}),"Set Workspace"]}),e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>L({isOpen:!0,title:"Delete Backlogs",message:`Are you sure you want to delete ${r.size} backlog${r.size>1?"s":""}? This action cannot be undone.`,onConfirm:Y}),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Delete"]}),e.jsxs(O,{variant:"ghost",size:"sm",onClick:te,children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Clear"]})]}):e.jsxs(O,{onClick:U,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Create Backlog"]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ps,{className:"w-4 h-4 text-neutral-500 dark:text-neutral-400"}),e.jsx("input",{type:"text",placeholder:"Search backlogs...",value:E.search,onChange:H=>B({...E,search:H.target.value}),className:"px-3 py-1.5 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"w-4 h-4 text-neutral-500 dark:text-neutral-400"}),e.jsx("select",{value:E.status,onChange:H=>B({...E,status:H.target.value}),className:"px-3 py-1.5 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 text-sm",children:ce.map(H=>e.jsx("option",{value:H,children:H},H))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Tags:"}),e.jsx("input",{type:"text",placeholder:"Filter by tags...",value:E.tags,onChange:H=>B({...E,tags:H.target.value}),className:"px-3 py-1.5 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kt,{className:"w-4 h-4 text-neutral-500 dark:text-neutral-400"}),e.jsxs("select",{value:E.workspace,onChange:H=>B({...E,workspace:H.target.value}),className:"px-3 py-1.5 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 text-sm",children:[e.jsx("option",{value:"All",children:"All Workspaces"}),e.jsx("option",{value:"No workspace",children:"No workspace"}),s.map(H=>e.jsx("option",{value:H.name,children:H.name},H.id))]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ee.length>0&&r.size===ee.length,onChange:H=>{H.target.checked?Q():te()},className:"rounded border-neutral-300 dark:border-neutral-600"}),e.jsx("span",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Select all"})]}),e.jsxs("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:[ee.length," of ",t.length," backlogs"]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:ee.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:t.length===0?"No backlogs found":"No backlogs match your filters"}),t.length===0&&e.jsxs(O,{onClick:U,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Create your first backlog"]})]}):e.jsx("div",{className:"bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-700 border-b border-neutral-200 dark:border-neutral-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 w-12",children:e.jsx("input",{type:"checkbox",checked:ee.length>0&&r.size===ee.length,onChange:H=>{H.target.checked?Q():te()},className:"rounded border-neutral-300 dark:border-neutral-600"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Title"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Workspace"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Tags"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Session"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs text-neutral-500 dark:text-neutral-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-600",children:ee.map(H=>e.jsxs("tr",{className:r.has(H.id)?"bg-purple-50 dark:bg-purple-900/20":"",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:r.has(H.id),onChange:()=>_(H.id),className:"rounded border-neutral-300 dark:border-neutral-600"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:H.title})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(Se,{className:se(H.status),children:K(H.status)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-300",children:H.workspaceId?s.find(de=>de.id===H.workspaceId)?.name||"Unknown":"No workspace"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:H.tags&&H.tags.length>0?H.tags.map((de,Ge)=>e.jsx("span",{className:"px-2 py-1 bg-neutral-100 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300 text-xs rounded",children:de},Ge)):e.jsx("span",{className:"text-neutral-400 dark:text-neutral-500 text-xs",children:"No tags"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-300 max-w-xs truncate",children:H.description})}),e.jsx("td",{className:"px-6 py-4",children:H.sessionId?e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>W(H.sessionId),children:[e.jsx(lt,{className:"w-4 h-4 mr-2"}),"Open"]}):e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>$(H),children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Start"]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>M(H),children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>L({isOpen:!0,title:"Delete Backlog",message:`Are you sure you want to delete "${H.title}"? This action cannot be undone.`,onConfirm:()=>q(H.id)}),children:e.jsx(Ce,{className:"w-4 h-4"})})]})})]},H.id))})]})})}),e.jsx(ja,{isOpen:i,selectedBacklog:n,formData:A,setFormData:D,onSave:P,onClose:()=>{b(!1),T(null)},availableTags:J,workspaces:s}),e.jsx(va,{isOpen:o,selectedCount:r.size,bulkTags:S,setBulkTags:v,availableTags:J,onSave:R,onClose:()=>{l(!1),v([])}}),e.jsx(wa,{isOpen:d,selectedCount:r.size,bulkStatus:h,setBulkStatus:C,onSave:f,onClose:()=>m(!1)}),e.jsx(Na,{isOpen:g,selectedCount:r.size,bulkWorkspaceId:N,setBulkWorkspaceId:j,workspaces:s,onSave:p,onClose:()=>x(!1)}),e.jsx(Sa,{isOpen:u,backlog:k,workspaces:s,onCreateSession:V,onCancel:()=>{y(!1),F(null)}}),e.jsx($e,{isOpen:w.isOpen,title:w.title,message:w.message,onConfirm:()=>{w.onConfirm(),L({isOpen:!1,title:"",message:"",onConfirm:()=>{}})},onCancel:()=>L({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),variant:"danger",confirmText:"Delete"})]})}function Fa(){const[t,s]=c.useState([]),[a,n]=c.useState([]),[r,i]=c.useState(!0),[o,l]=c.useState(null),[d,m]=c.useState(!1),[g,x]=c.useState({name:"",roleName:"",model:"",systemPrompt:"",mcpIds:[],mcps:[]}),[u,y]=c.useState({}),[k,F]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});c.useEffect(()=>{S(),v()},[]);const S=async()=>{i(!0);try{const b=await Ee.getAll();s(b)}catch(b){console.error("Failed to load agents:",b)}finally{i(!1)}},v=async()=>{try{const b=await We.getAll();n(b)}catch(b){console.error("Failed to load MCPs:",b)}},h=()=>{l(null),x({name:"",roleName:"",model:"",systemPrompt:"",mcpIds:[],mcps:[]}),y({}),m(!0)},C=b=>{l(b),x({name:b.name,roleName:b.roleName,model:b.model,systemPrompt:b.systemPrompt,mcpIds:b.mcpIds,mcps:b.mcps?.map(T=>T.name)??[]}),y({}),m(!0)},N=async()=>{y({});const b={};if(g.name.trim()||(b.name="Name is required"),g.model.trim()||(b.model="Please select a model for this agent"),Object.keys(b).length>0){y(b);return}try{if(o){const T={name:g.name,roleName:g.roleName,model:g.model,systemPrompt:g.systemPrompt,mcpIds:g.mcpIds},P=await Ee.update(o.id,T);s(q=>q?.map(M=>M.id===o.id?P:M))}else{const T={name:g.name,roleName:g.roleName,model:g.model,systemPrompt:g.systemPrompt,mcpIds:g.mcpIds},P=await Ee.create(T);s(q=>[...q,P])}m(!1),l(null)}catch(T){console.error("Failed to save agent:",T)}},j=async b=>{try{await Ee.delete(b),s(T=>T.filter(P=>P.id!==b)),F({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(T){console.error("Failed to delete agent:",T)}};return{agents:t,mcps:a,loading:r,selectedAgent:o,showForm:d,formData:g,formErrors:u,setFormData:x,setShowForm:m,setSelectedAgent:l,handleSave:N,handleDelete:j,handleDeleteConfirm:(b,T)=>{F({isOpen:!0,title:"Delete Agent",message:`Are you sure you want to delete "${T}"? This action cannot be undone.`,onConfirm:()=>j(b)})},handleModalClose:()=>{m(!1),l(null)},handleEdit:C,handleCreate:h,confirmDialog:k,setConfirmDialog:F}}function Ta({isOpen:t,onClose:s,onSave:a,selectedAgent:n,formData:r,formErrors:i,mcps:o,setFormData:l}){return e.jsx(ue,{isOpen:t,onClose:s,title:n?"Edit Agent":"Create Agent",size:"md",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:a,children:n?"Update":"Create"}),e.jsx(O,{variant:"ghost",onClick:s,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:r.name,onChange:d=>l({...r,name:d.target.value}),className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${i.name?"border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,placeholder:"Enter agent name",required:!0}),i.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Role Name"}),e.jsx("input",{type:"text",value:r.roleName,onChange:d=>l({...r,roleName:d.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",placeholder:"e.g., Frontend Developer, QA Engineer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Model *"}),e.jsxs("select",{value:r.model,onChange:d=>l({...r,model:d.target.value}),required:!0,className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${i.model?"border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,children:[e.jsx("option",{value:"",children:"Select a model"}),e.jsx("option",{value:"claude-code",children:"Claude Code"})]}),i.model&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.model})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"System Prompt"}),e.jsx("textarea",{value:r.systemPrompt,onChange:d=>l({...r,systemPrompt:d.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",rows:6,placeholder:"Enter the system prompt that defines the agent's behavior and role"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"MCPs"}),e.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto border border-neutral-300 dark:border-neutral-600 rounded-md p-2 bg-white dark:bg-neutral-700",children:[o.map(d=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:r.mcpIds.includes(d.id),onChange:m=>{m.target.checked?l({...r,mcpIds:[...r.mcpIds,d.id]}):l({...r,mcpIds:r.mcpIds.filter(g=>g!==d.id)})},className:"rounded border-neutral-300 text-purple-600"}),e.jsx("span",{className:"text-sm text-neutral-900 dark:text-neutral-100",children:d.name})]},d.id)),o.length===0&&e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400 text-center py-2",children:"No MCPs available"})]})]})]})})}function Ea({agent:t,onEdit:s,onDelete:a}){return e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(fs,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-neutral-900 dark:text-neutral-100",children:t.name}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:t.roleName})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(t),children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>a(t.id,t.name),children:e.jsx(Ce,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsx(Se,{className:"font-mono",children:t.model})}),t.mcps?.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:"MCPs:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.mcps.map((n,r)=>e.jsxs(Se,{className:"bg-green-100 text-green-800",children:[e.jsx(nt,{className:"w-3 h-3 mr-1"}),n.name]},r))})]})]})]})}function Aa(){const{agents:t,mcps:s,loading:a,selectedAgent:n,showForm:r,formData:i,formErrors:o,setFormData:l,handleSave:d,handleDeleteConfirm:m,handleModalClose:g,handleEdit:x,handleCreate:u,confirmDialog:y,setConfirmDialog:k}=Fa();return a?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg",children:"Loading agents..."})}):e.jsxs("div",{className:"flex flex-col h-full bg-neutral-50 dark:bg-neutral-900",children:[e.jsx("div",{className:"p-6 border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-neutral-900 dark:text-neutral-100",children:"Agents"}),e.jsxs(O,{onClick:u,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Create Agent"]})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:"No agents found"}),e.jsxs(O,{onClick:u,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Create your first agent"]})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:t?.map(F=>e.jsx(Ea,{agent:F,onEdit:x,onDelete:m},F.id))})}),e.jsx(Ta,{isOpen:r,onClose:g,onSave:d,selectedAgent:n,formData:i,formErrors:o,mcps:s,setFormData:l}),e.jsx($e,{isOpen:y.isOpen,title:y.title,message:y.message,onConfirm:()=>{y.onConfirm(),k({isOpen:!1,title:"",message:"",onConfirm:()=>{}})},onCancel:()=>k({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),variant:"danger",confirmText:"Delete"})]})}function $a(){const{workspaces:t,addWorkspace:s,updateWorkspace:a,removeWorkspace:n}=xe(),[r,i]=c.useState(!1),[o,l]=c.useState(null),[d,m]=c.useState(!1),[g,x]=c.useState({name:"",gitRepository:""}),[u,y]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});return{workspaces:t,loading:r,selectedWorkspace:o,showForm:d,formData:g,setFormData:x,setShowForm:m,setSelectedWorkspace:l,handleSave:async()=>{i(!0);try{if(o){const h={name:g.name},C=await Me.update(o.id,h);a(o.id,C)}else{const h={name:g.name,gitRepository:g.gitRepository},C=await Me.create(h);s(C)}m(!1),l(null)}catch(h){console.error("Failed to save workspace:",h)}finally{i(!1)}},handleDelete:async h=>{i(!0);try{await Me.delete(h),n(h),y({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(C){console.error("Failed to delete workspace:",C)}finally{i(!1)}},handleEdit:h=>{l(h),x({name:h.name,gitRepository:h.gitRepository}),m(!0)},handleCreate:()=>{l(null),x({name:"",gitRepository:""}),m(!0)},confirmDialog:u,setConfirmDialog:y}}function Da(){const{workspaces:t,loading:s,selectedWorkspace:a,showForm:n,formData:r,setFormData:i,setShowForm:o,setSelectedWorkspace:l,handleSave:d,handleDelete:m,handleEdit:g,handleCreate:x,confirmDialog:u,setConfirmDialog:y}=$a();return s?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg",children:"Loading workspaces..."})}):e.jsxs("div",{className:"flex flex-col h-full bg-neutral-50 dark:bg-neutral-900",children:[e.jsx("div",{className:"p-6 border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-neutral-900 dark:text-neutral-100",children:"Workspaces"}),e.jsxs(O,{onClick:x,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Create Workspace"]})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:"No workspaces found"}),e.jsxs(O,{onClick:x,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Create your first workspace"]})]}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:t.map(k=>e.jsx(Ps,{workspace:k,onEdit:g,onDelete:F=>y({isOpen:!0,title:"Delete Workspace",message:`Are you sure you want to delete "${k.name}"? This will also delete all associated sessions, environments, and tasks.`,onConfirm:()=>m(F)})},k.id))})}),e.jsx(zt,{isOpen:n,workspace:a,formData:r,setFormData:i,onSave:d,onCancel:()=>{o(!1),l(null)}}),e.jsx($e,{isOpen:u.isOpen,title:u.title,message:u.message,onConfirm:()=>{u.onConfirm(),y({isOpen:!1,title:"",message:"",onConfirm:()=>{}})},onCancel:()=>y({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),variant:"danger",confirmText:"Delete"})]})}function Ma(){const{workspaceId:t}=Pt(),{workspaces:s,updateWorkspace:a}=xe(),{addEnvironment:n,updateEnvironment:r,removeEnvironment:i}=gt(),[o,l]=c.useState(null),[d,m]=c.useState(!0),[g,x]=c.useState({name:"",gitRepository:""}),[u,y]=c.useState(!1),{environments:k,loading:F}=Je({workspaceId:+t,autoLoad:!0}),{refreshTasks:S}=Vt(+t),[v,h]=c.useState(null),[C,N]=c.useState(!1),[j,A]=c.useState({name:"",gitBranch:"",url:"",environmentVariables:{}}),[D,b]=c.useState([]),[T,P]=c.useState(!0),[q,M]=c.useState(null),[U,Y]=c.useState(!1),[R,f]=c.useState({name:"",type:null,workingDirectory:"",scriptType:ye.Bash,scriptContent:""}),[p,$]=c.useState({}),[V,W]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});c.useEffect(()=>{t&&(_(),Q())},[t]);const _=async()=>{if(t){m(!0);try{const z=s.find(I=>I.id===Number(t));if(z)l(z);else{const I=await Me.getById(Number(t));l(I)}}catch(z){console.error("Failed to load workspace:",z)}finally{m(!1)}}},Q=async()=>{if(!t){P(!1);return}P(!0);try{const z=await ve.getByWorkspaceId(Number(t));b(z)}catch(z){console.error("Failed to load tasks:",z)}finally{P(!1)}},te=()=>{o&&(x({name:o.name,gitRepository:o.gitRepository}),y(!0))},ee=async()=>{if(o)try{const z={name:g.name},I=await Me.update(o.id,z);l(I),a(o.id,I),y(!1)}catch(z){console.error("Failed to update workspace:",z)}},E=()=>{h(null),A({name:"",gitBranch:"",url:"",environmentVariables:{}}),N(!0)},B=z=>{h(z),A({name:z.name,gitBranch:z.gitBranch,url:z.url||"",environmentVariables:z.environmentVariables}),N(!0)},w=async()=>{if(!t){console.error("No workspace ID available");return}try{const z=Number(t);if(v){const I=await Be.update(v.id,{name:j.name,url:j.url,environmentVariables:j.environmentVariables});r(z,I)}else{const I=await Be.create(z,{name:j.name,gitBranch:j.gitBranch,url:j.url,environmentVariables:j.environmentVariables});n(z,I)}N(!1),h(null)}catch(z){console.error("Failed to save environment:",z)}},L=async z=>{if(t)try{await Be.delete(z),i(Number(t),z),W({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(I){console.error("Failed to delete environment:",I)}},J=()=>{M(null),f({name:"",type:null,workingDirectory:"",scriptType:ye.Bash,scriptContent:""}),$({}),Y(!0)},K=z=>{M(z),f({name:z.name,type:z.type,workingDirectory:z.workingDirectory,scriptType:z.scriptType,scriptContent:z.scriptContent}),$({}),Y(!0)},se=z=>{M(null),f({name:`${z.name} Copy`,type:z.type,workingDirectory:z.workingDirectory,scriptType:z.scriptType,scriptContent:z.scriptContent}),$({}),Y(!0)},ce=()=>{const z={};return R.name.trim()||(z.name="Task name is required"),R.scriptContent.trim()||(z.scriptContent="Script content is required"),$(z),Object.keys(z).length===0},H=async()=>{if(!(!ce()||!t))try{if(q){const z={name:R.name,type:R.type,workingDirectory:R.workingDirectory,scriptType:R.scriptType,scriptContent:R.scriptContent},I=await ve.update(q.id,z);b(X=>X.map(oe=>oe.id===q.id?I:oe)),S(!0)}else{const z={name:R.name,type:R.type,workingDirectory:R.workingDirectory,scriptType:R.scriptType,scriptContent:R.scriptContent},I=await ve.create(Number(t),z);b(X=>[...X,I])}S(!0),Y(!1),M(null)}catch(z){console.error("Failed to save task:",z)}},de=async z=>{try{await ve.delete(z),b(I=>I.filter(X=>X.id!==z)),S(!0),W({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(I){console.error("Failed to delete task:",I)}};return{workspace:o,workspaceLoading:d,workspaceForm:g,showWorkspaceForm:u,setShowWorkspaceForm:y,handleWorkspaceEdit:te,handleWorkspaceSave:ee,setWorkspaceForm:x,environments:k,environmentsLoading:F,selectedEnvironment:v,showEnvironmentForm:C,environmentFormData:j,setEnvironmentFormData:A,setShowEnvironmentForm:N,setSelectedEnvironment:h,handleEnvironmentSave:w,handleEnvironmentDelete:L,handleEnvironmentEdit:B,handleEnvironmentCreate:E,tasks:D,tasksLoading:T,selectedTask:q,showTaskForm:U,taskFormData:R,taskFormErrors:p,setTaskFormData:f,handleCreateTask:J,handleEditTask:K,handleSaveTask:H,handleCloneTask:se,handleDeleteTaskConfirm:(z,I)=>{W({isOpen:!0,title:"Delete Task",message:`Are you sure you want to delete "${I}"? This action cannot be undone.`,onConfirm:()=>de(z)})},handleTaskModalClose:()=>{Y(!1),M(null)},confirmDialog:V,setConfirmDialog:W}}function Ba({environments:t,loading:s,onEditEnvironment:a,onDeleteEnvironment:n,onCloneEnvironment:r}){return s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-lg",children:"Loading environments..."})}):t.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:"No environments found"})}):t.map(i=>e.jsx(Bs,{environment:i,onEdit:a,onDelete:o=>n(o,i.name),onClone:r},i.id))}const qt=c.forwardRef(({workspace:t},s)=>{const[a,n]=c.useState([]),[r,i]=c.useState(!0),[o,l]=c.useState(!1),[d,m]=c.useState(null),[g,x]=c.useState({key:"",value:""}),[u,y]=c.useState({}),[k,F]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});c.useEffect(()=>{S()},[t.id]);const S=async()=>{i(!0);try{const b=await He.getByWorkspaceId(t.id);n(b)}catch(b){console.error("Failed to load workspace environment variables:",b)}finally{i(!1)}},v=a,h=()=>{const b={};return g.key.trim()?g.key.length>255?b.key="Variable name must be 255 characters or less":!d&&a.some(T=>T.key===g.key)&&(b.key="Variable name already exists"):b.key="Variable name is required",g.value.trim()||(b.value="Variable value is required"),y(b),Object.keys(b).length===0},C=()=>{m(null),x({key:"",value:""}),y({}),l(!0)};c.useImperativeHandle(s,()=>({addVariable:C}));const N=b=>{m(b.key),x({key:b.key,value:b.value}),y({}),l(!0)},j=async()=>{if(h())try{if(d){const b={value:g.value},T=await He.update(t.id,d,b);n(P=>P.map(q=>q.key===d?T:q))}else{const b={key:g.key,value:g.value},T=await He.create(t.id,b);n(P=>[...P,T])}l(!1),m(null)}catch(b){console.error("Failed to save workspace environment variable:",b),y({general:"Failed to save variable. Please try again."})}},A=async b=>{try{await He.delete(t.id,b),n(T=>T.filter(P=>P.key!==b)),F({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(T){console.error("Failed to delete workspace environment variable:",T)}},D=b=>{F({isOpen:!0,title:"Delete Environment Variable",message:`Are you sure you want to delete "${b.key}"? This action cannot be undone.`,onConfirm:()=>A(b.key)})};return r?e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"text-lg",children:"Loading environment variables..."})}):e.jsxs("div",{className:"space-y-6",children:[a.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:"No environment variables found"})}):e.jsx("div",{className:"space-y-4",children:v.map(b=>e.jsxs("div",{className:"flex items-center p-4 border bg-white dark:bg-neutral-800 border-neutral-200 dark:border-neutral-600 rounded-lg",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-neutral-900 dark:text-neutral-100 mb-1",children:"Variable Name"}),e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-400 font-mono bg-neutral-100 dark:bg-neutral-600 px-2 py-1 rounded",children:b.key})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-neutral-900 dark:text-neutral-100 mb-1",children:"Variable Value"}),e.jsx("div",{className:"text-sm text-neutral-600 dark:text-neutral-400 font-mono bg-neutral-100 dark:bg-neutral-600 px-2 py-1 rounded break-all",children:b.value})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>N(b),title:"Edit variable",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>D(b),title:"Delete variable",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]},b.key))}),e.jsxs(ue,{isOpen:o,onClose:()=>l(!1),title:d?"Edit Variable":"Add Variable",size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:j,children:d?"Update":"Create"}),e.jsx(O,{variant:"ghost",onClick:()=>l(!1),children:"Cancel"})]}),children:[u.general&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 dark:bg-red-900/20 border border-red-300 dark:border-red-700 rounded text-red-700 dark:text-red-300 text-sm",children:u.general}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Variable Name"}),e.jsx("input",{type:"text",value:g.key,onChange:b=>x({...g,key:b.target.value}),disabled:!!d,placeholder:"Variable name (e.g., DATABASE_URL)",className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${u.key?"border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"} ${d?"opacity-50 cursor-not-allowed bg-neutral-100 dark:bg-neutral-600":""}`}),u.key&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.key}),d&&e.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Variable name cannot be changed when editing"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Variable Value"}),e.jsx("input",{type:"text",value:g.value,onChange:b=>x({...g,value:b.target.value}),placeholder:"Variable value",className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${u.value?"border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`}),u.value&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.value})]})]})]}),e.jsx($e,{isOpen:k.isOpen,title:k.title,message:k.message,onConfirm:()=>{k.onConfirm(),F({isOpen:!1,title:"",message:"",onConfirm:()=>{}})},onCancel:()=>F({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),variant:"danger",confirmText:"Delete"})]})});qt.displayName="WorkspaceEnvironmentVariablesView";const Oa=t=>{if(t===null)return e.jsx(Le,{className:"w-5 h-5 text-neutral-600"});switch(t){case ge.Build:return e.jsx(Bt,{className:"w-5 h-5 text-purple-600"});case ge.Test:return e.jsx(Mt,{className:"w-5 h-5 text-green-600"});case ge.Start:return e.jsx(Ve,{className:"w-5 h-5 text-purple-600"});default:return e.jsx(Le,{className:"w-5 h-5 text-neutral-600"})}},Pa=t=>{if(t===null)return"bg-neutral-100 text-neutral-800 dark:bg-neutral-700 dark:text-neutral-300";switch(t){case ge.Build:return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";case ge.Test:return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case ge.Start:return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";default:return"bg-neutral-100 text-neutral-800 dark:bg-neutral-700 dark:text-neutral-300"}},Ia=t=>{if(t===null)return"No Selected";switch(t){case ge.Build:return"Build";case ge.Test:return"Test";case ge.Start:return"Start";default:return"Unknown"}},Wa=t=>{switch(t){case ye.Bash:return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300";case ye.PowerShell:return"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300";case ye.NodeJs:return"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-300";default:return"bg-neutral-100 text-neutral-800 dark:bg-neutral-700 dark:text-neutral-300"}};function La({task:t,onEdit:s,onDelete:a,onClone:n,onExecute:r}){return e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 p-6 mb-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-neutral-100 dark:bg-neutral-700 rounded-lg",children:Oa(t.type)}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-neutral-900 dark:text-neutral-100",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Se,{className:Pa(t.type),children:Ia(t.type)}),e.jsx(Se,{className:Wa(t.scriptType),children:ye[t.scriptType]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[r&&e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>r(t),className:"text-green-600 hover:text-green-700 hover:bg-green-50 dark:text-green-400 dark:hover:text-green-300 dark:hover:bg-green-900",title:"Execute task",children:e.jsx(Ve,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>n(t),title:"Clone task",children:e.jsx(Et,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(t),title:"Edit task",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>a(t.id,t.name),title:"Delete task",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-neutral-500 dark:text-neutral-400 pt-2 border-t border-neutral-200 dark:border-neutral-600",children:[e.jsxs("span",{children:["Created: ",new Date(t.createdAt).toLocaleDateString()]}),e.jsxs("span",{children:["Updated: ",new Date(t.updatedAt).toLocaleDateString()]})]})]})}function Ra({tasks:t,loading:s,onEditTask:a,onDeleteTask:n,onCloneTask:r}){return s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-lg",children:"Loading tasks..."})}):t.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:"No tasks found"})}):t.map(i=>e.jsx(La,{task:i,onEdit:a,onDelete:n,onClone:r},i.id))}function za({workspace:t,onWorkspaceEdit:s}){return e.jsx("div",{className:"p-6 border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-semibold text-neutral-900 dark:text-neutral-100",children:t.name}),e.jsx(O,{variant:"ghost",size:"sm",onClick:s,children:e.jsx(bs,{className:"w-4 h-4 mr-2"})}),e.jsx(Se,{className:"font-mono",children:t.gitRepository})]})})})}function Va({isOpen:t,onClose:s,onSave:a,selectedTask:n,formData:r,formErrors:i,setFormData:o}){return e.jsx(ue,{isOpen:t,onClose:s,title:n?"Edit Task":"Create Task",size:"xl",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:a,children:n?"Update":"Create"}),e.jsx(O,{variant:"ghost",onClick:s,children:"Cancel"})]}),children:e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:r.name,onChange:l=>o({...r,name:l.target.value}),className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${i.name?"border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,placeholder:"Enter task name"}),i.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Type"}),e.jsxs("select",{value:r.type??"",onChange:l=>o({...r,type:l.target.value===""?null:+l.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",children:[e.jsx("option",{value:"",children:"No Selected"}),Object.values(ge).filter(l=>!isNaN(Number(l))).map(l=>e.jsx("option",{value:l,children:Ua(+l)},l))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Script Type *"}),e.jsx("select",{value:r.scriptType,onChange:l=>o({...r,scriptType:+l.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",children:Object.values(ye).filter(l=>!isNaN(Number(l))).map(l=>e.jsx("option",{value:l,children:Ga(+l)},l))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:[e.jsx("span",{children:"Working Directory "}),e.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Relative paths are relative to the workspace root"})]}),e.jsx("input",{type:"text",value:r.workingDirectory,onChange:l=>o({...r,workingDirectory:l.target.value}),className:"w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 font-mono border-neutral-300 dark:border-neutral-600",placeholder:"e.g., /path/to/project or ./src"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Script Content *"}),e.jsx("textarea",{value:r.scriptContent,onChange:l=>o({...r,scriptContent:l.target.value}),className:`w-full flex-1 px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 font-mono text-sm ${i.scriptContent?"border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,rows:12,placeholder:Ha(r.scriptType)}),i.scriptContent&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.scriptContent})]})]})})}function Ga(t){switch(t){case ye.Bash:return"Bash";case ye.PowerShell:return"PowerShell";case ye.NodeJs:return"Node.js";default:return"Unknown"}}function Ua(t){if(t===null)return"No Selected";switch(t){case ge.Build:return"Build";case ge.Test:return"Test";case ge.Start:return"Start";default:return"Unknown"}}function Ha(t){switch(t){case ye.Bash:return`#!/bin/bash

# Example: Build script
npm install
npm run build`;case ye.PowerShell:return`# PowerShell script
# Example: Build script
npm install
npm run build`;case ye.NodeJs:return`// Node.js script
// Example: Build script
console.log("Starting build...");
process.exit(0);`;default:return"Enter your script content here..."}}function qa(){const t=c.useRef(null),{workspace:s,workspaceLoading:a,workspaceForm:n,showWorkspaceForm:r,setShowWorkspaceForm:i,handleWorkspaceEdit:o,handleWorkspaceSave:l,setWorkspaceForm:d,environments:m,environmentsLoading:g,selectedEnvironment:x,showEnvironmentForm:u,environmentFormData:y,setEnvironmentFormData:k,setShowEnvironmentForm:F,setSelectedEnvironment:S,handleEnvironmentSave:v,handleEnvironmentDelete:h,handleEnvironmentEdit:C,handleEnvironmentCreate:N,tasks:j,tasksLoading:A,selectedTask:D,showTaskForm:b,taskFormData:T,taskFormErrors:P,setTaskFormData:q,handleCreateTask:M,handleEditTask:U,handleCloneTask:Y,handleSaveTask:R,handleDeleteTaskConfirm:f,handleTaskModalClose:p,confirmDialog:$,setConfirmDialog:V}=Ma();return a?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg",children:"Loading workspace..."})}):s?e.jsxs("div",{className:"flex flex-col h-full bg-neutral-50 dark:bg-neutral-900",children:[e.jsx(za,{workspace:s,onWorkspaceEdit:o}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 overflow-auto p-6",children:[e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/20 rounded-lg",children:e.jsx(ks,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 dark:text-neutral-100",children:"Environments"})]}),e.jsxs(O,{onClick:N,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Create Environment"]})]}),e.jsx(Ba,{environments:m,loading:g,onEditEnvironment:C,onDeleteEnvironment:(W,_)=>V({isOpen:!0,title:"Delete Environment",message:`Are you sure you want to delete "${_}"? This action cannot be undone.`,onConfirm:()=>h(W)}),onCloneEnvironment:W=>{k({name:`${W.name} Copy`,gitBranch:W.gitBranch,url:W.url||"",environmentVariables:{...W.environmentVariables}}),S(null),F(!0)}})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/20 rounded-lg",children:e.jsx(Le,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 dark:text-neutral-100",children:"Tasks"})]}),e.jsxs(O,{onClick:M,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Create Task"]})]}),e.jsx(Ra,{tasks:j,loading:A,onEditTask:U,onDeleteTask:f,onCloneTask:Y})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/20 rounded-lg",children:e.jsx(js,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-900 dark:text-neutral-100",children:"Environment Variables"})]}),e.jsxs(O,{onClick:()=>t.current?.addVariable(),children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Add Variable"]})]}),e.jsx(qt,{ref:t,workspace:s})]})]}),e.jsx(zt,{isOpen:r,workspace:s,formData:n,setFormData:d,onSave:l,onCancel:()=>i(!1)}),e.jsx(Os,{isOpen:u,environment:x,formData:y,setFormData:k,onSave:v,onCancel:()=>{F(!1),S(null)},workspace:s}),e.jsx(Va,{isOpen:b,onClose:p,onSave:R,selectedTask:D,formData:T,formErrors:P,setFormData:q}),e.jsx($e,{isOpen:$.isOpen,title:$.title,message:$.message,onConfirm:()=>{$.onConfirm(),V({isOpen:!1,title:"",message:"",onConfirm:()=>{}})},onCancel:()=>V({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),variant:"danger",confirmText:"Delete"})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg text-red-600",children:"Workspace not found"})})}function _a(){const[t,s]=c.useState([]),[a,n]=c.useState(!0),[r,i]=c.useState(null),[o,l]=c.useState({}),[d,m]=c.useState(null),[g,x]=c.useState(!1),[u,y]=c.useState({name:"",description:"",type:Ae.HttpStreaming,path:""}),[k,F]=c.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});c.useEffect(()=>{S()},[]);const S=async()=>{n(!0),i(null);try{const D=await We.getAll();s(D)}catch(D){console.error("Failed to load MCPs:",D),i("Failed to load MCPs. Please try again.")}finally{n(!1)}},v=()=>{m(null),y({name:"",description:"",type:Ae.HttpStreaming,path:""}),l({}),i(null),x(!0)},h=D=>{m(D),y({name:D.name,description:D.description||"",type:D.type,path:D.path}),l({}),i(null),x(!0)},C=()=>{const D={};return u.name.trim()||(D.name="Name is required"),u.type||(D.type="Type is required"),u.path.trim()||(D.path="Path is required"),l(D),Object.keys(D).length===0};return{mcps:t,loading:a,error:r,setError:i,fieldErrors:o,handleFieldErrorClear:D=>{l(b=>{const{[D]:T,...P}=b;return P})},selectedMCP:d,showForm:g,formData:u,setFormData:y,setShowForm:x,setSelectedMCP:m,handleSave:async()=>{if(C())try{if(i(null),l({}),d){const D={name:u.name,description:u.description,type:u.type,path:u.path},b=await We.update(d.id,D);s(T=>T.map(P=>P.id===d.id?b:P))}else{const D={name:u.name,description:u.description,type:u.type,path:u.path},b=await We.create(D);s(T=>[...T,b])}x(!1),m(null)}catch(D){console.error("Failed to save MCP:",D),i("Failed to save MCP. Please try again.")}},handleDelete:async D=>{try{i(null),await We.delete(D),s(b=>b.filter(T=>T.id!==D)),F({isOpen:!1,title:"",message:"",onConfirm:()=>{}})}catch(b){console.error("Failed to delete MCP:",b),i("Failed to delete MCP. Please try again.")}},handleEdit:h,handleCreate:v,confirmDialog:k,setConfirmDialog:F}}const Ka=t=>{switch(t){case Ae.HttpStreaming:return"bg-purple-100 text-purple-800";case Ae.Sse:return"bg-green-100 text-green-800";case Ae.Stdio:return"bg-orange-100 text-orange-800";default:return"bg-neutral-100 text-neutral-800"}},Ja=t=>{switch(t){case Ae.HttpStreaming:return"HTTP Streaming";case Ae.Sse:return"SSE (Server-Sent Events)";case Ae.Stdio:return"STDIO";default:return"Unknown"}};function Ya({mcp:t,onEdit:s,onDelete:a}){return e.jsx("div",{className:"bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(Dt,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-neutral-900 dark:text-neutral-100",children:t.name}),t.description&&e.jsx("div",{className:"space-y-3",children:e.jsx("div",{children:e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-300 mt-1",children:t.description||"No description provided"})})}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Se,{className:Ka(t.type),children:Ja(t.type)}),e.jsx("code",{className:"text-sm bg-neutral-100 dark:bg-neutral-700 text-neutral-800 dark:text-neutral-200 px-2 py-1 rounded break-all",children:t.path})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(t),children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>a(t.id),children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})})}function Qa({isOpen:t,selectedMCP:s,formData:a,error:n,fieldErrors:r={},onFormDataChange:i,onFieldErrorClear:o,onSave:l,onClose:d,onErrorDismiss:m}){return e.jsxs(ue,{isOpen:t,onClose:d,title:s?"Edit MCP":"Add MCP",size:"sm",contentClassName:"p-6",footer:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{onClick:l,children:s?"Update":"Add"}),e.jsx(O,{variant:"ghost",onClick:d,children:"Cancel"})]}),children:[n&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:n}),m&&e.jsx("button",{onClick:m,className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200",children:"×"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:a.name,onChange:g=>{i({...a,name:g.target.value}),r.name&&o&&o("name")},className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${r.name?"border-red-500 dark:border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,placeholder:"Enter MCP name"}),r.name&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:r.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:g=>i({...a,description:g.target.value}),className:"w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100",rows:3,placeholder:"Describe what this MCP does"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Type"}),e.jsxs("select",{value:a.type,onChange:g=>{i({...a,type:+g.target.value}),r.type&&o&&o("type")},className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${r.type?"border-red-500 dark:border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,children:[e.jsx("option",{value:"",children:"Select MCP type"}),e.jsx("option",{value:"1",children:"HTTP Streaming"}),e.jsx("option",{value:"2",children:"SSE (Server-Sent Events)"}),e.jsx("option",{value:"3",children:"STDIO"})]}),r.type&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:r.type})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-neutral-700 dark:text-neutral-300 mb-1",children:"Path"}),e.jsx("input",{type:"text",value:a.path,onChange:g=>{i({...a,path:g.target.value}),r.path&&o&&o("path")},className:`w-full px-3 py-2 border rounded-md bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 ${r.path?"border-red-500 dark:border-red-500 focus:ring-red-500":"border-neutral-300 dark:border-neutral-600"}`,placeholder:"Path to MCP package or executable"}),r.path&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:r.path}),e.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Can be a local path, npm package, or URL"})]})]})]})}function Xa(){const{mcps:t,loading:s,error:a,setError:n,fieldErrors:r,handleFieldErrorClear:i,selectedMCP:o,showForm:l,formData:d,setFormData:m,setShowForm:g,setSelectedMCP:x,handleSave:u,handleDelete:y,handleEdit:k,handleCreate:F,confirmDialog:S,setConfirmDialog:v}=_a();return s?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-lg",children:"Loading MCPs..."})}):e.jsxs("div",{className:"flex flex-col h-full bg-neutral-50 dark:bg-neutral-900",children:[e.jsx("div",{className:"p-6 border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-neutral-900 dark:text-neutral-100",children:"MCPs"}),e.jsx("p",{className:"text-neutral-600 dark:text-neutral-300 mt-1",children:"Model Context Protocols"})]}),e.jsxs(O,{onClick:F,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Add MCP"]})]})}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[a&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-red-700 dark:text-red-300",children:a}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>n(null),className:"text-red-600 dark:text-red-400",children:"×"})]})}),t.length===0&&!s?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:"No MCPs found"}),e.jsxs(O,{onClick:F,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Add your first MCP"]})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:t.map(h=>e.jsx(Ya,{mcp:h,onEdit:k,onDelete:C=>v({isOpen:!0,title:"Delete MCP",message:`Are you sure you want to delete "${h.name}"? This action cannot be undone.`,onConfirm:()=>y(C)})},h.id))})]}),e.jsx(Qa,{isOpen:l,selectedMCP:o,formData:d,error:a,fieldErrors:r,onFormDataChange:m,onFieldErrorClear:i,onSave:u,onClose:()=>{g(!1),x(null),n(null)},onErrorDismiss:()=>n(null)}),e.jsx($e,{isOpen:S.isOpen,title:S.title,message:S.message,onConfirm:()=>{S.onConfirm(),v({isOpen:!1,title:"",message:"",onConfirm:()=>{}})},onCancel:()=>v({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),variant:"danger",confirmText:"Delete"})]})}function Za(){Wt(),As();const{initialize:t,isInitialized:s,isInitializing:a,initError:n}=ht(),{loadSessions:r,loadWorkspaces:i}=xe();return c.useEffect(()=>{t()},[t]),c.useEffect(()=>{s&&(async()=>(await i(),await r(null)))()},[s,r,i]),a?e.jsx("div",{className:"flex items-center justify-center h-screen bg-neutral-50 dark:bg-neutral-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-neutral-600 dark:text-neutral-300",children:"Initializing application..."})]})}):n?e.jsx("div",{className:"flex items-center justify-center h-screen bg-neutral-50 dark:bg-neutral-900",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx("svg",{className:"h-12 w-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 13.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-800 dark:text-neutral-200 mb-2",children:"Initialization Failed"}),e.jsx("p",{className:"text-neutral-600 dark:text-neutral-400 mb-4",children:n}),e.jsx(O,{onClick:()=>window.location.reload(),children:"Retry"})]})}):e.jsx(vs,{children:e.jsxs("div",{className:"flex flex-col h-screen select-none",children:[e.jsx(Ls,{}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs(ws,{children:[e.jsx(De,{path:"/",element:e.jsx(Js,{})}),e.jsx(De,{path:"/session/:sessionId",element:e.jsx(ba,{})}),e.jsx(De,{path:"/backlogs",element:e.jsx(Ca,{})}),e.jsx(De,{path:"/agents",element:e.jsx(Aa,{})}),e.jsx(De,{path:"/workspaces",element:e.jsx(Da,{})}),e.jsx(De,{path:"/workspace/:workspaceId",element:e.jsx(qa,{})}),e.jsx(De,{path:"/mcps",element:e.jsx(Xa,{})}),e.jsx(De,{path:"*",element:e.jsx(Ns,{to:"/",replace:!0})})]})}),e.jsx(Rs,{})]})})}Ss.createRoot(document.getElementById("root")).render(e.jsx(Za,{}));
